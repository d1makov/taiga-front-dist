(function(){var t,b,e,r,n,i,o,S;this.taiga=S={},S.emojis=window.emojis,this.taigaContribPlugins=this.taigaContribPlugins||window.taigaContribPlugins||[],S.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))},S.generateUniqueSessionIdentifier=function(){var t=(new Date).getTime(),e=Math.floor(150994944*Math.random());return S.generateHash([t,e])},S.sessionId=S.generateUniqueSessionIdentifier(),t=function(r,t,e,n,i,o,s,a,c){var u,l,p,d,h,f,g,m,v;return c.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),f=r.when,r.when=function(t,e){return e.resolve||(e.resolve={}),angular.extend(e.resolve,{languageLoad:["$q","$translate",function(t,e){var r=t.defer();return e().then(function(){return r.resolve()}),r.promise}],projectLoaded:["$q","tgProjectService","$route",function(t,e,r){var n,i=t.defer();return e.setSection(null!=(n=r.current.$$route)?n.section:void 0),r.current.params.pslug?e.setProjectBySlug(r.current.params.pslug).then(i.resolve):(e.cleanProject(),i.resolve()),i.promise}]}),f.call(r,t,e)},r.when("/",{templateUrl:"home/home.html",controller:"Home",controllerAs:"vm",loader:!0,title:"HOME.PAGE_TITLE",description:"HOME.PAGE_DESCRIPTION",joyride:"dashboard"}),r.when("/discover",{templateUrl:"discover/discover-home/discover-home.html",controller:"DiscoverHome",controllerAs:"vm",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0}),r.when("/discover/search",{templateUrl:"discover/discover-search/discover-search.html",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0,controller:"DiscoverSearch",controllerAs:"vm",reloadOnSearch:!1}),r.when("/projects/",{templateUrl:"projects/listing/projects-listing.html",access:{requiresLogin:!0},title:"PROJECTS.PAGE_TITLE",description:"PROJECTS.PAGE_DESCRIPTION",loader:!0,controller:"ProjectsListing",controllerAs:"vm"}),r.when("/project/new",{title:"PROJECT.CREATE.TITLE",templateUrl:"projects/create/create-project.html",loader:!0,controller:"CreateProjectCtrl",controllerAs:"vm"}),r.when("/project/new/scrum",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="scrum"></tg-create-project-form>',loader:!0}),r.when("/project/new/kanban",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="kanban"></tg-create-project-form>',loader:!0}),r.when("/project/new/duplicate",{title:"PROJECT.CREATE.TITLE",template:"<tg-duplicate-project></tg-duplicate-project>",loader:!0}),r.when("/project/new/import/:platform?",{title:"PROJECT.CREATE.TITLE",template:"<tg-import-project></tg-import-project>",loader:!0}),r.when("/project/:pslug/",{template:"",loader:!0,controller:"ProjectRouter"}),r.when("/project/:pslug/timeline",{templateUrl:"projects/project/project.html",loader:!0,controller:"Project",controllerAs:"vm",section:"project-timeline"}),r.when("/project/:pslug/t/:ref",{loader:!0,controller:"DetailController",template:""}),r.when("/project/:pslug/search",{templateUrl:"search/search.html",reloadOnSearch:!1,section:"search",loader:!0}),r.when("/project/:pslug/epics",{section:"epics",templateUrl:"epics/dashboard/epics-dashboard.html",loader:!0,controller:"EpicsDashboardCtrl",controllerAs:"vm"}),r.when("/project/:pslug/epic/:epicref",{templateUrl:"epic/epic-detail.html",loader:!0,section:"epics"}),r.when("/project/:pslug/backlog",{templateUrl:"backlog/backlog.html",loader:!0,section:"backlog",joyride:"backlog"}),r.when("/project/:pslug/kanban",{templateUrl:"kanban/kanban.html",loader:!0,section:"kanban",joyride:"kanban"}),r.when("/project/:pslug/taskboard/:sslug",{templateUrl:"taskboard/taskboard.html",loader:!0,section:"backlog"}),r.when("/project/:pslug/us/:usref",{templateUrl:"us/us-detail.html",loader:!0,section:"backlog-kanban"}),r.when("/project/:pslug/task/:taskref",{templateUrl:"task/task-detail.html",loader:!0,section:"backlog-kanban"}),r.when("/project/:pslug/wiki",{redirectTo:function(t){return"/project/"+t.pslug+"/wiki/home"}}),r.when("/project/:pslug/wiki-list",{templateUrl:"wiki/wiki-list.html",loader:!0,section:"wiki"}),r.when("/project/:pslug/wiki/:slug",{templateUrl:"wiki/wiki.html",loader:!0,section:"wiki"}),r.when("/project/:pslug/team",{templateUrl:"team/team.html",loader:!0,section:"team"}),r.when("/project/:pslug/issues",{templateUrl:"issue/issues.html",loader:!0,section:"issues"}),r.when("/project/:pslug/issue/:issueref",{templateUrl:"issue/issues-detail.html",loader:!0,section:"issues"}),r.when("/project/:pslug/admin/project-profile/details",{templateUrl:"admin/admin-project-profile.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/default-values",{templateUrl:"admin/admin-project-default-values.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/modules",{templateUrl:"admin/admin-project-modules.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/export",{templateUrl:"admin/admin-project-export.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/reports",{templateUrl:"admin/admin-project-reports.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/status",{templateUrl:"admin/admin-project-values-status.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/points",{templateUrl:"admin/admin-project-values-points.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/priorities",{templateUrl:"admin/admin-project-values-priorities.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/severities",{templateUrl:"admin/admin-project-values-severities.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/types",{templateUrl:"admin/admin-project-values-types.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/custom-fields",{templateUrl:"admin/admin-project-values-custom-fields.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/tags",{templateUrl:"admin/admin-project-values-tags.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/due-dates",{templateUrl:"admin/admin-project-values-due-dates.html",section:"admin"}),r.when("/project/:pslug/admin/memberships",{templateUrl:"admin/admin-memberships.html",section:"admin"}),r.when("/project/:pslug/admin/roles",{templateUrl:"admin/admin-roles.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/webhooks",{templateUrl:"admin/admin-third-parties-webhooks.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/github",{templateUrl:"admin/admin-third-parties-github.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/gitlab",{templateUrl:"admin/admin-third-parties-gitlab.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/bitbucket",{templateUrl:"admin/admin-third-parties-bitbucket.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/gogs",{templateUrl:"admin/admin-third-parties-gogs.html",section:"admin"}),r.when("/project/:pslug/admin/contrib/:plugin",{templateUrl:"contrib/main.html"}),r.when("/project/:pslug/transfer/:token",{templateUrl:"projects/transfer/transfer-page.html",loader:!0,controller:"Project",controllerAs:"vm"}),r.when("/user-settings/user-profile",{templateUrl:"user/user-profile.html"}),r.when("/user-settings/user-change-password",{templateUrl:"user/user-change-password.html"}),r.when("/user-settings/user-project-settings",{templateUrl:"user/user-project-settings.html"}),r.when("/user-settings/mail-notifications",{templateUrl:"user/mail-notifications.html"}),r.when("/user-settings/live-notifications",{templateUrl:"user/live-notifications.html"}),r.when("/user-settings/web-notifications",{templateUrl:"user/web-notifications.html"}),r.when("/change-email/:email_token",{templateUrl:"user/change-email.html"}),r.when("/verify-email/:email_token",{templateUrl:"user/verify-email.html"}),r.when("/cancel-account/:cancel_token",{templateUrl:"user/cancel-account.html"}),r.when("/user-settings/contrib/:plugin",{templateUrl:"contrib/user-settings.html"}),r.when("/profile",{templateUrl:"profile/profile.html",loader:!0,access:{requiresLogin:!0},controller:"Profile",controllerAs:"vm"}),r.when("/notifications",{templateUrl:"notifications/notifications.html",loader:!0,access:{requiresLogin:!0},controller:"Notifications",controllerAs:"vm"}),r.when("/profile/:slug",{templateUrl:"profile/profile.html",loader:!0,controller:"Profile",controllerAs:"vm"}),r.when("/login",{templateUrl:"auth/login.html",title:"LOGIN.PAGE_TITLE",description:"LOGIN.PAGE_DESCRIPTION",disableHeader:!0,controller:"LoginPage"}),r.when("/register",{templateUrl:"auth/register.html",title:"REGISTER.PAGE_TITLE",description:"REGISTER.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/forgot-password",{templateUrl:"auth/forgot-password.html",title:"FORGOT_PASSWORD.PAGE_TITLE",description:"FORGOT_PASSWORD.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/change-password/:token",{templateUrl:"auth/change-password-from-recovery.html",title:"CHANGE_PASSWORD.PAGE_TITLE",description:"CHANGE_PASSWORD.PAGE_TITLE",disableHeader:!0}),r.when("/invitation/:token",{templateUrl:"auth/invitation.html",title:"INVITATION.PAGE_TITLE",description:"INVITATION.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/external-apps",{templateUrl:"external-apps/external-app.html",title:"EXTERNAL_APP.PAGE_TITLE",description:"EXTERNAL_APP.PAGE_DESCRIPTION",controller:"ExternalApp",controllerAs:"vm",disableHeader:!0,mobileViewport:!0}),r.when("/blocked-project/:pslug/",{templateUrl:"projects/project/blocked-project.html",loader:!0}),r.when("/error",{templateUrl:"error/error.html"}),r.when("/not-found",{templateUrl:"error/not-found.html"}),r.when("/permission-denied",{templateUrl:"error/permission-denied.html"}),r.otherwise({templateUrl:"error/not-found.html"}),t.html5Mode({enabled:!0,requireBase:!1}),d={"Content-Type":"application/json","Accept-Language":window.taigaConfig.defaultLanguage||"en","X-Session-Id":S.sessionId},e.defaults.headers.delete=d,e.defaults.headers.patch=d,e.defaults.headers.post=d,e.defaults.headers.put=d,e.defaults.headers.get={"X-Session-Id":S.sessionId},e.useApplyAsync(!0),i.setSessionId(S.sessionId),u=function(n,i,o,s,a){return{responseError:function(t){var e,r;return 0===t.status||-1===t.status&&!t.config.cancelable?(s.closeAll(),a.error()):401===t.status&&-1===i.url().indexOf("/login")&&(e=i.url(),(r=i.search()).force_next?i.url(o.resolve("login")).search("force_next",r.force_next):i.url(o.resolve("login")).search({unauthorized:!0,next:e})),n.reject(t)}}},n.factory("authHttpIntercept",["$q","$location","$tgNavUrls","lightboxService","tgErrorHandlingService",u]),e.interceptors.push("authHttpIntercept"),h=function(e,r){return{request:function(t){return r.logRequest(),t},requestError:function(t){return r.logResponse(),e.reject(t)},responseError:function(t){return r.logResponse(),e.reject(t)},response:function(t){return r.logResponse(),t}}},n.factory("loaderIntercept",["$q","tgLoader",h]),e.interceptors.push("loaderIntercept"),v=function(e){return{responseError:function(t){return 400===t.status&&t.data.version&&angular.element("body").injector().invoke(["$tgConfirm","$translate",function(t,e){var r=e.instant("ERROR.VERSION_ERROR");return t.notify("error",r,null,1e4)}]),e.reject(t)}}},n.factory("versionCheckHttpIntercept",["$q",v]),e.interceptors.push("versionCheckHttpIntercept"),l=function(e,t){var r=function(){return t.block()};return{response:function(t){return t.data.blocked_code&&r(),t},responseError:function(t){return 451===t.status&&r(),e.reject(t)}}},n.factory("blockingIntercept",["$q","tgErrorHandlingService",l]),e.interceptors.push("blockingIntercept"),o.debugInfoEnabled(window.taigaConfig.debugInfo||!1),localStorage.userInfo&&(m=JSON.parse(localStorage.userInfo)),g=(null!=m?m.lang:void 0)||window.taigaConfig.defaultLanguage||"en",a.addPart("taiga"),s.useLoader("$translatePartialLoader",{urlTemplate:"/"+window._version+"/locales/{part}/locale-{lang}.json"}).useSanitizeValueStrategy("escapeParameters").addInterpolation("$translateMessageFormatInterpolation").preferredLanguage(g),s.fallbackLanguage(g),p=window.getDecorators(),_.each(p,function(t){return n.decorator(t.provider,t.decorator)})},b=function(t,e){var r;return moment.locale(t),"en"!==t&&ljs.load("/"+window._version+"/locales/moment-locales/"+t+".js"),r={defaultMessage:e.instant("COMMON.FORM_ERRORS.DEFAULT_MESSAGE"),type:{email:e.instant("COMMON.FORM_ERRORS.TYPE_EMAIL"),url:e.instant("COMMON.FORM_ERRORS.TYPE_URL"),urlstrict:e.instant("COMMON.FORM_ERRORS.TYPE_URLSTRICT"),number:e.instant("COMMON.FORM_ERRORS.TYPE_NUMBER"),digits:e.instant("COMMON.FORM_ERRORS.TYPE_DIGITS"),dateIso:e.instant("COMMON.FORM_ERRORS.TYPE_DATEISO"),alphanum:e.instant("COMMON.FORM_ERRORS.TYPE_ALPHANUM"),phone:e.instant("COMMON.FORM_ERRORS.TYPE_PHONE")},notnull:e.instant("COMMON.FORM_ERRORS.NOTNULL"),notblank:e.instant("COMMON.FORM_ERRORS.NOT_BLANK"),required:e.instant("COMMON.FORM_ERRORS.REQUIRED"),regexp:e.instant("COMMON.FORM_ERRORS.REGEXP"),min:e.instant("COMMON.FORM_ERRORS.MIN"),max:e.instant("COMMON.FORM_ERRORS.MAX"),range:e.instant("COMMON.FORM_ERRORS.RANGE"),minlength:e.instant("COMMON.FORM_ERRORS.MIN_LENGTH"),maxlength:e.instant("COMMON.FORM_ERRORS.MAX_LENGTH"),rangelength:e.instant("COMMON.FORM_ERRORS.RANGE_LENGTH"),mincheck:e.instant("COMMON.FORM_ERRORS.MIN_CHECK"),maxcheck:e.instant("COMMON.FORM_ERRORS.MAX_CHECK"),rangecheck:e.instant("COMMON.FORM_ERRORS.RANGE_CHECK"),equalto:e.instant("COMMON.FORM_ERRORS.EQUAL_TO"),linewidth:e.instant("COMMON.FORM_ERRORS.LINEWIDTH"),pikaday:e.instant("COMMON.FORM_ERRORS.PIKADAY")},checksley.updateMessages("default",r)},e=function(t,i,o,e,r,n,s,a,c,u,l,p,d,h,f,g,m){var v,y;return t.debug("Initialize application"),i.$on("$translatePartialLoaderStructureChanged",function(){return a.refresh()}),y={linewidth:function(t,e){var r=S.nl2br(t).split("<br />");return _.every(r,function(t){return t.length<e})},pikaday:function(t){var e=a.instant("COMMON.PICKERDATE.FORMAT");return moment(t,e).isValid()},url:function(t){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(t)}},checksley.updateValidators(y),i.contribPlugins=this.taigaContribPlugins,i.adminPlugins=_.filter(this.taigaContribPlugins,{type:"admin"}),i.userSettingsPlugins=_.filter(this.taigaContribPlugins,{type:"userSettings"}),i.$on("$translateChangeEnd",function(t,e){var r,n=e.language;return b(n,a),r=g.get("rtlLanguages",[]),i.isRTL=-1<r.indexOf(n)}),Promise.setScheduler(function(t){return i.$evalAsync(t)}),e.setupConnection(),o.isAuthenticated()&&(o.getUser(),o.showTerms()),r.initialize(),n.initialize(),s.initialize(),s.identify(),i.$on("$locationChangeStart",function(t){if(h.init(),f.getLightboxOpen().length)return t.preventDefault(),f.closeAll()}),v=i.$on("$routeChangeStart",function(t,e){return e.loader&&p.start(!0),v()}),i.$on("$routeChangeSuccess",function(t,e){var r,n,i;return null!=(n=m.project)&&n.get("blocked_code")&&h.block(),e.loader&&p.start(!0),e.access&&e.access.requiresLogin&&(o.isAuthenticated()||c.path(u.resolve("login"))),(e.title||e.description)&&(i=a.instant(e.title||""),r=a.instant(e.description||""),l.setAll(i,r)),e.mobileViewport?l.addMobileViewport():l.removeMobileViewport(),e.disableHeader?d.disableHeader():d.enableHeader()})},angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),o=_.filter(this.taigaContribPlugins,function(t){return t.module}),i=_.map(o,function(t){return t.module}),n=["taigaBase","taigaCommon","taigaResources","taigaResources2","taigaAuth","taigaEvents","taigaHome","taigaNavigationBar","taigaProjects","taigaRelatedTasks","taigaBacklog","taigaTaskboard","taigaKanban","taigaIssues","taigaUserStories","taigaTasks","taigaTeam","taigaWiki","taigaSearch","taigaAdmin","taigaProject","taigaUserSettings","taigaFeedback","taigaPlugins","taigaIntegrations","taigaComponents","taigaProfile","taigaHome","taigaUserTimeline","taigaExternalApps","taigaDiscover","taigaHistory","taigaNotifications","taigaWikiHistory","taigaEpics","taigaUtils","templates","ngSanitize","ngRoute","ngAnimate","ngAria","pascalprecht.translate","infinite-scroll","tgRepeat"].concat(i),(r=angular.module("taiga",n)).config(["$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider",t]),r.run(["$log","$rootScope","$tgAuth","$tgEvents","$tgAnalytics","$tgTagManager","$tgUserPilot","$translate","$tgLocation","$tgNavUrls","tgAppMetaService","tgLoader","tgNavigationBarService","tgErrorHandlingService","lightboxService","$tgConfig","tgProjectService",e])}).call(this),function(){function t(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};function s(){return s.__super__.constructor.apply(this,arguments)}function a(){return this.onInitialDataError=o(this.onInitialDataError,this),a.__super__.constructor.apply(this,arguments)}t(s,e=function(){}),n=s,t(a,e),a.prototype.onInitialDataError=function(t){return t&&(404===t.status?this.errorHandlingService.notfound():403===t.status&&this.errorHandlingService.permissionDenied()),this.q.reject(t)},r=a,this.taiga.Base=e,this.taiga.Service=n,this.taiga.Controller=r}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},d=[].slice,h={}.hasOwnProperty,f=function(t,e){return t.classList?t.classList.add(e):t.className+=" "+e},g=function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},m=function(t){var r=_.keys(t),n=[];return _.forIn(t,function(t,e){if(p.call(r,e)<0&&_.isFunction(t))return n.push(e)}),_.bindAll(t,n)},v=function(t,e,r){var n,i=t.$eval(e);return void 0!==i?r(i):(n=null,n=t.$watch(e,function(t){if(void 0!==t)return r(t),n?n():void 0}))},y=function(){var t,e,r,n,i,o,s;function a(){return a.__super__.constructor.apply(this,arguments)}for(e=arguments[0],i=2<=arguments.length?d.call(arguments,1):[],function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,e),t=a,r=i.length-1;0<=r;r+=-1)for(o in s=i[r].prototype)n=s[o],t.prototype[o]=n;return t},b=function(t,e){return _.trim(t,e)},S=function(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")},j=function(t){return t?_.capitalize(t.replace(/-/g," ")):t},k=function(t,e){var r,n=t.data("nextTextPosition");return(null==n||n>=e.length)&&(n=0),r=e[n],t.data("nextTextPosition",n+1),t.text(r)},$=function(t,e){for(var r,n={},i=0,o=t.length;i<o;i++)n[e(r=t[i])]=r;return n},I=function(t,e){return window.setTimeout(e,t)},E=function(t){return window.clearTimeout(t)},T=function(t,e){return _.defer(function(){return t.$apply(e)})},C=function(t){return _.isNumber(t)?t+"":_.isString(t)?t:_.isPlainObject(t)?JSON.stringify(t):_.isUndefined(t)?"":t.toString()},P=function(t,e){return e.join(t)},w=function(t,e){return _.debounce(e,t,{leading:!0,trailing:!1})},A=function(t,e){return _.debounce(e,t,{leading:!1,trailing:!0})},O=function(t,e){return _.startsWith(t,e)},R=function(t,e,r){var n;return null==r&&(r="..."),"string"==typeof t||t instanceof String?((n=t.slice(0)).length>e&&(n=(n=n.substring(0,e+1)).substring(0,Math.min(n.length,n.lastIndexOf(" "))),n+=r),n):t},M=function(t,e){var r,n;return null==e&&(e=1),isNaN(parseFloat(t))||!isFinite(t)?"-":0===t?"0 bytes":(n=["bytes","KB","MB","GB","TB","PB"],5<(r=Math.floor(Math.log(t)/Math.log(1024)))&&(r=5),(t/Math.pow(1024,r)).toFixed(e)+" "+n[r])},U=function(t,e){var r;return e?(r=new RegExp("<(?!"+e+"s*/?)[^>]+>","gi"),String(t).replace(r,"")):String(t).replace(/<\/?[^>]+>/g,"")},D=function(t,e,r){var n=new RegExp("<("+e+")>","gi");return t=t.replace(n,"<"+r+">"),n=new RegExp("</("+e+")>","gi"),t=t.replace(n,"</"+r+">")},N=function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t;if(!_.isFunction(r))throw"defineImmutableProperty third param must be a function";if((t=r())&&_.isObject(t)&&void 0===t.size)throw"defineImmutableProperty must return immutable data";return t}})};_.mixin({removeKeys:function(t,e){return _.chain([e]).flatten().reduce(function(t,e){return delete t[e],t},t).value()},cartesianProduct:function(){return _.reduceRight(arguments,function(t,r){return _.flatten(_.map(t,function(e){return _.map(r,function(t){return[t].concat(e)})}),!0)},[[]])}}),o=function(t){return null!==t.match(/\.(jpe?g|png|gif|gifv|webm|svg|psd)/i)},i=function(t){return null!=t&&null!==t.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},s=function(t){return null!==t.match(/\.(pdf)/i)},c=function(r,t){var n={};return t.forEach(function(t,e){if(t!==r.get(e))return t.toJS?n[e]=t.toJS():n[e]=t}),n},t=["#fce94f","#edd400","#c4a000","#8ae234","#73d216","#4e9a06","#d3d7cf","#fcaf3e","#f57900","#ce5c00","#729fcf","#3465a4","#204a87","#888a85","#ad7fa8","#75507b","#5c3566","#ef2929","#cc0000","#a40000","#222222"],n=function(){return _.sample(t)},e=function(){return _.clone(t)},r=function(t,e,r){var n,i;for(r=r||1,i=[],0;n=e.exec(t);)-1===r?i.push(n):i.push(n[r]);return i},u=function(t,e){var r=e-t;return t+Math.floor(Math.random()*(1+r))},a=function(t){var e=t;return e=(e=(e=(e=(e=e.replace("Á","A").replace("Ä","A").replace("À","A")).replace("É","E").replace("Ë","E").replace("È","E")).replace("Í","I").replace("Ï","I").replace("Ì","I")).replace("Ó","O").replace("Ö","O").replace("Ò","O")).replace("Ú","U").replace("Ü","U").replace("Ù","U")},(l=this.taiga).addClass=f,l.nl2br=g,l.bindMethods=m,l.bindOnce=v,l.mixOf=y,l.trim=b,l.slugify=S,l.unslugify=j,l.toggleText=k,l.groupBy=$,l.timeout=I,l.cancelTimeout=E,l.scopeDefer=T,l.toString=C,l.joinStr=P,l.truncate=R,l.debounce=w,l.debounceLeading=A,l.startswith=O,l.sizeFormat=M,l.stripTags=U,l.replaceTags=D,l.defineImmutableProperty=N,l.isImage=o,l.isEmail=i,l.isPdf=s,l.patch=c,l.getRandomDefaultColor=n,l.getDefaulColorList=e,l.getMatches=r,l.randomInt=u,l.normalizeString=a}.call(this),function(){var i,a,c,u;function t(){}function e(){}function r(){}c=this.taiga,i=this.taiga.groupBy,a=this.taiga.joinStr,u=this.taiga.trim,this.taiga.toString,t.prototype.fillUsersAndRoles=function(t,e){var r,n=_.filter(t,function(t){return t.is_active});return this.scope.activeUsers=_.sortBy(n,"full_name_display"),this.scope.activeUsersById=i(this.scope.activeUsers,function(t){return t.id}),this.scope.users=_.sortBy(t,"full_name_display"),this.scope.usersById=i(t,function(t){return t.id}),this.scope.roles=_.sortBy(e,"order"),r=_(this.scope.project.members).map("role").uniq().value(),this.scope.computableRoles=_(e).filter("computable").filter(function(t){return _.includes(r,t.id)}).value()},t.prototype.loadUsersAndRoles=function(){var n;return this.q.all([this.rs.projects.usersList(this.scope.projectId),this.rs.projects.rolesList(this.scope.projectId)]).then((n=this,function(t){var e=t[0],r=t[1];return n.fillUsersAndRoles(e,r),t}))},c.PageMixin=t,e.prototype.excludePrefix="exclude_",e.prototype.selectFilter=function(t,e,r,n){var i,o;if(null==r&&(r=!1),null==n&&(n="include"),o=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==o[t]&&"page"!==t&&((i=_.map(c.toString(o[t]).split(","),function(t){return u(t)})).push(c.toString(e)),i=_.compact(i),e=a(",",_.uniq(i))),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.replaceFilter=function(t,e,r){if(null==r&&(r=!1),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.replaceAllFilters=function(t,e){return null==e&&(e=!1),(e?this.location:this.location.noreload(this.scope)).search(t)},e.prototype.unselectFilter=function(t,e,r,n){var i,o,s;if(null==r&&(r=!1),null==n&&(n="include"),o=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==o[t])return null==e&&delete o[t],s=_.map(c.toString(o[t]).split(","),function(t){return u(t)}),i=_.reject(s,function(t){return t===c.toString(e)}),i=_.compact(i),e=_.isEmpty(i)?null:a(",",_.uniq(i)),(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.applyStoredFilters=function(t,e){var r;return!(!_.isEmpty(this.location.search())||(r=this.getFilters(t,e),!Object.keys(r).length))&&(this.location.search(r),this.location.replace(),!0)},e.prototype.storeFilters=function(t,e,r){var n=t+":"+r,i=c.generateHash([t,n]);return this.storage.set(i,e)},e.prototype.getFilters=function(t,e){var r=t+":"+e,n=c.generateHash([t,r]);return this.storage.get(n)||{}},e.prototype.formatSelectedFilters=function(e,t,r,n){var i,o,s,a,c;return null==n&&(n="include"),a=r.split(","),s=_.filter(t,function(t){return-1!==a.indexOf(_.toString(t.id))}),o=_.filter(a,function(e){return!_.find(s,function(t){return _.toString(t.id)===e})}),i=_.map(o,function(t){return{id:t,key:e+":"+t,dataType:e,name:t,mode:n}}),c=_.map(s,function(t){return{id:t.id,key:e+":"+t.id,dataType:e,name:t.name,color:t.color,mode:n}}),i.concat(c)},c.FiltersMixin=e,r.prototype.excludePrefix="exclude_",r.prototype.filterCategories=["tags","status","assigned_users","assigned_to","owner","epic","role"],r.prototype.changeQ=function(t){return this.replaceFilter("q",t),this.filtersReloadContent(),this.generateFilters()},r.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},r.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},r.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.filtersReloadContent(),this.generateFilters()},r.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.location.search(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,n.storeCustomFiltersName).then(n.generateFilters)}))},r.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,r.storeCustomFiltersName).then(r.generateFilters),r.generateFilters()}));var r},r.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},r.prototype.generateFilters=function(t){var u,e,l,r,p,n,i,d;for(this.storeFilters(this.params.pslug,this.location.search(),this.storeFiltersName),i=this.location.search(),(p={}).project=this.scope.projectId,p.q=i.q,e=0,r=(n=this.filterCategories).length;e<r;e++)l=n[e],u=this.excludePrefix.concat(l),p[l]=i[l],p[u]=i[u];return t&&(p.milestone=t),this.q.all([this.rs.userstories.filtersData(p),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName)]).then((d=this,function(t){var e,r,n,i,o,s=t[0],a=t[1],c={};for(c.status=_.map(s.statuses,function(t){return t.id=t.id.toString(),t}),c.tags=_.map(s.tags,function(t){return t.id=t.name,t}),o=_.filter(c.tags,function(t){return 0<t.count}),c.assigned_users=_.map(s.assigned_users,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),c.assigned_to=_.map(s.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),c.role=_.map(s.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),c.owner=_.map(s.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),c.epic=_.map(s.epics,function(t){return t.id?(t.id=t.id.toString(),t.name="#"+t.ref+" "+t.subject):(t.id="null",t.name="Not in an epic"),t}),d.selectedFilters=[],e=0,r=(n=d.filterCategories).length;e<r;e++)l=n[e],u=d.excludePrefix.concat(l),p[l]&&(i=d.formatSelectedFilters(l,c[l],p[l]),d.selectedFilters=d.selectedFilters.concat(i)),p[u]&&(i=d.formatSelectedFilters(l,c[l],p[u],"exclude"),d.selectedFilters=d.selectedFilters.concat(i));return d.filterQ=p.q,d.filters=[{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:c.status},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:c.tags,hideEmpty:!0,totalTaggedElements:o.length},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_USERS"),dataType:"assigned_users",content:c.assigned_users},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:c.role},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:c.owner},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.EPIC"),dataType:"epic",content:c.epic}],d.customFilters=[],_.forOwn(a,function(t,e){return d.customFilters.push({id:e,name:e,filter:t})})}))},c.UsFiltersMixin=r}.call(this),function(){angular.module("taigaAdmin",[])}.call(this),function(){var t,e,r,n,i,o,s,a,c,j,u,l,p={}.hasOwnProperty;function d(t,e,r,n,i){var o;t.isAuthenticated()&&(n.force_login||(o=r.resolve("home"),n.next&&(o=decodeURIComponent(n.next),e.search("next",null)),n.unauthorized?(i.clear(),i.removeToken()):e.url(o)))}function f(t,e,r,n,i,o,s,a,c,u,l,p,d){var h;this.rootscope=t,this.storage=e,this.model=r,this.rs=n,this.http=i,this.urls=o,this.config=s,this.userpilot=a,this.translate=c,this.currentUserService=u,this.themeService=l,this.analytics=p,this.termsAnnouncementService=d,f.__super__.constructor.call(this),h=this.getUser(),this._currentTheme=this._getUserTheme(),this.setUserdata(h)}l=this.taiga,j=this.taiga.debounce,u=angular.module("taigaAuth",["taigaResources"]),d.$inject=["tgCurrentUserService","$location","$tgNavUrls","$routeParams","$tgAuth"],u.controller("LoginPage",d),function(t,e){for(var r in e)p.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(f,l.Service),f.$inject=["$rootScope","$tgStorage","$tgModel","$tgResources","$tgHttp","$tgUrls","$tgConfig","$tgUserPilot","$translate","tgCurrentUserService","tgThemeService","$tgAnalytics","tgTermsAnnouncementService"],f.prototype.setUserdata=function(t){return t?(this.userData=Immutable.fromJS(t.getAttrs()),this.currentUserService.setUser(this.userData)):this.userData=null,this.analytics.setUserId()},f.prototype._getUserTheme=function(){var t,e,r=this.config.get("defaultTheme")||"taiga";return _.includes(this.config.get("themes"),null!=(t=this.rootscope.user)?t.theme:void 0)?null!=(e=this.rootscope.user)?e.theme:void 0:r},f.prototype._setTheme=function(){var t=this._getUserTheme();if(this._currentTheme!==t)return this._currentTheme=t,this.themeService.use(this._currentTheme)},f.prototype._setLocales=function(){var t,e=(null!=(t=this.rootscope.user)?t.lang:void 0)||this.config.get("defaultLanguage")||"en";return this.translate.preferredLanguage(e),this.translate.use(e)},f.prototype.getUser=function(){var t,e;return this.rootscope.user?this.rootscope.user:(e=this.storage.get("userInfo"))?(t=this.model.make_model("users",e),this.rootscope.user=t,this._setLocales(),this._setTheme(),t):(this._setTheme(),null)},f.prototype.setUser=function(t){return this.rootscope.auth=t,this.storage.set("userInfo",t.getAttrs()),this.rootscope.user=t,this.setUserdata(t),this._setLocales(),this._setTheme()},f.prototype.clear=function(){return this.rootscope.auth=null,this.rootscope.user=null,this.storage.remove("userInfo")},f.prototype.setToken=function(t){return this.storage.set("token",t)},f.prototype.getToken=function(){return this.storage.get("token")},f.prototype.removeToken=function(){return this.storage.remove("token")},f.prototype.isAuthenticated=function(){return null!==this.getUser()},f.prototype.refresh=function(){var n,t=this.urls.resolve("user-me");return this.http.get(t).then((n=this,function(t,e){var r=t.data;return r.token=n.getUser().auth_token,r=n.model.make_model("users",r),n.setUser(r),n.rootscope.$broadcast("auth:refresh",r),r}))},f.prototype.login=function(t,e){var n,r=this.urls.resolve("auth");return(t=_.clone(t,!1)).type=e||"normal",this.removeToken(),this.http.post(r,t).then((n=this,function(t,e){var r=n.model.make_model("users",t.data);return n.setToken(r.auth_token),n.setUser(r),n.rootscope.$broadcast("auth:login",r),r}))},f.prototype.logout=function(){return this.removeToken(),this.clear(),this.currentUserService.removeUser(),this._setTheme(),this._setLocales(),this.rootscope.$broadcast("auth:logout"),this.analytics.setUserId()},f.prototype.register=function(t,e,r){var n,i=this.urls.resolve("auth-register");return(t=_.clone(t,!1)).type=e||"public","private"===e&&(t.existing=r||!1),this.removeToken(),this.http.post(i,t).then((n=this,function(t){var e=n.model.make_model("users",t.data);return n.setToken(e.auth_token),n.setUser(e),n.rootscope.$broadcast("auth:register",e),e}))},f.prototype.getInvitation=function(t){return this.rs.invitations.get(t)},f.prototype.acceptInvitiationWithNewUser=function(t){return this.register(t,"private",!1)},f.prototype.forgotPassword=function(t){var e=this.urls.resolve("users-password-recovery");return t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},f.prototype.changePasswordFromRecovery=function(t){var e=this.urls.resolve("users-change-password-from-recovery");return t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},f.prototype.changeEmail=function(t){var e=this.urls.resolve("users-change-email");return t=_.clone(t,!1),this.http.post(e,t)},f.prototype.cancelAccount=function(t){var e=this.urls.resolve("users-cancel-account");return t=_.clone(t,!1),this.http.post(e,t)},f.prototype.exportProfile=function(){var t=this.urls.resolve("users-export");return this.http.post(t)},f.prototype.showTerms=function(t){var e=this.getUser();if(e&&!e.read_new_terms)return this.termsAnnouncementService.show()},f.prototype.sendVerificationEmail=function(){var t=this.urls.resolve("user-send-verification-email");return this.http.post(t)},u.service("$tgAuth",f),s=function(e,r,n,t){var i=t.get("auth/login-text.html",!0);return{restrict:"AE",scope:{},template:function(){var t;return e.get("publicRegisterEnabled")?(t=r.resolve("register"),n.force_next&&(t+="?next="+encodeURIComponent(n.force_next)),i({url:t})):""}}},u.directive("tgPublicRegisterMessage",["$tgConfig","$tgNavUrls","$routeParams","$tgTemplate",s]),o=function(a,c,u,l,p,d,h,f,g,m){return{link:function(r,n,t){var i,o,e,s=new checksley.Form(n.find("form.login-form"));return r.defaultLoginEnabled=l.get("defaultLoginEnabled",!0),p.next&&p.next!==d.resolve("login")?r.nextUrl=decodeURIComponent(p.next):r.nextUrl=d.resolve("home"),p.force_next&&(r.nextUrl=decodeURIComponent(p.force_next)),o=function(t){return h.setupConnection(),m.trackEvent("auth","login","user login",1),a.showTerms(),0===r.nextUrl.indexOf("http")?g.location.href=r.nextUrl:u.url(r.nextUrl)},i=function(t){return c.notify("light-error",f.instant("LOGIN_FORM.ERROR_AUTH_INCORRECT"))},r.onKeyUp=function(t){var e=angular.element(t.currentTarget).val();if(r.iscapsLockActivated=!1,e!==e.toLowerCase())return r.iscapsLockActivated=!0},e=j(2e3,function(t){var e,r;if(t.preventDefault(),s.validate())return e={username:n.find("form.login-form input[name=username]").val(),password:n.find("form.login-form input[name=password]").val()},r=l.get("loginFormType","normal"),a.login(e,r).then(o,i)}),n.on("submit","form",e),window.prerenderReady=!0,r.$on("$destroy",function(){return n.off()})}}},u.directive("tgLogin",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgEvents","$translate","$window","$tgAnalytics",o]),a=function(a,c,u,l,p,d,h,f,g){return{link:function(e,t,r){var n,i,o,s;return p.get("publicRegisterEnabled")||(u.path(l.resolve("not-found")),u.replace()),e.data={},n=t.find("form").checksley({onlyOneErrorElement:!0}),d.next&&d.next!==l.resolve("login")?e.nextUrl=decodeURIComponent(d.next):e.nextUrl=l.resolve("home"),o=function(t){return h.trackEvent("auth","register","user registration",1),0===e.nextUrl.indexOf("http")?g.location.href=e.nextUrl:u.url(e.nextUrl)},i=function(t){var e;return t.data._error_message&&(e=f.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),c.notify("light-error",e)),n.setErrors(t.data)},s=j(2e3,function(t){if(t.preventDefault(),n.validate())return a.register(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()}),window.prerenderReady=!0}}},u.directive("tgRegister",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$tgConfig","$routeParams","$tgAnalytics","$translate","$window",a]),c=function(){return{}},u.directive("tgRegisterOptions",[c]),n=function(a,c,u,l,p){return{link:function(e,t,r){var n,i,o,s;return e.data={},n=t.find("form").checksley(),o=function(t){var e,r;return u.path(l.resolve("login")),r=p.instant("FORGOT_PASSWORD_FORM.SUCCESS_TITLE"),e=p.instant("FORGOT_PASSWORD_FORM.SUCCESS_TEXT"),c.success(r,e)},i=function(t){var e=p.instant("FORGOT_PASSWORD_FORM.ERROR");return c.notify("light-error",e)},s=j(2e3,function(t){if(t.preventDefault(),n.validate())return a.forgotPassword(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()}),window.prerenderReady=!0}}},u.directive("tgForgotPassword",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$translate",n]),r=function(c,u,l,p,d,h){return{link:function(e,t,r){var n,i,o,s,a;return e.data={},null!=p.token?(e.tokenInParams=!0,e.data.token=p.token):(l.path(d.resolve("login")),a=h.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),u.notify("light-error",a)),n=t.find("form").checksley(),o=function(t){return l.path(d.resolve("login")),a=h.instant("CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS"),u.success(a)},i=function(t){return a=h.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),u.notify("light-error",a)},s=j(2e3,function(t){if(t.preventDefault(),n.validate())return c.changePasswordFromRecovery(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()})}}},u.directive("tgChangePasswordFromRecovery",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",r]),i=function(h,f,g,m,v,y,_,b,S){return{link:function(n,t,e){var i,o,r,s,a,c,u,l,p=v.token,d=h.getInvitation(p);return d.then(function(t){return n.invitation=t,n.publicRegisterEnabled=S.get("publicRegisterEnabled")}),d.then(null,function(t){var e;return g.path(y.resolve("login")),e=b.instant("INVITATION_LOGIN_FORM.NOT_FOUND"),f.notify("light-error",e)}),n.dataLogin={token:p},i=t.find("form.login-form").checksley({onlyOneErrorElement:!0}),s=function(t){var e;return _.trackEvent("auth","invitationAccept","invitation accept with existing user",1),g.path(y.resolve("project",{project:n.invitation.project_slug})),e=b.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:n.invitation.project_name}),f.notify("success",e)},o=function(t){return f.notify("light-error",t.data._error_message)},u=j(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return r=m.get("loginFormType","normal"),e=n.dataLogin,(d=h.login({username:e.username,password:e.password,invitation_token:e.token},r)).then(s,o)}),t.on("submit","form.login-form",u),t.on("click",".button-login",u),n.dataRegister={token:p},c=t.find("form.register-form").checksley({onlyOneErrorElement:!0}),a=function(t){var e;return _.trackEvent("auth","invitationAccept","invitation accept with new user",1),g.path(y.resolve("project",{project:n.invitation.project_slug})),e=b.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:n.invitation.project_name}),f.notify("success",e)},r=function(t){var e;return t.data._error_message&&(e=b.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),f.notify("light-error",e)),c.setErrors(t.data)},l=j(2e3,function(t){if(t.preventDefault(),c.validate())return(d=h.acceptInvitiationWithNewUser(n.dataRegister)).then(a,r)}),t.on("submit","form.register-form",l),t.on("click",".button-register",l),n.$on("$destroy",function(){return t.off()})}}},u.directive("tgInvitation",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgAnalytics","$translate","$tgConfig",i]),e=function(a,t,c,u,l,p,d,h){return{link:function(t,e,r){var n,i,o,s;return t.data={},t.data.email_token=p.email_token,n=e.find("form").checksley(),o=function(t){var e;return c.isAuthenticated()?(a.queryOne("users",c.getUser().id).then(function(t){return c.setUser(t)}),l.url(d.resolve("home"))):l.url(d.resolve("login")),e=h.instant("CHANGE_EMAIL_FORM.SUCCESS"),u.success(e)},i=function(t){var e=h.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message});return u.notify("light-error",e)},s=function(){if(n.validate())return c.changeEmail(t.data).then(o,i)},e.on("submit",function(t){return t.preventDefault(),s()}),e.on("click","a.button-change-email",function(t){return t.preventDefault(),s()}),t.$on("$destroy",function(){return e.off()})}}},u.directive("tgChangeEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",e]),t=function(t,e,a,c,u,l,p){return{link:function(e,t,r){var n,i,o,s;return e.data={},e.data.cancel_token=l.cancel_token,n=t.find("form").checksley(),o=function(t){var e;return a.logout(),u.path(p.resolve("home")),e=$translate.instant("CANCEL_ACCOUNT.SUCCESS"),c.success(e)},i=function(t){var e=$translate.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message});return c.notify("error",e)},s=j(2e3,function(t){if(t.preventDefault(),n.validate())return a.cancelAccount(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()})}}},u.directive("tgCancelAccount",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls",t])}.call(this),function(){angular.module("taigaBacklog",[])}.call(this),function(){this.taiga,this.taiga.groupBy,this.taiga.bindOnce;var t,r,e=angular.module("taigaBase",[]),n=function(n,i){return{link:function(t,e,r){return i.onresize=function(){return n.$broadcast("resize")}}}};e.directive("tgMain",["$rootScope","$window",n]),r={home:"/",projects:"/projects",error:"/error","not-found":"/not-found","permission-denied":"/permission-denied",discover:"/discover","discover-search":"/discover/search",login:"/login","forgot-password":"/forgot-password","change-password":"/change-password/:token","change-email":"/change-email/:token","verified-email":"/change-email/:token","cancel-account":"/cancel-account/:token",register:"/register",invitation:"/invitation/:token","create-project":"/project/new","create-project-scrum":"/project/new/scrum","create-project-kanban":"/project/new/kanban","create-project-duplicate":"/project/new/duplicate","create-project-import":"/project/new/import","create-project-import-platform":"/project/new/import/:platform",profile:"/profile","user-profile":"/profile/:username","blocked-project":"/blocked-project/:project",project:"/project/:project","project-detail-ref":"/project/:project/t/:ref","project-backlog":"/project/:project/backlog","project-taskboard":"/project/:project/taskboard/:sprint","project-kanban":"/project/:project/kanban","project-issues":"/project/:project/issues","project-epics":"/project/:project/epics","project-search":"/project/:project/search","project-timeline":"/project/:project/timeline","project-epics-detail":"/project/:project/epic/:ref","project-userstories-detail":"/project/:project/us/:ref","project-tasks-detail":"/project/:project/task/:ref","project-issues-detail":"/project/:project/issue/:ref","project-wiki":"/project/:project/wiki","project-wiki-list":"/project/:project/wiki-list","project-wiki-page":"/project/:project/wiki/:slug","project-team":"/project/:project/team","project-admin-home":"/project/:project/admin/project-profile/details","project-admin-project-profile-details":"/project/:project/admin/project-profile/details","project-admin-project-profile-default-values":"/project/:project/admin/project-profile/default-values","project-admin-project-profile-modules":"/project/:project/admin/project-profile/modules","project-admin-project-profile-export":"/project/:project/admin/project-profile/export","project-admin-project-profile-reports":"/project/:project/admin/project-profile/reports","project-admin-project-values-status":"/project/:project/admin/project-values/status","project-admin-project-values-points":"/project/:project/admin/project-values/points","project-admin-project-values-priorities":"/project/:project/admin/project-values/priorities","project-admin-project-values-severities":"/project/:project/admin/project-values/severities","project-admin-project-values-types":"/project/:project/admin/project-values/types","project-admin-project-values-custom-fields":"/project/:project/admin/project-values/custom-fields","project-admin-project-values-tags":"/project/:project/admin/project-values/tags","project-admin-project-values-due-dates":"/project/:project/admin/project-values/due-dates","project-admin-memberships":"/project/:project/admin/memberships","project-admin-roles":"/project/:project/admin/roles","project-admin-third-parties-webhooks":"/project/:project/admin/third-parties/webhooks","project-admin-third-parties-github":"/project/:project/admin/third-parties/github","project-admin-third-parties-gitlab":"/project/:project/admin/third-parties/gitlab","project-admin-third-parties-bitbucket":"/project/:project/admin/third-parties/bitbucket","project-admin-third-parties-gogs":"/project/:project/admin/third-parties/gogs","project-admin-contrib":"/project/:project/admin/contrib/:plugin","user-settings-user-profile":"/user-settings/user-profile","user-settings-user-change-password":"/user-settings/user-change-password","user-settings-user-avatar":"/user-settings/user-avatar","user-settings-user-project-settings":"/user-settings/user-project-settings","user-settings-mail-notifications":"/user-settings/mail-notifications","user-settings-live-notifications":"/user-settings/live-notifications","user-settings-web-notifications":"/user-settings/web-notifications","user-settings-contrib":"/user-settings/contrib/:plugin",notifications:"/notifications"},t=function(t,e){return t.debug("Initialize navigation urls"),e.update(r)},e.run(["$log","$tgNavUrls",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m=[].slice,v={}.hasOwnProperty;function y(t,e,r,n){this.qqueue=t,this.repo=e,this.q=r,this.model=n}g=this.taiga,s=function(n,i,o){return{get:function(){var t=o.getUser(),e=(null!=t?t.lang:void 0)||n.preferredLanguage(),r=-1<i.get("rtlLanguages",[]).indexOf(e);return{i18n:{previousMonth:n.instant("COMMON.PICKERDATE.PREV_MONTH"),nextMonth:n.instant("COMMON.PICKERDATE.NEXT_MONTH"),months:[n.instant("COMMON.PICKERDATE.MONTHS.JAN"),n.instant("COMMON.PICKERDATE.MONTHS.FEB"),n.instant("COMMON.PICKERDATE.MONTHS.MAR"),n.instant("COMMON.PICKERDATE.MONTHS.APR"),n.instant("COMMON.PICKERDATE.MONTHS.MAY"),n.instant("COMMON.PICKERDATE.MONTHS.JUN"),n.instant("COMMON.PICKERDATE.MONTHS.JUL"),n.instant("COMMON.PICKERDATE.MONTHS.AUG"),n.instant("COMMON.PICKERDATE.MONTHS.SEP"),n.instant("COMMON.PICKERDATE.MONTHS.OCT"),n.instant("COMMON.PICKERDATE.MONTHS.NOV"),n.instant("COMMON.PICKERDATE.MONTHS.DEC")],weekdays:[n.instant("COMMON.PICKERDATE.WEEK_DAYS.SUN"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.MON"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.TUE"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.WED"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.THU"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.FRI"),n.instant("COMMON.PICKERDATE.WEEK_DAYS.SAT")],weekdaysShort:[n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI"),n.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT")]},isRTL:r,firstDay:parseInt(n.instant("COMMON.PICKERDATE.FIRST_DAY_OF_WEEK"),10),format:n.instant("COMMON.PICKERDATE.FORMAT")}}}},(f=angular.module("taigaCommon",[])).factory("tgDatePickerConfigService",["$translate","$tgConfig","$tgAuth",s]),l=function(t,e){return{get:function(){return t.getSelection?t.getSelection().toString():e.selection?e.selection.createRange().text:""}}},f.factory("$selectedText",["$window","$document",l]),(n=function(s){var a=function(t,e,r){if(e&&r&&-1<e.get("my_permissions").indexOf(r))return t.removeClass("hidden")};return{link:function(t,e,r){var n,i,o;return e.addClass("hidden"),n=r.tgCheckPermission,o=t.$watch(function(){return s.project},function(){if(s.project)return a(e,s.project,n),o()}),i=r.$observe("tgCheckPermission",function(t){if(t)return a(e,s.project,t),i()}),t.$on("$destroy",function(){return e.off()})}}}).$inject=["tgProjectService"],f.directive("tgCheckPermission",n),i=function(){return{link:function(o,i,s){var a,c=function(t,e,r){var n="!"===r[0];return n&&(r=r.slice(1)),!(n&&-1===t.my_permissions.indexOf(r)||!n&&-1!==t.my_permissions.indexOf(r))?i.removeClass(e):i.addClass(e)},t=function(t){var e,r,n,i;if(t){for(e in a(),i=[],r=o.$eval(s.tgClassPermission))n=r[e],i.push(c(t,e,n));return i}};return a=o.$watch("project",t)}}},f.directive("tgClassPermission",i),t=function(){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,o=function(t){if(s.shift()(),s.length)return i(o)},s=[];return{add:function(){for(var t,e=[],r=0,n=arguments.length;r<n;r++)t=arguments[r],s.push(t),1===s.length?e.push(i(o)):e.push(void 0);return e}}},f.factory("animationFrame",t),h=function(){return{link:function(t,e,r){return e.find("textarea").on("focus",function(){return e.addClass("active")})}}},f.directive("tgToggleComment",h),c=function(r){return{get:function(t){var e;return t.toJS&&(t=t.toJS()),e={project:t.slug},t.is_backlog_activated&&-1<t.my_permissions.indexOf("view_us")?r.resolve("project-backlog",e):t.is_kanban_activated&&-1<t.my_permissions.indexOf("view_us")?r.resolve("project-kanban",e):t.is_wiki_activated&&-1<t.my_permissions.indexOf("view_wiki_pages")?r.resolve("project-wiki",e):t.is_issues_activated&&-1<t.my_permissions.indexOf("view_issues")?r.resolve("project-issues",e):r.resolve("project",e)}}},f.factory("$projectUrl",["$tgNavUrls",c]),u=function(t){var r,e,n,i=t.defer();return i.resolve(),r=i.promise,e={bindAdd:(n=this,function(e){return function(){var t=1<=arguments.length?m.call(arguments,0):[];return r=r.then(function(){return e.apply(n,t)})}}),add:function(t){return r=r?r.then(t):t(),e}}},f.factory("$tgQqueue",["$q",u]),function(t,e){for(var r in e)v.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(y,g.Service),y.$inject=["$tgQqueue","$tgRepo","$q","$tgModel"],y.prototype.setObject=function(t,e){this.scope=t,this.prop=e},y.prototype.clone=function(){var t=_.cloneDeep(this.scope[this.prop]._attrs);return this.model.make_model(this.scope[this.prop]._name,t)},y.prototype.getObj=function(){return this.scope[this.prop]},y.prototype.save=function(o){var s,a=this.q.defer();return this.qqueue.add((s=this,function(){var t,e,r,n=s.getObj(),i=n.comment;return n.comment="",t=s.clone(),e=_.omit(n._modifiedAttrs,["version"]),t=_.assign(t,e),o(t),i.length&&(t.comment=i),r=function(){return s.scope[s.prop]=t,a.resolve.apply(null,arguments)},s.repo.save(t).then(r,a.reject)})),a.promise},f.service("$tgQueueModelTransformation",y),d=function(n){return{get:function(t,e){var r;return null==e&&(e=!1),r=n.get(t),e&&(r=_.template(r)),r}}},f.factory("$tgTemplate",["$templateCache",d]),r=function(){return{template:"<tg-svg class=\"capslock\" ng-if=\"capslockIcon && iscapsLockActivated\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>"}},f.directive("tgCapslock",[r]),a=function(){return{scope:{onClose:"&"},link:function(t,e,r){},template:'<a class="close" ng-click="onClose()" href="" title="{{\'COMMON.CLOSE\' | translate}}">\n    <tg-svg svg-icon="icon-close"></tg-svg>\n</a>'}},f.directive("tgLightboxClose",[a]),p=function(){return{scope:{svgIcon:"@",svgTitle:"@",svgTitleTranslate:"@",svgTitleTranslateValues:"=",svgFill:"="},template:'<svg class="{{ \'icon \' + svgIcon }}" style="fill: {{ svgFill }}">\n    <use xlink:href="" ng-attr-xlink:href="{{ \'#\' + svgIcon }}" ng-attr-href="{{ \'#\' + svgIcon }}">\n        <title ng-if="svgTitle">{{svgTitle}}</title>\n        <title ng-if="svgTitleTranslate">{{svgTitleTranslate | translate: svgTitleTranslateValues}}</title>\n    </use>\n</svg>'}},f.directive("tgSvg",[p]),e=function(i,o,t){return{restrict:"A",link:function(t,e,r){var n;return r.ngShow?(n=o(r.ngShow),t.$watch(n,function(t){if(!0===t)return i(function(){return e[0].focus()})})):i(function(){return e[0].focus()})}}},f.directive("tgAutofocus",["$timeout","$parse","animationFrame",e]),f.directive("tgPreloadImage",function(){var s="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",a=function(t,e){var r=new Image;return r.onload=e,r.src=t,r};return{template:"<div>\n    <ng-transclude></ng-transclude>\n</div>",transclude:!0,replace:!0,link:function(t,e,r){var n=e.find("img:last"),i=null,o=function(){if(e.find(".loading-spinner").remove(),n.show(),i)return clearTimeout(i),i=null};return r.$observe("preloadSrc",function(t){return i&&clearTimeout(i),e.find(".loading-spinner").remove(),i=setTimeout(function(){return e.prepend(s)},200),n.hide(),a(t,o)})}}}),o=function(){return{link:function(t,e,r){return e.on("click",function(t){if(t.ctrlKey||t.metaKey)return t.preventDefault()})}}},f.directive("tgCtrlClickDisable",o)}.call(this),function(){var t;function e(t,e,r,n,i){var o;this.params=t,this.repo=e,this.projectService=r,this.navurls=n,this.location=i,this.repo.resolve({pslug:this.params.pslug,ref:this.params.ref}).then((o=this,function(t){var e;return t.issue?e=o.navurls.resolve("project-issues-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.task?e=o.navurls.resolve("project-tasks-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.us?e=o.navurls.resolve("project-userstories-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.epic?e=o.navurls.resolve("project-epics-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.wikipage&&(e=o.navurls.resolve("project-wiki-page",{project:o.projectService.project.get("slug"),slug:o.params.ref})),o.location.path(e)}))}this.taiga,this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.bindMethods,t=angular.module("taigaCommon"),e.$inject=["$routeParams","$tgRepo","tgProjectService","$tgNavUrls","$location"],t.controller("DetailController",e)}.call(this),function(){angular.module("taigaEpics",[])}.call(this),function(){var a,c,t,i,r,n=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function e(t,e,r,n,i,o){var s,a;this.win=t,this.log=e,this.config=r,this.auth=n,this.liveAnnouncementService=i,this.rootScope=o,this.processMessage=(s=this.processMessage,a=this,function(){return s.apply(a,arguments)}),c(this)}function o(){}r=this.taiga,i=this.taiga.startswith,c=this.taiga.bindMethods,t=angular.module("taigaEvents",[]),e.prototype.initialize=function(t){if(this.sessionId=t,this.subscriptions={},this.connected=!1,this.error=!1,this.pendingMessages=[],this.missedHeartbeats=0,this.heartbeatInterval=null,void 0===this.win.WebSocket)return this.log.info("WebSockets not supported on your browser")},e.prototype.setupConnection=function(){var t,e,r,n;if(this.stopExistingConnection(),n=this.config.get("eventsUrl"))return i(n,"ws:")||i(n,"wss:")||(r="https:"===(t=this.win.location).protocol?"wss:":"ws:",e=_.trimStart(n,"/"),n=r+"//"+t.host+"/"+e),this.error=!1,this.ws=new this.win.WebSocket(n),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)},e.prototype.stopExistingConnection=function(){if(void 0!==this.ws)return this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("close",this.onClose),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("message",this.onMessage),this.stopHeartBeatMessages(),this.ws.close(),delete this.ws},e.prototype.notifications=function(){return this.subscribe(null,"notifications",(e=this,function(t){return e.liveAnnouncementService.show(t.title,t.desc),e.rootScope.$digest()}));var e},e.prototype.liveNotifications=function(){var e;if(null!=this.auth.userData){var t,r=this.auth.userData.get("id");return t=this,e=function(){return t.subscribe(null,"live_notifications."+r,function(t){var e=new Notification(t.title,{icon:"/"+window._version+"/images/favicon.png",body:t.body,tag:t.id});if(e.onshow=function(){if(t.timeout&&0<t.timeout)return setTimeout(function(){return e.close()},t.timeout)},t.url)return e.onclick=function(){return window.open(t.url)}})},0<=n.call(window,"Notification")?"granted"===Notification.permission?e():"denied"!==Notification.permission?Notification.requestPermission(function(t){if("granted"===t)return e()}):void 0:console.log("This browser does not support desktop notification")}},e.prototype.webNotifications=function(){var t,e;if(null!=this.auth.userData)return t="web_notifications."+this.auth.userData.get("id"),r.randomInt(700,1e3),this.subscribe(null,t,(e=this,function(t){return e.rootScope.$broadcast("notifications:new")}))},e.prototype.startHeartBeatMessages=function(){if(!this.heartbeatInterval){var e,t=this.config.get("eventsMaxMissedHeartbeats",5),r=this.config.get("eventsHeartbeatIntervalTime",6e4);this.config.get("eventsReconnectTryInterval",1e4);return this.missedHeartbeats=0,this.heartbeatInterval=setInterval((e=this,function(){try{if(e.missedHeartbeats>=t)throw new Error("Too many missed heartbeats PINGs.");return e.missedHeartbeats++,e.sendMessage({cmd:"ping"}),e.log.debug("HeartBeat send PING")}catch(t){return e.log.error("HeartBeat error: "+t.message),e.setupConnection()}}),r),this.log.debug("HeartBeat enabled")}},e.prototype.stopHeartBeatMessages=function(){if(this.heartbeatInterval)return clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.log.debug("HeartBeat disabled")},e.prototype.processHeartBeatPongMessage=function(t){return this.missedHeartbeats=0,this.log.debug("HeartBeat received PONG")},e.prototype.serialize=function(t){return _.isObject(t)?JSON.stringify(t):t},e.prototype.sendMessage=function(t){var e,r,n,i,o;if(this.pendingMessages.push(t),this.connected){for(n=_.map(this.pendingMessages,this.serialize),this.pendingMessages=[],o=[],e=0,r=n.length;e<r;e++)i=n[e],o.push(this.ws.send(i));return o}},e.prototype.processMessage=function(t){var e,r=t.routing_key;if(null!=this.subscriptions[r])return(e=this.subscriptions[r]).scope?e.scope.$apply(function(){return e.callback(t.data)}):e.callback(t.data)},e.prototype.subscribe=function(t,e,r){var n,i,o;if(!this.error)return this.log.debug("Subscribe to: "+e),i={scope:t,routingKey:e,callback:r},n={cmd:"subscribe",routing_key:e},this.subscriptions[e]=i,this.sendMessage(n),t?t.$on("$destroy",(o=this,function(){return o.unsubscribe(e)})):void 0},e.prototype.unsubscribe=function(t){var e;if(!this.error)return this.log.debug("Unsubscribe from: "+t),e={cmd:"unsubscribe",routing_key:t},this.sendMessage(e)},e.prototype.onOpen=function(){var t;return this.connected=!0,this.log.debug("WebSocket connection opened"),t={cmd:"auth",data:{token:this.auth.getToken(),sessionId:this.sessionId}},this.sendMessage(t),this.startHeartBeatMessages(),this.notifications(),this.liveNotifications(),this.webNotifications()},e.prototype.onMessage=function(t){var e;return this.log.debug("WebSocket message received: "+t.data),"pong"===(e=JSON.parse(t.data)).cmd?this.processHeartBeatPongMessage(e):this.processMessage(e)},e.prototype.onError=function(t){return this.log.error("WebSocket error: "+t),this.error=!0,setTimeout(this.setupConnection,this.reconnectTryInterval)},e.prototype.onClose=function(){return this.log.debug("WebSocket closed."),this.connected=!1,this.stopHeartBeatMessages(),setTimeout(this.setupConnection,this.reconnectTryInterval)},a=e,o.prototype.setSessionId=function(t){return this.sessionId=t},(o.prototype.$get=function(t,e,r,n,i,o){var s=new a(t,e,r,n,i,o);return s.initialize(this.sessionId),s}).$inject=["$window","$log","$tgConfig","$tgAuth","tgLiveAnnouncementService","$rootScope"],t.provider("$tgEvents",o)}.call(this),function(){this.taiga,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.mixOf;var p=this.taiga.debounce,t=(this.taiga.trim,function(a,c,u,l,t){return{link:function(n,i,t){var e,o=i.find("form").checksley(),r=p(2e3,function(t){var e,r;if(t.preventDefault(),o.validate())return e=l().target(s).start(),(r=c.create("feedback",n.feedback)).then(function(t){return e.finish(),a.close(i),u.notify("success","\\o/ we'll be happy to read your")}),r.then(null,function(){return e.finish(),u.notify("error")})}),s=i.find(".submit-button");return i.on("submit","form",r),e=function(){return n.feedback={},a.open(i),i.find("textarea").focus()},n.$on("$destroy",function(){return i.off()}),e()},templateUrl:"common/lightbox-feedback.html",scope:{}}});angular.module("taigaFeedback",[]).directive("tgLbFeedback",["lightboxService","$tgRepo","$tgConfirm","$tgLoading","tgFeedbackService",t])}.call(this),function(){angular.module("taigaIntegrations",[])}.call(this),function(){angular.module("taigaIssues",[])}.call(this),function(){angular.module("taigaKanban",[])}.call(this),function(){angular.module("taigaPlugins",["ngRoute"])}.call(this),function(){angular.module("taigaProject",[])}.call(this),function(){var t,e,r,n,h=this.taiga,m=(this.taiga.trim,this.taiga.debounce),i=angular.module("taigaRelatedTasks",[]),o=function(a,c,u,l,p,t,d,h){var f=t.get("task/related-task-row.html",!0),g=t.get("task/related-task-row-edit.html",!0);return{link:function(i,o,t,s){var e=m(2e3,function(t){var e,r;return t.subject=o.find("input").val(),e=p().target(o.find(".task-name")).start(),(r=a.save(t)).then(function(){return e.finish(),l.$broadcast("related-tasks:update")}),r.then(null,function(){return e.finish(),o.find("input").val(t.subject),u.notify("error")}),r}),r=function(t){return this.childScope&&this.childScope.$destroy(),this.childScope=i.$new(),o.off(),o.html(c(g({task:t}))(childScope)),o.find(".task-name input").val(t.subject),o.on("keyup","input",function(t){return 13===t.keyCode?e(s.$modelValue).then(function(){return n(s.$modelValue)}):27===t.keyCode?n(s.$modelValue):void 0}),o.on("click",".save-task",function(t){return e(s.$modelValue).then(function(){return n(s.$modelValue)})}),o.on("click",".cancel-edit",function(t){return n(s.$modelValue)})},n=function(n){var t={modify_task:-1!==i.project.my_permissions.indexOf("modify_task"),delete_task:-1!==i.project.my_permissions.indexOf("delete_task")};return o.html(c(f({task:n,perms:t,emojify:function(t){return h.replaceEmojiNameByHtmlImgs(_.escape(t))}}))(i)),o.on("click",".edit-task",function(){return r(s.$modelValue),o.find("input").focus().select()}),o.on("click",".delete-task",function(t){var e=d.instant("TASK.TITLE_DELETE_ACTION"),r=(n=s.$modelValue).subject;return u.askOnDelete(e,r).then(function(t){var e=a.remove(n);return e.then(function(){return t.finish(),i.$emit("related-tasks:delete")}),e.then(null,function(){return t.finish(!1),u.notify("error")})})})};return i.$watch(t.ngModel,function(t){if(t)return n(t)}),i.$on("related-tasks:assigned-to-changed",function(){return l.$broadcast("related-tasks:update")}),i.$on("related-tasks:status-changed",function(){return l.$broadcast("related-tasks:update")}),i.$on("$destroy",function(){return o.off()})},require:"ngModel"}};i.directive("tgRelatedTaskRow",["$tgRepo","$compile","$tgConfirm","$rootScope","$tgLoading","$tgTemplate","$translate","$tgEmojis",o]),r=function(a,t,c,u,l,p){var d={subject:"",assigned_to:null};return{scope:!0,link:function(n,i,t){var e=function(t){var e,r;return t.subject=i.find("input").val(),t.assigned_to=n.newTask.assigned_to,t.status=n.newTask.status,n.newTask.status=n.project.default_task_status,n.newTask.assigned_to=null,e=l().target(i.find(".task-name")).start(),(r=a.create("tasks",t)).then(function(){return p.trackEvent("task","create","create task on userstory",1),e.finish(),n.$emit("related-tasks:add")}),r.then(null,function(){return i.find("input").val(t.subject),e.finish(),c.notify("error")}),r},r=function(){return i.off(),n.openNewRelatedTask=!1},o=function(){return(d={subject:"",assigned_to:null}).status=n.project.default_task_status,d.project=n.project.id,d.user_story=n.us.id,n.newTask=u.make_model("tasks",d)},s=function(){if(!n.openNewRelatedTask)return n.openNewRelatedTask=!0,i.on("keyup","input",function(t){return 13===t.keyCode?e(d).then(function(){return o(),i.find("input").focus()}):27===t.keyCode?n.$apply(r):void 0})};return n.save=function(){return e(d).then(r)},h.bindOnce(n,"us",o),n.$on("related-tasks:show-form",function(){return n.$apply(s)}),n.$on("$destroy",function(){return i.off()})},templateUrl:"task/related-task-create-form.html"}},i.directive("tgRelatedTaskCreateForm",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgLoading","$tgAnalytics",r]),e=function(t,n,e,r,i){var o=i.get("common/components/add-button.html",!0);return{link:function(e,r,t){return e.$watch("project",function(t){if(t)return r.off(),-1!==e.project.my_permissions.indexOf("add_task")?r.html(n(o())(e)):r.html(""),r.on("click",".add-button",function(t){return e.$emit("related-tasks:add-new-clicked")})}),e.$on("$destroy",function(){return r.off()})}}},i.directive("tgRelatedTaskCreateButton",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgTemplate",e]),n=function(t,s,a){return{link:function(e,t,r){var n=function(){return s.tasks.list(e.projectId,null,e.usId).then(function(t){return Immutable.fromJS(t.data)})},i=function(){return!!e.project&&-1!==e.project.my_permissions.indexOf("view_tasks")},o=function(){return!!e.project&&-1!==e.project.my_permissions.indexOf("modify_task")};return e.reorderTask=function(t,e){return a.$broadcast("task:reorder",t,e)},e.showRelatedTasks=function(){var t;return i()&&(o()||(null!=(t=e.tasks)?t.length:void 0))},e.$on("related-tasks:add",function(){return n().then(function(){return a.$broadcast("related-tasks:update")})}),e.$on("related-tasks:reordered",n),e.$on("related-tasks:delete",function(){return n().then(function(){return a.$broadcast("related-tasks:update")})}),e.$on("related-tasks:add-new-clicked",function(){return e.$broadcast("related-tasks:show-form")}),h.bindOnce(e,"us",function(t){return n()}),e.$on("$destroy",function(){return t.off()})}}},i.directive("tgRelatedTasks",["$tgRepo","$tgResources","$rootScope",n]),t=function(a,t,c,u,l){var p=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>');return{link:function(i,o,t){var r=function(t){var e={name:c.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},r=i.usersById[t.assigned_to],n=u.getAvatar(r);return e.imgurl=n.url,e.bg=n.bg,r&&(e.name=r.full_name_display),o.find(".avatar").html(p(e)),o.find(".task-assignedto").attr("title",e.name)},n=(o.controller(),i.$eval(t.tgRelatedTaskAssignedToInlineEdition)),s=!i.$eval(t.notAutoSave);return i.$watch(t.tgRelatedTaskAssignedToInlineEdition,function(){return n=i.$eval(t.tgRelatedTaskAssignedToInlineEdition),r(n)}),r(n),o.on("click",".task-assignedto",function(t){var e;return t.preventDefault(),t.stopPropagation(),e=function(t){if(n.assigned_to=t.pop()||null,s)return a.save(n).then(function(){return i.$emit("related-tasks:assigned-to-changed"),r(n)})},l.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[n.assigned_to],activeUsers:i.activeUsers,onClose:e,single:!0,lbTitle:c.instant("COMMON.ASSIGNED_USERS.ADD")})}),h.bindOnce(i,"project",function(t){if(-1===t.my_permissions.indexOf("modify_task"))return o.unbind("click"),o.find("a").addClass("not-clickable")}),i.$on("$destroy",function(){return o.off()})}}},i.directive("tgRelatedTaskAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService","tgLightboxFactory",t])}.call(this),function(){var t,e,r,n,i,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}(function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(s,this.taiga.Service),t=s,i={auth:"/auth","auth-register":"/auth/register",invitations:"/invitations",users:"/users",by_username:"/users/by_username","users-password-recovery":"/users/password_recovery","users-change-password-from-recovery":"/users/change_password_from_recovery","users-change-password":"/users/change_password","users-change-email":"/users/change_email","users-cancel-account":"/users/cancel","users-export":"/users/export","user-stats":"/users/%s/stats","user-liked":"/users/%s/liked","user-voted":"/users/%s/voted","user-watched":"/users/%s/watched","user-contacts":"/users/%s/contacts","user-me":"/users/me","user-send-verification-email":"/users/send_verification_email",permissions:"/permissions","notify-policies":"/notify-policies",notifications:"/web-notifications","user-project-settings":"/user-project-settings","user-storage":"/user-storage",memberships:"/memberships","bulk-create-memberships":"/memberships/bulk_create",roles:"/roles",resolver:"/resolver",projects:"/projects","project-templates":"/project-templates","project-modules":"/projects/%s/modules","bulk-update-projects-order":"/projects/bulk_update_order","project-like":"/projects/%s/like","project-unlike":"/projects/%s/unlike","project-watch":"/projects/%s/watch","project-unwatch":"/projects/%s/unwatch","project-contact":"contact","project-transfer-validate-token":"/projects/%s/transfer_validate_token","project-transfer-accept":"/projects/%s/transfer_accept","project-transfer-reject":"/projects/%s/transfer_reject","project-transfer-request":"/projects/%s/transfer_request","project-transfer-start":"/projects/%s/transfer_start","epic-statuses":"/epic-statuses","userstory-statuses":"/userstory-statuses","userstory-due-dates":"/userstory-due-dates","userstory-due-dates-create-default":"/userstory-due-dates/create_default",points:"/points","task-statuses":"/task-statuses","task-due-dates":"/task-due-dates","task-due-dates-create-default":"/task-due-dates/create_default","issue-statuses":"/issue-statuses","issue-due-dates":"/issue-due-dates","issue-due-dates-create-default":"/issue-due-dates/create_default","issue-types":"/issue-types",priorities:"/priorities",severities:"/severities",milestones:"/milestones","move-userstories-to-milestone":"/milestones/%s/move_userstories_to_sprint","move-tasks-to-milestone":"/milestones/%s/move_tasks_to_sprint","move-issues-to-milestone":"/milestones/%s/move_issues_to_sprint",epics:"/epics","epic-upvote":"/epics/%s/upvote","epic-downvote":"/epics/%s/downvote","epic-watch":"/epics/%s/watch","epic-unwatch":"/epics/%s/unwatch","epic-related-userstories":"/epics/%s/related_userstories","epic-related-userstories-bulk-create":"/epics/%s/related_userstories/bulk_create",userstories:"/userstories","bulk-create-us":"/userstories/bulk_create","bulk-update-us-backlog-order":"/userstories/bulk_update_backlog_order","bulk-update-us-milestone":"/userstories/bulk_update_milestone","bulk-update-us-miles-order":"/userstories/bulk_update_sprint_order","bulk-update-us-kanban-order":"/userstories/bulk_update_kanban_order","userstories-filters":"/userstories/filters_data","userstory-upvote":"/userstories/%s/upvote","userstory-downvote":"/userstories/%s/downvote","userstory-watch":"/userstories/%s/watch","userstory-unwatch":"/userstories/%s/unwatch",tasks:"/tasks","bulk-create-tasks":"/tasks/bulk_create","bulk-update-task-taskboard-order":"/tasks/bulk_update_taskboard_order","bulk-update-task-milestone":"/tasks/bulk_update_milestone","task-upvote":"/tasks/%s/upvote","task-downvote":"/tasks/%s/downvote","task-watch":"/tasks/%s/watch","task-unwatch":"/tasks/%s/unwatch","task-filters":"/tasks/filters_data","promote-task-to-us":"/tasks/%s/promote_to_user_story",issues:"/issues","bulk-create-issues":"/issues/bulk_create","bulk-update-issue-milestone":"/issues/bulk_update_milestone","issues-filters":"/issues/filters_data","issue-upvote":"/issues/%s/upvote","issue-downvote":"/issues/%s/downvote","issue-watch":"/issues/%s/watch","issue-unwatch":"/issues/%s/unwatch","promote-issue-to-us":"/issues/%s/promote_to_user_story",wiki:"/wiki","wiki-restore":"/wiki/%s/restore","wiki-links":"/wiki-links","history/epic":"/history/epic","history/us":"/history/userstory","history/issue":"/history/issue","history/task":"/history/task","history/wiki":"/history/wiki","attachments/epic":"/epics/attachments","attachments/us":"/userstories/attachments","attachments/issue":"/issues/attachments","attachments/task":"/tasks/attachments","attachments/wiki_page":"/wiki/attachments","custom-attributes/epic":"/epic-custom-attributes","custom-attributes/userstory":"/userstory-custom-attributes","custom-attributes/task":"/task-custom-attributes","custom-attributes/issue":"/issue-custom-attributes","custom-attributes-values/epic":"/epics/custom-attributes-values","custom-attributes-values/userstory":"/userstories/custom-attributes-values","custom-attributes-values/task":"/tasks/custom-attributes-values","custom-attributes-values/issue":"/issues/custom-attributes-values",webhooks:"/webhooks","webhooks-test":"/webhooks/%s/test",webhooklogs:"/webhooklogs","webhooklogs-resend":"/webhooklogs/%s/resend","epics-csv":"/epics/csv?uuid=%s","userstories-csv":"/userstories/csv?uuid=%s","tasks-csv":"/tasks/csv?uuid=%s","issues-csv":"/issues/csv?uuid=%s","timeline-profile":"/timeline/profile","timeline-user":"/timeline/user","timeline-project":"/timeline/project",search:"/search",exporter:"/exporter",importer:"/importer/load_dump",feedback:"/feedback",locales:"/locales",applications:"/applications","application-tokens":"/application-tokens","stats-discover":"/stats/discover","importers-trello-auth-url":"/importers/trello/auth_url","importers-trello-authorize":"/importers/trello/authorize","importers-trello-list-projects":"/importers/trello/list_projects","importers-trello-list-users":"/importers/trello/list_users","importers-trello-import-project":"/importers/trello/import_project","importers-jira-auth-url":"/importers/jira/auth_url","importers-jira-authorize":"/importers/jira/authorize","importers-jira-list-projects":"/importers/jira/list_projects","importers-jira-list-users":"/importers/jira/list_users","importers-jira-import-project":"/importers/jira/import_project","importers-github-auth-url":"/importers/github/auth_url","importers-github-authorize":"/importers/github/authorize","importers-github-list-projects":"/importers/github/list_projects","importers-github-list-users":"/importers/github/list_users","importers-github-import-project":"/importers/github/import_project","importers-asana-auth-url":"/importers/asana/auth_url","importers-asana-authorize":"/importers/asana/authorize","importers-asana-list-projects":"/importers/asana/list_projects","importers-asana-list-users":"/importers/asana/list_users","importers-asana-import-project":"/importers/asana/import_project"},r=function(t,e){return t.debug("Initialize api urls"),e.update(i)},e=function(t,e){var r,n,i,o,s;for(t.debug("Initialize resources"),s=[],r=0,n=(o=_.toArray(arguments).slice(2)).length;r<n;r++)i=o[r],s.push(i(e));return s},(n=angular.module("taigaResources",["taigaBase"])).service("$tgResources",t),n.run(["$log","$tgUrls",r]),n.run(["$log","$tgResources","$tgProjectsResourcesProvider","$tgCustomAttributesResourcesProvider","$tgCustomAttributesValuesResourcesProvider","$tgMembershipsResourcesProvider","$tgNotifyPoliciesResourcesProvider","$tgInvitationsResourcesProvider","$tgRolesResourcesProvider","$tgUserProjectSettingsResourcesProvider","$tgUserSettingsResourcesProvider","$tgSprintsResourcesProvider","$tgEpicsResourcesProvider","$tgUserstoriesResourcesProvider","$tgTasksResourcesProvider","$tgIssuesResourcesProvider","$tgWikiResourcesProvider","$tgSearchResourcesProvider","$tgMdRenderResourcesProvider","$tgHistoryResourcesProvider","$tgKanbanResourcesProvider","$tgModulesResourcesProvider","$tgWebhooksResourcesProvider","$tgWebhookLogsResourcesProvider","$tgLocalesResourcesProvider","$tgUsersResourcesProvider",e])}.call(this),function(){var t,e,m,p,v,r,n,i,o,y,s={}.hasOwnProperty;function a(t,e,r,n,i,o,s,a,c,u,l){var p,d,h,f,g;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.q=i,this.location=o,this.appMetaService=s,this.navUrls=a,this.translate=c,this.errorHandlingService=u,this.projectService=l,this.scope.sectionName="Search",this.loadInitialData(),d=this.translate.instant("SEARCH.PAGE_TITLE",{projectName:this.scope.project.name}),p=this.translate.instant("SEARCH.PAGE_DESCRIPTION",{projectName:this.scope.project.name,projectDescription:this.scope.project.description}),this.appMetaService.setAll(d,p),this.scope.searchTerm=null,v(100,(h=this,function(t){return h.loadSearchData(t)})),m(this.scope,"projectId",(f=this,function(t){if(!f.scope.searchResults&&f.scope.searchTerm)return f.loadSearchData()})),this.scope.$watch("searchTerm",(g=this,function(t){if(void 0!==t&&g.scope.projectId)return g.loadSearchData(t)}))}o=this.taiga,r=this.taiga.groupBy,m=this.taiga.bindOnce,n=this.taiga.mixOf,v=this.taiga.debounceLeading,y=this.taiga.trim,p=this.taiga.debounce,i=angular.module("taigaSearch",[]),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,n(o.Controller,o.PageMixin)),a.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$translate","tgErrorHandlingService","tgProjectService"],a.prototype.loadFilters=function(){var t=this.q.defer();return t.resolve(),t.promise},a.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.epicStatusById=r(t.epic_statuses,function(t){return t.id}),this.scope.issueStatusById=r(t.issue_statuses,function(t){return t.id}),this.scope.taskStatusById=r(t.task_statuses,function(t){return t.id}),this.scope.severityById=r(t.severities,function(t){return t.id}),this.scope.priorityById=r(t.priorities,function(t){return t.id}),this.scope.usStatusById=r(t.us_statuses,function(t){return t.id}),t},a.prototype.loadSearchData=function(t){return null==t&&(t=""),this.scope.loading=!0,this._loadSearchData(t).then((e=this,function(t){return e.scope.searchResults=t,e.scope.loading=!1}));var e},a.prototype._loadSearchData=function(t){return null==t&&(t=""),this._promise&&this._promise.abort(),this._promise=this.rs.search.do(this.scope.projectId,t),this._promise},a.prototype.loadInitialData=function(){var t=this.loadProject();return this.scope.projectId=t.id,this.fillUsersAndRoles(t.members,t.roles)},i.controller("SearchController",a),(t=function(s,a,c,u,l){return{templateUrl:"search/lightbox-search.html",link:function(n,i,t){var o=null,e=p(2e3,function(t){var e,r;if(t.preventDefault(),i.find("form").checksley().validate())return e=i.find("#search-text").val(),r=c.resolve("project-search",{project:o.get("slug")}),n.$apply(function(){return a.close(i),u.path(r),u.search("text",e).path(r),l.reload()})}),r=function(){return o=s.project,a.open(i).then(function(){return i.find("#search-text").focus()})};return i.on("submit","form",e),r()}}}).$inject=["tgProjectService","lightboxService","$tgNavUrls","$tgLocation","$route"],i.directive("tgSearchBox",t),e=function(t,h,f,i,g,m){var o=function(s,a,t,e){var c=!0,u="userstories",i=a.find(".search-filter"),o=null,r=function(t){var e,r,n,i,o,s=0,a={name:"userstories",value:[]};if(!c)return a.name=u,a.value=t[u],a;if(t)for(e=0,r=(i=["userstories","epics","issues","tasks","wikipages"]).length;e<r;e++)if((o=t[n=i[e]]).length>s){s=o.length,a.name=n,a.value=o;break}return a},n=function(t){var e,r,n=[];for(e in t)r=t[e],i.find("li."+e).show(),n.push(i.find("li."+e+" .num").html(r.length));return n},l=function(t){return i.find("a.active").removeClass("active"),i.find("li."+t.name+" a").addClass("active"),c=!1,u=t.name},p={epics:f.get("search-epics"),issues:f.get("search-issues"),tasks:f.get("search-tasks"),userstories:f.get("search-userstories"),wikipages:f.get("search-wikipages")},d=function(t){var e,r,n,i=a.find(".search-result-table").children(),o=i.scope();return o&&(o.$destroy(),i.remove()),(r=s.$new())[t.name]=t.value,n=angular.element.parseHTML(y(p[t.name])),e=h(n)(r),a.find(".search-result-table").html(e)};return s.$watch("searchResults",function(t){var e;if(o=t)return e=r(t),n(t),d(e),l(e)}),s.$watch("searchTerm",function(t){return void 0!==t&&g.search("text",t),m.trackPage(g.url(),"Search")}),a.on("click",".search-filter li > a",function(t){var e,r,n;return t.preventDefault(),n=angular.element(t.currentTarget).parent().data("name"),r=o?o[n]:[],e={name:n,value:r},s.$apply(function(){return d(e),l(e)})})};return{link:function(e,t,r){var n;t.controller();return o(e,t),n=i.text,e.$watch("projectId",function(t){if(null!=t)return e.searchTerm=n})}}},i.directive("tgSearch",["$log","$compile","$templateCache","$routeParams","$tgLocation","$tgAnalytics",e])}.call(this),function(){angular.module("taigaTaskboard",[])}.call(this),function(){angular.module("taigaTasks",[])}.call(this),function(){angular.module("taigaTeam",[])}.call(this),function(){angular.module("taigaUserSettings",[])}.call(this),function(){angular.module("taigaUserStories",[])}.call(this),function(){angular.module("taigaWiki",[])}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e,r,n,i,o){var s;this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,s=this.config.get("analytics",{}),this.accountId=s.accountId,this.pageEvent=s.pageEvent||"$routeChangeSuccess",this.trackRoutes=s.trackRoutes||!0,this.ignoreFirstPageLoad=s.ignoreFirstPageLoad||!1}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],r.prototype.initialize=function(){var t;if(this.accountId)return this.injectAnalytics(),this.win.ga("create",this.accountId,"auto"),this.win.ga("require","ec"),this.win.ga("require","displayfeatures"),this.trackRoutes&&!this.ignoreFirstPageLoad&&this.win.ga("send","pageview",this.getUrl()),this.trackRoutes&&this.rootscope.$on(this.pageEvent,(t=this,function(){return t.trackPage(t.getUrl(),"Taiga")})),this.initialized=!0,this.setUserId();this.log.debug("Analytics: no acount id provided. Disabling.")},r.prototype.setUserId=function(){var t,e;if(this.initialized&&this.win.ga)return this.win.ga("set","userId",null!=(t=this.rootscope)&&null!=(e=t.user)?e.uuid:void 0)},r.prototype.getUrl=function(){return this.location.path()},r.prototype.injectAnalytics=function(){return function(t,e,r,n,i,o,s){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=+new Date,o=e.createElement(r),s=e.getElementsByTagName(r)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga")},r.prototype.trackPage=function(t,e){if(this.initialized&&this.win.ga)return e=e||this.doc[0].title,this.win.ga("send","pageview",{page:t,title:e})},r.prototype.trackEvent=function(t,e,r,n){if(this.initialized&&this.win.ga)return this.win.ga("send","event",t,e,r,n)},r.prototype.ecViewPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","detail"),this.trackEvent("ecommerce","view-product-detail",t.name,t.plan_id)},r.prototype.ecClickPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","click"),this.trackEvent("ecommerce","click-product",t.name,t.plan_id)},r.prototype.ecListPlans=function(t,e){var r,n,i,o,s=t[0];if(this.initialized&&this.win.ga){for(o=1,r=0,n=s.length;r<n;r++)i=s[r],this.win.ga("ec:addImpression",{id:i.plan_id,name:i.name,list:e,position:o}),o++;return this.trackEvent("ecommerce","list-plans")}},r.prototype.ecAddToCart=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","add"),this.trackEvent("ecommerce","add-to-cart","Collect Payment Info",null)},r.prototype.ecConfirmChange=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:1}),this.trackEvent("ecommerce","start-checkout","start",1)},r.prototype.ecPurchase=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:2}),this.trackEvent("ecommerce","end-checkout","end",2),this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","purchase",{id:t,revenue:r}),this.trackEvent("ecommerce","checkout","Plan checkout",null)},t.service("$tgAnalytics",r)}.call(this),function(){var t=function(r){return r.debugInfo||(jQuery.fn.scope=function(){return this.data("scope")}),{link:function(t,e){if(!r.debugInfo)return e.data("scope",t).addClass("tg-scope")}}};angular.module("taigaCommon").directive("tgBindScope",["$tgConfig",t])}.call(this),function(){var t=function(i){return{link:function(r,n,t){return r.$watch(t.tgCompileHtml,function(t,e){return n.html(t),i(n.contents())(r)})}}};t.$inject=["$compile"],angular.module("taigaCommon").directive("tgCompileHtml",t)}.call(this),function(){this.taiga;var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m=this.taiga.bindOnce,v=angular.module("taigaCommon"),y=function(s){var a=function(t,e,r){var n=s.instant("BACKLOG.SPRINTS.DATE"),i=moment(e).format(n),o=moment(r).format(n);return t.html(i+"-"+o)};return{link:function(t,r,e){var n=e.tgDateRange.split(","),i=n[0],o=n[1];return m(t,i,function(e){return m(t,o,function(t){return a(r,e,t)})})}}};v.directive("tgDateRange",["$translate",y]),r=function(s,a){return{link:function(t,e,r,n){var i=function(){var t=a.get();return _.merge(t,{field:e[0]}),e.picker=new Pikaday(t)},o=s.$on("$translateChangeEnd",function(t){return e.picker&&e.picker.destroy(),i()});return r.$observe("pickerValue",function(t){return e.val(t),null!=t&&(e.picker&&e.picker.destroy(),i()),e.picker.setDate(t)}),t.$on("$destroy",function(){return e.off(),o(),e.picker.destroy()})}}},v.directive("tgDateSelector",["$rootScope","tgDatePickerConfigService",r]),d=function(){var s=function(t,e,r){return t.hasClass(".current-progress")?t.css("width",e+"%"):(t.find(".current-progress").css("width",r+"%"),t.find(".number").html(e+" %"))};return{link:function(t,o,e){return m(t,e.tgSprintProgressbar,function(t){var e,r=t.closed_points,n=t.total_points,i=0;return 0!==n&&(i=Math.round(r/n*100)),(e=0)!==n&&(e=Math.round(r/n*98)),s(o,i,e)}),t.$on("$destroy",function(){return o.off()})}}},v.directive("tgSprintProgressbar",d),e=function(t,e,i,o,s){return{link:function(n,t,e){return m(n,e.ngModel,function(t){var e,r;if(null!=t)return e=s.getAvatar(t.owner_extra_info),n.owner=t.owner_extra_info||{full_name_display:i.instant("COMMON.EXTERNAL_USER")},n.owner.avatar=e.url,n.owner.bg=e.bg,n.url=null!=(r=n.owner)&&r.is_active?o.resolve("user-profile",{username:n.owner.username}):"",n.date=moment(t.created_date).format(i.instant("COMMON.DATETIME"))}),n.$on("$destroy",function(){return t.off()})},restrict:"EA",require:"ngModel",scope:!0,templateUrl:"common/components/created-by.html"}},v.directive("tgCreatedByDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",e]),g=function(t,e,o,s,a){return{link:function(t,e,r){var n,i=r.tgUserId;return t.user=t.usersById[i]||{full_name_display:o.instant("COMMON.EXTERNAL_USER")},n=a.getAvatar(t.usersById[i]||null),t.user.avatar=n.url,t.user.bg=n.bg,t.url=t.user.is_active?s.resolve("user-profile",{username:t.user.username}):"",t.$on("$destroy",function(){return e.off()})},restrict:"EA",scope:!0,templateUrl:"common/components/user-display.html"}},v.directive("tgUserDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",g]),t=function(o,s,t){return{link:function(t,n,e,i){var r=function(){return-1!==t.project.my_permissions.indexOf("modify_us")};return t.$watch(e.ngModel,function(t){if(t)return r()&&n.find(".item-block").addClass("editable"),t.is_blocked?(n.find(".item-block").removeClass("is-active"),n.find(".item-unblock").addClass("is-active")):(n.find(".item-block").addClass("is-active"),n.find(".item-unblock").removeClass("is-active"))}),n.on("click",".item-block",function(t){return t.preventDefault(),o.$broadcast("block",i.$modelValue)}),n.on("click",".item-unblock",function(t){var e,r;return t.preventDefault(),e=s().target(n.find(".item-unblock")).start(),r=function(){return e.finish()},o.$broadcast("unblock",i.$modelValue,r)}),t.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel",template:t.get("common/components/block-button.html")}},v.directive("tgBlockButton",["$rootScope","$tgLoading","$tgTemplate",t]),n=function(e,s,a,c,t){return{link:function(n,t,i,o){return i.onDeleteGoToUrl?i.onDeleteTitle?(t.on("click",".button-delete",function(t){var e=i.onDeleteTitle,r=o.$modelValue.subject;return a.askOnDelete(e,r).then(function(e){var t=s.remove(o.$modelValue);return t.then(function(){var t;return e.finish(),t=n.$eval(i.onDeleteGoToUrl),c.path(t)}),t.then(null,function(){return e.finish(!1),a.notify("error")})})}),n.$on("$destroy",function(){return t.off()})):e.error("DeleteButtonDirective requires on-delete-title set in scope."):e.error("DeleteButtonDirective requires on-delete-go-to-url set in scope.")},restrict:"EA",require:"ngModel",template:t.get("common/components/delete-button.html")}},v.directive("tgDeleteButton",["$log","$tgRepo","$tgConfirm","$tgLocation","$tgTemplate",n]),o=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemEpicStatus);return m(t,"epicStatusById",function(t){return e.html(t[n.status].name)})}}},v.directive("tgListitemEpicStatus",o),p=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemUsStatus);return m(t,"usStatusById",function(t){return e.html(t[n.status].name)})}}},v.directive("tgListitemUsStatus",p),u=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemTaskStatus);return m(t,"taskStatusById",function(t){return e.html(t[n.status].name)})}}},v.directive("tgListitemTaskStatus",u),i=function(t,c,u){var l=t.get("common/components/list-item-assigned-to-avatar.html",!0);return{link:function(o,s,a){return m(o,"usersById",function(t){var e=o.$eval(a.tgListitemAssignedto),r={name:c.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},n=t[e.assigned_to],i=u.getAvatar(n);return r.imgurl=i.url,r.bg=i.bg,n&&(r.name=n.full_name_display),s.html(l(r))})}}},v.directive("tgListitemAssignedto",["$tgTemplate","$translate","tgAvatarService",i]),s=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemIssueStatus);return m(t,"issueStatusById",function(t){return e.html(t[n.status].name)})}}},v.directive("tgListitemIssueStatus",s),l=function(){return{link:function(r,i,n){var o=function(t,e){var r=t[e.type],n=i.find(".level");return n.css("background-color",r.color),n.attr("title",r.name)};return m(r,"issueTypeById",function(t){var e=r.$eval(n.tgListitemType);return o(t,e)}),r.$watch(n.tgListitemType,function(t){return o(r.issueTypeById,t)})},templateUrl:"common/components/level.html"}},v.directive("tgListitemType",l),a=function(){return{link:function(r,i,n){var o=function(t,e){var r=t[e.priority],n=i.find(".level");return n.css("background-color",r.color),n.attr("title",r.name)};return m(r,"priorityById",function(t){var e=r.$eval(n.tgListitemPriority);return o(t,e)}),r.$watch(n.tgListitemPriority,function(t){return o(r.priorityById,t)})},templateUrl:"common/components/level.html"}},v.directive("tgListitemPriority",a),c=function(){return{link:function(r,i,n){var o=function(t,e){var r=t[e.severity],n=i.find(".level");return n.css("background-color",r.color),n.attr("title",r.name)};return m(r,"severityById",function(t){var e=r.$eval(n.tgListitemSeverity);return o(t,e)}),r.$watch(n.tgListitemSeverity,function(t){return o(r.severityById,t)})},templateUrl:"common/components/level.html"}},v.directive("tgListitemSeverity",c),f=function(t){var r=t.get("common/components/progress-bar.html",!0),n=function(t,e){return t.html(r({percentage:e}))};return{link:function(t,e,r){angular.element(e);return t.$watch(r.tgProgressBar,function(t){return t=_.max([0,t]),t=_.min([100,t]),n(e,t)}),t.$on("$destroy",function(){return e.off()})}}},v.directive("tgProgressBar",["$tgTemplate",f]),h=function(t){return{link:function(e,t,r){return r.$observe("i18nSectionName",function(t){return e.sectionName=t}),e.$on("$destroy",function(){return t.off()})},templateUrl:"common/components/main-title.html",scope:{projectName:"=projectName"}}},v.directive("tgMainTitle",["$translate",h])}.call(this),function(){var t,c,o,u,p,d,l,i={}.hasOwnProperty;function e(t,e,r,n,i){this.q=t,this.lightboxService=e,this.loading=r,this.translate=n,this.filter=i,o(this)}d=this.taiga,l=this.taiga.timeout,u=this.taiga.cancelTimeout,p=this.taiga.debounce,o=this.taiga.bindMethods,c={success:{title:"NOTIFICATION.OK",message:"NOTIFICATION.SAVED"},error:{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"},"light-error":{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"}},function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,d.Service),e.$inject=["$q","lightboxService","$tgLoading","$translate","$filter"],e.prototype.hide=function(t){if(t)return this.lightboxService.close(t),t.off(".confirm-dialog")},e.prototype.ask=function(t,e,r,n){var i,o,s,a,c,u;return null==n&&(n=".lightbox-generic-ask"),i=this.q.defer(),(o=angular.element(n)).find(".title").text(t||""),o.find(".subtitle").text(e||""),r=r&&this.filter("textToHTML")(r),o.find(".message").html(r||""),o.on("click.confirm-dialog",".button-green",p(2e3,(a=this,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=a.loading().target(r).start(),i.resolve({finish:function(t){if(null==t&&(t=!0),e.finish(),t)return a.hide(o)}})}))),o.on("click.confirm-dialog",".button-red",(c=this,function(t){return t.preventDefault(),i.reject(),c.hide(o)})),s=function(){return u.hide(o)},(u=this).lightboxService.open(o,null,s),i.promise},e.prototype.askOnDelete=function(t,e,r){return null==r&&(r=this.translate.instant("NOTIFICATION.ASK_DELETE")),this.ask(t,r,e)},e.prototype.askChoice=function(t,e,r,n,i,o){var s,a,c,u,l;return null==o&&(o=".lightbox-ask-choice"),a=this.q.defer(),(c=angular.element(o)).find(".title").text(t),c.find(".subtitle").text(e),n?c.find(".replacement").text(n):c.find(".replacement").remove(),i?c.find(".warning").text(i):c.find(".warning").remove(),(s=c.find(".choices")).html(""),_.each(r,function(t,e){return t=_.escape(t),s.append(angular.element("<option value='"+e+"'>"+t+"</option>"))}),c.on("click.confirm-dialog","a.button-green",p(2e3,(u=this,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=u.loading().target(r).start(),a.resolve({selected:s.val(),finish:function(t){if(null==t&&(t=!0),e.finish(),t)return u.hide(c)}})}))),c.on("click.confirm-dialog",".button-red",(l=this,function(t){return t.preventDefault(),a.reject(),l.hide(c)})),this.lightboxService.open(c),a.promise},e.prototype.error=function(t){var e,r,n=this.q.defer(),i=angular.element(".lightbox-generic-error");return i.find(".title").html(t),i.on("click.confirm-dialog",".button-green",(e=this,function(t){return t.preventDefault(),n.resolve(),e.hide(i)})),i.on("click.confirm-dialog",".close",(r=this,function(t){return t.preventDefault(),n.resolve(),r.hide(i)})),this.lightboxService.open(i),n.promise},e.prototype.success=function(t,e,r,n){var i,o,s,a,c,u=this.q.defer(),l=angular.element(".lightbox-generic-success");return l.find("img").remove(),l.find("svg").remove(),r&&("img"===r.type?i=$("<img>").addClass("lb-icon").attr("src",r.name):"svg"===r.type&&(i=document.createElement("div"),d.addClass(i,"icon"),d.addClass(i,r.name),d.addClass(i,"lb-icon"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),(s=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+r.name),i.appendChild(o).appendChild(s)),i&&l.find("section").prepend(i)),t&&l.find(".title").html(t),e&&l.find(".message").html(e),n&&(l.find(".button-green").html(n),l.find(".button-green").attr("title",n)),l.on("click.confirm-dialog",".button-green",(a=this,function(t){return t.preventDefault(),u.resolve(),a.hide(l)})),l.on("click.confirm-dialog",".close",(c=this,function(t){return t.preventDefault(),u.resolve(),c.hide(l)})),this.lightboxService.open(l),u.promise},e.prototype.loader=function(t,e,r){var i,n,o;return null==r&&(r=!1),i=angular.element(".lightbox-generic-loading"),t&&i.find(".title").html(t),e&&i.find(".message").html(e),r&&i.find(".spin").removeClass("hidden"),{start:function(){return o.lightboxService.open(i)},stop:(n=o=this,function(){return n.lightboxService.close(i)}),update:function(t,e,r,n){return e&&i.find(".title").html(e),r&&i.find(".message").html(r),n?(i.find(".spin").addClass("hidden"),i.find(".progress-bar-wrapper").removeClass("hidden"),i.find(".progress-bar-wrapper > .bar").width(n+"%"),i.find(".progress-bar-wrapper > span").html(n+"%").css("left",n-9+"%")):(i.find(".spin").removeClass("hidden"),i.find(".progress-bar-wrapper").addClass("hidden"))}}},e.prototype.notify=function(t,e,r,n){var i,o,s=".notification-message-"+t,a=angular.element(s);if(!a.hasClass("active"))return r?a.find("h4").html(r):a.find("h4").html(this.translate.instant(c[t].title)),e?a.find("p").html(e):a.find("p").html(this.translate.instant(c[t].message)),(i=angular.element("body")).find(".notification-message .notification-light").removeClass("active").addClass("inactive"),i.find(s).removeClass("inactive").addClass("active"),this.tsem&&u(this.tsem),n=n||("error"===t||"light-error"===t?3500:1500),this.tsem=l(n,(o=this,function(){return i.find(s).removeClass("active").addClass("inactive").one("animationend",function(){return $(this).removeClass("inactive")}),delete o.tsem})),a.on("click",".icon-close, .close",function(t){return i.find(s).removeClass("active").addClass("inactive")})},t=e,angular.module("taigaCommon").service("$tgConfirm",t)}.call(this),function(){var y,t,e,r,b,S,j,s,c,k,n,i,o,a={}.hasOwnProperty;function u(t,e,r,n,i,o){this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.confirm=i,this.q=o,s(this),this.type=null,this.objectId=null,this.projectId=null,this.customAttributes=[],this.customAttributesValues=null}o=this.taiga,s=this.taiga.bindMethods,c=this.taiga.bindOnce,k=this.taiga.debounce,n=o.generateHash,i=angular.module("taigaCommon"),b="date",S="dropdown",y="checkbox",j="number",function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(u,o.Controller),u.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$tgConfirm","$q"],u.prototype.initialize=function(t,e){return this.project=this.scope.project,this.type=t,this.objectId=e,this.projectId=this.scope.projectId},u.prototype.loadCustomAttributesValues=function(){return this.objectId?this.rs.customAttributesValues[this.type].get(this.objectId).then((e=this,function(t){return e.customAttributes=e.project[e.type+"_custom_attributes"],e.customAttributesValues=t})):this.customAttributesValues;var e},u.prototype.getAttributeValue=function(t){var e=_.clone(t,!1);return e.value=this.customAttributesValues.attributes_values[t.id],e},u.prototype.updateAttributeValue=function(t){var e,r,n,i,o=function(){return n.rootscope.$broadcast("custom-attributes-values:edit")};return i=n=this,r=function(t){return i.confirm.notify("error"),i.q.reject()},(e=_.clone(this.customAttributesValues.attributes_values,!0))[t.id]=t.value,this.customAttributesValues.attributes_values=e,this.customAttributesValues.id=this.objectId,this.repo.save(this.customAttributesValues).then(o,r)},e=u,r=function(t,s){var r=t.get("custom-attributes/custom-attributes-values.html",!0),a=function(t){return n(["custom-attributes-collapsed",t])};return{require:["tgCustomAttributesValues","ngModel"],controller:e,controllerAs:"ctrl",restrict:"AE",scope:!0,link:function(t,e,r,n){var i=n[0],o=(n[1],a(r.type));return t.collapsed=s.get(o)||!1,c(t,r.ngModel,function(t){return i.initialize(r.type,t.id),i.loadCustomAttributesValues()}),t.toggleCollapse=function(){return t.collapsed=!t.collapsed,s.set(o,t.collapsed)},t.$on("$destroy",function(){return e.off()})},template:function(t,e){return r({requiredEditionPerm:e.requiredEditionPerm})}}},i.directive("tgCustomAttributesValues",["$tgTemplate","$tgStorage","$translate",r]),t=function(t,a,d,h,f,g){var m=t.get("custom-attributes/custom-attribute-value.html",!0),v=t.get("custom-attributes/custom-attribute-value-edit.html",!0);return{link:function(c,u,r,n){var i,e,o,l=h.instant("COMMON.PICKERDATE.FORMAT"),s=function(t,e){var r,n,i,o,s,a;return null==e&&(e=!1),t.type===b&&t.value&&(a=moment(t.value,"YYYY-MM-DD").format(l)),a=t.type===j&&t.value?parseFloat(t.value):t.value,i=p(),r={id:t.id,name:t.name,description:t.description,value:a,type:t.type,isEditable:i},(s=c.$new()).attributeHtml=g.getHTML(a),s.extra=t.extra,s.model=a,!i||!e&&a?(o=m(r),o=d(o)(s),u.html(o)):(o=v(r),o=d(o)(s),u.html(o),t.type===b?(n=f.get(),_.merge(n,{field:u.find("input[name=value]")[0],onSelect:function(t){return t},onOpen:function(){if("undefined"!=typeof selectedDate&&null!==selectedDate)return u.picker.setDate(selectedDate)}}),u.picker=new Pikaday(n)):void 0)},p=function(){var t=c.project.my_permissions,e=r.requiredEditionPerm;return-1<t.indexOf(e)};return c.saveCustomRichText=function(t,e){return i.value=t,n.updateAttributeValue(i).then(function(){return e(),s(i,!1)})},c.cancelCustomRichText=function(){return s(i,!1),null},o=k(2e3,function(t){var e;if(t.preventDefault(),u.find("form").checksley().validate())return i.type===S?(e=u.find("select[name='value']"),i.value=e.val()):i.type===y?(e=u.find("input[name=value]"),i.value=e[0].checked):(e=u.find("input[name=value], textarea[name='value']"),i.value=e.val(),i.type===b&&moment(i.value,l).isValid()&&(i.value=moment(i.value,l).format("YYYY-MM-DD")),i.type===j&&(i.value=parseFloat(i.value))),c.$apply(function(){return n.updateAttributeValue(i).then(function(){return s(i,!1)})})}),e=function(){return u.find("input[name='value'], textarea[name='value']").focus().select()},null!==(i=c.$eval(r.tgCustomAttributeValue)).value&&void 0!==i.value||(i.value=""),c.customAttributeValue=i,s(i),u.on("click",".js-value-view-mode span a",function(t){return t.stopPropagation()}),u.on("click",".js-value-view-mode",function(){if(p()&&!a.get().length)return s(i,!0),e()}),u.on("click",".js-edit-description",function(t){return t.preventDefault(),s(i,!0),e()}),u.on("keyup","input[name=value], textarea[name='value']",function(t){return 13===t.keyCode&&"textarea"!==t.currentTarget.type?o(t):27===t.keyCode?s(i,!1):void 0}),u.on("submit","form",o),u.on("click",".js-save-description",o),c.$on("$destroy",function(){return u.off()})},require:"^tgCustomAttributesValues",restrict:"AE"}},i.directive("tgCustomAttributeValue",["$tgTemplate","$selectedText","$compile","$translate","tgDatePickerConfigService","tgWysiwygService",t])}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}var e,a,i={}.hasOwnProperty;function r(){this.replaceEmojiNameByHtmlImgs=t(this.replaceEmojiNameByHtmlImgs,this),this.replaceEmojiNameByImgs=t(this.replaceEmojiNameByImgs,this),this.replaceImgsByEmojiName=t(this.replaceImgsByEmojiName,this),this.getEmojiByName=t(this.getEmojiByName,this),this.getEmojiById=t(this.getEmojiById,this),this.searchByName=t(this.searchByName,this),this.emojis=_.map(a.emojis,function(t){return t.image="/"+window._version+"/emojis/"+t.image,t}),this.emojisById=_.keyBy(this.emojis,"id"),this.emojisByName=_.keyBy(this.emojis,"name")}a=this.taiga,e=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,a.Service),r.$inject=[],r.prototype.searchByName=function(e){return _.filter(this.emojis,function(t){return-1!==t.name.indexOf(e)})},r.prototype.getEmojiById=function(t){return this.emojisById[t]},r.prototype.getEmojiByName=function(t){return this.emojisByName[t]},r.prototype.replaceImgsByEmojiName=function(t){for(var e,r,n,i=a.getMatches(t,/emojis\/([^"]+).png"/gi),o=0,s=i.length;o<s;o++)r=i[o],n=new RegExp("<img(.*)"+r+"[^>]+>","g"),e=this.getEmojiById(r),t=t.replace(n,":"+e.name+":");return t},r.prototype.replaceEmojiNameByImgs=function(t){for(var e,r,n,i=a.getMatches(t,/:([\w +-]*):/g),o=0,s=i.length;o<s;o++)r=i[o],n=new RegExp(":"+r+":","g"),(e=this.getEmojiByName(r))&&(t=t.replace(n,"![alt]("+e.image+")"));return t},r.prototype.replaceEmojiNameByHtmlImgs=function(t){for(var e,r,n,i=a.getMatches(t,/:([\w +-]*):/g),o=0,s=i.length;o<s;o++)r=i[o],n=new RegExp(":"+_.escapeRegExp(r)+":","g"),(e=this.getEmojiByName(r))&&(t=t.replace(n,'<img src="'+e.image+'" />'));return t},e.service("$tgEmojis",r)}.call(this),function(){this.taiga;var t,e,l=this.taiga.groupBy,r=angular.module("taigaCommon"),n=function(r,t,e,a,c){return{link:function(o,t,e,s){return o.$watch(e.ngModel,function(n){var i;if(n)return(i=r.create(t,n,o.project)).onSelectedPointForRole=function(t,e,r){return n.points=r,i.render(),o.$apply(function(){return s.$setViewValue(n)})},i.render=function(){var t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:!1},e=a.get("common/estimation/us-estimation-points-per-role.html",!0)(t);return e=c(e)(o),this.$el.html(e)},i.render()}),o.$on("$destroy",function(){return t.off()})},restrict:"EA",require:"ngModel"}};r.directive("tgLbUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile",n]),e=function(s,a,t,c,u,n,l){return{link:function(r,e,t,i){var o=function(e){var t=function(){return l.notify("error")};return n.save(function(t){return t.points=e,t}).then(null,t)};return r.$watchCollection(function(){return i.$modelValue&&i.$modelValue.points},function(){var n,t=i.$modelValue;if(t)return(n=s.create(e,t,r.project)).onSelectedPointForRole=function(t,e,r){return n.loading=t,n.render(),o(r).then(function(){return n.loading=!1,a.$broadcast("object:updated"),n.render()})},n.render=function(){var t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:n.loading},e=c.get("common/estimation/us-estimation-points-per-role.html",!0)(t);return e=u(e)(r),this.$el.html(e)},n.render()}),r.$on("$destroy",function(){return e.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile","$tgQueueModelTransformation","$tgConfirm",e]),t=function(t,i,o,s,a){var c,u;function e(t,e,r){var n,i;this.$el=t,this.us=e,this.project=r,this.bindClickEvents=(n=this.bindClickEvents,i=this,function(){return n.apply(i,arguments)}),this.isEditable=-1!==this.project.my_permissions.indexOf("modify_us"),this.roles=this.project.roles,this.points=this.project.points,this.loading=!1,this.pointsById=l(this.points,function(t){return t.id}),this.onSelectedPointForRole=function(t,e){},this.render=function(){}}return u=t.get("common/estimation/us-estimation-points.html",!0),e.prototype.save=function(t,e){var r,n=s.defer();return a.add((r=this,function(){var t=function(){return n.resolve(),r.render()},e=function(){return o.notify("error"),r.us.revert(),r.render(),n.reject()};return i.save(r.us).then(t,e)})),n.promise},e.prototype.calculateTotalPoints=function(){var t,n,e=_.map(this.us.points,(n=this,function(t,e){var r;return null!=(r=n.pointsById[t])?r.value:void 0}));return 0===e.length||0===(t=_.filter(e,function(t){return null!=t})).length?"?":_.reduce(t,function(t,e){return t+e})},e.prototype.calculateRoles=function(){var n,t=_.filter(this.project.roles,"computable");return _.map(t,(n=this,function(t){var e=n.us.points[t.id],r=n.pointsById[e];return(t=_.clone(t,!0)).points=null!=r&&null!=r.name?r.name:"?",t}))},e.prototype.bindClickEvents=function(){var n,o;return this.$el.on("click",".total.clickable",(n=this,function(t){var e,r;return t.preventDefault(),t.stopPropagation(),e=(r=angular.element(t.currentTarget)).data("role-id"),n.renderPointsSelector(e,r),r.siblings().removeClass("active"),r.addClass("active")})),this.$el.on("click",".point",(o=this,function(t){var e,r,n,i;return t.preventDefault(),t.stopPropagation(),n=(i=angular.element(t.currentTarget)).data("role-id"),e=i.data("point-id"),o.$el.find(".popover").popover().close(),(r=_.clone(o.us.points,!0))[n]=e,o.onSelectedPointForRole(n,e,r)}))},e.prototype.renderPointsSelector=function(e,t){var r,n,i=_.map(this.points,(n=this,function(t){return(t=_.clone(t,!0)).selected=n.us.points[e]!==t.id,t})),o=_.some(i,function(t){return 5<t.name.length}),s=u({points:i,roleId:e,horizontal:o});if(this.$el.find(".popover").popover().close(),this.$el.find(".pop-points-open").remove(),null!=t?this.$el.find(t).append(s):this.$el.append(s),this.$el.find(".pop-points-open").popover().open(function(){return $(this).removeClass("active").closest("li").removeClass("active")}),this.$el.find(".pop-points-open").show(),(r=this.$el.find(".pop-points-open")).offset().top+r.height()>document.body.clientHeight)return r.addClass("pop-bottom")},c=e,{create:function(t,e,r){var n;return t.unbind("click"),(n=new c(t,e,r)).isEditable&&n.bindClickEvents(),n}}},r.factory("$tgEstimationsService",["$tgTemplate","$tgRepo","$tgConfirm","$q","$tgQqueue",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h=this.taiga,f=angular.module("taigaCommon"),g=function(){return function(t,e){return t===[null,void 0]?e:t}};f.filter("default",g),p=function(e){return function(t){return t?e.instant("COMMON.YES"):e.instant("COMMON.NO")}},f.filter("yesNo",["$translate",p]),l=function(){return h.unslugify},f.filter("unslugify",l),o=function(){return function(t,e){return t?moment(t).format(e):""}},f.filter("momentFormat",o),s=function(){return function(t,e){return t?moment(t).fromNow(e||!1):""}},f.filter("momentFromNow",s),d=this,a=function(){return d.taiga.sizeFormat},f.filter("sizeFormat",a),u=function(){var t=function(t){return t.toJS()},e=_.memoize(t);return function(t){return t instanceof Immutable.List?e(t):t}},f.filter("toMutable",u),t=function(n){return function(t,e){var r;return null!=e&&e.startsWith("#")?(r=e.substr(1),_.filter(t,function(t){return String(t.ref).startsWith(r)})):n(t,e)}},f.filter("byRef",["filterFilter",t]),e=function(){return function(t,e){var r,n,i,o,s,a;for((t=new String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0,s="#",o=(a=[i=0,1,2]).length;i<o;i++)n=a[i],r=parseInt(t.substr(2*n,2),16),s+=("00"+(r=Math.round(Math.min(Math.max(0,r+255*e),255)).toString(16))).substr(r.length);return s}},f.filter("darker",e),i=function(e){return function(t){return t?e.getHTML(t):""}},f.filter("markdownToHTML",["tgWysiwygService",i]),n=function(n){return function(t,e,r){if(e)return n("filter")(t,function(t){return-1!==e.indexOf(t[r])})}},f.filter("inArray",["$filter",n]),r=function(e){return function(t){return t?e.replaceEmojiNameByHtmlImgs(_.escape(t)):""}},f.filter("emojify",["$tgEmojis",r]),c=function(t){return function(t){return t?t.replace(/\<(?!(\/?)(strong|br)(\/?)).*?\>/g,""):""}},f.filter("textToHTML",["$filter",c])}.call(this),function(){function t(t,e){for(var r in e)d.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i,o,s,a,c,D,m,N,u,x,l,p,d={}.hasOwnProperty,L=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function h(t,e,r){this.animationFrame=t,this.q=e,this.rootScope=r}function f(){return f.__super__.constructor.apply(this,arguments)}u=angular.module("taigaCommon"),this.taiga.bindOnce,this.taiga.timeout,D=this.taiga.debounce,this.taiga.sizeFormat,x=this.taiga.trim,this.taiga.normalizeString,l=taiga.Service,t(h,l),h.prototype.open=function(e,t,r,n){var i,o,s;return this.onClose=t,_.isString(e)&&(e=$(e)),i=this.q.defer(),(o=e.children().not(".close")).hide(),this.animationFrame.add(function(){return e.css("display","flex")}),this.animationFrame.add(function(){return e.addClass("open"),e.one("transitionend",function(){var t=e.find("input:not(.no-focus),textarea:not(.no-focus)").first();return t.length?t.focus():document.activeElement?$(document.activeElement).blur():void 0})}),this.animationFrame.add(function(){return o.show(),i.resolve()}),n||angular.element(document).on("keydown.lightbox",(s=this,function(t){if(27===(t.keyCode?t.keyCode:t.which))return r?s.rootScope.$applyAsync(r):s.close(e)})),i.promise},h.prototype.close=function(n){return new Promise((i=this,function(t){var e,r;if(_.isString(n)&&(n=$(n)),(e=angular.element(document)).off(".lightbox"),e.off(".keyboard-navigation"),n.addClass("close-started"),i.animationFrame.add(function(){return n.addClass("close"),n.one("transitionend",function(){return n.removeAttr("style"),n.removeClass("open").removeClass("close").removeClass("close-started"),i.onClose&&i.rootScope.$apply(i.onClose),t()})}),n.hasClass("remove-on-close"))return(r=n.data("scope"))&&r.$destroy(),n.remove()}));var i},h.prototype.getLightboxOpen=function(){return $(".lightbox.open:not(.close-started)")},h.prototype.closeAll=function(){for(var t,e=angular.element(document).find(".lightbox.open"),r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(this.close($(t)));return r},u.service("lightboxService",["animationFrame","$q","$rootScope",h]),p=taiga.Service,t(f,p),f.prototype.stop=function(){return angular.element(document).off(".keyboard-navigation")},f.prototype.dispatch=function(t,e){var r,n,i=t.find(".selected");if(13===e)return 1===t.find(".user-list-single").length?t.find(".user-list-single:first").trigger("click"):i.trigger("click");if(40===e){if(!i.length)return t.find('.user-list-single:not(".is-active"):first').addClass("selected");if((r=i.next(".user-list-single")).length)return i.removeClass("selected"),r.addClass("selected")}else if(38===e){if(!i.length)return t.find(".user-list-single:last").addClass("selected");if((n=i.prev('.user-list-single:not(".is-active")')).length)return i.removeClass("selected"),n.addClass("selected")}},f.prototype.init=function(r){var n;return this.stop(),angular.element(document).on("keydown.keyboard-navigation",(n=this,function(t){var e=t.keyCode?t.keyCode:t.which;if(40===e||38===e||13===e)return t.preventDefault(),n.dispatch(r,e)}))},u.service("lightboxKeyboardNavigationService",f),o=function(n){return{restrict:"C",link:function(t,e,r){if(!r.$attr.visible)return e.on("click",".close",function(t){return t.preventDefault(),n.close(e)})}}},u.directive("lightbox",["lightboxService",o]),e=function(a,t,c,u,l,p,d){return{templateUrl:"common/lightbox/lightbox-block.html",link:function(t,r,e,n){var i,o,s=d.instant(e.title);return r.find("h2.title").text(s),o=function(t){var e=p.save(function(t){return t.is_blocked=!1,t.blocked_note="",t});return e.then(function(){return c.notify("success"),a.$broadcast("object:updated"),t()}),e.then(null,function(){return c.notify("error"),item.revert()}),e.finally(function(){return t()}),e},i=function(){var t=l().target(r.find(".button-green")).start(),e=p.save(function(t){return t.is_blocked=!0,t.blocked_note=r.find(".reason").val(),t});return e.then(function(){return c.notify("success"),a.$broadcast("object:updated")}),e.then(null,function(){return c.notify("error")}),e.finally(function(){return t.finish(),u.close(r)})},t.$on("block",function(){return r.find(".reason").val(n.$modelValue.blocked_note),u.open(r)}),t.$on("unblock",function(t,e,r){return o(r)}),t.$on("$destroy",function(){return r.off()}),r.on("click",".button-green",function(t){return t.preventDefault(),i()})},require:"ngModel"}},u.directive("tgLbBlock",["$rootScope","$tgRepo","$tgConfirm","lightboxService","$tgLoading","$tgQueueModelTransformation","$translate",e]),r=function(i,t,e){var r=t.get("common/lightbox/lightbox-blocking-message-input.html",!0);return{template:function(t,e){return r({ngmodel:e.ngModel})},link:function(t,e,r,n){return r.watch?t.$watch(r.watch,function(t){return!0===t&&!0===t?e.find(".blocked-note").removeClass("hidden"):e.find(".blocked-note").addClass("hidden")}):i.error("No watch attribute on tg-blocking-message-input directive")},require:"ngModel",restrict:"EA"}},u.directive("tgBlockingMessageInput",["$log","$tgTemplate","$compile",r]),n=function(t,a,c,u,l,p){return{link:function(n,i,t){var e,o,s=null;return n.$on("usform:bulk",function(t,e,r){return s&&s.reset(),n.new={projectId:e,statusId:r,bulk:""},u.open(i)}),e=D(2e3,function(t){var e,r;if(t.preventDefault(),(s=i.find("form").checksley({onlyOneErrorElement:!0})).validate())return e=l().target(o).start(),(r=a.userstories.bulkCreate(n.new.projectId,n.new.statusId,n.new.bulk)).then(function(t){return t=_.map(t.data,function(t){return p.make_model("userstories",t)}),e.finish(),c.$broadcast("usform:bulk:success",t),u.close(i)}),r.then(null,function(t){if(e.finish(),s.setErrors(t),t._error_message)return $confirm.notify("error",t._error_message)})}),o=i.find(".submit-button"),i.on("submit","form",e),n.$on("$destroy",function(){return i.off()})}}},u.directive("tgLbCreateBulkUserstories",["$tgRepo","$tgResources","$rootScope","lightboxService","$tgLoading","$tgModel",n]),s=function(n,t,e){return{templateUrl:"common/lightbox/lightbox-leave-project-warning.html",link:function(t,e,r){return n.open(e)},scope:!0}},u.directive("tgLightboxLeaveProjectWarning",["lightboxService",s]),c=function(a,c,u,l,p,d){return{templateUrl:"common/lightbox/lightbox-due-date.html",link:function(n,o,t){var e,i,s=l.instant("COMMON.PICKERDATE.FORMAT");return c.open(o),n.object.due_date&&(n.new_due_date=moment(n.object.due_date).format(s)),o.on("click",".suggestion",function(t){var e=angular.element(t.currentTarget),r=e.data("quantity"),n=e.data("unit"),i=moment().add(r,n).format(s);return o.find(".due-date").val(i)}),i=function(){var e,t,r=u().target(o.find(".submit-button")).start();return n.notAutoSave?(e=$(".due-date").val(),n.object.due_date=e?moment(e,s).format("YYYY-MM-DD"):null,n.$apply(),r.finish(),void c.close(o)):((t=d.save(function(t){return e=$(".due-date").val(),t.due_date=e?moment(e,s).format("YYYY-MM-DD"):null,t})).then(function(){return p.notify("success")}),t.then(null,function(){return p.notify("error")}),t.finally(function(){return r.finish(),c.close(o),a.$broadcast("object:updated")}))},o.on("click",".submit-button",function(t){return t.preventDefault(),i()}),e=function(){var t=l.instant("LIGHTBOX.DELETE_DUE_DATE.TITLE"),e=l.instant("LIGHTBOX.DELETE_DUE_DATE.SUBTITLE"),r=moment(n.object.due_date).format(s);return p.askOnDelete(t,r,e).then(function(t){return t.finish(),$(".due-date").val(null),n.object.due_date_reason=null,n.notAutoSave?(n.object.due_date=null,c.close(o)):i()})},o.on("click",".delete-due-date",function(t){return t.preventDefault(),e()})},scope:!0}},u.directive("tgLbSetDueDate",["$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$tgQueueModelTransformation",c]),N=this.taiga.groupBy,i=function(k,$,I,E,T,C,P,w,A,O,R,M,U){return{link:function(s,i,t){var e,r,o,a,c,n,u,l,p,d,h,f,g,m,v=null,y=null,b=Immutable.List(),S=Immutable.List(),j={us:{objName:"User Story",model:"userstories",params:{include_attachments:!0,include_tasks:!0},data:function(t){return{translationID:"US",translationIDPlural:"US",statusList:_.sortBy(t.us_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",tags:[],points:{},status:t.statusId?t.statusId:t.project.default_us_status,is_archived:!1}}},task:{objName:"Task",model:"tasks",params:{include_attachments:!0},data:function(t){return{translationID:"TASK",translationIDPlural:"TASKS",statusList:_.sortBy(t.task_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",assigned_to:null,tags:[],milestone:t.sprintId,status:t.project.default_task_status,user_story:t.usId,is_archived:!1}}},issue:{objName:"Issue",model:"issues",params:{include_attachments:!0},data:function(t){return{translationID:"ISSUE",translationIDPlural:"ISSUES",project:t,statusList:_.sortBy(t.issue_statuses,"order"),typeById:N(t.issue_types,function(t){return t.id}),typeList:_.sortBy(t.issue_types,"order"),severityById:N(t.severities,function(t){return t.id}),severityList:_.sortBy(t.severities,"order"),priorityById:N(t.priorities,function(t){return t.id}),priorityList:_.sortBy(t.priorities,"order"),milestonesById:N(t.milestones,function(t){return t.id})}},initialData:function(t){return{assigned_to:null,milestone:t.sprintId,priority:t.project.default_priority,project:t.project.id,severity:t.project.default_severity,status:t.project.default_issue_status,subject:"",tags:[],type:t.project.default_issue_type}}}};return s.setMode=function(t){return s.mode=t},s.$on("genericform:new",function(t,e){return n(e),s.mode="new",s.getOrCreate=!1,l(e)}),s.$on("genericform:new-or-existing",function(t,e){return n(e),s.mode="add-existing",s.getOrCreate=!0,s.existingFilterText="",E[v.model].listInAllProjects({project:s.project.id},!0).then(function(t){return s.existingItems=angular.copy(t)}),l(e)}),s.$on("genericform:edit",function(t,e){return n(e),s.mode="edit",s.getOrCreate=!1,l(e)}),n=function(t){return _.map(t,function(t,e){return s[e]=t}),s.objType&&j[s.objType]?v=j[s.objType]:k.error("Invalid objType `"+s.objType+"` for `genericform` event")},l=function(t){return s.objName=v.objName,"edit"===s.mode?(s.obj=t.obj,s.attachments=Immutable.fromJS(t.attachments)):(s.obj=I.make_model(v.model,v.initialData(t)),s.attachments=Immutable.List()),_.map(v.data(s.project),function(t,e){return s[e]=t}),y&&y.reset(),d(),f(s.obj.status),p(),s.lightboxOpen=!0,C.open(i,null,null,!0)},d=function(){return b=Immutable.List(),S=Immutable.List()},s.addAttachment=function(t){return b=b.push(t)},s.deleteAttachment=function(e){if(b=b.filter(function(t){return t.get("name")!==e.get("name")}),e.get("id"))return S=S.push(e)},s.addTag=function(t,e){var r,n=x(t.toLowerCase()),i=s.project.tags,o=s.project.tags_colors;if(null==i&&(i=[]),null==o&&(o={}),L.call(i,n)<0&&i.push(n),o[t]=e||null,s.project.tags=i,r=_.clone(s.obj.tags),!_.find(r,function(t){return t[0]===n}))return r.push([n,e]),s.obj.tags=r},s.deleteTag=function(t){var e=x(t[0].toLowerCase()),r=(s.project.tags,_.clone(s.obj.tags));return _.remove(r,function(t){return t[0]===e}),s.obj.tags=r,_.pull(s.obj.tags,e)},a=function(e){var t=_.map(b.toJS(),function(t){return R.upload(t.file,e.id,s.obj.project,s.objType)});return O.all(t)},c=function(t){var e=_.map(S.toJS(),function(t){return R.delete(s.objType,t.id)});return O.all(e)},e=function(t){P().target(i.find(".add-existing-button")).start();return t.milestone?g(t):h(t,function(){return o(),T.$broadcast(s.objType+"form:add:success",t)},function(){return o()})},g=function(e){var t=s.milestonesById[e.milestone].name,r=s.milestonesById[s.relatedObjectId].name,n=w.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.TITLE"),i=w.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.MESSAGE",{issue:e.subject,oldSprintName:t,newSprintName:r});return A.ask(n,null,i).then(function(t){return h(e,function(){return t.finish(),C.closeAll(),s.lightboxOpen=!1,T.$broadcast(s.objType+"form:add:success",e)},function(){return t.finish(!1),A.notify("error")})})},h=function(t,e,r){return t.setAttr(s.relatedField,s.relatedObjectId),$.save(t,!0).then(e,r)},u=function(t){return t&&t[s.relatedField]===s.relatedObjectId},s.isDisabledExisting=u,s.addExistingToSprint=e,m=D(2e3,function(t){var e,r,n;if((y=i.find("form").checksley()).validate())return r=P().target(i.find("#submitButton")).start(),e="new"===s.mode?(n=$.create(v.model,s.obj),s.objType+"form:new:success"):(s.obj.due_date instanceof moment&&(w.instant("COMMON.PICKERDATE.FORMAT"),s.obj.due_date=s.obj.due_date.format("YYYY-MM-DD")),n=$.save(s.obj,!0),s.objType+"form:edit:success"),n.then(function(t){return c().then(function(){return a(t).then(function(){if(r.finish(),A.notify("success"),o(),t.ref)return E[v.model].getByRef(t.project,t.ref,v.params).then(function(t){return T.$broadcast(e,t)})})})}),n.then(null,function(t){if(r.finish(),y.setErrors(t),t._error_message)return A.notify("error",t._error_message)})}),r=function(){return s.obj.isModified()?A.ask(w.instant("LIGHTBOX.CREATE_EDIT.CONFIRM_CLOSE")).then(function(t){return t.finish(),o()}):(o(),s.$apply(function(){return s.obj.revert()}))},o=function(){return C.closeAll(),s.lightboxOpen=!1},angular.element(document).on("keydown.lightbox-create-edit",function(t){if(s.lightboxOpen&&(t.stopPropagation(),27===(t.keyCode?t.keyCode:t.which)))return r()}),i.on("submit","form",m),i.find(".close").on("click",function(t){return t.preventDefault(),t.stopPropagation(),r()}),i.on("click",".status-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){return t.preventDefault(),t.stopPropagation(),f(angular.element(t.currentTarget).data("status-id")),s.$apply(),s.$broadcast("status:changed",s.obj.status),i.find(".pop-status").popover().close()}),i.on("click",".team-requirement",function(t){return s.obj.team_requirement=!s.obj.team_requirement,s.$apply()}),i.on("click",".client-requirement",function(t){return s.obj.client_requirement=!s.obj.client_requirement,s.$apply()}),i.on("click",".is-blocked",function(t){return s.obj.is_blocked=!s.obj.is_blocked,s.$apply()}),i.on("click",".iocaine",function(t){return s.obj.is_iocaine=!s.obj.is_iocaine,s.$broadcast("isiocaine:changed",s.obj)}),s.isTeamRequirement=function(){var t;return null!=(t=s.obj)?t.team_requirement:void 0},s.isClientRequirement=function(){var t;return null!=(t=s.obj)?t.client_requirement:void 0},f=function(e){return s.obj.status=e,s.selectedStatus=_.find(s.statusList,function(t){return t.id===e}),s.obj.is_closed=s.selectedStatus.is_closed},p=function(t){var e=M.get("common/lightbox/lightbox-create-edit/lb-create-edit.html"),r=s.$new(),n=U(e)(r);return i.html(n)}}}},u.directive("tgLbCreateEdit",["$log","$tgRepo","$tgModel","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$q","tgAttachmentsService","$tgTemplate","$compile",i]),m=this.taiga.debounceLeading,a=function(l,p,d,i,h,t,f,g){return{templateUrl:"common/lightbox/lightbox-relate-to-epic.html",link:function(o,s,t){var a,r,n,c,e,u=null;return o.projects=null,o.projectEpics=Immutable.List(),o.loading=!1,o.selectedProject=o.project.id,c=s.find(".new-epic-form").checksley(),a=s.find(".existing-epic-form").checksley(),n=function(){if(null===o.projects)return o.projects=i.projects.get("unblocked")},r=function(t,e){return h.epics.listInAllProjects({is_epics_activated:!0,project__blocked_code:"null",project:t,q:e},!0).then(function(t){var e,r=[];return u.epics&&(r=u.epics.map(function(t){return t.id})),e=t.filter(function(t){return-1===r.indexOf(t.get("id"))}),o.projectEpics=e})},e=function(t){return o.selectedEpic=null,o.searchEpic="",r(t,o.searchEpic)},s.on("click",".close",function(t){return t.preventDefault(),d.close(s)}),o.$on("relate-to-epic:add",function(t,e){return u=e,o.selectedEpic=null,o.searchEpic="",n(),r(o.selectedProject,o.searchEpic).then(function(){return d.open(s).then(function(){return s.find("input").focus})})}),o.$on("$destroy",function(){return s.off()}),o.selectProject=e,o.onUpdateSearchEpic=m(300,function(){return o.selectedEpic=null,r(o.selectedProject,o.searchEpic)}),o.saveRelatedEpic=function(t,e){var r,n,i;if(a.validate())return o.loading=!0,r=function(t){return o.loading=!1,p.notify("error"),a.setErrors(t)},n=function(t){return g.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,l.$broadcast("related-epics:changed",u),d.close(s)},i=u.id,h.epics.addRelatedUserstory(t,i).then(n,r)},o.createEpic=function(t,e){var r,n,i;if(c.validate())return this.loading=!0,n=function(t){return o.loading=!1,p.notify("error"),c.setErrors(errors)},i=function(){return g.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,l.$broadcast("related-epics:changed",u),d.close(s)},r=function(t){var e=t.get("id"),r=u.id;return h.epics.addRelatedUserstory(e,r).then(i,n)},f.createEpic({subject:e},null,t).then(r,n)}}}},u.directive("tgLbRelatetoepic",["$rootScope","$tgConfirm","lightboxService","tgCurrentUserService","tgResources","$tgResources","tgEpicsService","$tgAnalytics",a])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t,l=this.taiga.timeout,e=angular.module("taigaCommon"),r=function(n,t){return{link:function(t,e,r){return n.onStart(function(){return $(document.body).addClass("loader-active"),e.addClass("active")}),n.onEnd(function(){return $(document.body).removeClass("loader-active"),e.removeClass("active")})}}};e.directive("tgLoader",["tgLoader","$rootScope",r]),(t=function(n){var i={minTime:300},o=!1,s=0,a=0,c=0,e=function(t){var e,r;return null==t&&(t=!1),s&&(r=0,t||(e=(new Date).getTime()-s)<i.minTime&&(r=i.minTime-e),l(r,function(){return n.$broadcast("loader:end"),o=!1,window.prerenderReady=!0})),c=a=s=0},r=function(){var t;return t=setInterval(function(){if(c&&0===a)return e(),clearInterval(t)},50)},u=function(){return s=(new Date).getTime(),n.$broadcast("loader:start"),o=!0};return{pageLoaded:e,open:function(){return o},start:function(t){if(null==t&&(t=!1),!o&&(u(),t))return r()},onStart:function(t){return n.$on("loader:start",t)},onEnd:function(t){return n.$on("loader:end",t)},logRequest:function(){return a++},logResponse:function(){return 0<a&&a--,c=(new Date).getTime()}}}).$inject=["$rootScope"],e.factory("tgLoader",t)}.call(this),function(){var t,e=[].slice,r=angular.module("taigaCommon"),n=function(n){var i="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />";return function(){var r={settings:{target:null,scope:null,classes:[],timeout:0,template:null},target:function(t){return r.settings.target=t,r},scope:function(t){return r.settings.scope=t,r},template:function(t){return r.settings.template=t,r},removeClasses:function(){var t=1<=arguments.length?e.call(arguments,0):[];return r.settings.classes=t,r},timeout:function(t){return r.settings.timeout=t,r},start:function(){var t,e=r.settings.target;return r.settings.classes.map(function(t){return e.removeClass(t)}),e.hasClass("loading")||r.settings.template||(r.settings.template=e.html()),t=setTimeout(function(){if(!e.hasClass("loading"))return e.addClass("loading"),e.html(i)},r.settings.timeout),r.settings.timeoutId=t,r},finish:function(){var t=r.settings.target,e=r.settings.timeoutId;return e&&(clearTimeout(e),r.settings.classes.map(function(t){return r.settings.target.addClass(t)}),t.html(r.settings.template),t.removeClass("loading"),r.settings.scope&&n(t.contents())(r.settings.scope)),r}};return r}};n.$inject=["$compile"],r.factory("$tgLoading",n),t=function(o){return{priority:99999,link:function(e,r,t){var n=null,i=r.html();return e.$watch(t.tgLoading,function(t){return t?n=o().target(r).timeout(100).template(i).scope(e).start():n?n.finish():void 0})}}},r.directive("tgLoading",["$tgLoading",t])}.call(this),function(){var t,u=this.taiga,e=this.taiga.bindOnce,l=this.taiga.debounce,r=angular.module("taigaCommon"),n=function(a,t){var r=t.get("common/popover/popover-us-status.html",!0);return{link:function(i,o,n){o.controller();var t,s=function(t){var e=o.find(".us-status"),r=o.find(".us-status .us-status-bind"),n=i.usStatusById;if(n[t.status])return r.text(n[t.status].name),e.css("color",n[t.status].color)};return o.on("click",".us-status",function(t){return t.preventDefault(),t.stopPropagation(),o.find(".pop-status").popover().open()}),o.on("click",".status",l(2e3,function(t){var e,r;return t.preventDefault(),t.stopPropagation(),e=angular.element(t.currentTarget),(r=i.$eval(n.tgUsStatus)).status=e.data("status-id"),s(r),o.find(".pop-status").popover().close(),i.$apply(function(){return a.save(r).then(function(){return i.$eval(n.onUpdate)})})})),i.$on("userstories:loaded",function(){return s(i.$eval(n.tgUsStatus))}),i.$on("$destroy",function(){return o.off()}),t=i.$eval(n.tgUsStatus),s(t),e(i,"project",function(t){var e=r({statuses:t.us_statuses});if(o.append(e),-1===i.project.my_permissions.indexOf("modify_us"))return o.unbind("click"),o.find("a").addClass("not-clickable")})}}};r.directive("tgUsStatus",["$tgRepo","$tgTemplate",n]),t=function(a,t){var e=t.get("common/popover/popover-related-task-status.html",!0),c=function(t,e,r){var n=t.find(".us-status"),i=t.find(".task-status .task-status-bind");if(r[e.status])return i.text(r[e.status].name),n.css("color",r[e.status].color)};return{link:function(r,n,i){n.controller();var o=r.$eval(i.tgRelatedTaskStatus),s=!r.$eval(i.notAutoSave);return n.on("click",".task-status",function(t){return t.preventDefault(),t.stopPropagation(),n.find(".pop-status").popover().open()}),n.on("click",".status",l(2e3,function(t){var e;if(t.preventDefault(),t.stopPropagation(),e=angular.element(t.currentTarget),o.status=e.data("status-id"),n.find(".pop-status").popover().close(),c(n,o,r.taskStatusById),s)return r.$apply(function(){return a.save(o).then(function(){return r.$eval(i.onUpdate),r.$emit("related-tasks:status-changed")})})})),r.$watch(i.tgRelatedTaskStatus,function(){return o=r.$eval(i.tgRelatedTaskStatus),c(n,o,r.taskStatusById)}),u.bindOnce(r,"project",function(t){if(n.append(e({statuses:t.task_statuses})),c(n,o,r.taskStatusById),-1===t.my_permissions.indexOf("modify_task"))return n.unbind("click"),n.find("a").addClass("not-clickable")}),r.$on("$destroy",function(){return n.off()})}}},r.directive("tgRelatedTaskStatus",["$tgRepo","$tgTemplate",t]),$.fn.popover=function(){var c=this,t=function(){var t,e,r,n,i,o,s,a;return c.css({display:"block",visibility:"hidden"}),t=(r=$(window).scrollTop())+$(window).height(),e=$(window).width(),n=(s=c.offset().top)+c.height(),a=c.width(),i=c.offset().left,o=c.offset().left+a,c.css({display:"none",visibility:"visible"}),n<=t&&r<=s&&0<=i&&o<=e},r=function(t){return t&&t.call(c),c.fadeOut(function(){return c.removeClass("active").removeClass("fix")}),c.off("popup:close")},n=function(){return $(".popover.active").each(function(){return $(this).trigger("popup:close")})},e=function(e){return c.hasClass("active")?i():(n(),t()||c.addClass("fix"),c.fadeIn(function(){return c.addClass("active"),$(document.body).off("popover"),$(document.body).one("click.popover",function(){return n()})}),c.on("popup:close",function(t){return r(e)}))},i=function(){return c.trigger("popup:close")};return{open:e,close:i,closeAll:n}}}.call(this),function(){this.taiga;var t=function(r,t){var e;return this.config=t,(e=this.config.get("ravenConfig",null))?(r.debug("Using the RavenJS exception handler."),Raven.config(e).install(),function(t,e){return r.error.apply(r,arguments),Raven.captureException(t)}):(r.debug("Using the default logging exception handler."),function(t,e){return r.error.apply(r,arguments)})};angular.module("taigaCommon").factory("$exceptionHandler",["$log","$tgConfig",t])}.call(this),function(){var t,a,i={}.hasOwnProperty;function n(t,e){var r;this.translate=t,this.currentUserService=e,n.__super__.constructor.call(this),_.map(a,(r=this,function(t){return t.title=r.translate.instant("PROJECT.SECTION."+t.title)}))}t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,taiga.Service),n.$inject=["$translate","tgCurrentUserService"],a={1:{id:1,title:"TIMELINE",path:"timeline",enabled:""},2:{id:2,title:"EPICS",path:"epics",enabled:"is_epics_activated"},3:{id:3,title:"BACKLOG",path:"backlog",enabled:"is_backlog_activated"},4:{id:4,title:"KANBAN",path:"kanban",enabled:"is_kanban_activated"},5:{id:5,title:"ISSUES",path:"issues",enabled:"is_issues_activated"},6:{id:6,title:"WIKI",path:"wiki",enabled:"is_wiki_activated"}},n.prototype.list=function(){return a},n.prototype.getPath=function(e,t){var r,n,i,o="timeline",s=null!=(n=this.currentUserService.projects)?n.get("all"):void 0;return s&&(r=s.find(function(t){return t.get("slug")===e}))?(t=t||r.get("my_homepage"),(i=_.find(a,{id:t}))&&!1!==(null!=r?r.get(i.enabled):void 0)?i.path:o):o},t.service("$tgSections",n)}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e,r,n,i,o){var s;this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,s=this.config.get("tagManager",{}),this.accountId=s.accountId}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],r.prototype.initialize=function(){if(this.accountId)return this.injectTagManager(),this.initialized=!0;this.log.debug("Tag Manager: no acount id provided. Disabling.")},r.prototype.injectTagManager=function(){return function(t,e,r,n,i){t[n]=t[n]||[],t[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=e.getElementsByTagName(r)[0],s=e.createElement(r),a="dataLayer"!=n?"&l="+n:"";s.async=!0,s.src="https://www.googletagmanager.com/gtm.js?id="+i+a,o.parentNode.insertBefore(s,o)}(window,document,"script","dataLayer",this.accountId)},t.service("$tgTagManager",r)}.call(this),function(){var e,r,m=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},v=(this.taiga,this.taiga.trim),y=this.taiga.bindOnce,n=angular.module("taigaCommon"),i=function(){var i=function(t){return _.isArray(t)?t.join(", "):""},o=function(t){return t?_(t.split(",")).map(function(t){return _.trim(t)}).value():[]};return{require:"ngModel",link:function(t,e,r,n){return n.$formatters.push(i),n.$parsers.push(o),t.$on("$destroy",function(){return e.off()})}}};n.directive("tgTags",i),e=function(o){var s=_.template('<% _.each(tags, function(tag) { %>\n    <% if (tag[1] !== null) { %>\n    <span class="tag"\n          style="border-left: 5px solid <%- tag[1] %>"\n          title="<%- tag[0] %>">\n          <%= emojify(tag[0]) %>\n    </span>\n    <% } %>\n<% }) %>\n<% _.each(tags, function(tag) { %>\n    <% if (tag[1] === null) { %>\n    <span class="tag"\n          title="<%- tag[0] %>">\n          <%= emojify(tag[0]) %>\n    </span>\n    <% } %>\n<% }) %>');return{link:function(t,r,e,n){var i=function(t){var e=s({tags:t,emojify:function(t){return o.replaceEmojiNameByHtmlImgs(_.escape(t))}});return r.html(e)};return t.$watch(e.tgColorizeBacklogTags,function(t){if(null!=t)return i(t)}),t.$on("$destroy",function(){return r.off()})}}},n.directive("tgColorizeBacklogTags",["$tgEmojis",e]),r=function(e,r,h){var f=r.get("common/tag/lb-tag-line-tags.html",!0),g=null;return{link:function(s,a,e,r){var c=_.has(e,"withoutColors"),n=function(e,r){var n,i,o;return null==r&&(r=[]),n=c?null:r[t],i={tags:_.map(e,function(t){return{name:t,style:n?"border-left: 5px solid "+n:""}})},o=h(f(i))(s),a.find(".tags-container").html(o)},i=function(){return a.find(".save").removeClass("hidden")},o=function(){return a.find(".save").addClass("hidden")},u=function(){return a.find("input").val(""),g.close()},l=function(t){var e;if(0!==(t=v(t.toLowerCase())).length)return null==(e=_.clone(r.$modelValue,!1))&&(e=[]),m.call(e,t)<0&&e.push(t),s.$apply(function(){return r.$setViewValue(e)}),o()},p=function(t){var e;if(0!==(t=v(t.toLowerCase())).length)return e=_.clone(r.$modelValue,!1),e=_.pull(e,t),s.$apply(function(){return r.$setViewValue(e)})},d=function(){var t=a.find("input").val();return l(t),u()};return a.on("keypress","input",function(t){var e=angular.element(t.currentTarget);return 13===t.keyCode||","===String.fromCharCode(t.keyCode)?(t.preventDefault(),d()):(e.val().length?i:o)()}),a.on("click",".save",function(t){return t.preventDefault(),d()}),a.on("click",".remove-tag",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget).siblings(".tag-name").text(),p(e)}),y(s,"project",function(t){var e=a.find("input");return g=new Awesomplete(e[0],{list:_.keys(t.tags_colors)}),e.on("awesomplete-selectcomplete",function(){return l(e.val()),e.val("")})}),s.$watch(e.ngModel,function(t){var e,r=(null!=(e=s.project)?e.tags_colors:void 0)||[];return n(t,r)}),s.$on("$destroy",function(){return a.off()})},require:"ngModel",templateUrl:"common/tag/lb-tag-line.html"}},n.directive("tgLbTagLine",["$tgResources","$tgTemplate","$compile",r])}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e){this.rootScope=t,this.win=e,this.initialized=!1}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$window"],r.prototype.initialize=function(){var t,r,n,i,o;if(!this.initialized)return this.rootScope.$on("$locationChangeSuccess",(t=this,function(){if(t.win.userpilot)return t.win.userpilot.reload()})),this.rootScope.$on("auth:refresh",(r=this,function(t,e){return r.identify()})),this.rootScope.$on("auth:register",(n=this,function(t,e){return n.identify()})),this.rootScope.$on("auth:login",(i=this,function(t,e){return i.identify()})),this.rootScope.$on("auth:logout",(o=this,function(t,e){return o.identify()})),this.initialized=!0},r.prototype.checkZendeskConditions=function(t){var e=this.hasPaidPlan(t),r=new Date(t.date_joined)>this.getJoinedLimit();return e&&r},r.prototype.identify=function(){var t,e,r=this.win.localStorage.getItem("userInfo")||"{}",n=JSON.parse(r);if(this.win.userpilot&&(e=this.calculateUserPilotId(n),t=this.prepareUserPilotCustomer(n),this.win.userpilot.identify(e,t)),this.win.zE)return this.checkZendeskConditions(n)?this.setZendeskWidgetStatus({enabled:!0}):this.setZendeskWidgetStatus({enabled:!1})},r.prototype.prepareUserPilotCustomer=function(t){return t.id?{name:t.full_name_display,email:t.email,created_at:Date.now(),taiga_id:t.id,taiga_username:t.username,taiga_date_joined:t.date_joined,taiga_lang:t.lang,taiga_max_private_projects:t.max_private_projects,taiga_max_memberships_private_projects:t.max_memberships_private_projects,taiga_verified_email:t.verified_email,taiga_total_private_projects:t.total_private_projects,taiga_total_public_projects:t.total_public_projects,taiga_roles:t.roles&&t.roles.toString()}:{created_at:Date.now()}},r.prototype.hasPaidPlan=function(t){var e=t.max_private_projects;return void 0!==e&&1!==e},r.prototype.calculateUserPilotId=function(t){return t.id?new Date(t.date_joined)>this.getJoinedLimit()||this.hasPaidPlan(t)?t.id:1:2},r.prototype.getJoinedLimit=function(){var t=new Date;return t.setDate(t.getDate()-42),t},r.prototype.setZendeskWidgetStatus=function(t){var e;return null==t&&(t={enabled:!1}),e=!t.enabled,this.win.zE("webWidget","updateSettings",{webWidget:{chat:{suppress:e},contactForm:{suppress:e},helpCenter:{suppress:e},talk:{suppress:e},answerBot:{suppress:e}}})},t.service("$tgUserPilot",r)}.call(this),function(){this.taiga,this.taiga.bindOnce;var n=this.taiga.debounce,t=function(v,y,t,b,S,j,k){return{link:function(u,l,t){var p,e,d,r,h,f=!1,g=!0,m=null;return u.newSprint={},h=null,d=function(){return m&&m.reset(),u.newSprint={project:null,name:null,estimated_start:null,estimated_finish:null}},r=n(2e3,function(t){var r,n,e,i,o,s,a,c;return t.preventDefault(),angular.element(t.currentTarget),s=k.instant("COMMON.PICKERDATE.FORMAT"),c=l.find(".submit-button"),(m=l.find("form").checksley()).validate()?(f=!1,r=null,i=$(".date-start").val(),e=$(".date-end").val(),r=g?((o=angular.copy(u.newSprint)).estimated_start=moment(i,s).format("YYYY-MM-DD"),o.estimated_finish=moment(e,s).format("YYYY-MM-DD"),a=v.create("milestones",o),"sprintform:create:success"):((o=u.newSprint.realClone()).estimated_start=moment(i,s).format("YYYY-MM-DD"),o.estimated_finish=moment(e,s).format("YYYY-MM-DD"),a=v.save(o),"sprintform:edit:success"),n=j().target(c).start(),a.then(function(e){return n.finish(),g&&(u.sprintsCounter+=1),u.sprints=_.map(u.sprints,function(t){return t.id===e.id?e:t}),"sprintform:create:success"===r&&h?b.$broadcast(r,e,h):b.$broadcast(r,e),S.close(l)}),a.then(null,function(t){return n.finish(),m.setErrors(t),t._error_message?y.notify("light-error",t._error_message):t.__all__?y.notify("light-error",t.__all__[0]):void 0})):(f=!0,void l.find(".last-sprint-name").addClass("disappear"))}),e=function(){var t=k.instant("LIGHTBOX.DELETE_SPRINT.TITLE"),e=u.newSprint.name;return y.askOnDelete(t,e).then(function(t){var e=function(){return t.finish(),--u.milestonesCounter,S.close(l),b.$broadcast("sprintform:remove:success",u.newSprint)},r=function(){return t.finish(!1),y.notify("error")};return v.remove(u.newSprint).then(e,r)})},p=function(){var t=_.filter(u.sprints,function(t){return!t.closed}),e=_.sortBy(t,function(t){return moment(t.estimated_finish,"YYYY-MM-DD").format("X")});return e[e.length-1]},u.$on("sprintform:create",function(t,e,r){var n,i,o,s,a,c;return h=r,d(),(m=l.find("form").checksley()).reset(),g=!0,a=k.instant("COMMON.PICKERDATE.FORMAT"),u.newSprint.project=e,u.newSprint.name=null,u.newSprint.slug=null,o=p(),i=moment(),o?i=moment(o.estimated_finish):u.newSprint.estimated_start&&(i=moment(u.newSprint.estimated_start)),u.newSprint.estimated_start=i.format(a),n=moment().add(2,"weeks"),o?n=moment(o.estimated_finish).add(2,"weeks"):u.newSprint.estimated_finish&&(n=moment(u.newSprint.estimated_finish)),u.newSprint.estimated_finish=n.format(a),s=l.find(".last-sprint-name"),null!=(null!=o?o.name:void 0)&&(c=k.instant("LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME",{lastSprint:o.name}),s.html(c)),l.find(".delete-sprint").addClass("hidden"),c=k.instant("LIGHTBOX.ADD_EDIT_SPRINT.TITLE"),l.find(".title").text(c),c=k.instant("COMMON.CREATE"),l.find(".button-green").text(c),S.open(l),l.find(".sprint-name").focus(),l.find(".last-sprint-name").removeClass("disappear")}),u.$on("sprintform:edit",function(t,e){var r,n,i;return d(),g=!1,n=k.instant("COMMON.PICKERDATE.FORMAT"),u.$apply(function(){return u.newSprint=e.realClone(),u.newSprint.estimated_start=moment(u.newSprint.estimated_start).format(n),u.newSprint.estimated_finish=moment(u.newSprint.estimated_finish).format(n)}),l.find(".delete-sprint").removeClass("hidden"),r=k.instant("BACKLOG.EDIT_SPRINT"),l.find(".title").text(r),i=k.instant("COMMON.SAVE"),l.find(".button-green").text(i),S.open(l),l.find(".sprint-name").focus().select(),l.find(".last-sprint-name").addClass("disappear")}),l.on("keyup",".sprint-name",function(t){return 0<l.find(".sprint-name").val().length||f?l.find(".last-sprint-name").addClass("disappear"):l.find(".last-sprint-name").removeClass("disappear")}),l.on("submit","form",r),l.on("click",".delete-sprint",function(t){return t.preventDefault(),e()}),u.$on("$destroy",function(){return l.off()}),d()}}};angular.module("taigaBacklog").directive("tgLbCreateEditSprint",["$tgRepo","$tgConfirm","$tgResources","$rootScope","lightboxService","$tgLoading","$translate",t])}.call(this),function(){var t,e,r,n,i,o,k,c,u,s,a,l,p,d,g,m,h={}.hasOwnProperty;function f(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,_,b){var S,j;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.appMetaService=c,this.navUrls=u,this.events=l,this.analytics=p,this.translate=d,this.loading=h,this.rs2=f,this.modelTransform=g,this.errorHandlingService=m,this.storage=v,this.filterRemoteStorageService=y,this.projectService=_,this.tgLoader=b,k(this),this.backlogOrder={},this.milestonesOrder={},this.page=1,this.disablePagination=!1,this.firstLoadComplete=!1,this.scope.userstories=[],this.applyStoredFilters(this.params.pslug,"backlog-filters")||(this.scope.sectionName=this.translate.instant("BACKLOG.SECTION_NAME"),this.showTags=!1,this.activeFilters=!1,this.scope.showGraphPlaceholder=null,this.displayVelocity=!1,this.initializeEventHandlers(),(S=this.loadInitialData()).then((j=this,function(){var t,e;if(j.firstLoadComplete=!0,e=j.translate.instant("BACKLOG.PAGE_TITLE",{projectName:j.scope.project.name}),t=j.translate.instant("BACKLOG.PAGE_DESCRIPTION",{projectName:j.scope.project.name,projectDescription:j.scope.project.description}),j.appMetaService.setAll(e,t),j.rs.userstories.getShowTags(j.scope.projectId))return j.showTags=!0,j.scope.$broadcast("showTags",j.showTags)})),S.then(null,this.onInitialDataError.bind(this)))}d=this.taiga,a=this.taiga.mixOf,m=this.taiga.toggleText,p=this.taiga.scopeDefer,c=this.taiga.bindOnce,s=this.taiga.groupBy,g=this.taiga.timeout,k=this.taiga.bindMethods,u=this.taiga.generateHash,l=angular.module("taigaBacklog"),function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(f,a(d.Controller,d.PageMixin,d.FiltersMixin,d.UsFiltersMixin)),f.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","$tgLoading","tgResources","$tgQueueModelTransformation","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgLoader"],f.prototype.storeCustomFiltersName="backlog-custom-filters",f.prototype.storeFiltersName="backlog-filters",f.prototype.backlogOrder={},f.prototype.milestonesOrder={},f.prototype.filtersReloadContent=function(){return this.loadUserstories(!0)},f.prototype.initializeEventHandlers=function(){var t,n,e,r,i,o,s,a;return this.scope.$on("usform:bulk:success",(t=this,function(){return t.loadUserstories(!0),t.loadProjectStats(),t.confirm.notify("success"),t.analytics.trackEvent("userstory","create","bulk create userstory on backlog",1)})),this.scope.$on("sprintform:create:success",(n=this,function(t,e,r){return n.loadSprints().then(function(){return n.scope.$broadcast("sprintform:create:success:callback",r)}),n.loadProjectStats(),n.confirm.notify("success"),n.analytics.trackEvent("sprint","create","create sprint on backlog",1)})),this.scope.$on("usform:new:success",(e=this,function(){return e.loadUserstories(!0),e.loadProjectStats(),e.rootscope.$broadcast("filters:update"),e.analytics.trackEvent("userstory","create","create userstory on backlog",1)})),this.scope.$on("sprintform:edit:success",(r=this,function(){return r.loadProjectStats()})),this.scope.$on("sprintform:remove:success",(i=this,function(t,e){return i.loadSprints(),i.loadProjectStats(),i.loadUserstories(!0),e.closed&&i.loadClosedSprints(),i.rootscope.$broadcast("filters:update")})),this.scope.$on("usform:edit:success",(o=this,function(t,e){var r=_.findIndex(o.scope.userstories,function(t){return t.id===e.id});return o.scope.userstories[r]=e,o.rootscope.$broadcast("filters:update")})),this.scope.$on("filters:update",(s=this,function(){return s.generateFilters("null")})),this.scope.$on("sprint:us:move",this.moveUs),this.scope.$on("sprint:us:moved",(a=this,function(){return a.loadSprints(),a.loadProjectStats(),a.rootscope.$broadcast("filters:update")})),this.scope.$on("backlog:load-closed-sprints",this.loadClosedSprints),this.scope.$on("backlog:unload-closed-sprints",this.unloadClosedSprints)},f.prototype.initializeSubscription=function(){var t,e,r,n="changes.project."+this.scope.projectId+".userstories";return this.events.subscribe(this.scope,n,(e=this,function(t){return e.loadAllPaginatedUserstories(),e.loadSprints()})),t="changes.project."+this.scope.projectId+".milestones",this.events.subscribe(this.scope,t,(r=this,function(t){return r.loadSprints()}))},f.prototype.toggleShowTags=function(){return this.scope.$apply((t=this,function(){return t.showTags=!t.showTags,t.rs.userstories.storeShowTags(t.scope.projectId,t.showTags)}));var t},f.prototype.toggleActiveFilters=function(){return this.activeFilters=!this.activeFilters},f.prototype.toggleVelocityForecasting=function(){return this.displayVelocity=!this.displayVelocity,this.displayVelocity?this.scope.visibleUserStories=_.map(this.forecastedStories,function(t){return t.ref}):this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),p(this.scope,(t=this,function(){return t.scope.$broadcast("userstories:loaded")}));var t},f.prototype.loadProjectStats=function(){return this.rs.projects.stats(this.scope.projectId).then((r=this,function(t){var e=(r.scope.stats=t).total_points?t.total_points:t.defined_points;return r.scope.stats.completedPercentage=e?Math.round(100*t.closed_points/e):0,r.scope.showGraphPlaceholder=!(null!=t.total_points&&null!=t.total_milestones),r.calculateForecasting(),t}));var r},f.prototype.setMilestonesOrder=function(t){for(var i,o,e=[],r=0,n=t.length;r<n;r++)o=t[r],this.milestonesOrder[o.id]={},e.push(function(){for(var t=o.user_stories,e=[],r=0,n=t.length;r<n;r++)i=t[r],e.push(this.milestonesOrder[o.id][i.id]=i.sprint_order);return e}.call(this));return e},f.prototype.unloadClosedSprints=function(){return this.scope.$apply((t=this,function(){return t.scope.closedSprints=[],t.rootscope.$broadcast("closed-sprints:reloaded",[])}));var t},f.prototype.loadClosedSprints=function(){var o,t={closed:!0};return this.rs.sprints.list(this.scope.projectId,t).then((o=this,function(t){var e,r,n,i=t.milestones;for(o.setMilestonesOrder(i),o.scope.totalClosedMilestones=t.closed,e=0,r=i.length;e<r;e++)(n=i[e]).user_stories=_.sortBy(n.user_stories,"sprint_order");return o.scope.closedSprints=i,o.scope.closedSprintsById=s(i,function(t){return t.id}),o.rootscope.$broadcast("closed-sprints:reloaded",i),i}))},f.prototype.loadSprints=function(){var o,t={closed:!1};return this.rs.sprints.list(this.scope.projectId,t).then((o=this,function(t){var e,r,n,i=t.milestones;for(o.setMilestonesOrder(i),o.scope.totalMilestones=i,o.scope.totalClosedMilestones=t.closed,o.scope.totalOpenMilestones=t.open,o.scope.totalMilestones=o.scope.totalOpenMilestones+o.scope.totalClosedMilestones,e=0,r=i.length;e<r;e++)(n=i[e]).user_stories=_.sortBy(n.user_stories,"sprint_order");return o.scope.sprints=i,o.scope.closedSprints||(o.scope.closedSprints=[]),o.scope.sprintsCounter=i.length,o.scope.sprintsById=s(i,function(t){return t.id}),o.rootscope.$broadcast("sprints:loaded",i),o.scope.currentSprint=o.findCurrentSprint(),i}))},f.prototype.openSprints=function(){return _.filter(this.scope.sprints,function(t){return!t.closed}).reverse()},f.prototype.loadAllPaginatedUserstories=function(){var t,e=this.page;return this.loadUserstories(!0,this.scope.userstories.length).then((t=this,function(){return t.page=e}))},f.prototype.loadUserstories=function(a,t){var e,c;return null==a&&(a=!1),this.scope.projectId?(this.loadingUserstories=!0,this.disablePagination=!0,e=_.clone(this.location.search()),this.rs.userstories.storeQueryParams(this.scope.projectId,e),a&&(this.page=1),e.page=this.page,this.rs.userstories.listUnassigned(this.scope.projectId,e,t).then((c=this,function(t){var e,r,n,i,o=t[0],s=t[1];for(a&&(c.scope.userstories=[]),c.scope.userstories=c.scope.userstories.concat(_.sortBy(o,"backlog_order")),c.scope.visibleUserStories=_.map(c.scope.userstories,function(t){return t.ref}),r=0,n=(i=c.scope.userstories).length;r<n;r++)e=i[r],c.backlogOrder[e.id]=e.backlog_order;return c.loadingUserstories=!1,s("x-pagination-next")&&(c.disablePagination=!1,c.page++),c.rootscope.$broadcast("backlog:userstories:loaded"),p(c.scope,function(){return c.scope.$broadcast("userstories:loaded"),c.tgLoader.pageLoaded()}),o}))):null},f.prototype.loadBacklog=function(){return this.q.all([this.loadProjectStats(),this.loadSprints(),this.loadUserstories()]).then(this.calculateForecasting)},f.prototype.calculateForecasting=function(){var t,e,r,n,i,o=this.scope.stats,s=(o.total_points,o.assigned_points,0);for(this.forecastedStories=[],n=[],t=0,e=(r=this.scope.userstories).length;t<e&&((i=r[t]).total_points,s+=i.total_points,this.forecastedStories.push(i),!(0<o.speed&&s>o.speed));t++)n.push(void 0);return n},f.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_backlog_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.closedMilestones=!!t.total_closed_milestones,this.scope.$emit("project:loaded",t),this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=s(t.points,function(t){return t.id}),this.scope.usStatusById=s(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"id"),t},f.prototype.loadInitialData=function(){var t,e,r=this.loadProject();return this.fillUsersAndRoles(r.members,r.roles),this.initializeSubscription(),this.loadBacklog().then((e=this,function(){return e.generateFilters("null")})).then((t=this,function(){return t.scope.$emit("backlog:loaded")}))},f.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="backlog_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},f.prototype.moveUs=function(t,r,e,n){var i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I,E,T,C,P,w,A,O,R,M,U,D,N,x,L,F,B,H,q,G,V,z=r[0].milestone,W=r[0].project;if(z&&(B=this.scope.sprintsById[z]||this.scope.closedSprintsById[z]),n&&(I=this.scope.sprintsById[n]||this.scope.closedSprintsById[n]),s=n!==z?n:z,P=null,C="",n!==z)if(null===n){for(l=u=0,d=r.length;u<d;l=++u)q=r[l],_.remove(B.user_stories,function(t){return t.id===q.id});C="backlog_order",P=this.backlogOrder,o=_.slice(this.scope.userstories,0,e),i=_.slice(this.scope.userstories,e),this.scope.userstories=this.scope.userstories.concat(r)}else{for(p=0,h=r.length;p<h;p++)q=r[p],_.remove(this.scope.userstories,function(t){return t.id===q.id});C="sprint_order",P=this.milestonesOrder[I.id],o=_.slice(I.user_stories,0,e),i=_.slice(I.user_stories,e),I.user_stories=I.user_stories.concat(r)}else i=(o=(S=null===z?(C="backlog_order",P=this.backlogOrder,_.filter(this.scope.userstories,function(e){return!_.find(r,function(t){return e.id===t.id})})):(C="sprint_order",P=this.milestonesOrder[B.id],_.filter(I.user_stories,function(e){return!_.find(r,function(t){return e.id===t.id})})),_.slice(S,0,e)),_.slice(S,e));for(F=[],(A=o[o.length-1])?A&&(H=P[A.id]+1,1<(O=_.filter(o,function(t){return t[C]===P[A.id]})).length&&(F=_.map(O,function(t){return{us_id:t.id,order:P[t.id]}}))):H=0,k=[],l=j=0,f=r.length;j<f;l=++j)(q=r[l]).milestone=s,q[C]=H+l,P[q.id]=q[C],k.push({us_id:q.id,order:q[C]});for(H=P[r[r.length-1].id],l=$=0,g=i.length;$<g;l=++$)c=i[l],P[c.id]=H+l+1;for(x=_.map(i,function(t){return{us_id:t.id,order:P[t.id]}}),this.scope.userstories=_.sortBy(this.scope.userstories,(G=this,function(t){return G.backlogOrder[t.id]})),this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),E=0,m=(D=this.scope.sprints).length;E<m;E++)(B=D[E]).user_stories=_.sortBy(B.user_stories,function(e){return function(t){return e.milestonesOrder[B.id][t.id]}}(this));for(w=0,v=(N=this.scope.closedSprints).length;w<v;w++)(B=N[w]).user_stories=_.sortBy(B.user_stories,function(e){return function(t){return e.milestonesOrder[B.id][t.id]}}(this));if(1<r.length&&n!==z)a=k.concat(F,x),R=this.rs.userstories.bulkUpdateMilestone(W,n,a);else if(1<r.length)a=k.concat(F,x),R=this.rs.userstories.bulkUpdateBacklogOrder(W,a);else{for(L={},M=0,y=F.length;M<y;M++)L[(c=F[M]).us_id]=c.order;for(U=0,b=x.length;U<b;U++)L[(c=x[U]).us_id]=c.order;T={headers:{"set-orders":JSON.stringify(L)}},R=this.repo.save(r[0],!0,{},T,!0)}return R.then((V=this,function(){if(V.rootscope.$broadcast("sprint:us:moved"),V.scope.closedSprintsById&&V.scope.closedSprintsById[z])return V.rootscope.$broadcast("backlog:load-closed-sprints")})),R},f.prototype.updateUserStoryStatus=function(){return this.generateFilters().then((t=this,function(){if(t.rootscope.$broadcast("filters:update"),t.loadProjectStats(),t.isFilterDataTypeSelected("status"))return t.filtersReloadContent()}));var t},f.prototype.editUserStory=function(t,e,r){var n,i=$(r.target),o=this.loading().target(i).removeClasses("edit-story").timeout(200).start();return this.rs.userstories.getByRef(t,e).then((n=this,function(e){return n.rs2.attachments.list("us",e.id,t).then(function(t){return n.rootscope.$broadcast("genericform:edit",{objType:"us",obj:e,attachments:t.toJS()}),o.finish()})}))},f.prototype.deleteUserStory=function(r){var n,t=this.translate.instant("US.TITLE_DELETE_ACTION"),e=r.subject;return this.confirm.askOnDelete(t,e).then((n=this,function(t){var e;return n.scope.userstories=_.without(n.scope.userstories,r),(e=n.repo.remove(r)).then(function(){return t.finish(),n.q.all([n.loadProjectStats(),n.loadSprints()])}),e.then(null,function(){return t.finish(!1),n.confirm.notify("error")})}))},f.prototype.addNewUs=function(t){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,this.scope.project.default_us_status)}},f.prototype.addNewSprint=function(){return this.rootscope.$broadcast("sprintform:create",this.scope.projectId)},f.prototype.findCurrentSprint=function(){var n=(new Date).getTime();return _.find(this.scope.sprints,function(t){var e=moment(t.estimated_start,"YYYY-MM-DD").format("x"),r=moment(t.estimated_finish,"YYYY-MM-DD").format("x");return e<=n&&n<=r})},l.controller("BacklogController",f),t=function(t,d,a,h){var n=_.template('<div class="doom-line"><span><%- text %></span></div>'),s=function(u,l,t,e){var r=function(){var t,e,r,n,i,o,s,a,c;if(u.displayVelocity&&p(),null!=u.stats&&null!=u.stats.total_points&&0!==u.stats.total_points&&null==u.displayVelocity){if(p(),c=(a=u.stats).total_points,t=a.assigned_points,!u.userstories)return;for(s=[],r=n=0,i=(o=u.userstories).length;n<i;r=++n){if(c<(t+=o[r].total_points)){e=l.find(".backlog-table-body .us-item-row")[r],d(e);break}s.push(void 0)}return s}},p=function(){return l.find(".doom-line").remove()},d=function(t){var e=a.instant("BACKLOG.DOOMLINE");return $(t).before(n({text:e}))};return u.$on("userstories:loaded",r),u.$on("userstories:forecast",p),u.$watch("stats",r)},c=function(s,a,t,c){var u,l,p,r=function(){var t=a.find(".backlog-table-body input:checkbox:checked");return _.map(t,function(t){var e;return(e=(t=$(t).closest(".tg-scope")).scope()).us.milestone=s.sprints[0].id,e.us})},e=function(t,e){var r,n,i,o=_(s.userstories);return s.userstories=o.without.apply(o,t).value(),n=_.map(t,function(t,e){return t.total_points}),i=_.reduce(n,function(t,e){return t+e}),e.user_stories=_.union(e.user_stories,t),e.total_points+=i,r=_.map(t,function(t){return{us_id:t.id,order:t.sprint_order}}),h.userstories.bulkUpdateMilestone(s.project.id,s.sprints[0].id,r).then(function(){return c.loadSprints(),c.loadProjectStats(),c.toggleVelocityForecasting(),c.calculateForecasting()}),a.find(".move-to-sprint").hide()},n=function(t){return e(t,s.currentSprint)},i=function(t){return e(t,s.sprints[0])};return s.$on("sprintform:create:success:callback",function(t,e){if(e)return _.partial(n,e)()}),p=!1,l=null,u=function(t){var e;return l=t.closest(".us-item-row"),t.closest(".us-item-row").toggleClass("ui-multisortable-multiple"),e=a.find(".move-to-sprint"),0<a.find(".backlog-table-body input:checkbox:checked").length&&0<s.sprints.length?e.show():e.hide()},$(window).on("keydown.shift-pressed keyup.shift-pressed",function(t){return p=!!t.shiftKey,!0}),a.on("change",".backlog-table-body input:checkbox",function(t){var e,r,n,i,o;return l&&p&&(r=[],e=$(t.currentTarget).closest(".us-item-row"),n=l.nextAll(),i=l.prevAll(),_.some(n,function(t){return t===e[0]})?r=l.nextUntil(e):_.some(i,function(t){return t===e[0]})&&(r=l.prevUntil(e)),_.map(r,function(t){var e=$(t).find("input:checkbox");return e.prop("checked",!0),u(e)})),(o=angular.element(t.currentTarget)).closest(".us-item-row").toggleClass("is-checked"),u(o)}),a.on("click","#move-to-latest-sprint",function(t){var e=r();return s.$apply(_.partial(i,e))}),a.on("click","#move-to-current-sprint",function(t){var e=r();return s.$apply(_.partial(n,e))}),a.on("click","#show-tags",function(t){return t.preventDefault(),c.toggleShowTags(),f(c)}),a.on("click",".forecasting-add-sprint",function(t){var e,r=c.forecastedStories;return s.currentSprint?(e=_.map(r,function(t,e){return t.milestone=s.currentSprint.id,t.order=e,t}),s.$apply(_.partial(n,e))):(e=_.map(r,function(t,e){return t.order=e,t}),d.$broadcast("sprintform:create",s.projectId,e))})},f=function(t){var e=angular.element("#show-tags"),r=t.showTags?(e.addClass("active"),a.instant("BACKLOG.TAGS.HIDE")):(e.removeClass("active"),a.instant("BACKLOG.TAGS.SHOW"));return e.text(r)},u=function(t,e,r){return e.find("sidebar.backlog-filter").addClass("active"),r.activeFilters=!0},i=function(t,e,r){var n,i,o,s=e.find("sidebar.backlog-filter");return s.one("transitionend",function(){return g(150,function(){return d.$broadcast("resize"),$(".burndown").css("visibility","visible")})}),o=angular.element("#show-filters-button"),$(".burndown").css("visibility","hidden"),s.toggleClass("active"),o.toggleClass("active"),n=a.instant("BACKLOG.FILTERS.HIDE"),i=a.instant("BACKLOG.FILTERS.SHOW"),m(o,[n,i]),r.toggleActiveFilters()},l=function(e,r,t,n){return e.filtersSearch={},r.on("click","#show-filters-button",function(t){return t.preventDefault(),e.$apply(function(){return i(0,r,n)})})};return{link:function(t,e,r,n){var i,o=e.controller();return c(t,e,0,o),l(t,e,0,o),s(t,e),((i=o.location.search()).status||i.tags||i.q||i.assigned_to||i.owner)&&u(0,e,o),t.$on("showTags",function(){return f(o)}),t.$on("$destroy",function(){return e.off(),$(window).off(".shift-pressed")})}}},l.directive("tgBacklog",["$tgRepo","$rootScope","$translate","$tgResources",t]),o=function(i,t,o,s){var a=t.get("backlog/us-role-points-popover.html",!0);return{link:function(r,n,t){return c(r,"project",function(t){var e=_.filter(t.roles,"computable");return 1<_.size(e)?n.append(o(a({roles:e}))(r)):(n.find(".icon-arrow-down").remove(),n.find(".header-points").addClass("not-clickable"))}),r.$on("uspoints:select",function(t,e,r){return n.find(".popover").popover().close(),n.find(".header-points").html(r+"/<span>Total</span>")}),r.$on("uspoints:clear-selection",function(t,e){var r;return n.find(".popover").popover().close(),r=s.instant("COMMON.FIELDS.POINTS"),n.find(".header-points").text(r)}),n.on("click",function(t){var e=angular.element(t.target);return(e.is("span")||e.is("div"))&&t.stopPropagation(),n.find(".popover").popover().open()}),n.on("click",".clear-selection",function(t){return t.preventDefault(),t.stopPropagation(),i.$broadcast("uspoints:clear-selection")}),n.on("click",".role",function(t){var e;return t.preventDefault(),t.stopPropagation(),(e=angular.element(t.currentTarget)).scope(),i.$broadcast("uspoints:select",e.data("role-id"),e.text())}),r.$on("$destroy",function(){return n.off()})}}},l.directive("tgUsRolePointsSelector",["$rootScope","$tgTemplate","$compile","$translate",o]),i=function(r,t,l){var p=l.get("common/estimation/us-points-roles-popover.html",!0);return{link:function(i,o,n){var t,e,s=o.controller(),a=null,c=null,u=null;return i.$on("uspoints:select",function(t,e,r){i.$eval(n.tgBacklogUsPoints);return c=e,u.render()}),i.$on("uspoints:clear-selection",function(t){i.$eval(n.tgBacklogUsPoints);return c=null,u.render()}),i.$watch(n.tgBacklogUsPoints,function(n){var a;if(n)return u=r.create(o,n,i.project),0===(a=u.calculateRoles()).length?(o.find(".icon-arrow-bottom").remove(),o.find("a.us-points").addClass("not-clickable")):1===a.length&&(c=_.keys(n.points)[0]),u.isEditable&&t(),u.onSelectedPointForRole=function(t,e,r){return n.points=r,u.render(),this.save(t,e).then(function(){return s.loadProjectStats()})},u.render=function(){var t,e,r,n=this.calculateTotalPoints(),i=null==c||1===a.length?r=n:(t=this.us.points[c],r=(e=this.pointsById[t]).name+" / <span>"+n+"</span>",e.name+" / "+n),o={totalPoints:n,roles:this.calculateRoles(),editable:this.isEditable,text:r,title:i},s=l.get("common/estimation/us-estimation-total.html",!0)(o);return this.$el.html(s)},u.render()}),e=function(){var t=u.calculateRoles(),e=p({roles:t});return o.append(e),o.find(".pop-role").popover().open(function(){return $(this).remove()})},t=function(){return o.on("click","a.us-points",function(t){return t.preventDefault(),t.stopPropagation(),i.$eval(n.tgBacklogUsPoints),null!=(a=c)?u.renderPointsSelector(c):e()}),o.on("click",".role",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),r=angular.element(t.currentTarget),i.$eval(n.tgBacklogUsPoints),a=r.data("role-id"),(e=o.find(".pop-role")).find("a").removeClass("active"),e.find("a[data-role-id='"+a+"']").addClass("active"),u.renderPointsSelector(a)})},i.$on("$destroy",function(){return o.off()})}}},l.directive("tgBacklogUsPoints",["$tgEstimationsService","$tgRepo","$tgTemplate",i]),n=function(s){var a=function(){return $(".js-burndown-graph").removeClass("shown"),$(".js-toggle-burndown-visibility-button").removeClass("active"),$(".js-burndown-graph").removeClass("open")},c=function(t){return $(".js-toggle-burndown-visibility-button").addClass("active"),t?$(".js-burndown-graph").addClass("shown"):$(".js-burndown-graph").addClass("open")};return{link:function(t,e,r){var n,i=!0,o=u(["is-burndown-grpahs-collapsed"]);return t.isBurndownGraphCollapsed=s.get(o)||!1,n=function(){return t.isBurndownGraphCollapsed?a():c(i),i=!1},t.$watch("showGraphPlaceholder",function(){if(null!=t.showGraphPlaceholder)return t.isBurndownGraphCollapsed=t.isBurndownGraphCollapsed||t.showGraphPlaceholder,n()}),e.on("click",".js-toggle-burndown-visibility-button",function(){return t.isBurndownGraphCollapsed=!t.isBurndownGraphCollapsed,s.set(o,t.isBurndownGraphCollapsed),n()}),t.$on("$destroy",function(){return e.off()})}}},l.directive("tgToggleBurndownVisibility",["$tgStorage",n]),e=function(h){var i=function(t,o){var e,r,n,i,s,a,c,u,l,p,d=t.width();return t.height(d/6),s=function(){u=[];for(var t=0,e=o.milestones.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)u.push(t);return u}.apply(this),n=[],p=_.map(o.milestones,function(t){return 0}),n.push({data:_.zip(s,p),lines:{fillColor:"rgba(0,0,0,0)"},points:{show:!1}}),a=_.map(o.milestones,function(t){return t.optimal}),n.push({data:_.zip(s,a),lines:{fillColor:"rgba(120,120,120,0.2)"}}),i=_.filter(_.map(o.milestones,function(t){return t.evolution}),function(t){return null!=t}),n.push({data:_.zip(s,i),lines:{fillColor:"rgba(102,153,51,0.3)"}}),e=_.map(o.milestones,function(t){return-t["team-increment"]-t["client-increment"]}),n.push({data:_.zip(s,e),lines:{fillColor:"rgba(255,51,51,0.3)"}}),l=_.map(o.milestones,function(t){return-t["team-increment"]}),n.push({data:_.zip(s,l),lines:{fillColor:"rgba(153,51,51,0.3)"}}),r=["rgba(0,0,0,1)","rgba(120,120,120,0.2)","rgba(102,153,51,1)","rgba(153,51,51,1)","rgba(255,51,51,1)"],c={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{ticks:o.milestones.length,axisLabel:h.instant("BACKLOG.CHART.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5,tickFormatter:function(t,e){return""}},yaxis:{axisLabel:h.instant("BACKLOG.CHART.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:r,tooltip:!0,tooltipOpts:{content:function(t,e,r,n){var i;return 1===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(r)},h.instant("BACKLOG.CHART.OPTIMAL",i)):2===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(r)},h.instant("BACKLOG.CHART.REAL",i)):3===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(r)},h.instant("BACKLOG.CHART.INCREMENT_CLIENT",i)):(i={sprintName:o.milestones[e].name,value:Math.abs(r)},h.instant("BACKLOG.CHART.INCREMENT_TEAM",i))}}},t.empty(),t.plot(n,c).data("plot")};return{link:function(e,t,r){var n=angular.element(t);return e.$watch("stats",function(t){if(null!=e.stats)return i(n,e.stats),e.$on("resize",function(){return i(n,e.stats)})}),e.$on("$destroy",function(){return t.off()})}}},l.directive("tgBurndownBacklogGraph",["$translate",e]),r=function(t,o){var s=t.get("backlog/progress-bar.html",!0),c=function(t,e,r,n){var i=s({projectPointsPercentaje:r,closedPointsPercentaje:n});return i=o(i)(t),e.html(i)},u=function(t){var e=_.max([0,t]);return e=_.min([100,e]),Math.round(e)};return{link:function(s,a,t){angular.element(a);return s.$watch(t.tgBacklogProgressBar,function(t){var e,r,n,i,o;if(null!=t)return o=t.total_points?t.total_points:t.defined_points,n=t.defined_points,e=t.closed_points,r=o<n?(i=100*o/n,100*e/n):(i=100)*e/o,i=u(i-3),r=u(r-3),c(s,a,i,r)}),s.$on("$destroy",function(){return a.off()})}}},l.directive("tgBacklogProgressBar",["$tgTemplate","$compile",r])}.call(this),function(){this.taiga;var e=this.taiga.bindOnce,t=angular.module("taigaBacklog"),d=function(t){return $(t).scope().$destroy(),$(t).off(),$(t).remove()},r=function(){return{link:function(p,r,t){return e(p,"project",function(t){var e,l;if(-1<t.my_permissions.indexOf("modify_us"))return l=!1,(e=dragula([r[0],$(".js-empty-backlog")[0]],{copySortSource:!1,copy:!1,isContainer:function(t){return t.classList.contains("sprint-table")},moves:function(t){return!!$(t).hasClass("row")}})).on("drag",function(t,e){var r=$(t).parent();return l=r.hasClass("backlog-table-body"),$(document.body).addClass("drag-active"),$(t).find("input[type='checkbox']").is(":checked"),window.dragMultiple.start(t,e)}),e.on("cloned",function(t){return $(t).addClass("multiple-drag-mirror")}),e.on("dragend",function(t){var e,r,n,i,o,s,a,c,u;return $(".doom-line").remove(),i=(o=$(t).parent()).hasClass("backlog-table-body")||o.hasClass("js-empty-backlog"),a=l||i?l===i:o&&$(t).scope().sprint.id===o.scope().sprint.id,e=window.dragMultiple.stop(),$(document.body).removeClass("drag-active"),c=null,r=e.length?e[0]:t,i?n=$(r).index(".backlog-table-body .row"):(n=$(r).index(),c=null!=(s=o.scope())?s.sprint.id:void 0),a?e.length?u=_.map(e,function(t){return $(t).scope().us}):$(t).scope()&&(u=[$(t).scope().us]):(e.length?u=_.map(e,function(t){return $(t).scope().us}):$(t).scope()&&(u=[$(t).scope().us]),e.length?_.each(e,d):d(t)),p.$emit("sprint:us:move",u,n,c)}),autoScroll([window],{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&e.dragging}}),p.$on("$destroy",function(){return r.off(),e.destroy()})})}}};t.directive("tgBacklogSortable",r)}.call(this),function(){this.taiga;var t,e,r=angular.module("taigaBacklog"),n=function(t,i){var o={duration:500,easing:"linear"},s=function(t){var e=t.find(".sprint-table");return t.find(".compact-sprint").toggleClass("active"),e.toggleClass("open")};return{link:function(r,e,n){return r.$watch(n.tgBacklogSprint,function(t){return r.$eval(n.tgBacklogSprint).closed?e.addClass("sprint-closed"):s(e)}),e.on("click",".sprint-name > .compact-sprint",function(t){return t.preventDefault(),s(e),e.find(".sprint-table").slideToggle(o)}),e.on("click",".edit-sprint",function(t){var e;return t.preventDefault(),e=r.$eval(n.tgBacklogSprint),i.$broadcast("sprintform:edit",e)}),r.$on("$destroy",function(){return e.off()})}}};r.directive("tgBacklogSprint",["$tgRepo","$rootScope",n]),t=function(p,t,d,n){var h=t.get("backlog/sprint-header.html");return{link:function(s,a,t,e){var c=n.instant("BACKLOG.SPRINTS.DATE"),u=function(){return-1!==s.project.my_permissions.indexOf("modify_milestone")},l=function(){return-1!==s.project.my_permissions.indexOf("view_milestones")},r=function(t){var e,r=p.resolve("project-taskboard",{project:s.project.slug,sprint:t.slug}),n=moment(t.estimated_start).format(c)+"-"+moment(t.estimated_finish).format(c),i={name:t.name,taskboardUrl:r,estimatedDateRange:n,closedPoints:t.closed_points||0,totalPoints:t.total_points||0,isVisible:l(),isEditable:u()},o=s.$new();return _.assign(o,i),e=d(h)(o),a.html(e)};return s.$watch("sprint",r),s.$on("$destroy",function(){return a.off()})},restrict:"EA"}},r.directive("tgBacklogSprintHeader",["$tgNavUrls","$tgTemplate","$compile","$translate",t]),e=function(n,s,a){var c=!0;return{link:function(t,i,e){var o,r=$("<div>");return i.after(r),o=null,i.on("click",function(t){return t.preventDefault(),c=!c,o=s().target(r).start(),c?n.$broadcast("backlog:unload-closed-sprints"):n.$broadcast("backlog:load-closed-sprints")}),t.$on("$destroy",function(){return i.off()}),t.$on("closed-sprints:reloaded",function(t,e){var r,n;return o&&o.finish(),r=0<e.length?"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS":"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS",n=a.instant(r),i.find(".text").text(n)})}}},r.directive("tgBacklogToggleClosedSprintsVisualization",["$rootScope","$tgLoading","$translate",e])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy;var o=this.taiga.timeout,t=function(s){var i=function(t,e){var r,n,i;t.width();return t.height(240),n=_.map(e,function(t){return moment.utc(t.day)}),(r=[]).unshift({data:_.zip(n,_.map(e,function(t){return t.optimal_points})),lines:{fillColor:"rgba(120,120,120,0.2)"}}),r.unshift({data:_.zip(n,_.map(e,function(t){return t.open_points})),lines:{fillColor:"rgba(102,153,51,0.3)"}}),i={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{tickSize:[1,"day"],min:n[0],max:_.last(n),mode:"time",daysNames:n,axisLabel:s.instant("TASKBOARD.CHARTS.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},yaxis:{min:0,axisLabel:s.instant("TASKBOARD.CHARTS.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:["rgba(102,153,51,1)","rgba(120,120,120,0.2)"],tooltip:!0,tooltipOpts:{content:function(t,e,r,n){var i=moment(e).format(s.instant("TASKBOARD.CHARTS.DATE")),o=Math.round(r);return 1===n.seriesIndex?s.instant("TASKBOARD.CHARTS.OPTIMAL",{formattedDate:i,roundedValue:o}):s.instant("TASKBOARD.CHARTS.REAL",{formattedDate:i,roundedValue:o})}}},t.empty(),t.plot(r,i).data("plot")};return{link:function(e,t,r){var n=angular.element(t);return e.$on("resize",function(){if(e.stats)return i(n,e.stats.days)}),e.$on("taskboard:graph:toggle-visibility",function(){return t.parent().toggleClass("open"),o(100,function(){if(e.stats)return i(n,e.stats.days)})}),e.$watch("stats",function(t){if(null!=e.stats)return i(n,e.stats.days)}),e.$on("$destroy",function(){return t.off()})}}};angular.module("taigaTaskboard").directive("tgSprintGraph",["$translate",t])}.call(this),function(){this.taiga,this.taiga.bindOnce;var r=this.taiga.debounce,t=(this.taiga.trim,function(t,l,p,d,h,f){return{link:function(a,c,t){var e,u;return a.form={data:"",usId:null},e=r(2e3,function(t){var e,r,n,i,o,s;if(t.preventDefault(),c.find("form").checksley().validate())return e=d().target(u).start(),r=a.form.data,n=a.projectId,o=a.form.sprintId,s=a.form.usId,(i=l.tasks.bulkCreate(n,o,s,r)).then(function(t){return t=_.map(t,function(t){return f.make_model("tasks",t)}),e.finish(),p.$broadcast("taskform:bulk:success",t),h.close(c)}),i.then(null,function(){return e.finish()})}),a.$on("taskform:bulk",function(t,e,r){return h.open(c),a.form={data:"",sprintId:e,usId:r}}),u=c.find(".submit-button"),c.on("submit","form",e),a.$on("$destroy",function(){return c.off()})}}});angular.module("taigaTaskboard").directive("tgLbCreateBulkTasks",["$tgRepo","$tgResources","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var t,e,j,o,r,n,i,k,s={}.hasOwnProperty;function a(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,_){var b,S;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.appMetaService=c,this.location=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.taskboardTasksService=g,this.taskboardIssuesService=m,this.storage=v,this.filterRemoteStorageService=y,this.lightboxFactory=_,j(this),this.taskboardTasksService.reset(),this.scope.userstories=[],this.openFilter=!1,this.applyStoredFilters(this.params.pslug,"tasks-filters")||(this.scope.sectionName=this.translate.instant("TASKBOARD.SECTION_NAME"),this.initializeEventHandlers(),k.defineImmutableProperty(this.scope,"usTasks",(b=this,function(){return b.taskboardTasksService.usTasks})),k.defineImmutableProperty(this.scope,"milestoneIssues",(S=this,function(){return S.taskboardIssuesService.milestoneIssues})))}k=this.taiga,this.taiga.toggleText,n=this.taiga.mixOf,r=this.taiga.groupBy,this.taiga.bindOnce,this.taiga.scopeDefer,this.taiga.timeout,j=this.taiga.bindMethods,o=this.taiga.debounceLeading,i=angular.module("taigaTaskboard"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,n(k.Controller,k.PageMixin,k.FiltersMixin)),a.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","tgAppMetaService","$tgLocation","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","tgTaskboardTasks","tgTaskboardIssues","$tgStorage","tgFilterRemoteStorageService","tgLightboxFactory"],a.prototype.excludePrefix="exclude_",a.prototype.filterCategories=["tags","status","assigned_to","owner","role"],a.prototype.firstLoad=function(){var t,e=this.loadInitialData();return e.then((t=this,function(){return t._setMeta()})),e.then(null,this.onInitialDataError.bind(this))},a.prototype.setZoom=function(t,e){var r,n,i;return this.zoomLevel===t?null:(this.isFirstLoad=!this.zoomLevel,r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((i=this,function(){return i.isFirstLoad=!1,i.taskboardTasksService.resetFolds()})):1<this.zoomLevel&&r<=1&&(this.zoomLoading=!0,this.q.all([this.loadTasks(),this.loadIssues()]).then((n=this,function(){return n.zoomLoading=!1,n.taskboardTasksService.resetFolds()}))),"0"===this.zoomLevel?this.rootscope.$broadcast("sprint:zoom0"):void 0)},a.prototype.changeQ=function(t){return this.replaceFilter("q",t),this.loadTasks(),this.generateFilters()},a.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadTasks(),this.generateFilters()},a.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadTasks(),this.generateFilters()},a.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.loadTasks(),this.generateFilters()},a.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,"tasks-custom-filters").then(r.generateFilters)}));var r},a.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},a.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.location.search(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,"tasks-custom-filters").then(n.generateFilters)}))},a.prototype.generateFilters=function(){var u,t,l,e,p,r,n,d;for(this.storeFilters(this.params.pslug,this.location.search(),"tasks-filters"),n=this.location.search(),(p={}).project=this.scope.projectId,p.milestone=this.scope.sprintId,p.q=n.q,t=0,e=(r=this.filterCategories).length;t<e;t++)l=r[t],u=this.excludePrefix.concat(l),p[l]=n[l],p[u]=n[u];return this.q.all([this.rs.tasks.filtersData(p),this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters")]).then((d=this,function(t){var e,r,n,i,o,s=t[0],a=t[1],c={};for(c.status=_.map(s.statuses,function(t){return t.id=t.id.toString(),t}),c.tags=_.map(s.tags,function(t){return t.id=t.name,t}),o=_.filter(c.tags,function(t){return 0<t.count}),c.assigned_to=_.map(s.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),c.role=_.map(s.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),c.owner=_.map(s.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),d.selectedFilters=[],e=0,r=(n=d.filterCategories).length;e<r;e++)l=n[e],u=d.excludePrefix.concat(l),p[l]&&(i=d.formatSelectedFilters(l,c[l],p[l]),d.selectedFilters=d.selectedFilters.concat(i)),p[u]&&(i=d.formatSelectedFilters(l,c[l],p[u],"exclude"),d.selectedFilters=d.selectedFilters.concat(i));return d.filterQ=p.q,d.filters=[{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:c.status},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:c.tags,hideEmpty:!0,totalTaggedElements:o.length},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:c.assigned_to},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:c.role},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:c.owner}],d.customFilters=[],_.forOwn(a,function(t,e){return d.customFilters.push({id:e,name:e,filter:t})})}))},a.prototype._setMeta=function(){var t=this.translate.instant("BACKLOG.SPRINTS.DATE"),e=this.translate.instant("TASKBOARD.PAGE_TITLE",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name}),r=this.translate.instant("TASKBOARD.PAGE_DESCRIPTION",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name,startDate:moment(this.scope.sprint.estimated_start).format(t),endDate:moment(this.scope.sprint.estimated_finish).format(t),completedPercentage:this.scope.stats.completedPercentage||"0",completedPoints:this.scope.stats.completedPointsSum||"--",totalPoints:this.scope.stats.totalPointsSum||"--",openTasks:this.scope.stats.openTasks||"--",totalTasks:this.scope.stats.total_tasks||"--"});return this.appMetaService.setAll(e,r)},a.prototype.initializeEventHandlers=function(){var r,n,i,o,s,a,c,u,l;return this.scope.$on("taskform:bulk:success",(r=this,function(t,e){return r.refreshTagsColors().then(function(){return r.taskboardTasksService.add(e)}),r.analytics.trackEvent("task","create","bulk create task on taskboard",1)})),this.scope.$on("taskform:new:success",(n=this,function(t,e){return n.refreshTagsColors().then(function(){return n.taskboardTasksService.add(e)}),n.analytics.trackEvent("task","create","create task on taskboard",1)})),this.scope.$on("taskform:edit:success",(i=this,function(t,e){return i.refreshTagsColors().then(function(){return i.taskboardTasksService.replaceModel(e)})})),this.scope.$on("issueform:new:success",(o=this,function(t,e){return o.refreshTagsColors().then(function(){return o.taskboardIssuesService.add(e)}),o.analytics.trackEvent("issue","create","create issue on taskboard",1)})),this.scope.$on("issueform:add:success",(s=this,function(t,e){return s.refreshTagsColors().then(function(){return s.taskboardIssuesService.add(e)})})),this.scope.$on("issueform:edit:success",(a=this,function(t,e){return a.refreshTagsColors().then(function(){return a.taskboardIssuesService.replaceModel(e)})})),this.scope.$on("taskboard:task:deleted",(c=this,function(t,e){return c.loadTasks()})),this.scope.$on("taskboard:issue:deleted",(u=this,function(t,e){return u.loadIssues()})),this.scope.$on("taskboard:task:move",this.taskMove),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("taskboard:items:move",(l=this,function(t,e){return e.uss?l.firstLoad():(e.tasks&&l.loadTasks(),e.issues?l.loadIssues():void 0)}))},a.prototype.onAssignedToChanged=function(t,e,r){var n,i;if("tasks"===r.getName()&&(r.assigned_to=e,this.taskboardTasksService.replaceModel(r),this.repo.save(r).then((n=this,function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.loadTasks()}))),"issues"===r.getName())return r.assigned_to=e,this.taskboardIssuesService.replaceModel(r),this.repo.save(r).then((i=this,function(){if(i.generateFilters(),i.isFilterDataTypeSelected("assigned_to")||i.isFilterDataTypeSelected("role"))return i.loadIssues()}))},a.prototype.initializeSubscription=function(){var t,e,r,n,i="changes.project."+this.scope.projectId+".tasks";return this.events.subscribe(this.scope,i,o(500,(e=this,function(t){return e.loadTaskboard()}))),i="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,i,o(500,(r=this,function(t){return r.loadIssues()}))),t="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,t,(n=this,function(t){return n.refreshTagsColors(),n.loadSprintStats(),n.loadSprint()}))},a.prototype.loadProject=function(){return this.rs.projects.get(this.scope.projectId).then((e=this,function(t){return t.is_backlog_activated||e.errorHandlingService.permissionDenied(),e.scope.project=t,e.scope.pointsList=_.sortBy(t.points,"order"),e.scope.pointsById=r(t.points,function(t){return t.id}),e.scope.roleById=r(t.roles,function(t){return t.id}),e.scope.taskStatusList=_.sortBy(t.task_statuses,"order"),e.scope.usStatusList=_.sortBy(t.us_statuses,"order"),e.scope.usStatusById=r(t.us_statuses,function(t){return t.id}),e.scope.issueStatusById=r(t.issue_statuses,function(t){return t.id}),e.scope.$emit("project:loaded",t),e.fillUsersAndRoles(t.members,t.roles),t}));var e},a.prototype.loadSprintStats=function(){return this.rs.sprints.stats(this.scope.projectId,this.scope.sprintId).then((o=this,function(t){var e=_.reduce(_.values(t.total_points),function(t,e){return t+e},0),r=_.reduce(_.values(t.completed_points),function(t,e){return t+e},0),n=e-r,i=t.total_tasks-t.completed_tasks;return o.scope.stats=t,o.scope.stats.totalPointsSum=e,o.scope.stats.completedPointsSum=r,o.scope.stats.remainingPointsSum=n,o.scope.stats.remainingTasks=i,t.totalPointsSum?o.scope.stats.completedPercentage=Math.round(100*t.completedPointsSum/t.totalPointsSum):o.scope.stats.completedPercentage=0,o.scope.stats.openTasks=t.total_tasks-t.completed_tasks,t}));var o},a.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((e=this,function(t){return e.scope.project.tags_colors=t._attrs}));var e},a.prototype.loadSprint=function(){return this.rs.sprints.get(this.scope.projectId,this.scope.sprintId).then((e=this,function(t){return e.scope.sprint=t,e.scope.userstories=_.sortBy(t.user_stories,"sprint_order"),e.taskboardTasksService.setUserstories(e.scope.userstories),e.rootscope.$broadcast("taskboard:userstories:loaded",e.scope.userstories),t}));var e},a.prototype.loadIssues=function(){var e,t={};return 1<this.zoomLevel&&(t.include_attachments=1),t=_.merge(t,this.location.search()),this.rs.issues.listInProject(this.scope.projectId,this.scope.sprintId,t).then((e=this,function(t){return e.taskboardIssuesService.init(e.scope.project,e.scope.usersById,e.scope.issueStatusById),e.taskboardIssuesService.set(t),e.scope.taskBoardLoading=!1}))},a.prototype.loadTasks=function(){var e,t={};return 1<this.zoomLevel&&(t.include_attachments=1),t=_.merge(t,this.location.search()),this.rs.tasks.list(this.scope.projectId,this.scope.sprintId,null,t).then((e=this,function(t){return e.taskboardTasksService.init(e.scope.project,e.scope.usersById),e.taskboardTasksService.set(t)}))},a.prototype.loadTaskboard=function(){return this.q.all([this.refreshTagsColors(),this.loadSprintStats(),this.loadSprint().then((t=this,function(){return t.loadTasks(),t.loadIssues()}))]);var t},a.prototype.loadInitialData=function(){var e,t,r,n={pslug:this.params.pslug,sslug:this.params.sslug};return this.repo.resolve(n).then((e=this,function(t){return e.scope.projectId=t.project,e.scope.sprintId=t.milestone,e.initializeSubscription(),t})).then((r=this,function(){return r.loadProject()})).then((t=this,function(){return t.generateFilters(),t.loadTaskboard().then(function(){return t.setRolePoints()})}))},a.prototype.showPlaceHolder=function(t,e){return!(this.taskboardTasksService.tasksRaw.length||this.scope.taskStatusList[0].id!==t||this.scope.userstories.length&&this.scope.userstories[0].id!==e)},a.prototype.editTask=function(t){var r,n=this.taskboardTasksService.getTask(t);return n=n.set("loading-edit",!0),this.taskboardTasksService.replace(n),this.rs.tasks.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("task",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"task",obj:e,project:r.scope.project,sprintId:r.scope.sprintId,attachments:t.toJS()}),n=n.set("loading-edit",!1),r.taskboardTasksService.replace(n)})}))},a.prototype.editIssue=function(t){var r,n=this.taskboardIssuesService.getIssue(t);return n=n.set("loading-edit",!0),this.rs.issues.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("issue",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"issue",obj:e,project:r.scope.project,sprintId:r.scope.sprintId,attachments:t.toJS()}),n=n.set("loading-edit",!1)})}))},a.prototype.deleteTask=function(t){var n,i=this.taskboardTasksService.getTask(t);return i=i.set("loading-delete",!0),this.rs.tasks.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("TASK.TITLE_DELETE_ACTION"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(t){var e=n.repo.remove(r);return e.then(function(){return n.scope.$broadcast("taskboard:task:deleted"),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},a.prototype.deleteIssue=function(t){var n,i=this.taskboardIssuesService.getIssue(t);return i=i.set("loading-delete",!0),this.rs.issues.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("ISSUES.ACTION_DELETE"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(t){var e=n.repo.remove(r);return e.then(function(){return n.scope.$broadcast("taskboard:issue:deleted"),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},a.prototype.removeIssueFromSprint=function(t){var n,i=this.taskboardIssuesService.getIssue(t);return i=i.set("loading-delete",!0),this.rs.issues.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE"),t=n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:n.scope.sprint.name}),n.confirm.ask(e,null,t).then(function(t){var e;return r.milestone=null,(e=n.repo.save(r)).then(function(){return n.taskboardIssuesService.remove(r),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},a.prototype.taskMove=function(t,e,r,n,i,o){var s,a,c,u;return this.scope.movingTask=!0,e=this.taskboardTasksService.getTaskModel(e.get("id")),s=this.taskboardTasksService.move(e.id,n,i,o),c={status__is_archived:!1,include_attachments:!0},a={headers:{"set-orders":JSON.stringify(s.set_orders)}},this.repo.save(e,!0,c,a,!0).then((u=this,function(t){var e;if(t[0]&&t[0].user_story&&u.reloadUserStory(t[0].user_story),u.scope.movingTask=!1,(e=t[1])&&e["taiga-info-order-updated"]&&(o=JSON.parse(e["taiga-info-order-updated"]),u.taskboardTasksService.assignOrders(o)),u.loadSprintStats(),u.generateFilters(),u.isFilterDataTypeSelected("status"))return u.loadTasks()}))},a.prototype.reloadUserStory=function(t){return this.rs.userstories.get(this.scope.project.id,t).then((r=this,function(e){return r.scope.userstories=_.map(r.scope.userstories,function(t){return t.id===e.id?e:t})}));var r},a.prototype.addNewTask=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"task",project:this.scope.project,sprintId:this.scope.sprintId,usId:null!=e?e.id:void 0});case"bulk":return this.rootscope.$broadcast("taskform:bulk",this.scope.sprintId,null!=e?e.id:void 0)}},a.prototype.addNewIssue=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new-or-existing",{objType:"issue",project:this.scope.project,sprintId:this.scope.sprintId,relatedField:"milestone",relatedObjectId:this.scope.sprintId,targetName:this.scope.sprint.name});case"standard":return this.rootscope.$broadcast("taskform:new",this.scope.sprintId,null!=e?e.id:void 0);case"bulk":return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId,this.scope.sprintId)}},a.prototype.toggleFold=function(t,e){return"issues"===e?this.taskboardIssuesService.toggleFold(t):"tasks"===e?this.taskboardTasksService.toggleFold(t):void 0},a.prototype.openUsersSelection=function(r){var n,t=function(t){var e=t.pop()||null;if("tasks"===r.getName()&&(r.assigned_to=e,n.taskboardTasksService.replaceModel(r),n.repo.save(r).then(function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.loadTasks()})),"issues"===r.getName())return r.assigned_to=e,n.taskboardIssuesService.replaceModel(r),n.repo.save(r).then(function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.loadIssues()})};return(n=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[r.assigned_to],activeUsers:this.scope.activeUsers,onClose:t,single:!0,lbTitle:this.translate.instant("COMMON.ASSIGNED_USERS.ADD")})},a.prototype.changeTaskAssignedTo=function(t){var e=this.taskboardTasksService.getTaskModel(t);return this.openUsersSelection(e)},a.prototype.changeIssueAssignedTo=function(t){var e=this.taskboardIssuesService.getIssueModel(t);return this.openUsersSelection(e)},a.prototype.setRolePoints=function(){var o,e,t,r=_.filter(this.scope.project.roles,"computable"),s=function(e){return e=parseInt(e,10),_.find(r,function(t){return t.id===e})};return t=this,o=function(e){parseInt(e,10);return _.find(t.scope.project.points,function(t){return t.id===e})},e=_.reduce(this.scope.userstories,function(i,t,e){return _.forOwn(t.points,function(t,e){var r=s(e),n=o(t);return i[r.id]||(i[r.id]=r,i[r.id].points=0),i[r.id].points+=n.value}),i},{}),this.scope.pointsByRole=Object.keys(e).map(function(t){return e[t]})},i.controller("TaskboardController",a),t=function(n){return{link:function(t,r,e){r.controller();return r.on("click",".toggle-analytics-visibility",function(t){return t.preventDefault(),angular.element(t.currentTarget).toggleClass("active"),n.$broadcast("taskboard:graph:toggle-visibility")}),r.find(".taskboard-table-body").on("scroll",function(t){var e=angular.element(t.currentTarget);return r.find(".taskboard-table-header .taskboard-table-inner").css("left",-1*e.scrollLeft())}),t.$on("$destroy",function(){return r.off()})}}},i.directive("tgTaskboard",["$rootScope",t]),e=function(c){return{link:function(i,o,t){var s,e,r,n,a;return i.$on("sprint:zoom0",function(){return r()}),i.$on("sprint:task:moved",function(){return r()}),i.$watch("usTasks",function(){if(i.project)return i.statusesFolded=c.tasks.getStatusColumnModes(i.project.id),i.usFolded=c.tasks.getUsRowModes(i.project.id,i.sprintId),r()}),i.foldStatus=function(t){return i.statusesFolded[t.id]=!i.statusesFolded[t.id],c.tasks.storeStatusColumnModes(i.projectId,i.statusesFolded),r()},i.foldUs=function(t){return i.usFolded[t]=!i.usFolded[t],c.tasks.storeUsRowModes(i.projectId,i.sprintId,i.usFolded),r()},s=function(t,e){var r=t?i.usTasks.getIn([t.toString(),e.toString()]).size:i.usTasks.getIn(["null",e.toString()]).size;return i.statusesFolded[e]?r&&i.usFolded[t]?40*Math.round(Math.sqrt(r)):40:0},a=function(t,e){var r=o.find(".squish-status-"+t);return e?r.css("max-width",e):"0"===i.ctrl.zoomLevel?r.css("max-width",148):r.css("max-width",300)},n=function(){var t,e,r=[],n=o.find(".task-colum-name");return r=_.map(n,function(t){return $(t).outerWidth(!0)}),e=_.reduce(r,function(t,e){return t+e}),o.find(".taskboard-table-inner").css("width",e),o.find(".issues-row .taskboard-row-title-box").outerWidth(!0),o.find(".issues-row").css("width",e-r.pop()),t="0"===i.ctrl.zoomLevel?128:280,o.find(".issues-row .taskboard-cards-box .card").css("max-width",t)},e=function(r){var n=s(null,r);return _.forEach(i.userstories,function(t){var e=s(t.id,r);if(n<e)return n=e}),a(r,n)},r=function(){_.forEach(i.taskStatusList,function(t){return e(t.id)}),n()}}}},i.directive("tgTaskboardSquishColumn",["$tgResources",e])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy;var t=function(t,e,h,s){return{link:function(d,i,t){var o;return o=d.$watch("usTasks",function(t){var e,c,r,n,u,l,p;if(t&&t.size&&(o(),-1<d.project.my_permissions.indexOf("modify_task")))return u=p=null,n=function(){var t=s.instant("BACKLOG.SORTABLE_FILTER_ERROR");return $tgConfirm.notify("error",t)},c=function(t){return t.scope().$destroy(),t.off(),t.remove()},e=_.map(i.find(".taskboard-column"),function(t){return t}),(r=dragula(e,{copySortSource:!1,copy:!1,accepts:function(t,e){return!$(e).hasClass("taskboard-row-title-box")},moves:function(t){return $(t).is("tg-card")}})).on("drag",function(t){if(p=$(t).parent().scope(),i.hasClass("active-filters"))return n(),setTimeout(function(){return r.cancel(!0)},0),!1}),r.on("dragend",function(t){var e,r,n,i,o,s,a=$(t).parent();return u=$(t),r=u.scope().task,e=u.index(),l=a.scope(),s=p.us?p.us.id:null,o=p.st.id,i=l.us?l.us.id:null,(n=l.st.id)===o&&i===s||c(u),d.$apply(function(){return h.$broadcast("taskboard:task:move",r,r.getIn(["model","status"]),i,n,e)})}),autoScroll([$(".taskboard-table-body")[0]],{margin:100,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),d.$on("$destroy",function(){return i.off(),r.destroy()})})}}};angular.module("taigaBacklog").directive("tgTaskboardSortable",["$tgRepo","$tgResources","$rootScope","$translate",t])}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.reset=function(){return this.foldStatusChanged={},this.issuesRaw=[]},e.prototype.init=function(t,e,r){return this.issueStatusById=r,this.project=t,this.usersById=e},e.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},e.prototype.add=function(t){return this.issuesRaw=this.issuesRaw.concat(t),this.refresh()},e.prototype.remove=function(t){var e,r,n=this.issuesRaw;for(r in n)if(e=n[r],t.id===e.id)return this.issuesRaw.splice(r,1),void this.refresh()},e.prototype.set=function(t){return this.issuesRaw=t,this.refresh()},e.prototype.getIssue=function(e){return this.milestoneIssues.find(function(t){return t.get("id")===e})},e.prototype.getIssueModel=function(e){return _.find(this.issuesRaw,function(t){return t.id===e})},e.prototype.replaceModel=function(e){return this.issuesRaw=_.map(this.issuesRaw,function(t){return e.id===t.id?e:t}),this.refresh()},e.prototype.refresh=function(){for(var t,e,r=[],n=this.issuesRaw,i=0,o=n.length;i<o;i++)e=n[i],(t={}).foldStatusChanged=this.foldStatusChanged[e.id],t.model=e.getAttrs(),t.modelName=e.getName(),t.id=e.id,t.status=this.issueStatusById[e.status],t.images=_.filter(t.model.attachments,function(t){return!!t.thumbnail_card_url}),t.assigned_to=this.usersById[e.assigned_to],t.colorized_tags=_.map(t.model.tags,function(t){return{name:t[0],color:t[1]}}),r.push(t);return this.milestoneIssues=Immutable.fromJS(r)},t=e,angular.module("taigaKanban").service("tgTaskboardIssues",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.reset=function(){return this.tasksRaw=[],this.foldStatusChanged={},this.usTasks=Immutable.Map()},e.prototype.init=function(t,e){return this.project=t,this.usersById=e},e.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},e.prototype.add=function(t){return this.tasksRaw=this.tasksRaw.concat(t),this.refresh()},e.prototype.set=function(t){return this.tasksRaw=t,this.refreshRawOrder(),this.refresh()},e.prototype.setUserstories=function(t){return this.userstories=t},e.prototype.refreshRawOrder=function(){var t,e,r,n,i;for(this.order={},n=[],t=0,e=(r=this.tasksRaw).length;t<e;t++)i=r[t],n.push(this.order[i.id]=i.taskboard_order);return n},e.prototype.assignOrders=function(t){return t=_.invert(t),this.order=_.assign(this.order,t),this.refresh()},e.prototype.getTask=function(e){var r=null;return this.usTasks.forEach(function(t){if(t.forEach(function(t){if(r=t.find(function(t){return t.get("id")===e}))return!1}),r)return!1}),r},e.prototype.replace=function(n){return this.usTasks=this.usTasks.map(function(r){return r.map(function(t){var e=t.findIndex(function(t){return t.get("id")===r.get("id")});return-1!==e&&(t=t.set(e,n)),t})})},e.prototype.getTaskModel=function(e){return _.find(this.tasksRaw,function(t){return t.id===e})},e.prototype.replaceModel=function(e){return this.tasksRaw=_.map(this.tasksRaw,function(t){return e.id===t.id?e:t}),this.refresh()},e.prototype.move=function(e,r,n,t){var i,o,s,a,c,u,l,p,d,h,f,g,m,v,y=this.getTaskModel(e),b=_.filter(this.tasksRaw,function(t){return t.status===n&&t.user_story===r});if(b=_.sortBy(b,(m=this,function(t){return m.order[t.id]})),g=_.filter(b,function(t){return t.id!==e}),o=_.slice(g,0,t),i=_.slice(g,t),f={},d=o[o.length-1],1<(h=_.filter(o,(v=this,function(t){return v.order[t.id]===v.order[d.id]}))).length)for(s=0,l=h.length;s<l;s++)f[(a=h[s]).id]=this.order[a.id];for(d?d&&(this.order[y.id]=this.order[d.id]+1):this.order[y.id]=0,u=c=0,p=i.length;c<p;u=++c)a=i[u],this.order[a.id]=this.order[y.id]+u+1;return y.status=n,y.user_story=r,y.taskboard_order=this.order[y.id],this.refresh(),{task_id:y.id,order:this.order[y.id],set_orders:f}},e.prototype.refresh=function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g;if(this.project){for(this.tasksRaw=_.sortBy(this.tasksRaw,(g=this,function(t){return g.order[t.id]})),d=this.tasksRaw,p=_.sortBy(this.project.task_statuses,"order"),f={},t=0,n=(a=_.union(this.userstories,[{id:null}])).length;t<n;t++)for(f[(h=a[t]).id]={},e=0,i=p.length;e<i;e++)c=p[e],f[h.id][c.id]=[];for(r=0,o=d.length;r<o;r++)null!=f[(l=d[r]).user_story]&&null!=f[l.user_story][l.status]&&(u={},s=l.getAttrs(),u.foldStatusChanged=this.foldStatusChanged[l.id],u.model=s,u.images=_.filter(s.attachments,function(t){return!!t.thumbnail_card_url}),u.id=l.id,u.assigned_to=this.usersById[l.assigned_to],u.colorized_tags=_.map(u.model.tags,function(t){return{name:t[0],color:t[1]}}),f[l.user_story][l.status].push(u));return this.usTasks=Immutable.fromJS(f)}},t=e,angular.module("taigaKanban").service("tgTaskboardTasks",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.reset=function(){return this.userstoriesRaw=[],this.archivedStatus=[],this.statusHide=[],this.foldStatusChanged={},this.usByStatus=Immutable.Map()},e.prototype.init=function(t,e){return this.project=t,this.usersById=e},e.prototype.resetFolds=function(){return this.foldStatusChanged={}},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refreshUserStory(t)},e.prototype.set=function(t){return this.userstoriesRaw=t,this.refreshRawOrder(),this.refresh()},e.prototype.add=function(t){return this.userstoriesRaw=this.userstoriesRaw.concat(t),this.refreshRawOrder(),this.refresh()},e.prototype.addArchivedStatus=function(t){return this.archivedStatus.push(t)},e.prototype.isUsInArchivedHiddenStatus=function(t){var e=this.getUsModel(t);return-1!==this.archivedStatus.indexOf(null!=e?e.status:void 0)&&-1!==this.statusHide.indexOf(null!=e?e.status:void 0)},e.prototype.hideStatus=function(t){return this.deleteStatus(t),this.statusHide.push(t)},e.prototype.showStatus=function(e){return _.remove(this.statusHide,function(t){return t===e})},e.prototype.getStatus=function(e){return _.filter(this.userstoriesRaw,function(t){return t.status===e})},e.prototype.deleteStatus=function(e){var t=_.filter(this.userstoriesRaw,function(t){return t.status===e});return t=_.map(function(t){return t.id}),this.archived=_.difference(this.archived,t),this.userstoriesRaw=_.filter(this.userstoriesRaw,function(t){return t.status!==e}),this.refresh()},e.prototype.refreshRawOrder=function(){var t,e,r,n,i;for(this.order={},i=[],t=0,r=(n=this.userstoriesRaw).length;t<r;t++)e=n[t],i.push(this.order[e.id]=e.kanban_order);return i},e.prototype.assignOrders=function(t){return this.order=_.assign(this.order,t),this.refresh()},e.prototype.move=function(t,e,r){var n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I,E,T,C,P,w,A=t.length,O=_.filter(this.userstoriesRaw,function(t){return t.status===e});if(O=_.sortBy(O,(I=this,function(t){return I.order[t.id]})),$=_.filter(O,function(e){return!_.find(t,function(t){return e.id===t.id})}),i=_.slice($,0,r),n=_.slice($,r),b={},m=i[i.length-1],1<(v=_.filter(i,(E=this,function(t){return E.order[t.id]===E.order[m.id]}))).length)for(o=0,p=v.length;o<p;o++)b[(s=v[o]).id]=this.order[s.id];if(g=[],S=[],y=[],-1!==this.archivedStatus.indexOf(e)&&-1!==this.statusHide.indexOf(e))j=(new Date).getTime();else if(m){if(m){for(j=this.order[m.id]+1,v=_.filter(i,(P=this,function(t){return t.kanban_order===P.order[m.id]})),u=c=0,h=n.length;c<h;u=++c)s=n[u],this.order[s.id]=this.order[m.id]+u+A+1,s.kanban_order=this.order[s.id];y=_.map(n,(C=this,function(t){return{us_id:t.id,order:C.order[t.id]}})),1<v.length&&(S=_.map(v,(T=this,function(t){return{us_id:t.id,order:T.order[t.id]}})))}}else{for(u=a=j=0,d=n.length;a<d;u=++a)s=n[u],this.order[s.id]=u+A+1,s.kanban_order=this.order[s.id];y=_.map(n,(w=this,function(t){return{us_id:t.id,order:w.order[t.id]}}))}for(u=l=0,f=t.length;l<f;u=++l)(k=t[u]).status=e,k.kanban_order=j+u,this.order[k.id]=k.kanban_order,g.push({us_id:k.id,order:k.kanban_order});return this.refresh(),{bulkOrders:g.concat(S,y),usList:g,set_orders:b}},e.prototype.moveToEnd=function(t,e){var r=this.getUsModel(t);return this.order[r.id]=-1,r.status=e,r.kanban_order=this.order[r.id],this.refresh(),{us_id:r.id,order:-1}},e.prototype.replace=function(r){return this.usByStatus=this.usByStatus.map(function(t){var e=t.findIndex(function(t){return t.get("id")===r.get("id")});return-1!==e&&(t=t.set(e,r)),t})},e.prototype.replaceModel=function(e){return this.userstoriesRaw=_.map(this.userstoriesRaw,function(t){return e.id===t.id?e:t}),this.refresh()},e.prototype.getUs=function(e){var r=null;return this.usByStatus.forEach(function(t){if(r=t.find(function(t){return t.get("id")===e}))return!1}),r},e.prototype.getUsModel=function(e){return _.find(this.userstoriesRaw,function(t){return t.id===e})},e.prototype.refreshUserStory=function(e){var t=this.getUsModel(e),r=this.usByStatus.toJS(),n=_.findIndex(r[t.status],function(t){return t.id===e}),i=this.retrieveUserStoryData(t);return r[t.status][n]=i,this.usByStatus=Immutable.fromJS(r)},e.prototype.retrieveUserStoryData=function(t){var r,n={},e=t.getAttrs();return n.foldStatusChanged=this.foldStatusChanged[t.id],n.model=e,n.images=_.filter(e.attachments,function(t){return!!t.thumbnail_card_url}),n.id=t.id,n.assigned_to=this.usersById[t.assigned_to],n.assigned_users=[],t.assigned_users.forEach((r=this,function(t){var e=r.usersById[t];return n.assigned_users.push(e)})),n.colorized_tags=_.map(n.model.tags,function(t){return{name:t[0],color:t[1]}}),n},e.prototype.refresh=function(){var t,e,r,n,i,o;for(e in this.userstoriesRaw=_.sortBy(this.userstoriesRaw,(o=this,function(t){return o.order[t.id]})),t={},r=this.userstoriesRaw)i=r[e],t[(n=this.retrieveUserStoryData(i)).model.status]||(t[n.model.status]=[]),t[n.model.status].push(n);return this.usByStatus=Immutable.fromJS(t)},t=e,angular.module("taigaKanban").service("tgKanbanUserstories",t)}.call(this),function(){function $(t,e){return function(){return t.apply(e,arguments)}}var t,e,r,n,i,I,o,s,a,c,u,E,l={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function d(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,_,b,S,j){var k;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.location=c,this.appMetaService=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.model=g,this.kanbanUserstoriesService=m,this.storage=v,this.filterRemoteStorageService=y,this.projectService=_,this.lightboxFactory=b,this.tgLoader=S,this.timeout=j,this.renderUserStories=$(this.renderUserStories,this),this.changeUsAssignedUsers=$(this.changeUsAssignedUsers,this),I(this),this.kanbanUserstoriesService.reset(),this.openFilter=!1,this.selectedUss={},this.applyStoredFilters(this.params.pslug,"kanban-filters")||(this.scope.sectionName=this.translate.instant("KANBAN.SECTION_NAME"),this.initializeEventHandlers(),E.defineImmutableProperty(this.scope,"usByStatus",(k=this,function(){return k.kanbanUserstoriesService.usByStatus})))}E=this.taiga,a=this.taiga.mixOf,this.taiga.toggleText,u=this.taiga.scopeDefer,this.taiga.bindOnce,s=this.taiga.groupBy,this.taiga.timeout,I=this.taiga.bindMethods,o=this.taiga.debounceLeading,c=angular.module("taigaKanban"),function(t,e){for(var r in e)l.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(d,a(E.Controller,E.PageMixin,E.FiltersMixin,E.UsFiltersMixin)),d.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgModel","tgKanbanUserstories","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgLightboxFactory","tgLoader","$timeout"],d.prototype.storeCustomFiltersName="kanban-custom-filters",d.prototype.storeFiltersName="kanban-filters",d.prototype.cleanSelectedUss=function(){var t,e=[];for(t in this.selectedUss)e.push(this.selectedUss[t]=!1);return e},d.prototype.toggleSelectedUs=function(t){return this.selectedUss[t]=!this.selectedUss[t]},d.prototype.firstLoad=function(){var r,t=this.loadInitialData();return t.then((r=this,function(){var t=r.translate.instant("KANBAN.PAGE_TITLE",{projectName:r.scope.project.name}),e=r.translate.instant("KANBAN.PAGE_DESCRIPTION",{projectName:r.scope.project.name,projectDescription:r.scope.project.description});return r.appMetaService.setAll(t,e)})),t.then(null,this.onInitialDataError.bind(this))},d.prototype.setZoom=function(t,e){var r,n,i;return this.zoomLevel===t?null:(this.isFirstLoad=!this.zoomLevel,r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((i=this,function(){return i.isFirstLoad=!1,i.kanbanUserstoriesService.resetFolds()})):2<this.zoomLevel&&r<=2?(this.zoomLoading=!0,this.loadUserstories().then((n=this,function(){return n.zoomLoading=!1,n.kanbanUserstoriesService.resetFolds()}))):void 0)},d.prototype.filtersReloadContent=function(){return this.loadUserstories().then((o=this,function(){var t,e,r,n,i=_.difference(o.kanbanUserstoriesService.archivedStatus,o.kanbanUserstoriesService.statusHide);if(i.length){for(r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(o.loadUserStoriesForStatus({},n));return r}}));var o},d.prototype.initializeEventHandlers=function(){var r,n,i,o;return this.scope.$on("usform:new:success",(r=this,function(t,e){return r.refreshTagsColors().then(function(){return r.kanbanUserstoriesService.add(e)}),r.analytics.trackEvent("userstory","create","create userstory on kanban",1)})),this.scope.$on("usform:bulk:success",(n=this,function(t,e){return n.confirm.notify("success"),n.refreshTagsColors().then(function(){return n.kanbanUserstoriesService.add(e)}),n.analytics.trackEvent("userstory","create","bulk create userstory on kanban",1)})),this.scope.$on("usform:edit:success",(i=this,function(t,e){return i.refreshTagsColors().then(function(){return i.kanbanUserstoriesService.replaceModel(e)})})),this.scope.$on("kanban:us:deleted",(o=this,function(t,e){return o.filtersReloadContent()})),this.scope.$on("kanban:us:move",this.moveUs),this.scope.$on("kanban:show-userstories-for-status",this.loadUserStoriesForStatus),this.scope.$on("kanban:hide-userstories-for-status",this.hideUserStoriesForStatus)},d.prototype.addNewUs=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project,statusId:e});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,e)}},d.prototype.editUs=function(t){var r,n=this.kanbanUserstoriesService.getUs(t);return n=n.set("loading-edit",!0),this.kanbanUserstoriesService.replace(n),this.rs.userstories.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("us",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"us",obj:e,statusList:r.scope.usStatusList,attachments:t.toJS()})}),n=n.set("loading-edit",!1),r.kanbanUserstoriesService.replace(n)}))},d.prototype.deleteUs=function(t){var n,i=this.kanbanUserstoriesService.getUs(t);return i=i.set("loading-delete",!0),this.rs.userstories.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("US.TITLE_DELETE_ACTION"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(t){var e=n.repo.remove(r);return e.then(function(){return n.scope.$broadcast("kanban:us:deleted"),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},d.prototype.showPlaceHolder=function(t){return this.scope.usStatusList[0].id===t&&!this.kanbanUserstoriesService.userstoriesRaw.length},d.prototype.toggleFold=function(t){return this.kanbanUserstoriesService.toggleFold(t)},d.prototype.isUsInArchivedHiddenStatus=function(t){return this.kanbanUserstoriesService.isUsInArchivedHiddenStatus(t)},d.prototype.changeUsAssignedUsers=function(t){var r,n=this.kanbanUserstoriesService.getUsModel(t),e=function(t){var e;return n.assigned_users=t,e=n.assigned_to,p.call(t,e)<0&&0<t.length&&(n.assigned_to=t[0]),0===t.length&&(n.assigned_to=null),r.kanbanUserstoriesService.replaceModel(n),r.repo.save(n).then(function(){if(r.generateFilters(),r.isFilterDataTypeSelected("assigned_users")||r.isFilterDataTypeSelected("role"))return r.filtersReloadContent()})};return(r=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:_.compact(_.union(n.assigned_users,[n.assigned_to])),activeUsers:this.scope.activeUsers,onClose:e,lbTitle:this.translate.instant("COMMON.ASSIGNED_USERS.ADD")})},d.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((e=this,function(t){return e.scope.project.tags_colors=t._attrs}));var e},d.prototype.renderBatch=function(){return this.rendered=_.concat(this.rendered,_.take(this.queue,this.batchSize)),this.queue=_.drop(this.queue,this.batchSize),this.kanbanUserstoriesService.set(this.rendered),this.scope.$broadcast("redraw:wip"),0<this.queue.length?this.timeout(this.renderBatch):u(this.scope,(t=this,function(){return t.rootscope.$broadcast("kanban:userstories:loaded",t.rendered),t.scope.$broadcast("userstories:loaded",t.rendered)}));var t},d.prototype.renderUserStories=function(t){var n;for(t=_.sortBy(t,"kanban_order"),n=_.groupBy(t,"status"),this.rendered=[],this.queue=[],this.batchSize=0;this.queue.length<t.length;)_.each(this.scope.project.us_statuses,function(r){return function(t){var e;if(0<(null!=(e=n[t.id])?e.length:void 0))return r.queue=_.concat(r.queue,_.take(n[t.id],3)),n[t.id]=_.drop(n[t.id],3)}}(this)),this.batchSize||(this.batchSize=this.queue.length);return this.timeout(this.renderBatch)},d.prototype.loadUserstories=function(){var e,t={status__is_archived:!1};return 2<this.zoomLevel&&(t.include_attachments=1,t.include_tasks=1),t=_.merge(t,this.location.search()),this.rs.userstories.listAll(this.scope.projectId,t).then((e=this,function(t){return e.kanbanUserstoriesService.init(e.scope.project,e.scope.usersById),e.tgLoader.pageLoaded(),e.renderUserStories(t),t}))},d.prototype.loadUserStoriesForStatus=function(t,e){var r,n,i=this.location.search().status;if(!i||-1!==(i=i.split(",").map(function(t){return parseInt(t,10)})).indexOf(e))return r={status:e,include_attachments:!0,include_tasks:!0},r=_.merge(r,this.location.search()),this.rs.userstories.listAll(this.scope.projectId,r).then((n=this,function(t){return n.scope.$broadcast("kanban:shown-userstories-for-status",e,t),t}))},d.prototype.hideUserStoriesForStatus=function(t,e){return this.scope.$broadcast("kanban:hidden-userstories-for-status",e)},d.prototype.loadKanban=function(){return this.q.all([this.refreshTagsColors(),this.loadUserstories()])},d.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_kanban_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.projectId=t.id,this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=s(t.points,function(t){return t.id}),this.scope.usStatusById=s(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"order"),this.scope.$emit("project:loaded",t),t},d.prototype.initializeSubscription=function(){var e,t="changes.project."+this.scope.projectId+".userstories",r=E.randomInt(700,1e3);return this.events.subscribe(this.scope,t,o(r,(e=this,function(t){return e.loadUserstories()})))},d.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.loadKanban(),this.generateFilters()},d.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="kanban_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},d.prototype.moveUs=function(t,n,e,r){var i,o,s,a;return this.cleanSelectedUss(),n=_.map(n,(s=this,function(t){return s.kanbanUserstoriesService.getUsModel(t.id)})),this.rootscope.$broadcast("kanban:userstories:loaded",n,e,r),i=this.kanbanUserstoriesService.move(n,e,r),(o=this.rs.userstories.bulkUpdateKanbanOrder(this.scope.projectId,e,i.bulkOrders)).then((a=this,function(){var e={headers:{"set-orders":JSON.stringify(i.setOrders)}},r={include_attachments:!0,include_tasks:!0},t=_.map(n,function(t){return a.repo.save(t,!0,r,e,!0)});return(o=a.q.all(t)).then(function(t){var e,r=t[1];return r&&r["taiga-info-order-updated"]&&(e=JSON.parse(r["taiga-info-order-updated"]),a.kanbanUserstoriesService.assignOrders(e)),a.scope.$broadcast("redraw:wip"),a.generateFilters(),a.isFilterDataTypeSelected("status")&&a.filtersReloadContent(),o})}))},c.controller("KanbanController",d),r=function(t,e){return{link:function(t,r,e){return r.find(".kanban-table-body").on("scroll",function(t){var e=angular.element(t.currentTarget);return r.find(".kanban-table-header .kanban-table-inner").css("left",-1*e.scrollLeft())}),t.$on("$destroy",function(){return r.off()})}}},c.directive("tgKanban",["$tgRepo","$rootScope",r]),t=function(o,t,s){var a=t.instant("KANBAN.ACTION_SHOW_ARCHIVED"),c=t.instant("KANBAN.ACTION_HIDE_ARCHIVED");return{link:function(e,t,r){var n=e.$eval(r.tgKanbanArchivedStatusHeader),i=!0;return s.addArchivedStatus(n.id),s.hideStatus(n.id),e.class="icon-watch",e.title=a,t.on("click",function(t){return i=!i,e.$apply(function(){return i?(e.class="icon-watch",e.title=a,o.$broadcast("kanban:hide-userstories-for-status",n.id),s.hideStatus(n.id)):(e.class="icon-unwatch",e.title=c,o.$broadcast("kanban:show-userstories-for-status",n.id),s.showStatus(n.id))})}),e.$on("$destroy",function(){return t.off()})}}},c.directive("tgKanbanArchivedStatusHeader",["$rootScope","$translate","tgKanbanUserstories",t]),e=function(o,a){return{link:function(t,e,r){var s,n=o.instant("KANBAN.HIDDEN_USER_STORIES"),i=t.$eval(r.tgKanbanArchivedStatusIntro);return e.text(n),s=function(t){return t?e.text(""):e.text(n)},t.$on("kanban:us:move",function(t,e,r,n,i){var o=!!a.getStatus(n).length;return s(o)}),t.$on("kanban:shown-userstories-for-status",function(t,e,r){var n;if(e===i.id)return a.deleteStatus(e),a.add(r),n=!!a.getStatus(e).length,s(n)}),t.$on("kanban:hidden-userstories-for-status",function(t,e){if(e===i.id)return s(!1)}),t.$on("$destroy",function(){return e.off()})}}},c.directive("tgKanbanArchivedStatusIntro",["$translate","tgKanbanUserstories",e]),n=function(o,s){return{link:function(r,n,t){var e,i;return r.foldStatus=function(t){r.folds[t.id]=!r.folds[t.id],o.kanban.storeStatusColumnModes(r.projectId,r.folds),i()},i=function(){var t=_.map(r.usStatusList,function(t){return r.folds[t.id]?40:310}),e=_.reduce(t,function(t,e){return t+e});return n.find(".kanban-table-inner").css("width",e)},e=r.$watch("usByStatus",function(t){if(null!=t&&t.size)return r.folds=o.kanban.getStatusColumnModes(s.project.get("id")),i(),e()})}}},c.directive("tgKanbanSquishColumn",["$tgResources","tgProjectService",n]),i=function(o){return{link:function(t,e,r){var n=t.$eval(r.tgKanbanWipLimit),i=function(){return e.find(".kanban-wip-limit").remove(),o(function(){var t=e.find("tg-card")[n.wip_limit];if(t)return angular.element(t).before("<div class='kanban-wip-limit'></div>")})};return n&&!n.is_archived&&(t.$on("redraw:wip",i),t.$on("kanban:us:move",i),t.$on("usform:new:success",i),t.$on("usform:bulk:success",i)),t.$on("$destroy",function(){return e.off()})}}},c.directive("tgKanbanWipLimit",["$timeout",i])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy,this.taiga.timeout;var t=function(t,e,d){return{link:function(p,n,t){var i;return i=p.$watch("usByStatus",function(t){var e,c,r,u,l;if(t&&t.size&&(i(),-1<p.project.my_permissions.indexOf("modify_us")))return 0,c=function(t){return t.scope().$destroy(),t.off(),t.remove()},e=_.map(n.find(".taskboard-column"),function(t){return t}),(r=dragula(e,{copySortSource:!1,copy:!1,moves:function(t){return $(t).is("tg-card")}})).on("drag",function(t){return window.dragMultiple.start(t,e)}),r.on("cloned",function(t,e){return $(t).addClass("multiple-drag-mirror")}),r.on("dragend",function(t){var n,e,r,i,o,s,a=$(t).parent();(l=a.scope()).s.id;return(n=window.dragMultiple.stop()).length||(n=[t]),r=n[0],i=$(a).find("tg-card").index(r),o=l.s.id,s=_.map(n,function(t){return $(t).scope().us}),e=_.map(s,function(t){return{id:t.get("id"),oldStatusId:t.getIn(["model","status"])}}),p.$apply(function(){return _.each(s,function(t,e){var r=t.getIn(["model","status"]);if(!(o===r))return u=$(n[e]),c(u)}),d.$broadcast("kanban:us:move",e,o,i)})}),autoScroll(e,{margin:100,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),p.$on("$destroy",function(){return n.off(),r.destroy()})})}}};angular.module("taigaKanban").directive("tgKanbanSortable",["$tgRepo","$tgResources","$rootScope",t])}.call(this),function(){var t,e,_,r,n,i,o,s={}.hasOwnProperty;function a(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.location=c,this.log=u,this.appMetaService=l,this.analytics=p,this.navUrls=d,this.translate=h,this.modelTransform=f,this.errorHandlingService=g,this.projectService=m,_(this),this.scope.epicRef=this.params.epicref,this.scope.sectionName=this.translate.instant("EPIC.SECTION_NAME"),this.initializeEventHandlers(),(v=this.loadInitialData()).then((y=this,function(){return y._setMeta(),y.initializeOnDeleteGoToUrl()})),v.then(null,this.onInitialDataError.bind(this))}o=this.taiga,n=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,r=this.taiga.groupBy,this.taiga.bindOnce,_=this.taiga.bindMethods,i=angular.module("taigaEpics"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,n(o.Controller,o.PageMixin)),a.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],a.prototype._setMeta=function(){var t,e=this.translate.instant("EPIC.PAGE_TITLE",{epicRef:"#"+this.scope.epic.ref,epicSubject:this.scope.epic.subject,projectName:this.scope.project.name}),r=this.translate.instant("EPIC.PAGE_DESCRIPTION",{epicStatus:(null!=(t=this.scope.statusById[this.scope.epic.status])?t.name:void 0)||"--",epicDescription:angular.element(this.scope.epic.description_html||"").text()});return this.appMetaService.setAll(e,r)},a.prototype.initializeEventHandlers=function(){var t,e,r;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on epic",1)})),this.scope.$on("comment:new",(e=this,function(){return e.loadEpic()})),this.scope.$on("custom-attributes-values:edit",(r=this,function(){return r.rootscope.$broadcast("object:updated")}))},a.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-epics",t)},a.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.immutableProject=this.projectService.project,this.scope.$emit("project:loaded",t),this.scope.statusList=t.epic_statuses,this.scope.statusById=r(t.epic_statuses,function(t){return t.id}),t},a.prototype.loadEpic=function(){return this.rs.epics.getByRef(this.scope.projectId,this.params.epicref).then((i=this,function(t){var e,r,n;if(i.scope.epic=t,i.scope.immutableEpic=Immutable.fromJS(t._attrs),i.scope.epicId=t.id,i.scope.commentModel=t,i.modelTransform.setObject(i.scope,"epic"),null!=(null!=(r=i.scope.epic.neighbors.previous)?r.ref:void 0)&&(e={project:i.scope.project.slug,ref:i.scope.epic.neighbors.previous.ref},i.scope.previousUrl=i.navUrls.resolve("project-epics-detail",e)),null!=(null!=(n=i.scope.epic.neighbors.next)?n.ref:void 0))return e={project:i.scope.project.slug,ref:i.scope.epic.neighbors.next.ref},i.scope.nextUrl=i.navUrls.resolve("project-epics-detail",e)}));var i},a.prototype.loadUserstories=function(){return this.rs2.userstories.listInEpic(this.scope.epicId).then((e=this,function(t){return e.scope.userstories=t}));var e},a.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadEpic().then((t=this,function(){return t.loadUserstories()}))},a.prototype.onUpvote=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.upvote(this.scope.epicId).then(r,n)},a.prototype.onDownvote=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.downvote(this.scope.epicId).then(r,n)},a.prototype.onWatch=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.watch(this.scope.epicId).then(r,n)},a.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.unwatch(this.scope.epicId).then(r,n)},a.prototype.onSelectColor=function(e){var t,r,n=function(){return t.rootscope.$broadcast("object:updated"),t.confirm.notify("success")},i=function(){return r.confirm.notify("error")};return(r=t=this).modelTransform.save(function(t){return t.color=e,t}).then(n,i)},i.controller("EpicDetailController",a),e=function(t,o){var s=t.get("common/components/status-display.html",!0);return{link:function(n,i,t){var e=function(t){var e=n.statusById[t.status],r=s({is_closed:e.is_closed,status:e});return r=o(r)(n),i.html(r)};return n.$watch(t.ngModel,function(t){if(null!=t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},i.directive("tgEpicStatusDisplay",["$tgTemplate","$compile",e]),t=function(a,t,c,u,l,p,e,r){var d=r.get("common/components/status-button.html",!0);return{link:function(n,i,t,e){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_epic")},r=function(t){var e=n.statusById[t.status],r=p(d({status:e,statuses:n.statusList,editable:o()}))(n);return i.html(r)},s=function(e){var t=u().target(i).start(),r=function(){return a.$broadcast("object:updated"),t.finish()},n=function(){return c.notify("error"),t.finish()};return l.save(function(t){return t.status=e,t}).then(r,n)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),o())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),o())return e=angular.element(t.currentTarget),$.fn.popover().closeAll(),s(e.data("status-id"))}),n.$watch(function(){var t;return null!=(t=e.$modelValue)?t.status:void 0},function(){var t=e.$modelValue;if(t)return r(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},i.directive("tgEpicStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",t])}.call(this),function(){var t,e,r,n,i,o,y,s,a,c,f,u,l={}.hasOwnProperty;function p(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g){var m,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.analytics=l,this.navUrls=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.projectService=g,y(this),this.scope.issueRef=this.params.issueref,this.scope.sectionName=this.translate.instant("ISSUES.SECTION_NAME"),this.initializeEventHandlers(),(m=this.loadInitialData()).then((v=this,function(){return v._setMeta(),v.initializeOnDeleteGoToUrl()})),m.then(null,this.onInitialDataError.bind(this))}u=this.taiga,a=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,s=this.taiga.groupBy,this.taiga.bindOnce,y=this.taiga.bindMethods,f=this.taiga.normalizeString,c=angular.module("taigaIssues"),function(t,e){for(var r in e)l.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(p,a(u.Controller,u.PageMixin)),p.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],p.prototype._setMeta=function(){var t,e,r,n,i=this.translate.instant("ISSUE.PAGE_TITLE",{issueRef:"#"+this.scope.issue.ref,issueSubject:this.scope.issue.subject,projectName:this.scope.project.name}),o=this.translate.instant("ISSUE.PAGE_DESCRIPTION",{issueStatus:(null!=(t=this.scope.statusById[this.scope.issue.status])?t.name:void 0)||"--",issueType:(null!=(e=this.scope.typeById[this.scope.issue.type])?e.name:void 0)||"--",issueSeverity:(null!=(r=this.scope.severityById[this.scope.issue.severity])?r.name:void 0)||"--",issuePriority:(null!=(n=this.scope.priorityById[this.scope.issue.priority])?n.name:void 0)||"--",issueDescription:angular.element(this.scope.issue.description_html||"").text()});return this.appMetaService.setAll(i,o)},p.prototype.initializeEventHandlers=function(){var t,e,r,n,i;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on issue",1)})),this.scope.$on("promote-issue-to-us:success",(e=this,function(){return e.analytics.trackEvent("issue","promoteToUserstory","promote issue to userstory",1),e.rootscope.$broadcast("object:updated"),e.loadIssue()})),this.scope.$on("comment:new",(r=this,function(){return r.loadIssue()})),this.scope.$on("custom-attributes-values:edit",(n=this,function(){return n.rootscope.$broadcast("object:updated")})),this.scope.$on("assign-sprint-to-issue:success",(i=this,function(t,e){return i.scope.issue.milestone=e,i.rootscope.$broadcast("object:updated"),e?i.loadSprint():i.scope.sprint=null}))},p.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.project.is_issues_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-issues",t):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t)},p.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.issue_statuses,this.scope.statusById=s(t.issue_statuses,function(t){return t.id}),this.scope.typeById=s(t.issue_types,function(t){return t.id}),this.scope.typeList=_.sortBy(t.issue_types,"order"),this.scope.severityList=t.severities,this.scope.severityById=s(t.severities,function(t){return t.id}),this.scope.priorityList=t.priorities,this.scope.priorityById=s(t.priorities,function(t){return t.id}),t},p.prototype.loadIssue=function(){return this.rs.issues.getByRef(this.scope.projectId,this.params.issueref).then((i=this,function(t){var e,r,n;if(i.scope.issue=t,i.scope.issueId=t.id,i.scope.commentModel=t,i.modelTransform.setObject(i.scope,"issue"),null!=(null!=(r=i.scope.issue.neighbors.previous)?r.ref:void 0)&&(e={project:i.scope.project.slug,ref:i.scope.issue.neighbors.previous.ref},i.scope.previousUrl=i.navUrls.resolve("project-issues-detail",e)),null!=(null!=(n=i.scope.issue.neighbors.next)?n.ref:void 0))return e={project:i.scope.project.slug,ref:i.scope.issue.neighbors.next.ref},i.scope.nextUrl=i.navUrls.resolve("project-issues-detail",e)}));var i},p.prototype.loadSprint=function(){if(this.scope.issue.milestone)return this.rs.sprints.get(this.scope.issue.project,this.scope.issue.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},p.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadIssue().then((t=this,function(){return t.loadSprint()}))},p.prototype.onUpvote=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.upvote(this.scope.issueId).then(r,n)},p.prototype.onDownvote=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.downvote(this.scope.issueId).then(r,n)},p.prototype.onWatch=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.watch(this.scope.issueId).then(r,n)},p.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.unwatch(this.scope.issueId).then(r,n)},c.controller("IssueDetailController",p),i=function(t,o){var s=t.get("common/components/status-display.html",!0);return{link:function(n,i,t){var e=function(t){var e=n.statusById[t.status],r=s({is_closed:e.is_closed,status:e});return r=o(r)(n),i.html(r)};return n.$watch(t.ngModel,function(t){if(null!=t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgIssueStatusDisplay",["$tgTemplate","$compile",i]),n=function(a,t,c,u,l,e,p){var d=e.get("common/components/status-button.html",!0);return{link:function(n,i,t,e){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_issue")},r=function(t){var e=n.statusById[t.status],r=d({status:e,statuses:n.statusList,editable:o()});return r=p(r)(n),i.html(r)},s=function(e){var t,r,n;return $.fn.popover().closeAll(),t=u().target(i).start(),n=function(){return a.$broadcast("object:updated"),t.finish()},r=function(){return c.notify("error"),t.finish()},l.save(function(t){return t.status=e,t}).then(n,r)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),o())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),o())return e=angular.element(t.currentTarget),s(e.data("status-id"))}),n.$watch(function(){var t;return null!=(t=e.$modelValue)?t.status:void 0},function(){var t=e.$modelValue;if(t)return r(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgIssueStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),o=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-type-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),n=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},e=function(t){var e=i.typeById[t.type],r=h({type:e,typees:i.typeList,editable:n()});return r=d(r)(i),o.html(r)},r=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.type=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.type=e,t}).then(n,r))};return o.on("click",".type-data",function(t){if(t.preventDefault(),t.stopPropagation(),n())return o.find(".pop-type").popover().open()}),o.on("click",".type",function(t){var e;if(t.preventDefault(),t.stopPropagation(),n())return e=angular.element(t.currentTarget).data("type-id"),r(e)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.type:void 0},function(){var t=s.$modelValue;if(t)return e(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgIssueTypeButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",o]),r=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-severity-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),n=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},e=function(t){var e=i.severityById[t.severity],r=h({severity:e,severityes:i.severityList,editable:n()});return r=d(r)(i),o.html(r)},r=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.severity=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.severity=e,t}).then(n,r))};return o.on("click",".severity-data",function(t){if(t.preventDefault(),t.stopPropagation(),n())return o.find(".pop-severity").popover().open()}),o.on("click",".severity",function(t){var e;if(t.preventDefault(),t.stopPropagation(),n())return e=angular.element(t.currentTarget).data("severity-id"),r(e)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.severity:void 0},function(){var t=s.$modelValue;if(t)return e(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgIssueSeverityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",r]),e=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-priority-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),n=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},e=function(t){var e=i.priorityById[t.priority],r=h({priority:e,priorityes:i.priorityList,editable:n()});return r=d(r)(i),o.html(r)},r=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.priority=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.priority=e,t}).then(n,r))};return o.on("click",".priority-data",function(t){if(t.preventDefault(),t.stopPropagation(),n())return o.find(".pop-priority").popover().open()}),o.on("click",".priority",function(t){var e;if(t.preventDefault(),t.stopPropagation(),n())return e=angular.element(t.currentTarget).data("priority-id"),r(e)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.priority:void 0},function(){var t=s.$modelValue;if(t)return e(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgIssuePriorityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",e]),t=function(a,c,t,u,l,p,d,h){return{link:function(r,i,t,e){var n,o=[],s=null;return r.$watch(t.ngModel,function(t){if(t)return t.milestone?(i.find(".assign-issue-button.button-unset").removeClass("is-active"),i.find(".assign-issue-button.button-set").addClass("is-active")):(i.find(".assign-issue-button.button-set").removeClass("is-active"),i.find(".assign-issue-button.button-unset").addClass("is-active"))}),i.on("click",".assign-issue-button.button-unset",function(t){return t.preventDefault(),t.stopPropagation(),l.instant("ISSUES.ACTION_ATTACH_SPRINT"),s=e.$modelValue,c.sprints.list(r.projectId,null).then(function(t){return r.milestones=t.milestones,r.selectedSprint=s.milestone,o=angular.copy(r.milestones),p.open(i.find(".lightbox-assign-sprint-to-issue"))})}),i.on("click",".assign-issue-button.button-set",function(t){return t.preventDefault(),t.stopPropagation(),s=e.$modelValue,c.sprints.list(r.projectId,null).then(function(t){var e=_.find(t.milestones,{id:s.milestone}),r=l.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),n=l.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:e.name});return h.ask(r,null,n).then(function(t){var e=function(){return a.$broadcast("assign-sprint-to-issue:success",null),t.finish(),p.close(i)},r=function(){return t.finish(!1),h.notify("error")};return d.save(function(t){return t.setAttr("milestone",null),t}).then(e,r)})})}),r.$on("$destroy",function(){return i.off()}),n=function(t,e){return e=f(e.toUpperCase()),t=f(t.toUpperCase()),_.includes(e,t)},r.filterMilestones=function(e){return r.milestones=o.filter(function(t){return n(e,t.name)})},r.saveIssueToSprint=function(e,t){var r=u().target($(t.currentTarget)).start();return s.setAttr("milestone",e.id),d.save(function(t){return s.setAttr("milestone",e.id),t}).then(function(){return r.finish(),p.close(i.find(".lightbox-assign-sprint-to-issue")),a.$broadcast("assign-sprint-to-issue:success",e.id)})}},restrict:"EA",require:"ngModel",templateUrl:"issue/assign-sprint-to-issue-button.html"}},c.directive("tgAssignSprintToIssueButton",["$rootScope","$tgResources","$tgRepo","$tgLoading","$translate","lightboxService","$tgQueueModelTransformation","$tgConfirm",t])}.call(this),function(){this.taiga,this.taiga.bindOnce;var r=this.taiga.debounce,t=(this.taiga.trim,function(t,l,p,d,h,f,g){return{link:function(s,a,t){var e,c,u=null;return s.$on("issueform:bulk",function(t,e,r,n){return u&&u.reset(),f.open(a),s.new={projectId:e,milestoneId:r,bulk:""}}),e=r(2e3,function(t){var e,r,n,i,o;if(t.preventDefault(),(u=a.find("form").checksley()).validate())return e=h().target(c).start(),r=s.new.bulk,i=s.new.projectId,n=s.new.milestoneId,(o=l.issues.bulkCreate(i,n,r)).then(function(t){return t=_.map(t.data,function(t){return g.make_model("issues",t)}),e.finish(),d.$broadcast("issueform:new:success",t),f.close(a),p.notify("success")}),o.then(null,function(){return e.finish(),p.notify("error")})}),c=a.find(".submit-button"),a.on("submit","form",e),s.$on("$destroy",function(){return a.off()})}}});angular.module("taigaIssues").directive("tgLbCreateBulkIssues",["$tgRepo","$tgResources","$tgConfirm","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var t,e,r,I,n,i,o,s,h,d,f,a={}.hasOwnProperty;function c(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v){var y,_,b,S,j,k,$;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.urls=o,this.params=s,this.q=a,this.location=c,this.appMetaService=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.storage=g,this.filterRemoteStorageService=m,this.projectService=v,this.loadIssues=(y=this.loadIssues,_=this,function(){return y.apply(_,arguments)}),I(this),this.scope.sectionName=this.translate.instant("PROJECT.SECTION.ISSUES"),this.voting=!1,this.applyStoredFilters(this.params.pslug,this.filtersHashSuffix)||(($=this.loadInitialData()).then((b=this,function(){var t=b.translate.instant("ISSUES.PAGE_TITLE",{projectName:b.scope.project.name}),e=b.translate.instant("ISSUES.PAGE_DESCRIPTION",{projectName:b.scope.project.name,projectDescription:b.scope.project.description});return b.appMetaService.setAll(t,e)})),$.then(null,this.onInitialDataError.bind(this)),this.scope.$on("issueform:new:success",(S=this,function(){return S.analytics.trackEvent("issue","create","create issue on issues list",1),S.loadIssues()})),this.scope.$on("assigned-to:changed",(j=this,function(){if(j.generateFilters(),j.isFilterDataTypeSelected("assigned_to")||j.isFilterDataTypeSelected("role")||j.isOrderedBy("assigned_to")||j.isOrderedBy("modified"))return j.loadIssues()})),this.scope.$on("status:changed",(k=this,function(){if(k.generateFilters(),k.isFilterDataTypeSelected("status")||k.isOrderedBy("status")||k.isOrderedBy("modified"))return k.loadIssues()})))}d=this.taiga,o=this.taiga.mixOf,f=this.taiga.trim,this.taiga.toString,this.taiga.joinStr,i=this.taiga.groupBy,this.taiga.bindOnce,n=this.taiga.debounceLeading,h=this.taiga.startswith,I=this.taiga.bindMethods,n=this.taiga.debounceLeading,s=angular.module("taigaIssues"),function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(c,o(d.Controller,d.PageMixin,d.FiltersMixin)),c.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgUrls","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgUserActivityService"],c.prototype.filtersHashSuffix="issues-filters",c.prototype.myFiltersHashSuffix="issues-my-filters",c.prototype.excludePrefix="exclude_",c.prototype.filterCategories=["tags","status","type","severity","priority","assigned_to","owner","role"],c.prototype.isOrderedBy=function(t){return new RegExp("-*"+t).test(this.location.search().order_by)},c.prototype.changeQ=function(t){return this.unselectFilter("page"),this.replaceFilter("q",t),this.loadIssues(),this.generateFilters()},c.prototype.removeFilter=function(t){return this.unselectFilter("page"),this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadIssues(),this.generateFilters()},c.prototype.addFilter=function(t){return this.unselectFilter("page"),this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadIssues(),this.generateFilters()},c.prototype.selectCustomFilter=function(t){var e=this.location.search().order_by;return e&&(t.filter.order_by=e),this.unselectFilter("page"),this.replaceAllFilters(t.filter),this.loadIssues(),this.generateFilters()},c.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,r.myFiltersHashSuffix).then(r.generateFilters)}));var r},c.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},c.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.location.search(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,n.myFiltersHashSuffix).then(n.generateFilters)}))},c.prototype.generateFilters=function(){var u,t,l,e,p,r,n,d;for(this.storeFilters(this.params.pslug,this.location.search(),this.filtersHashSuffix),n=this.location.search(),(p={}).project=this.scope.projectId,p.q=n.q,t=0,e=(r=this.filterCategories).length;t<e;t++)l=r[t],u=this.excludePrefix.concat(l),p[l]=n[l],p[u]=n[u];return this.q.all([this.rs.issues.filtersData(p),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix)]).then((d=this,function(t){var e,r,n,i,o,s=t[0],a=t[1],c={};for(c.status=_.map(s.statuses,function(t){return t.id=t.id.toString(),t}),c.type=_.map(s.types,function(t){return t.id=t.id.toString(),t}),c.severity=_.map(s.severities,function(t){return t.id=t.id.toString(),t}),c.priority=_.map(s.priorities,function(t){return t.id=t.id.toString(),t}),c.tags=_.map(s.tags,function(t){return t.id=t.name,t}),o=_.filter(c.tags,function(t){return 0<t.count}),c.assigned_to=_.map(s.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),c.owner=_.map(s.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),c.role=_.map(s.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),d.selectedFilters=[],e=0,r=(n=d.filterCategories).length;e<r;e++)l=n[e],u=d.excludePrefix.concat(l),p[l]&&(i=d.formatSelectedFilters(l,c[l],p[l]),d.selectedFilters=d.selectedFilters.concat(i)),p[u]&&(i=d.formatSelectedFilters(l,c[l],p[u],"exclude"),d.selectedFilters=d.selectedFilters.concat(i));return d.filterQ=p.q,d.filters=[{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.TYPE"),dataType:"type",content:c.type},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.SEVERITY"),dataType:"severity",content:c.severity},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.PRIORITIES"),dataType:"priority",content:c.priority},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:c.status},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:c.tags,hideEmpty:!0,totalTaggedElements:o.length},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:c.assigned_to},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:c.role},{title:d.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:c.owner}],d.customFilters=[],_.forOwn(a,function(t,e){return d.customFilters.push({id:e,name:e,filter:t})})}))},c.prototype.initializeSubscription=function(){var e,t="changes.project."+this.scope.projectId+".issues";return this.events.subscribe(this.scope,t,n(500,(e=this,function(t){return e.loadIssues()})))},c.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_issues_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issueStatusById=i(t.issue_statuses,function(t){return t.id}),this.scope.issueStatusList=_.sortBy(t.issue_statuses,"order"),this.scope.severityById=i(t.severities,function(t){return t.id}),this.scope.severityList=_.sortBy(t.severities,"order"),this.scope.priorityById=i(t.priorities,function(t){return t.id}),this.scope.priorityList=_.sortBy(t.priorities,"order"),this.scope.issueTypes=_.sortBy(t.issue_types,"order"),this.scope.issueTypeById=i(t.issue_types,function(t){return t.id}),t},c.prototype.loadIssuesRequests=0,c.prototype.loadIssues=function(){var e,t=this.location.search(),r=this.rs.issues.list(this.scope.projectId,t);return this.loadIssuesRequests+=1,r.index=this.loadIssuesRequests,r.then((e=this,function(t){return r.index===e.loadIssuesRequests&&(e.scope.issues=t.models,e.scope.page=t.current,e.scope.count=t.count,e.scope.paginatedBy=t.paginatedBy),t})),r},c.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.generateFilters(),this.loadIssues()},c.prototype.addNewIssue=function(){var t=this.projectService.project.toJS();return this.rootscope.$broadcast("genericform:new",{objType:"issue",project:t})},c.prototype.addIssuesInBulk=function(){return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId)},c.prototype.upVoteIssue=function(t){var e,r,n,i;return this.voting=t,r=function(){return n.loadIssues(),n.voting=null},e=function(){return i.confirm.notify("error"),i.voting=null},(i=n=this).rs.issues.upvote(t).then(r,e)},c.prototype.downVoteIssue=function(t){var e,r,n,i;return this.voting=t,r=function(){return n.loadIssues(),n.voting=null},e=function(){return i.confirm.notify("error"),i.voting=null},(i=n=this).rs.issues.downvote(t).then(r,e)},c.prototype.getOrderBy=function(){return _.isString(this.location.search().order_by)?this.location.search().order_by:"created_date"},s.controller("IssuesController",c),r=function(t,l,e,p){var d=e.get("issue/issue-paginator.html",!0),i=function(c,t,e,n){var u=t.find(".issues-paginator"),l=function(){var t=c.count/c.paginatedBy;return t=parseInt(t,10)<t?parseInt(t,10)+1:parseInt(t,10)},r=function(){var t,e,r,n,i,o,s,a=l();if(!(a<=1)){for(u.show(),(i={}).pages=o=[],i.showPrevious=1<c.page,i.showNext=!(c.page===a),t=c.page,r=n=1,s=a;1<=s?n<=s:s<=n;r=1<=s?++n:--n)r===t+2&&t+2+2<a||r===t-4&&6<t?o.push({classes:"dots",type:"dots"}):t+2<r&&r<=a-2||r<t-4&&2<r||(r===t?o.push({classes:"active",num:r,type:"page-active"}):o.push({classes:"page",num:r,type:"page"}));return e=d(i),e=p(e)(c),u.html(e)}u.hide()};return c.$watch("issues",function(t){if(t)return r()}),t.on("click",".issues-paginator a.next",function(t){return t.preventDefault(),c.$apply(function(){return n.selectFilter("page",c.page+1),n.loadIssues()})}),t.on("click",".issues-paginator a.previous",function(t){return t.preventDefault(),c.$apply(function(){return n.selectFilter("page",c.page-1),n.loadIssues()})}),t.on("click",".issues-paginator li.page > a",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.data("pagenum"),c.$apply(function(){return n.selectFilter("page",e),n.loadIssues()})})},o=function(i,o,t,s){var e,a,c,u=s.getOrderBy();return u&&(a=h(u,"-")?"icon-arrow-up":"icon-arrow-down",e=o.find(".row.title > div[data-fieldname='"+f(u,"-")+"']"),c=$("<tg-svg>").attr("svg-icon",a),e.append(c),p(e.contents())(i)),o.on("click",".row.title > div",function(t){var e,r,n=angular.element(t.currentTarget);return u=s.getOrderBy(),"total_voters"===(r=n.data("fieldname"))&&"-total_voters"!==u&&(u="total_voters"),e=u===r?"-"+r:r,i.$apply(function(){return s.replaceFilter("order_by",e),s.storeFilters(s.params.pslug,l.search(),s.filtersHashSuffix),s.loadIssues().then(function(){return o.find(".row.title > div > tg-svg").remove(),a=h(e,"-")?"icon-arrow-up":"icon-arrow-down",c=$("<tg-svg>").attr("svg-icon",a),n.append(c),p(n.contents())(i)})})})};return{link:function(t,e,r){var n=e.controller();return o(t,e,0,n),i(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},s.directive("tgIssues",["$log","$tgLocation","$tgTemplate","$compile",r]),e=function(o,t,s){var e=t.get("issue/issue-status-inline-edition-selection.html",!0),a=function(t,e,r){var n=t.find(".issue-status"),i=t.find(".issue-status .issue-status-bind"),o=r[e.status];if(o)return i.text(o.name),i.prop("title",o.name),n.css("color",o.color)};return{link:function(r,n,t){n.controller();var i=r.$eval(t.tgIssueStatusInlineEdition);return n.on("click",".issue-status",function(t){return t.preventDefault(),t.stopPropagation(),n.find(".pop-status").popover().open()}),n.on("click",".status",function(t){var e;return t.preventDefault(),t.stopPropagation(),e=angular.element(t.currentTarget),i.status=e.data("status-id"),n.find(".pop-status").popover().close(),a(n,i,r.issueStatusById),r.$apply(function(){return o.save(i).then(function(t){return s.$broadcast("status:changed",t)})})}),d.bindOnce(r,"project",function(t){if(n.append(e({statuses:t.issue_statuses})),a(n,i,r.issueStatusById),-1===t.my_permissions.indexOf("modify_issue"))return n.unbind("click"),n.find("a").addClass("not-clickable")}),r.$watch(t.tgIssueStatusInlineEdition,function(t){return a(n,t,r.issueStatusById)}),r.$on("$destroy",function(){return n.off()})}}},s.directive("tgIssueStatusInlineEdition",["$tgRepo","$tgTemplate","$rootScope",e]),t=function(s,a,c,u,l){var p=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>');return{link:function(i,o,t){var r=function(t){var e={name:c.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},r=i.usersById[t.assigned_to],n=u.getAvatar(r);return e.imgurl=n.url,e.bg=null,r&&(e.name=r.full_name_display,e.bg=n.bg),o.find(".avatar").html(p(e)),o.find(".issue-assignedto").attr("title",e.name)},n=(o.controller(),i.$eval(t.tgIssueAssignedToInlineEdition));return r(n),o.on("click",".issue-assignedto",function(t){var e=function(t){return n.assigned_to=t.pop()||null,s.save(n).then(function(){return r(n),a.$broadcast("assigned-to:changed",n)})};return l.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[n.assigned_to],activeUsers:i.activeUsers,onClose:e,single:!0,lbTitle:c.instant("COMMON.ASSIGNED_USERS.ADD")})}),d.bindOnce(i,"project",function(t){if(-1===t.my_permissions.indexOf("modify_issue"))return o.unbind("click"),o.find("a").addClass("not-clickable")}),i.$watch(t.tgIssueAssignedToInlineEdition,r),i.$on("$destroy",function(){return o.off()})}}},s.directive("tgIssueAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService","tgLightboxFactory",t])}.call(this),function(){var t,e,r,n,b,i,o,s,a,c={}.hasOwnProperty;function u(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v){var y,_;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.navUrls=l,this.analytics=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.configService=g,this.projectService=m,this.wysiwigService=v,b(this),this.scope.usRef=this.params.usref,this.scope.sectionName=this.translate.instant("US.SECTION_NAME"),this.scope.tribeEnabled=this.configService.config.tribeHost,this.initializeEventHandlers(),(y=this.loadInitialData()).then((_=this,function(){return _._setMeta(),_.initializeOnDeleteGoToUrl()})),y.then(null,this.onInitialDataError.bind(this))}a=this.taiga,o=this.taiga.mixOf,i=this.taiga.groupBy,this.taiga.bindOnce,b=this.taiga.bindMethods,s=angular.module("taigaUserStories"),function(t,e){for(var r in e)c.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(u,o(a.Controller,a.PageMixin)),u.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","$tgConfig","tgProjectService","tgWysiwygService"],u.prototype._setMeta=function(){var t,e,r=this.scope.tasks.length,n=_.filter(this.scope.tasks,(e=this,function(t){return e.scope.taskStatusById[t.status].is_closed})).length,i=0<r?Math.round(100*n/r):0,o=this.translate.instant("US.PAGE_TITLE",{userStoryRef:"#"+this.scope.us.ref,userStorySubject:this.scope.us.subject,projectName:this.scope.project.name}),s=this.translate.instant("US.PAGE_DESCRIPTION",{userStoryStatus:(null!=(t=this.scope.statusById[this.scope.us.status])?t.name:void 0)||"--",userStoryPoints:this.scope.us.total_points,userStoryDescription:angular.element(this.wysiwigService.getHTML(this.scope.us.description)||"").text(),userStoryClosedTasks:n,userStoryTotalTasks:r,userStoryProgressPercentage:i});return this.appMetaService.setAll(o,s)},u.prototype.initializeEventHandlers=function(){var e,r,t,n,i;return this.scope.relateToEpic=(e=this,function(t){return e.scope.$broadcast("relate-to-epic:add",t)}),this.scope.$on("related-tasks:update",(r=this,function(){var t;if(r.loadTasks(),r.scope.tasks=_.clone(r.scope.tasks,!1),t=_.every(r.scope.tasks,function(t){return t.is_closed}),r.scope.us.is_closed!==t)return r.loadUs()})),this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on userstory",1)})),this.scope.$on("task:reorder",(n=this,function(t,e,r){return n.reorderTask(e,r)})),this.scope.$on("comment:new",(i=this,function(){return i.loadUs()}))},u.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated?this.scope.us.milestone?(t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t)):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-backlog",t):this.scope.project.is_kanban_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-kanban",t):void 0},u.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.us_statuses,this.scope.statusById=i(t.us_statuses,function(t){return t.id}),this.scope.taskStatusById=i(t.task_statuses,function(t){return t.id}),this.scope.pointsList=_.sortBy(t.points,"order"),this.scope.pointsById=i(this.scope.pointsList,function(t){return t.id}),t},u.prototype.loadUs=function(){var t,e,r=_.pick(this.location.search(),"milestone","no-milestone","kanban-status"),n=r.milestone;return n&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:n,order_by:"sprint_order"}),r["no-milestone"]&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:"null",order_by:"backlog_order"}),(t=r["kanban-status"])&&this.rs.userstories.storeQueryParams(this.scope.projectId,{status:t,order_by:"kanban_order"}),this.rs.userstories.getByRef(this.scope.projectId,this.params.usref).then((e=this,function(t){return e.rootscope.$broadcast("userstory:loaded",t),e.scope.us=t,e.scope.usId=t.id,e.scope.commentModel=t,e.modelTransform.setObject(e.scope,"us"),t}))},u.prototype.loadSprint=function(){if(this.scope.us.milestone)return this.rs.sprints.get(this.scope.us.project,this.scope.us.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},u.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,null,this.scope.usId).then((e=this,function(t){return e.scope.tasks=t}));var e},u.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadUs().then((t=this,function(){return t.q.all([t.loadSprint(),t.loadTasks()])}))},u.prototype.onUpvote=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.upvote(this.scope.usId).then(r,n)},u.prototype.onDownvote=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.downvote(this.scope.usId).then(r,n)},u.prototype.onWatch=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.watch(this.scope.usId).then(r,n)},u.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.unwatch(this.scope.usId).then(r,n)},u.prototype.onTribeInfo=function(){var t=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE"),e=$("<img />").attr({src:"/"+window._version+"/images/monster-fight.png",alt:this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE")}),r=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TEXT"),n=$("<div></div>").append(e).append(r);return this.confirm.success(t,n)},u.prototype.reorderTask=function(e,t){var r,n,i,o,s,a,c,u,l,p={};return this.scope.tasks.forEach(function(t){return p[t.id]=t.us_order}),n=(u=this.scope.tasks.filter(function(t){return t.id!==e.id})).slice(0,t),r=u.slice(t),o=(s=n[n.length-1])?s.us_order+1:0,p[e.id]=o,a=n.filter(function(t){return t.us_order===s.us_order}),c=_.fromPairs(a.map(function(t){return[t.id,t.us_order]})),r.forEach(function(t){return p[t.id]=t.us_order+1}),this.scope.tasks=_.map(this.scope.tasks,function(t){return t.us_order=p[t.id],t}),this.scope.tasks=_.sortBy(this.scope.tasks,"us_order"),i={us_order:o,version:e.version},this.rs.tasks.reorder(e.id,i,c).then((l=this,function(e){return l.scope.tasks=_.map(l.scope.tasks,function(t){return t.id===e.id?e:t}),l.rootscope.$broadcast("related-tasks:reordered")}))},s.controller("UserStoryDetailController",u),r=function(t,o){var s=t.get("common/components/status-display.html",!0);return{link:function(n,i,t){var e=function(t){var e=n.statusById[t.status],r=s({is_closed:t.is_closed,status:e});return r=o(r)(n),i.html(r)};return n.$watch(t.ngModel,function(t){if(null!=t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgUsStatusDisplay",["$tgTemplate","$compile",r]),e=function(a,t,c,u,l,e,p){var d=e.get("common/components/status-button.html",!0);return{link:function(n,i,t,e){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_us")},r=function(t){var e=n.statusById[t.status],r=d({status:e,statuses:n.statusList,editable:o()});return i.html(r),p(i.contents())(n)},s=function(e){var t,r,n;return i.find(".pop-status").popover().close(),t=u().target(i.find(".js-edit-status")).start(),n=function(){return a.$broadcast("object:updated"),t.finish()},r=function(){return c.notify("error"),t.finish()},l.save(function(t){return t.status=e,t}).then(n,r)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),o())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),o())return e=angular.element(t.currentTarget).data("status-id"),s(e)}),n.$watch(function(){var t;return null!=(t=e.$modelValue)?t.status:void 0},function(){var t=e.$modelValue;if(t)return r(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgUsStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",e]),n=function(a,t,c,u,l,e,p){var d=e.get("us/us-team-requirement-button.html",!0);return{link:function(n,i,t,r){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_us")},e=function(t){var e={canEdit:o(),isRequired:t.team_requirement},r=d(e);return r=p(r)(n),i.html(r)},s=function(e){var t=u().target(i.find("label")).start(),r=l.save(function(t){return t.team_requirement=e,t});return r.then(function(){return t.finish(),a.$broadcast("object:updated")}),r.then(null,function(){return t.finish(),c.notify("error")})};return i.on("click",".team-requirement",function(t){var e;if(o())return e=!r.$modelValue.team_requirement,s(e)}),n.$watch(function(){var t;return null!=(t=r.$modelValue)?t.team_requirement:void 0},function(){var t=r.$modelValue;if(t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgUsTeamRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),t=function(a,t,c,u,l,e,p){var d=e.get("us/us-client-requirement-button.html",!0);return{link:function(n,i,t,r){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_us")},e=function(t){var e={canEdit:o(),isRequired:t.client_requirement},r=p(d(e))(n);return i.html(r)},s=function(e){var t=u().target(i.find("label")).start(),r=l.save(function(t){return t.client_requirement=e,t});return r.then(function(){return t.finish(),a.$broadcast("object:updated")}),r.then(null,function(){return c.notify("error")})};return i.on("click",".client-requirement",function(t){var e;if(o())return e=!r.$modelValue.client_requirement,s(e)}),n.$watch(function(){var t;return null!=(t=r.$modelValue)?t.client_requirement:void 0},function(){var t=r.$modelValue;if(t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgUsClientRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",t])}.call(this),function(){var t,e,r,y,n,i,o,s,a={}.hasOwnProperty;function c(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g){var m,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.navUrls=l,this.analytics=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.projectService=g,y(this),this.scope.taskRef=this.params.taskref,this.scope.sectionName=this.translate.instant("TASK.SECTION_NAME"),this.initializeEventHandlers(),(m=this.loadInitialData()).then((v=this,function(){return v._setMeta(),v.initializeOnDeleteGoToUrl()})),m.then(null,this.onInitialDataError.bind(this))}s=this.taiga,i=this.taiga.mixOf,n=this.taiga.groupBy,y=this.taiga.bindMethods,o=angular.module("taigaTasks"),function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(c,i(s.Controller,s.PageMixin)),c.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],c.prototype._setMeta=function(){var t,e=this.translate.instant("TASK.PAGE_TITLE",{taskRef:"#"+this.scope.task.ref,taskSubject:this.scope.task.subject,projectName:this.scope.project.name}),r=this.translate.instant("TASK.PAGE_DESCRIPTION",{taskStatus:(null!=(t=this.scope.statusById[this.scope.task.status])?t.name:void 0)||"--",taskDescription:angular.element(this.scope.task.description_html||"").text()});return this.appMetaService.setAll(e,r)},c.prototype.initializeEventHandlers=function(){var n,t,e,r;return this.scope.$on("promote-task-to-us:success",(n=this,function(t,e){var r;return n.analytics.trackEvent("task","promoteToUserstory","promote task to userstory",1),r={project:n.scope.project.slug,ref:e},n.location.path(n.navUrls.resolve("project-userstories-detail",r))})),this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on task",1)})),this.scope.$on("custom-attributes-values:edit",(e=this,function(){return e.rootscope.$broadcast("object:updated")})),this.scope.$on("comment:new",(r=this,function(){return r.loadTask()}))},c.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};if(this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated){if(this.scope.task.milestone)return t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t);if(this.scope.task.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)}else if(this.scope.project.is_kanban_activated&&this.scope.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)},c.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.task_statuses,this.scope.statusById=n(t.task_statuses,function(t){return t.id}),t},c.prototype.loadTask=function(){return this.rs.tasks.getByRef(this.scope.projectId,this.params.taskref).then((i=this,function(t){var e,r,n;return i.scope.task=t,i.scope.taskId=t.id,i.scope.commentModel=t,i.modelTransform.setObject(i.scope,"task"),null!=(null!=(r=i.scope.task.neighbors.previous)?r.ref:void 0)&&(e={project:i.scope.project.slug,ref:i.scope.task.neighbors.previous.ref},i.scope.previousUrl=i.navUrls.resolve("project-tasks-detail",e)),null!=(null!=(n=i.scope.task.neighbors.next)?n.ref:void 0)&&(e={project:i.scope.project.slug,ref:i.scope.task.neighbors.next.ref},i.scope.nextUrl=i.navUrls.resolve("project-tasks-detail",e)),t}));var i},c.prototype.loadSprint=function(){if(this.scope.task.milestone)return this.rs.sprints.get(this.scope.task.project,this.scope.task.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},c.prototype.loadUserStory=function(){if(this.scope.task.user_story)return this.rs.userstories.get(this.scope.task.project,this.scope.task.user_story).then((e=this,function(t){return e.scope.us=t}));var e},c.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadTask().then((t=this,function(){return t.q.all([t.loadSprint(),t.loadUserStory()])}))},c.prototype.onUpvote=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.upvote(this.scope.taskId).then(r,n)},c.prototype.onDownvote=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.downvote(this.scope.taskId).then(r,n)},c.prototype.onWatch=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.watch(this.scope.taskId).then(r,n)},c.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.unwatch(this.scope.taskId).then(r,n)},o.controller("TaskDetailController",c),r=function(t,o){var s=t.get("common/components/status-display.html",!0);return{link:function(n,i,t){var e=function(t){var e=n.statusById[t.status],r=s({is_closed:e.is_closed,status:e});return r=o(r)(n),i.html(r)};return n.$watch(t.ngModel,function(t){if(null!=t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},o.directive("tgTaskStatusDisplay",["$tgTemplate","$compile",r]),e=function(a,t,c,u,l,p,e,r){var d=r.get("common/components/status-button.html",!0);return{link:function(n,i,t,e){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_task")},r=function(t){var e=n.statusById[t.status],r=p(d({status:e,statuses:n.statusList,editable:o()}))(n);return i.html(r)},s=function(e){var t=u().target(i).start(),r=function(){return a.$broadcast("object:updated"),t.finish()},n=function(){return c.notify("error"),t.finish()};return l.save(function(t){return t.status=e,t}).then(r,n)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),o())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),o())return e=angular.element(t.currentTarget),$.fn.popover().closeAll(),s(e.data("status-id"))}),n.$watch(function(){var t;return null!=(t=e.$modelValue)?t.status:void 0},function(){var t=e.$modelValue;if(t)return r(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},o.directive("tgTaskStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",e]),t=function(a,t,c,u,l,p,e){var d=e.get("issue/iocaine-button.html",!0);return{link:function(n,i,t,r){var o=function(){return-1!==n.project.my_permissions.indexOf("modify_task")},e=function(t){var e,r;if(o()||t.is_iocaine)return e={isIocaine:t.is_iocaine,isEditable:o()},r=p(d(e))(n),i.html(r);i.html("")},s=function(e){var t=u().target(i.find("label")).start(),r=l.save(function(t){return t.is_iocaine=e,t});return r.then(function(){return a.$broadcast("object:updated")}),r.then(null,function(){return c.notify("error")}),r.finally(function(){return t.finish()})};return i.on("click",".is-iocaine",function(t){var e;if(o())return e=!r.$modelValue.is_iocaine,s(e)}),n.$watch(function(){var t;return null!=(t=r.$modelValue)?t.is_iocaine:void 0},function(){var t=r.$modelValue;if(t)return e(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},o.directive("tgTaskIsIocaineButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$tgTemplate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u={}.hasOwnProperty;function l(t,e,r,n,i,o,s,a,c,u,l,p,d){var h,f;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.auth=u,this.translate=l,this.projectService=p,this.errorHandlingService=d,this.scope.sectionName="TEAM.SECTION_NAME",(h=this.loadInitialData()).then((f=this,function(){var t=f.translate.instant("TEAM.PAGE_TITLE",{projectName:f.scope.project.name}),e=f.translate.instant("TEAM.PAGE_DESCRIPTION",{projectName:f.scope.project.name,projectDescription:f.scope.project.description});return f.appMetaService.setAll(t,e)})),h.then(null,this.onInitialDataError.bind(this))}c=this.taiga,s=this.taiga.mixOf,a=angular.module("taigaTeam"),function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(l,s(c.Controller,c.PageMixin)),l.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$location","$tgNavUrls","tgAppMetaService","$tgAuth","$translate","tgProjectService","tgErrorHandlingService"],l.prototype.setRole=function(t){return this.scope.filtersRole=t||null},l.prototype.loadMembers=function(){var t,e,r,n,i=this.auth.getUser();for(this.scope.totals={},t=0,e=(n=this.scope.activeUsers).length;t<e;t++)r=n[t],this.scope.totals[r.id]=0;return this.scope.currentUser=_.find(this.scope.activeUsers,{id:null!=i?i.id:void 0}),this.scope.memberships=_.reject(this.scope.activeUsers,{id:null!=i?i.id:void 0})},l.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issuesEnabled=t.is_issues_activated,this.scope.tasksEnabled=t.is_kanban_activated||t.is_backlog_activated,this.scope.wikiEnabled=t.is_wiki_activated,this.scope.owner=t.owner.id,t},l.prototype.loadMemberStats=function(){return this.rs.projects.memberStats(this.scope.projectId).then((i=this,function(n){return _.forEach(i.scope.totals,function(t,r){var e=_.map(n,function(t,e){return t[r]});return t=_.reduce(e,function(t,e){return t+e}),i.scope.totals[r]=t}),i.scope.stats=i._processStats(n),i.scope.stats.totals=i.scope.totals}));var i},l.prototype._processStat=function(t){var e,r,n=_.max(_.toArray(t)),i=_.min(_.toArray(t)),o=Object();for(e in t)u.call(t,e)&&(r=t[e],o[e]=r===i?.1:r===n?1:.5*r/n);return o},l.prototype._processStats=function(t){var e,r;for(e in t)r=t[e],t[e]=this._processStat(r);return t},l.prototype.loadInitialData=function(){var e,t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.loadMembers(),e=_.map(this.scope.users,function(t){return t.role}),this.scope.roles=_.filter(this.scope.roles,function(t){return-1!==e.indexOf(t.id)}),this.loadMemberStats()},a.controller("TeamController",l),e=function(){return{templateUrl:"team/team-filter.html"}},a.directive("tgTeamFilters",[e]),n=function(){return{templateUrl:"team/team-member-stats.html",scope:{stats:"=",userId:"=user",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},a.directive("tgTeamMemberStats",n),r=function(){return{templateUrl:"team/team-member-current-user.html",scope:{project:"=project",currentUser:"=currentuser",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},a.directive("tgTeamCurrentUser",r),i=function(){return{templateUrl:"team/team-members.html",scope:{memberships:"=",filtersQ:"=filtersq",filtersRole:"=filtersrole",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},a.directive("tgTeamMembers",i),t=function(t,i,o,s,a,c,u,l){return{scope:{user:"=",project:"="},templateUrl:"team/leave-project.html",link:function(r,t,e){var n=function(){var t=c.instant("TEAM.ACTION_LEAVE_PROJECT"),e=c.instant("TEAM.CONFIRM_LEAVE_PROJECT");return i.ask(t,e).then(function(t){var e=s.projects.leave(r.project.id);return e.then(function(){return l.loadProjects().then(function(){return t.finish(),i.notify("success"),o.path(a.resolve("home"))})}),e.then(null,function(t){return t.finish(),i.notify("error",t.data._error_message)})})};return r.leave=function(){return r.project.owner.id===r.user.id?u.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:!0,project:r.project}):n()}}}},a.directive("tgLeaveProject",["$tgRepo","$tgConfirm","$tgLocation","$tgResources","$tgNavUrls","$translate","tgLightboxFactory","tgCurrentUserService",t]),o=function(){return function(t,e,r){return _.filter(t,function(t){return(!r||t.role===r.id)&&(!e||0<=t.full_name.search(new RegExp(e,"i")))})}},a.filter("membersFilter",o)}.call(this),function(){function b(t,e){return function(){return t.apply(e,arguments)}}var t,e,r,n,i,o={}.hasOwnProperty;function s(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.location=c,this.filter=u,this.log=l,this.appMetaService=p,this.navUrls=d,this.analytics=h,this.translate=f,this.errorHandlingService=g,this.projectService=m,this.moveLink=b(this.moveLink,this),this.loadWiki=b(this.loadWiki,this),this.scope.$on("wiki:links:move",this.moveLink),this.scope.$on("wikipage:add",this.loadWiki),this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,(v=this.loadInitialData()).then((y=this,function(){return y._setMeta()})),v.then(null,this.onInitialDataError.bind(this))}i=this.taiga,r=this.taiga.mixOf,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.debounce,n=angular.module("taigaWiki"),function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(s,r(i.Controller,i.PageMixin)),s.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$filter","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","tgErrorHandlingService","tgProjectService"],s.prototype._setMeta=function(){var t,e,r,n=this.translate.instant("WIKI.PAGE_TITLE",{wikiPageName:this.scope.wikiSlug,projectName:this.scope.project.name}),i=this.translate.instant("WIKI.PAGE_DESCRIPTION",{wikiPageContent:angular.element((null!=(t=this.scope.wiki)?t.html:void 0)||"").text(),totalEditions:(null!=(e=this.scope.wiki)?e.editions:void 0)||0,lastModifiedDate:moment(null!=(r=this.scope.wiki)?r.modified_date:void 0).format(this.translate.instant("WIKI.DATETIME"))});return this.appMetaService.setAll(n,i)},s.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},s.prototype.loadWiki=function(){var e,r,t=this.rs.wiki.getBySlug(this.scope.projectId,this.params.slug);return t.then((e=this,function(t){return e.scope.wiki=t,e.scope.wikiId=t.id,e.scope.wiki})),t.then(null,(r=this,function(t){var e;return r.scope.wikiId=null,-1===r.scope.project.my_permissions.indexOf("add_wiki_page")?null:(e={project:r.scope.projectId,slug:r.scope.wikiSlug,content:""},r.scope.wiki=r.model.make_model("wiki",e),r.scope.wiki)}))},s.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((o=this,function(t){var e,r,n,i;for(o.scope.wikiLinks=t,e=0,r=(i=o.scope.wikiLinks).length;e<r;e++)(n=i[e]).url=o.navUrls.resolve("project-wiki-page",{project:o.scope.projectSlug,slug:n.href});return _.find(t,{href:o.scope.wikiSlug})}));var o},s.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWiki()]).then(this.checkLinksPerms.bind(this))},s.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},s.prototype.delete=function(){var n,t=this.translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),e=this.scope.wikiSlug;return this.confirm.askOnDelete(t,e).then((n=this,function(e){var t=function(){var t;return e.finish(),t={project:n.scope.projectSlug},n.location.path(n.navUrls.resolve("project-wiki",t)),n.confirm.notify("success"),n.loadWiki()},r=function(){return e.finish(!1),n.confirm.notify("error")};return n.repo.remove(n.scope.wiki).then(t,r)}))},s.prototype.moveLink=function(t,e,r){var n=this.scope.wikiLinks,i=n.indexOf(e);return n.splice(i,1),n.splice(r,0,e),_.each(n,function(t,e){return t.order=e}),this.repo.saveAll(n)},n.controller("WikiDetailController",s),t=function(a,t,c,u,l){var p=t.get("wiki/wiki-summary.html",!0);return{link:function(o,s,t,e){var r=function(t){var e,r,n,i;return null==o.usersById?a.error("WikiSummaryDirective requires userById set in scope."):i=o.usersById[t.last_modifier],e=l.getAvatar(i),i=void 0===i?{name:"unknown",avatar:e}:{name:i.full_name_display,avatar:e},r={totalEditions:t.editions,lastModifiedDate:moment(t.modified_date).format(u.instant("WIKI.DATETIME")),user:i},n=p(r),n=c(n)(o),s.html(n)};return o.$watch(t.ngModel,function(t){if(t)return r(t)}),o.$on("$destroy",function(){return s.off()})},restrict:"EA",require:"ngModel"}},n.directive("tgWikiSummary",["$log","$tgTemplate","$compile","$translate","tgAvatarService",t]),e=function(t,e,o,r,n,a,c,u){return{scope:!0,link:function(i,t,e){var s;return i.editableDescription=!1,i.saveDescription=n.bindAdd(function(t,e){var r=function(t){return null==i.item.id&&(c.trackEvent("wikipage","create","create wiki page",1),i.$emit("wikipage:add")),u.fetchEntries(!0),o.notify("success")},n=function(){return o.notify("error")};return i.item.content=t,(null!=i.item.id?a.save(i.item).then(r,n):a.create("wiki",i.item).then(r,n)).finally(e)}),s=function(t,e){return r.addAttachment(i.project.id,i.item.id,"wiki_page",t).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]),"wiki_page",t.getIn(["file","id"]))})},i.uploadFiles=function(t,e){for(var r,n=[],i=0,o=t.length;i<o;i++)r=t[i],n.push(s(r,e));return n},i.$watch(e.model,function(t){if(t)return i.item=t,i.version=t.version,i.storageKey=i.project.id+"-"+t.id+"-wiki"}),i.$watch("project",function(t){if(t)return i.editableDescription=-1!==t.my_permissions.indexOf("modify_wiki_page")})},template:"<div>\n    <tg-wysiwyg\n        ng-if=\"editableDescription\"\n        version='version'\n        storage-key='storageKey'\n        content='item.content'\n        on-save='saveDescription(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && item.content.length\"\n        ng-bind-html=\"item.content | markdownToHTML\"></div>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && !item.content.length\">\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\n    </div>\n</div>"}},n.directive("tgWikiWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$tgQqueue","$tgRepo","$tgAnalytics","tgActivityService",e])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.groupBy;var i=this.taiga.bindOnce,t=function(p,e,t,d,h,f,r,g,m){var v=r.get("wiki/wiki-nav.html",!0),n=function(o,s,t){var a,c,u,l=s.controller();return null==t.ngModel?e.error("WikiNavDirective: no ng-model attr is defined"):(o.project.my_permissions.indexOf("add_wiki_link"),c=null,u=function(t){var e,r,n,i;return a=-1<o.project.my_permissions.indexOf("add_wiki_link"),e=-1<o.project.my_permissions.indexOf("delete_wiki_link"),r=v({wikiLinks:t,projectSlug:o.projectSlug,addWikiLinkPermission:a,deleteWikiLinkPermission:e}),r=g(r)(o),s.off(),a&&c&&c.destroy(),s.html(r),a&&(n=null,i=s.find(".sortable"),(c=dragula([i[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:i[0],moves:function(t){return $(t).is("li")}})).on("dragend",function(t){var e;return t=(n=$(t)).scope().link,e=n.index(),o.$emit("wiki:links:move",t,e)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&c.dragging}})),s.on("click",".add-button",function(t){return t.preventDefault(),s.find(".new").removeClass("hidden"),s.find(".new input").focus(),s.find(".add-button").hide()}),s.on("click",".js-delete-link",function(t){var r,e,n,i;return t.preventDefault(),t.stopPropagation(),n=angular.element(t.currentTarget),r=n.parents(".wiki-link").data("id"),i=m.instant("WIKI.DELETE_LINK_TITLE"),e=o.wikiLinks[r].title,d.askOnDelete(i,e).then(function(t){var e=p.remove(o.wikiLinks[r]);return e.then(function(){return(e=l.loadWikiLinks()).then(function(){return t.finish(),u(o.wikiLinks)}),e.then(null,function(){return t.finish()})}),e.then(null,function(){return t.finish(!1),d.notify("error")})})}),s.on("keyup",".new input",function(t){var r,n,e,i;return t.preventDefault(),13===t.keyCode?(i=angular.element(t.currentTarget),n=i.val(),r=f().target(s.find(".new")).start(),(e=p.create("wiki-links",{project:o.projectId,title:n})).then(function(){var t;return h.trackEvent("wikilink","create","create wiki link",1),(t=l.loadWikiLinks()).then(function(){return r.finish(),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show(),u(o.wikiLinks)}),t.then(null,function(){return r.finish(),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show(),d.notify("error","Error loading wiki links")})}),e.then(null,function(t){var e;return r.finish(),s.find(".new input").val(n),s.find(".new input").focus().select(),null!=(null!=t&&null!=(e=t.__all__)?e[0]:void 0)?d.notify("error","The link already exists"):d.notify("error")})):27===t.keyCode?(i=angular.element(t.currentTarget),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show()):void 0})},i(o,t.ngModel,u))};return{link:function(t,e,r){return n(t,e,r),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaWiki").directive("tgWikiNav",["$tgRepo","$log","$tgLocation","$tgConfirm","$tgAnalytics","$tgLoading","$tgTemplate","$compile","$translate",t])}.call(this),function(){var t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.navUrls=c,this.errorHandlingService=u,this.projectService=l,this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,e=angular.module("taigaWiki"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgNavUrls","tgErrorHandlingService","tgProjectService"],n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},n.prototype.loadWikiPages=function(){var e;return this.rs.wiki.list(this.scope.projectId).then((e=this,function(t){return e.scope.wikipages=t}))},n.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((o=this,function(t){var e,r,n,i;for(o.scope.wikiLinks=t,e=0,r=(i=o.scope.wikiLinks).length;e<r;e++)(n=i[e]).url=o.navUrls.resolve("project-wiki-page",{project:o.scope.projectSlug,slug:n.href});return _.find(t,{href:o.scope.wikiSlug})}));var o},n.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWikiPages()]).then(this.checkLinksPerms.bind(this))},n.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},e.controller("WikiPagesListController",n)}.call(this),function(){var t,e,r,n,i,o,s;function a(t,e,r,n){this.rs=t,this.lightboxService=e,this.confirm=r,this.translate=n,this.users=[],this.q="",this.commentOpen=!1}this.taiga,this.taiga.debounce,s=this.taiga.normalizeString,n=function(){return{templateUrl:"admin/memberships-warning-message.html",scope:{project:"="}}},(o=angular.module("taigaKanban")).directive("tgLightboxAddMembersWarningMessage",[n]),r=function(r,n,i,o){return{link:function(t,e){return r.open(e),t.request=function(){return t.loading=!0,n.projects.transferRequest(t.projectId).then(function(){return t.loading=!1,r.close(e),i.notify("success",o.instant("ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS"))})}},templateUrl:"common/lightbox/lightbox-request-ownership.html"}},o.directive("tgLbRequestOwnership",["lightboxService","tgResources","$tgConfirm","$translate",r]),a.prototype.limit=3,a.prototype.filterUsers=function(t){var e,r=t.full_name_display.toUpperCase();return r=s(r),e=this.q.toUpperCase(),e=s(e),_.includes(r,e)},a.prototype.getUsers=function(){var t=this.users.length||this.q.length?this.users:this.activeUsers;return t=_.reject(t,{id:this.currentOwnerId}),t=_.reject(t,{selected:!0}),this.totalUsers=_.size(t),t.slice(0,this.limit)},a.prototype.userSearch=function(){if(this.users=this.activeUsers,this.selected=_.find(this.users,{selected:!0}),this.q)return this.users=_.filter(this.users,this.filterUsers.bind(this))},a.prototype.selectUser=function(t){return this.activeUsers=_.map(this.activeUsers,function(t){return t.selected=!1,t}),t.selected=!0,this.userSearch()},a.prototype.submit=function(){return this.loading=!0,this.rs.projects.transferStart(this.projectId,this.selected.id,this.comment).then((r=this,function(){var t,e;return r.loading=!1,r.lightboxService.closeAll(),e=r.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE"),t=r.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC"),r.confirm.success(e,t,{type:"svg",name:"icon-speak-up"})}));var r},(t=a).$inject=["tgResources","lightboxService","$tgConfirm","$translate"],o.controller("ChangeOwnerLightbox",t),e=function(r,t,e,n){return{scope:!0,controller:"ChangeOwnerLightbox",controllerAs:"vm",bindToController:{currentOwnerId:"=",projectId:"=",activeUsers:"="},templateUrl:"common/lightbox/lightbox-change-owner.html",link:function(t,e){return r.open(e)}}},o.directive("tgLbChangeOwner",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",e]),i=function(r){return{templateUrl:"common/lightbox/lightbox-transfer-project-start-success.html",link:function(t,e){return t.close=function(){return r.close(e)},r.open(e)}}},o.directive("tgLbTransferProjectStartSuccess",["lightboxService",i])}.call(this),function(){var t,e,r,n,i,o,b,s,a,c,u={}.hasOwnProperty;function l(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g){var m,v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.analytics=u,this.appMetaService=l,this.translate=p,this.auth=d,this.lightboxFactory=h,this.errorHandlingService=f,this.projectService=g,b(this),this.scope.project={},this.scope.filters={},(m=this.loadInitialData()).then((v=this,function(){var t=v.translate.instant("ADMIN.MEMBERSHIPS.PAGE_TITLE",{projectName:v.scope.project.name}),e=v.scope.project.description;return v.appMetaService.setAll(t,e)})),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("membersform:new:success",(y=this,function(){return y.loadInitialData(),y.analytics.trackEvent("membership","create","create memberships on admin",1)}))}c=this.taiga,s=this.taiga.mixOf,b=this.taiga.bindMethods,a=angular.module("taigaAdmin"),function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(l,s(c.Controller,c.PageMixin,c.FiltersMixin)),l.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAnalytics","tgAppMetaService","$translate","$tgAuth","tgLightboxFactory","tgErrorHandlingService","tgProjectService"],l.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.canAddUsers=null===t.max_memberships||t.max_memberships>t.total_memberships,this.scope.$emit("project:loaded",t),t},l.prototype.loadMembers=function(){var e,t=this.getUrlFilters();return this.rs.memberships.list(this.scope.projectId,t).then((e=this,function(t){return e.scope.memberships=_.filter(t.models,function(t){return null===t.user||t.is_user_active}),_.map(e.scope.memberships,function(t){if(t.is_owner)return e.scope.projectOwnerEmail=t.user_email}),e.scope.page=t.current,e.scope.count=t.count,e.scope.paginatedBy=t.paginatedBy,t}))},l.prototype.loadInitialData=function(){return this.loadProject(),this.q.all([this.loadMembers(),this.auth.refresh()])},l.prototype.getUrlFilters=function(){var t=_.pick(this.location.search(),"page");return t.page||(t.page=1),t},l.prototype.addNewMembers=function(){return this.lightboxFactory.create("tg-lb-add-members",{class:"lightbox lightbox-add-member",project:"project"},{project:this.scope.project})},l.prototype.showLimitUsersWarningMessage=function(){var t=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING"),e=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE",{members:this.scope.project.max_memberships}),r="/"+window._version+"/svg/icons/team-question.svg";return this.confirm.success(t,e,{name:r,type:"img"})},a.controller("MembershipsController",l),t=function(t,p){var d=t.get("admin/admin-membership-paginator.html",!0),i=function(c,t,e,n){var u=t.find(".memberships-paginator"),l=function(){var t=c.count/c.paginatedBy;return t=parseInt(t,10)<t?parseInt(t,10)+1:parseInt(t,10)},r=function(){var t,e,r,n,i,o,s,a=l();if(!(a<=1)){for((i={}).pages=o=[],i.showPrevious=1<c.page,i.showNext=!(c.page===a),t=c.page,r=n=1,s=a;1<=s?n<=s:s<=n;r=1<=s?++n:--n)r===t+2&&t+2+2<a||r===t-4&&6<t?o.push({classes:"dots",type:"dots"}):t+2<r&&r<=a-2||r<t-4&&2<r||(r===t?o.push({classes:"active",num:r,type:"page-active"}):o.push({classes:"page",num:r,type:"page"}));return e=d(i),e=p(e)(c),u.html(e),u.show()}u.hide()};return c.$watch("memberships",function(t){if(t)return r()}),t.on("click",".memberships-paginator a.next",function(t){return t.preventDefault(),c.$apply(function(){return n.selectFilter("page",c.page+1),n.loadMembers()})}),t.on("click",".memberships-paginator a.previous",function(t){return t.preventDefault(),c.$apply(function(){return n.selectFilter("page",c.page-1),n.loadMembers()})}),t.on("click",".memberships-paginator li.page > a",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.data("pagenum"),c.$apply(function(){return n.selectFilter("page",e),n.loadMembers()})})};return{link:function(t,e,r){var n=e.controller();return i(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},a.directive("tgMemberships",["$tgTemplate","$compile",t]),n=function(r,t,n,a,c){var u=t.get("admin/memberships-row-avatar.html",!0);return{link:function(i,o,t){var s=n.instant("ADMIN.MEMBERSHIP.STATUS_PENDING"),e=function(t){var e=c.getAvatar(t),r={full_name:t.full_name?t.full_name:"",email:t.user_email?t.user_email:t.email,imgurl:e.url,bg:e.bg,pending:t.is_user_active?"":s,isOwner:t.is_owner},n=u(r);return n=a(n)(i),o.html(n)};return null==t.tgMembershipsRowAvatar?r.error("MembershipsRowAvatarDirective: the directive need a member"):(e(i.$eval(t.tgMembershipsRowAvatar)),i.$on("$destroy",function(){return o.off()}))}}},a.directive("tgMembershipsRowAvatar",["$log","$tgTemplate","$translate","$compile","tgAvatarService",n]),r=function(r,s,a,t,c){var u=t.get("admin/admin-memberships-row-checkbox.html",!0);return{link:function(n,i,t){var o,e;return n.$on("$destroy",function(){return i.off()}),null==t.tgMembershipsRowAdminCheckbox?r.error("MembershipsRowAdminCheckboxDirective: the directive need a member"):(o=n.$eval(t.tgMembershipsRowAdminCheckbox)).is_owner?void i.find(".js-check").remove():(e=function(t){var e={inputId:"is-admin-"+t.id},r=u(e);return r=c(r)(n),i.html(r)},i.on("click",":checkbox",function(t){var e=function(){return a.notify("success")},r=function(t){return o.revert(),i.find(":checkbox").prop("checked",o.is_admin),a.notify("error",t.is_admin[0])},n=angular.element(t.currentTarget);return o.is_admin=n.prop("checked"),s.save(o).then(e,r)}),e(o),o.is_admin?i.find(":checkbox").prop("checked",!0):void 0)}}},a.directive("tgMembershipsRowAdminCheckbox",["$log","$tgRepo","$tgConfirm","$tgTemplate","$compile",r]),i=function(r,s,a){var c=_.template('<select>\n    <% _.each(roleList, function(role) { %>\n    <option value="<%- role.id %>" <% if(selectedRole === role.id){ %>selected="selected"<% } %>>\n        <%- role.name %>\n    </option>\n    <% }); %>\n</select>');return{link:function(n,i,t){var o,e=function(t){var e={roleList:n.project.roles,selectedRole:t.role},r=c(e);return i.html(r)};return null==t.tgMembershipsRowRoleSelector?r.error("MembershipsRowRoleSelectorDirective: the directive need a member"):(i.controller(),e(o=n.$eval(t.tgMembershipsRowRoleSelector)),i.on("change","select",function(t){var e=function(){return a.notify("success")},r=function(){return a.notify("error")},n=angular.element(t.currentTarget),i=parseInt(n.val(),10);if(o.role!==i)return o.role=i,s.save(o).then(e,r)}),n.$on("$destroy",function(){return i.off()}))}}},a.directive("tgMembershipsRowRoleSelector",["$log","$tgRepo","$tgConfirm",i]),e=function(a,c,u,l,p,d,h,f,g,m){return{link:function(i,r,t){var o,n,s,e=function(t){var e=(t.user?p('<div class="active"\n     translate="ADMIN.MEMBERSHIP.STATUS_ACTIVE">\n</div>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>'):p('<a class="resend js-resend" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.RESEND\' | translate }}"\n   translate="ADMIN.MEMBERSHIP.RESEND">\n</a>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>'))(i);return r.html(e)};return null==t.tgMembershipsRowActions?a.error("MembershipsRowActionsDirective: the directive need a member"):(o=r.controller(),e(s=i.$eval(t.tgMembershipsRowActions)),r.on("click",".js-resend",function(t){var e,r;return t.preventDefault(),r=function(){var t=d.instant("ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION",{email:i.member.email});return l.notify("success",t)},e=function(){var t=d.instant("ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION");return l.notify("error",t)},u.memberships.resendInvitation(i.member.id).then(r,e)}),n=function(){var t=d.instant("ADMIN.MEMBERSHIP.DELETE_MEMBER"),e=d.instant("ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE",{email:s.email}),n=s.user?s.full_name:e;return l.askOnDelete(t,n).then(function(e){var t=function(){var t;return e.finish(),s.user!==i.user.id?(1<i.page&&i.count-1<=i.paginatedBy&&o.selectFilter("page",i.page-1),m.fetchProject().then(function(){return o.loadInitialData()})):h.path(f.resolve("home")),t=d.instant("ADMIN.MEMBERSHIP.SUCCESS_DELETE",{message:n}),l.notify("success",t,null,5e3)},r=function(){var t;return e.finish(!1),t=d.instant("ADMIN.MEMBERSHIP.ERROR_DELETE",{message:n}),l.notify("error",t)};return c.remove(s).then(t,r)})},r.on("click",".delete",function(t){var e;return t.preventDefault(),i.project.owner.id===s.user?(e=i.user.id===s.user,g.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:e,project:i.project})):n()}),i.$on("$destroy",function(){return r.off()}))}}},a.directive("tgMembershipsRowActions",["$log","$tgRepo","$tgResources","$tgConfirm","$compile","$translate","$tgLocation","$tgNavUrls","tgLightboxFactory","tgProjectService",e]),o=function(){return{templateUrl:"admin/no-more-memberships-explanation.html",scope:{project:"=",ownerEmail:"="}}},a.directive("tgNoMoreMembershipsExplanation",[o])}.call(this),function(){var t=function(){return{link:function(t,e,r){var n=r.tgAdminNavigation;return e.find(".active").removeClass("active"),e.find("#adminmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaAdmin").directive("tgAdminNavigation",t)}.call(this),function(){function t(t,e){for(var r in e)T.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}function a(t,e){return function(){return t.apply(e,arguments)}}var e,r,n,i,o,s,c,u,l,p,d,h,f,g,m,v,y,b,M,S,j,k,$,I,E,T={}.hasOwnProperty;function C(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g){var m,v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.tgAuth=p,this.currentUserService=d,this.errorHandlingService=h,this.projectService=f,this.model=g,this.scope.project={},this.scope.projectTags=[],(m=this.loadInitialData()).then((v=this,function(){var t=v.translate.instant(v.scope.sectionName),e=v.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:t,projectName:v.scope.project.name}),r=v.scope.project.description;return v.appMetaService.setAll(e,r),v.fillUsersAndRoles(v.scope.project.members,v.scope.project.roles)})),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:loaded",(y=this,function(){var t=y.translate.instant(y.scope.sectionName),e=y.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:t,projectName:y.scope.project.name}),r=y.scope.project.description;return y.appMetaService.setAll(e,r)}))}function P(t,e,r,n,i,o){var s;this.scope=t,this.rootscope=e,this.urls=r,this.confirm=n,this.rs=i,this.translate=o,this._deleteUuid=a(this._deleteUuid,this),this._generateUuid=a(this._generateUuid,this),this.setCsvUuid=a(this.setCsvUuid,this),this.rootscope.$on("project:loaded",this.setCsvUuid),this.scope.$watch("csvUuid",(s=this,function(t){return s.scope.csvUrl=t?s.urls.resolveAbsolute(s.type+"-csv",t):""}))}function w(){return w.__super__.constructor.apply(this,arguments)}function A(){return A.__super__.constructor.apply(this,arguments)}function O(){return O.__super__.constructor.apply(this,arguments)}function R(){return R.__super__.constructor.apply(this,arguments)}$=this.taiga,S=this.taiga.mixOf,k=this.taiga.scopeDefer,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,M=this.taiga.debounce,j=angular.module("taigaAdmin"),I=S($.Controller,$.PageMixin),t(C,I),C.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","$tgAuth","tgCurrentUserService","tgErrorHandlingService","tgProjectService","$tgModel"],C.prototype.loadProject=function(){var t,e,r=this.projectService.project.toJS();return(r=this.model.make_model("projects",r)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=r.id,this.scope.project=r,this.scope.epicStatusList=_.sortBy(r.epic_statuses,"order"),this.scope.usStatusList=_.sortBy(r.us_statuses,"order"),this.scope.pointsList=_.sortBy(r.points,"order"),this.scope.taskStatusList=_.sortBy(r.task_statuses,"order"),this.scope.issueTypesList=_.sortBy(r.issue_types,"order"),this.scope.issueStatusList=_.sortBy(r.issue_statuses,"order"),this.scope.prioritiesList=_.sortBy(r.priorities,"order"),this.scope.severitiesList=_.sortBy(r.severities,"order"),k(this.scope,(t=this,function(){return t.scope.$emit("project:loaded",r)})),this.scope.projectTags=_.map(this.scope.project.tags,(e=this,function(t){return[t,e.scope.project.tags_colors[t]]})),r},C.prototype.loadInitialData=function(){return this.loadProject(),this.tgAuth.refresh()},C.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.project)},C.prototype.addTag=function(t,e){var r=_.clone(this.scope.project.tags);return r.push(t),this.scope.projectTags.push([t,null]),this.scope.project.tags=r},C.prototype.deleteTag=function(e){var t=_.clone(this.scope.project.tags);return _.pull(t,e[0]),_.remove(this.scope.projectTags,function(t){return t[0]===e[0]}),this.scope.project.tags=t},j.controller("ProjectProfileController",C),b=function(c,u,l,p,d,h,f,g){return{link:function(i,t,e){var o=t.controller(),s=t.find("form").checksley({onlyOneErrorElement:!0}),r=M(2e3,function(t){var e,r,n;if(t.preventDefault(),s.validate())return e=l().target(a).start(),r=i.project.isAttributeModified("is_private"),(n=c.save(i.project)).then(function(){var t;return e.finish(),r&&i.project.is_private?g.trackEvent("project-privacy-changed","from-public-to-private","Change project privacy from public to private",1):r&&!i.project.is_private&&g.trackEvent("project-privacy-changed","from-private-to-public","Change project privacy from private to public",1),u.notify("success"),t=p.resolve("project-admin-project-profile-details",{project:i.project.slug}),d.path(t),h.fetchProject().then(function(){return o.loadInitialData()}),f.loadProjects()}),n.then(null,function(t){if(e.finish(),s.setErrors(t),t._error_message)return u.notify("error",t._error_message)})}),a=t.find(".submit-button");return t.on("submit","form",r)}}},j.directive("tgProjectProfile",["$tgRepo","$tgConfirm","$tgLoading","$tgNavUrls","$tgLocation","tgProjectService","tgCurrentUserService","$tgAnalytics",b]),f=function(s,a,c,u){return{link:function(n,t,e){var i=t.find("form").checksley({onlyOneErrorElement:!0}),r=M(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return e=u().target(o).start(),(r=a.save(n.project)).then(function(){return e.finish(),c.notify("success"),s.$broadcast("admin:project-default-values:updated")}),r.then(null,function(t){if(e.finish(),i.setErrors(t),t._error_message)return c.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",r),n.$on("$destroy",function(){return t.off()})}}},j.directive("tgProjectDefaultValues",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",f]),y=function(o,s,a,t){return{link:function(r,n,t){var i=function(){var t,e=n.find("form").checksley();if(e.initializeFields(),e.reset(),e.validate())return(t=s.save(r.project)).then(function(){return r.$emit("project:loaded",r.project),o.$broadcast("admin:project-modules:updated"),a.notify("success")}),t.then(null,function(t){if(e.setErrors(t),t._error_message)return a.notify("error",t._error_message)})};return n.on("change",".module-activation.module-direct-active input",function(t){return t.preventDefault(),r.$applyAsync(i)}),n.on("submit","form",function(t){return t.preventDefault(),i()}),n.on("click",".save",function(t){return t.preventDefault(),i()}),n.on("keydown",".videoconference-attributes input",function(t){return 32!==t.which}),r.$watch("project.videoconferences",function(t,e){if(null!=t&&null!=e&&t!==e)return r.project.videoconferences_extra_data=""}),r.$watch("isVideoconferenceActivated",function(t,e){if(!1===t&&(r.project.videoconferences=null,!(r.project.videoconferences_extra_data="")===e))return i()}),r.$watch("project",function(t){return null!=t.videoconferences?r.isVideoconferenceActivated=!0:r.isVideoconferenceActivated=!1})}}},j.directive("tgProjectModules",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",y]),g=function(P,w,A,O,R){return{link:function(n,t,e){var r=t.find(".admin-project-export-buttons"),i=function(){return r.removeClass("hidden")},o=function(){return r.addClass("hidden")},s=t.find(".admin-project-export-result"),a=function(){return s.removeClass("hidden")},c=function(){return s.addClass("hidden")},u=t.find(".spin"),l=function(){return u.removeClass("hidden")},p=function(){return u.addClass("hidden")},d=t.find(".result-title"),h=O.instant("ADMIN.PROJECT_EXPORT.LOADING_TITLE"),f=O.instant("ADMIN.PROJECT_EXPORT.LOADING_MESSAGE"),g=function(){return d.html(O.instant("ADMIN.PROJECT_EXPORT.DUMP_READY"))},m=function(){return d.html(O.instant("ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE"))},v=function(t){return d.html(O.instant("ADMIN.PROJECT_EXPORT.SYNC_MESSAGE",{url:t}))},y=function(){return d.html(h)},_=function(){return d.html(f)},b=function(){return d.html(g)},S=t.find(".result-message "),j=function(){return S.html(f)},k=function(){return S.html(m)},$=function(t){return S.html(v(t))},I=function(){return l(),y(),j(),o(),a()},E=function(){return p(),_(),k()},T=function(t){return p(),b(),$(t)},C=function(){return p(),c(),i()};return t.on("click","a.button-export",M(2e3,function(t){var e,r;return t.preventDefault(),r=function(t){var e;return R.trackEvent("exporter","export-project","Exported project",1),202===t.status?E():(e=t.data.url,T(e),P.open(e,"_blank"))},e=function(t){var e,r;return C(),e=O.instant("ADMIN.PROJECT_EXPORT.ERROR"),429===t.status?e=O.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY"):null!=(r=t.data)&&r._error_message&&(e=O.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY",{message:t.data._error_message})),A.notify("error",e)},I(),w.projects.export(n.projectId).then(r,e)}))}}},j.directive("tgProjectExport",["$window","$tgResources","$tgConfirm","$translate","$tgAnalytics",g]),E=$.Controller,t(P,E),P.$inject=["$scope","$rootScope","$tgUrls","$tgConfirm","$tgResources","$translate"],P.prototype.setCsvUuid=function(){return this.scope.csvUuid=this.scope.project[this.type+"_csv_uuid"]},P.prototype._generateUuid=function(t){var e,r,n;return null==t&&(t=null),(e=this.rs.projects["regenerate_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){var e;return r.scope.csvUuid=null!=(e=t.data)?e.uuid:void 0})),e.then(null,(n=this,function(){return n.confirm.notify("error")})),e.finally(function(){if(t)return t.finish()}),e},P.prototype._deleteUuid=function(t){var e,r,n;return null==t&&(t=null),(e=this.rs.projects["delete_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){var e;return r.scope.csvUuid=null!=(e=t.data)?e.uuid:void 0})),e.then(null,(n=this,function(){return n.confirm.notify("error")})),e.finally(function(){if(t)return t.finish()}),e},P.prototype.regenerateUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.REGENERATE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.REGENERATE_SUBTITLE"),this.confirm.ask(e,t).then(this._generateUuid)):this._generateUuid()},P.prototype.deleteUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.DELETE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.DELETE_SUBTITLE"),this.confirm.ask(e,t).then(this._deleteUuid)):this._deleteUuid()},t(w,o=P),w.prototype.type="epics",s=w,t(A,o),A.prototype.type="userstories",l=A,t(O,o),O.prototype.type="tasks",u=O,t(R,o),R.prototype.type="issues",c=R,j.controller("CsvExporterEpicsController",s),j.controller("CsvExporterUserstoriesController",l),j.controller("CsvExporterTasksController",u),j.controller("CsvExporterIssuesController",c),i=function(t){return{controller:"CsvExporterEpicsController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_EPIC"},scope:!0}},j.directive("tgCsvEpic",["$translate",i]),h=function(t){return{controller:"CsvExporterUserstoriesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_US"},scope:!0}},j.directive("tgCsvUs",["$translate",h]),d=function(t){return{controller:"CsvExporterTasksController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_TASK"},scope:!0}},j.directive("tgCsvTask",["$translate",d]),p=function(t){return{controller:"CsvExporterIssuesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_ISSUE"},scope:!0}},j.directive("tgCsvIssue",["$translate",p]),m=function(t,s,a,c){return{link:function(r,n,t){var e=function(){return n.find(".size-info").addClass("active")},i=function(t){var e=s.make_model("projects",t.data);return r.project=e,n.find(".loading-overlay").removeClass("active"),c.notify("success")},o=function(t){return 413===t.status&&e(),n.find(".loading-overlay").removeClass("active"),c.notify("error",t.data._error_message)};return n.on("click",".js-change-logo",function(){return n.find("#logo-field").click()}),n.on("change","#logo-field",function(t){if(r.logoAttachment)return n.find(".loading-overlay").addClass("active"),a.projects.changeLogo(r.project.id,r.logoAttachment).then(i,o)}),n.on("click","a.js-use-default-logo",function(t){return n.find(".loading-overlay").addClass("active"),a.projects.removeLogo(r.project.id).then(i,o)}),r.$on("$destroy",function(){return n.off()})}}},j.directive("tgProjectLogo",["$tgAuth","$tgModel","$tgResources","$tgConfirm",m]),v=function(i){return{link:function(t,e,r){var n=i(r.tgProjectLogoModel).assign;return e.bind("change",function(){return t.$apply(function(){return n(t,e[0].files[0])})})}}},j.directive("tgProjectLogoModel",["$parse",v]),n=function(){return{scope:{project:"="},templateUrl:"admin/admin-project-restrictions.html"}},j.directive("tgAdminProjectRestrictions",[n]),r=function(e){return{link:function(t){return t.requestOwnership=function(){return e.create("tg-lb-request-ownership",{class:"lightbox lightbox-request-ownership"},{projectId:t.projectId})}},scope:{projectId:"=",owner:"="},templateUrl:"admin/admin-project-request-ownership.html"}},j.directive("tgAdminProjectRequestOwnership",["tgLightboxFactory",r]),e=function(e){return{link:function(t){return t.changeOwner=function(){return e.create("tg-lb-change-owner",{class:"lightbox lightbox-select-user","project-id":"projectId","active-users":"activeUsers","current-owner-id":"currentOwnerId"},{projectId:t.projectId,activeUsers:t.activeUsers,currentOwnerId:t.owner.id,members:t.members})}},scope:{activeUsers:"=",projectId:"=",owner:"=",members:"="},templateUrl:"admin/admin-project-change-owner.html"}},j.directive("tgAdminProjectChangeOwner",["tgLightboxFactory",e])}.call(this),function(){function t(t,e){for(var r in e)m.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i,o,s,g,w,a,c,u,l,p,d,h,f,m={}.hasOwnProperty,v=function(t,e){return function(){return t.apply(e,arguments)}};function y(t,e,r,n,i,o,s,a,c,u,l,p,d){var h,f,g;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.errorHandlingService=p,this.projectService=d,this.scope.project={},this.loadInitialData(),f=this.translate.instant(this.scope.sectionName),g=this.translate.instant("ADMIN.PROJECT_VALUES.PAGE_TITLE",{sectionName:f,projectName:this.scope.project.name}),h=this.scope.project.description,this.appMetaService.setAll(g,h)}function b(t,e,r,n,i){var o,s;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.moveValue=v(this.moveValue,this),this.loadValues=v(this.loadValues,this),this.scope.$on("admin:project-values:move",this.moveValue),o=this.scope.$watch("resource",(s=this,function(t){if(t)return s.loadValues(),o()}))}function S(){return this.displayValues=v(this.displayValues,this),this.createDefaultValues=v(this.createDefaultValues,this),this.loadValues=v(this.loadValues,this),S.__super__.constructor.apply(this,arguments)}function j(t,e,r,n,i,o,s,a,c,u,l){var p,d,h,f;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.translate=u,this.projectService=l,this.moveCustomAttributes=v(this.moveCustomAttributes,this),this.deleteCustomAttribute=v(this.deleteCustomAttribute,this),this.saveCustomAttribute=v(this.saveCustomAttribute,this),this.createCustomAttribute=v(this.createCustomAttribute,this),this.loadCustomAttributes=v(this.loadCustomAttributes,this),this._onCustomAttributesModified=v(this._onCustomAttributesModified,this),this.scope.TYPE_CHOICES=g,this.scope.project=this.projectService.project.toJS(),this.scope.projectId=this.scope.project.id,d=this.translate.instant(this.scope.sectionName),h=this.translate.instant("ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE",{sectionName:d,projectName:this.scope.project.name}),p=this.scope.project.description,this.appMetaService.setAll(h,p),this.scope.init=(f=this,function(t){return f.scope.type=t,f.loadCustomAttributes()})}function k(t,e,r,n,i,o,s){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.model=o,this.projectService=s,this.mixingClass=v(this.mixingClass,this),this.cancelMixingTags=v(this.cancelMixingTags,this),this.confirmMixingTags=v(this.confirmMixingTags,this),this.toggleMixingFromTags=v(this.toggleMixingFromTags,this),this.startMixingTags=v(this.startMixingTags,this),this.deleteTag=v(this.deleteTag,this),this.editTag=v(this.editTag,this),this.createTag=v(this.createTag,this),this.filterAndSortTags=v(this.filterAndSortTags,this),this.loadTags=v(this.loadTags,this),this.loading=!0,this.loadTags()}l=this.taiga,c=this.taiga.mixOf,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,w=this.taiga.debounce,a=this.taiga.getDefaulColorList,u=angular.module("taigaAdmin"),p=c(l.Controller,l.PageMixin),t(y,p),y.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],y.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},y.prototype.loadInitialData=function(){return this.loadProject()},u.controller("ProjectValuesSectionController",y),d=l.Controller,t(b,d),b.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],b.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((e=this,function(t){return t.length&&(e.scope.values=t,e.scope.maxValueOrder=_.maxBy(t,"order").order),t}));var e},b.prototype.moveValue=function(t,e,r){var n,i=this.scope.values,o=i.indexOf(e);return i.splice(o,1),i.splice(r,0,e),_.each(i,function(t,e){return t.order=e}),this.repo.saveAll(i).then((n=this,function(){return n.rootscope.$broadcast("admin:project-values:updated")}))},o=b,u.controller("ProjectValuesController",o),t(S,o),S.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],S.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((e=this,function(t){return t.length?(e.scope.maxValueOrder=_.maxBy(t,"order").order,e.displayValues(t)):e.createDefaultValues(),t}));var e},S.prototype.createDefaultValues=function(){var r;if(null!=this.rs[this.scope.resource].createDefaultValues)return this.rs[this.scope.resource].createDefaultValues(this.scope.projectId,this.scope.type).then((r=this,function(t){var e;return r.rootscope.$broadcast("admin:project-values:updated"),(e=t.data).length&&(r.scope.maxValueOrder=_.maxBy(e,"order").order,r.displayValues(e)),e}))},S.prototype.displayValues=function(t){return _.each(t,function(t,e){return t.days_to_due_abs=null!==t.days_to_due?Math.abs(t.days_to_due):null,t.sign=0<=t.days_to_due?1:-1}),this.scope.values=t},u.controller("ProjectDueDatesValuesController",S),s=function(t,d,h,e,r,f,g,m){var n=function(n,t,e){var i=null,r=t.find(".sortable"),o=dragula([r[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}});return o.on("dragend",function(t){var e=(i=$(t)).scope().value,r=i.index();return n.$broadcast("admin:project-values:move",e,r)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),n.$on("$destroy",function(){return t.off(),o.destroy()})},i=function(a,r,t){var n,e,i,o,c=r.controller(),s=t.type,u=t.objname,l=function(){return a.newValue={name:"",is_closed:!1,is_archived:!1}},p=function(){return a.addNewElementText=f.instant("ADMIN.PROJECT_VALUES_"+u.toUpperCase()+".ACTION_ADD")};return l(),p(),g.$on("$translateChangeEnd",function(){return a.$evalAsync(p)}),e=function(t){var e;if(null==t&&(t=!1),e=r.find(".table-main"),$(document.body).scrollTop(e.offset().top+e.height()),t)return r.find(".new-value input:visible").first().focus()},o=function(e){var t,r,n=e.parents("form"),i=n.checksley();if(i.validate())return r=n.scope().value,(t=d.save(r)).then(function(){var t=e.parents(".row.table-main");return t.addClass("hidden"),t.siblings(".visualization").removeClass("hidden"),g.$broadcast("admin:project-values:updated"),m.fetchProject()}),t.then(null,function(t){return i.setErrors(t)})},i=function(e){var t,r=e.parents("form").checksley();if(r.validate())return a.newValue.project=a.project.id,a.newValue.order=a.maxValueOrder?a.maxValueOrder+1:1,(t=d.create(s,a.newValue)).then(function(t){return e.addClass("hidden"),a.values.push(t),a.maxValueOrder=t.order,l(),g.$broadcast("admin:project-values:updated")}),t.then(null,function(t){return r.setErrors(t)})},n=function(t){var e=t.parents(".row.table-main"),r=t.parents("form").scope().value;return a.$apply(function(){return e.addClass("hidden"),r.revert(),e.siblings(".visualization").removeClass("hidden")})},r.on("click",".show-add-new",function(t){return t.preventDefault(),r.find(".new-value").removeClass("hidden"),e(!0)}),r.on("click",".add-new",w(2e3,function(t){var e;return t.preventDefault(),e=r.find(".new-value"),i(e)})),r.on("click",".delete-new",function(t){return t.preventDefault(),r.find(".new-value").addClass("hidden"),l()}),r.on("click",".edit-value",function(t){var e,r;return t.preventDefault(),(r=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(e=r.siblings(".edition")).removeClass("hidden"),e.find("input:visible").first().focus().select()}),r.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=r.find(".new-value"),i(e)):27===t.keyCode?(r.find(".new-value").addClass("hidden"),l()):void 0}),r.on("click",".save",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),o(e)}),r.on("click",".cancel",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),n(e)}),r.on("click",".delete-value",function(t){var e,r,n,i,o,s;return t.preventDefault(),r=angular.element(t.currentTarget).parents("form"),s=r.scope().value,e={},_.each(a.values,function(t){if(s.id!==t.id)return e[t.id]=t.name}),n=s.name,0===_.keys(e).length?h.error(f.instant("ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL")):(o=f.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE"),i=f.instant("ADMIN.PROJECT_VALUES.REPLACEMENT"),h.askChoice(o,n,e,i).then(function(t){var e=function(){return c.loadValues().finally(function(){return g.$broadcast("admin:project-values:updated"),t.finish()})},r=function(){return h.notify("error")};return d.remove(s,{moveTo:t.selected}).then(e,r)}))})};return{link:function(t,e,r){return n(t,e),i(t,e,r),t.$on("$destroy",function(){return e.off()})}}},u.directive("tgProjectValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",s]),n=function(t,l,p,e,r,d,h,n){var i=s(0,l,p,0,0,d,h,n),o=function(n,r,t,o){var i,s,a,c,u;return o=r.controller(),u=t.type,(a=function(){return n.newValue={name:"",days_to_due:0,sign:1}})(),i=function(t){return t.days_to_due=t.days_to_due_abs*t.sign},s=function(t){var e=angular.element(t.currentTarget),r=(e.parents(".row.table-main"),e.parents("form"));return r.scope().value?r.scope().value:r.scope().newValue},c=function(e){var t,r=e.parents("form").checksley();if(r.validate())return n.newValue.project=n.project.id,n.newValue.order=n.maxValueOrder?n.maxValueOrder+1:1,(t=l.create(u,n.newValue)).then(function(t){return e.addClass("hidden"),t.sign=n.newValue.sign,t.days_to_due_abs=n.newValue.days_to_due_abs,n.values.push(t),h.$broadcast("admin:project-values:updated"),a()}),t.then(null,function(t){return r.setErrors(t)})},r.on("input",".days-to-due-abs",function(t){var e;return t.preventDefault(),e=s(t),n.$apply(function(){return i(e)})}),r.on("click",".days-to-due-sign",function(t){var e;return t.preventDefault(),e=s(t),n.$apply(function(){return e.sign=-1*e.sign,i(e)})}),r.on("click",".add-new-due-date",w(2e3,function(t){var e;return t.preventDefault(),e=r.find(".new-value"),c(e)})),r.on("click",".delete-due-date",function(t){var e,r,n,i;return t.preventDefault(),e=angular.element(t.currentTarget).parents("form"),i=e.scope().value,n=d.instant("LIGHTBOX.ADMIN_DUE_DATES.TITLE_ACTION_DELETE_DUE_DATE"),r=d.instant("LIGHTBOX.ADMIN_DUE_DATES.SUBTITLE_ACTION_DELETE_DUE_DATE",{due_date_status_name:i.name}),p.ask(n,r).then(function(t){var e=function(){return o.loadValues().finally(function(){return h.$broadcast("admin:project-values:updated"),t.finish()})},r=function(){return p.notify("error")};return l.remove(i).then(e,r)})})};return{link:function(t,e,r){return i.link(t,e,r),o(t,e,r)}}},u.directive("tgProjectDueDatesValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",n]),e=function(){return{link:function(r,n,t,i){return r.colorList=a(),r.allowEmpty=!1,t.tgAllowEmpty&&(r.allowEmpty=!0),n.controller(),r.$watch(t.ngModel,function(t){return r.color=t.color}),n.on("click",".current-color",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),r=angular.element(t.currentTarget),$(".select-color").hide(),r.siblings(".select-color").show(),(e=angular.element("body")).on("click",function(t){if(0===angular.element(t.target).parent(".select-color").length)return n.find(".select-color").hide(),e.unbind("click")})}),n.on("click",".select-color .color",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),r.$apply(function(){return i.$modelValue.color=e.data("color")}),n.find(".select-color").hide()}),n.on("click",".select-color .selected-color",function(t){return t.preventDefault(),r.$apply(function(){return i.$modelValue.color=r.color}),n.find(".select-color").hide()}),n.on("keyup","input",function(t){return t.stopPropagation(),13===t.keyCode?(r.$apply(function(){return i.$modelValue.color=r.color}),n.find(".select-color").hide()):27===t.keyCode?n.find(".select-color").hide():void 0}),r.$on("$destroy",function(){return n.off()})},require:"ngModel"}},u.directive("tgColorSelection",e),g=[{key:"text",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:"multiline",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:"richtext",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_RICHTEXT"},{key:"date",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"},{key:"url",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL"},{key:"dropdown",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DROPDOWN"},{key:"checkbox",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_CHECKBOX"},{key:"number",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_NUMBER"}],h=c(l.Controller,l.PageMixin),t(j,h),j.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgProjectService"],j.prototype._parseAttributesExtra=function(){return this.scope.customAttributes=_.map(this.scope.customAttributes,(e=this,function(t){return e._parseAttributeExtra(t)}));var e},j.prototype._parseAttributeExtra=function(t){return"dropdown"!==t.type||t.extra||(t.extra=[""]),t},j.prototype._onCustomAttributesModified=function(){return this.rootscope.$broadcast("admin:project-custom-attributes:updated")},j.prototype.loadCustomAttributes=function(){return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((r=this,function(t){var e;return r.scope.customAttributes=t,r.scope.maxOrder=null!=(e=_.maxBy(t,"order"))?e.order:void 0,r._parseAttributesExtra(),t}));var r},j.prototype.createCustomAttribute=function(t){return this.repo.create("custom-attributes/"+this.scope.type,t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},j.prototype.saveCustomAttribute=function(t){return this.repo.save(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},j.prototype.deleteCustomAttribute=function(t){return this.repo.remove(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},j.prototype.moveCustomAttributes=function(t,e){var r,n=this.scope.customAttributes,i=n.indexOf(t);return n.splice(i,1),n.splice(e,0,t),_.each(n,function(t,e){return t.order=e}),this.repo.saveAll(n).then((r=this,function(){return r._onCustomAttributesModified()}))},u.controller("ProjectCustomAttributesController",j),r=function(t,C,e,P){return{link:function(o,a,t){var e,r,n,i,s,c,u,l,p,d,h,f,g,m,v,y,_,b,S,j,k,I,E,T=a.controller();return o.$on("$destroy",function(){return a.off()}),o.isExtraVisible={},r=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"))},m=function(){var t,e,r,n,i,o=a.find(".js-sortable"),s=dragula([o[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:o[0],moves:function(t,e,r){return!$(r).closest(".js-child-sortable")[0]&&$(t).is("div[tg-bind-scope]")}});for(s.on("dragend",function(t){var e=$(t),r=e.scope().attr,n=e.index();return T.moveCustomAttributes(r,n)}),n=[],e=0,r=(i=a.find(".js-child-sortable")).length;e<r;e++)s[t=i[e]]=dragula([t],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:t,moves:function(t){return $(t).is("div[tg-bind-scope]")}}),n.push(s[t].on("dragend",function(t){var e=$(t),r=e.scope().attr.extra,n=e.scope().$index,i=e.index(),o=r[n];return r.splice(n,1),r.splice(i,0,o),e.scope().attr.setAttr("extra",r),T.saveCustomAttribute(e.scope().attr).then(function(){return C.notify("success")})}));return n},j=function(){return a.find(".js-new-custom-field").removeClass("hidden"),a.find(".js-new-custom-field input:visible").first().focus()},d=function(){return a.find(".js-new-custom-field").addClass("hidden")},b=function(){return a.find(".js-add-custom-field-button").removeClass("hidden")},l=function(){return a.find(".js-add-custom-field-button").addClass("hidden")},S=function(){return a.find(".js-cancel-new-custom-field-button").removeClass("hidden")},p=function(){return a.find(".js-cancel-new-custom-field-button").addClass("hidden")},y=function(){return o.newAttr={}},c=function(t){var e,r,n,i=t.checksley();if(i.validate())return n=function(){return T.loadCustomAttributes(),d(),y(),C.notify("success")},r=function(t){return i.setErrors(t)},(e=o.newAttr).project=o.projectId,e.order=o.maxOrder?o.maxOrder+1:1,T.createCustomAttribute(e).then(n,r)},i=function(){return d(),y()},g=function(t){var e,r=t.scope().newAttr?t.scope().newAttr:t.scope().attr;if("dropdown"===r.type&&(null==(e=r.extra)||!e.length))return r.extra=[""],r.id?k(t):(I(-1),t.scope().$apply())},o.$watch("customAttributes",function(t){if(t)return 0===t.length?(p(),l(),j()):(d(),b(),S(),m())}),a.on("change",".custom-field-type select",function(t){return r(t,g)}),a.on("click",".js-add-custom-field-button",function(t){return r(t,j)}),a.on("click",".js-create-custom-field-button",w(2e3,function(t){return r(t,c)})),a.on("click",".js-cancel-new-custom-field-button",function(t){return t.preventDefault(),i()}),a.on("keyup",".js-new-custom-field input",function(t){return 13===t.keyCode?r(t,c):27===t.keyCode?i():void 0}),k=function(t){return t.find(".js-view-custom-field").addClass("hidden"),t.find(".js-edit-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field input:visible").first().focus().select(),t.find(".js-view-custom-field-extra").addClass("hidden"),t.find(".js-edit-custom-field-extra").removeClass("hidden"),t.find(".custom-extra-actions").removeClass("hidden"),I(t.scope().attr.id),o.$apply()},E=function(t){var e,r,n,i=t.checksley();if(i.validate())return n=function(){return T.loadCustomAttributes(),h(t),C.notify("success")},r=function(t){return i.setErrors(t)},(e=t.scope().attr).setAttr("extra",e.extra),T.saveCustomAttribute(e).then(n,r)},s=function(t){return h(t),_(t)},h=function(t){return t.find(".js-edit-custom-field").addClass("hidden"),t.find(".js-view-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field-extra").addClass("hidden"),t.find(".js-view-custom-field-extra").removeClass("hidden"),t.find(".custom-extra-actions").addClass("hidden")},_=function(t){return o.$apply(function(){return t.scope().attr.revert()})},a.on("click",".js-edit-custom-field-button",function(t){return r(t,k)}),a.on("click",".js-update-custom-field-button",w(1e3,function(t){return r(t,E)})),a.on("click",".js-cancel-edit-custom-field-button",function(t){return r(t,s)}),a.on("keyup",".js-edit-custom-field input",function(t){return 13===t.keyCode?r(t,E):27===t.keyCode?r(t,s):void 0}),u=function(t){var n=t.scope().attr,i=n.name,e=P.instant("COMMON.CUSTOM_ATTRIBUTES.DELETE"),r=P.instant("COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE");return C.ask(e,r,i).then(function(t){var e=function(){return T.loadCustomAttributes().finally(function(){return t.finish()})},r=function(){return C.notify("error",null,"We have not been able to delete '"+i+"'.")};return T.deleteCustomAttribute(n).then(e,r)})},a.on("click",".js-delete-custom-field-button",w(2e3,function(t){return r(t,u)})),o.toggleExtraVisible=function(t){return(o.isExtraVisible[t]?f:I)(t)},I=function(t){return o.isExtraVisible[t]=!0},f=function(t){return o.isExtraVisible[t]=!1},e=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"),angular.element(t.currentTarget).closest(".js-form"))},n=function(t,e){var r,n=t.scope();return(null!=(r=n.newAttr)&&r.extra?n.newAttr.extra:n.attr.extra).push(""),n.$apply(),t.find(".js-edit-custom-field-extra").last().removeClass("hidden"),t.find(".js-view-custom-field-extra").last().addClass("hidden"),t.find(".js-edit-custom-field-extra input").last().focus()},v=function(t,e){return t.scope().attr.extra.splice(e.scope().$index,1),e.scope().$apply()},a.on("keyup",".js-edit-custom-field-extra input",function(t){return 13===t.keyCode?r(t,E):27===t.keyCode?r(t,s):void 0}),a.on("keyup",".js-new-custom-field-extra input",function(t){return 13===t.keyCode?r(t,c):27===t.keyCode?i():void 0}),a.on("click",".js-add-option-custom-field-extra-button",w(500,function(t){return e(t,n)})),a.on("click",".js-delete-custom-field-extra-button",w(500,function(t){return e(t,v)}))}}},u.directive("tgProjectCustomAttributes",["$log","$tgConfirm","animationFrame","$translate",r]),f=l.Controller,t(k,f),k.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgModel","tgProjectService"],k.prototype.loadTags=function(){var r,t=this.projectService.project.toJS();return this.rs.projects.tagsColors(t.id).then((r=this,function(t){return r.scope.projectTagsAll=_.map(t.getAttrs(),function(t,e){return r.model.make_model("tag",{name:e,color:t})}),r.filterAndSortTags(),r.loading=!1}))},k.prototype.filterAndSortTags=function(){return this.scope.projectTags=_.sortBy(this.scope.projectTagsAll,function(t){return t.name.toLowerCase()}),this.scope.projectTags=_.filter(this.scope.projectTags,(e=this,function(t){return-1!==t.name.indexOf(e.scope.tagsFilter.name)}));var e},k.prototype.createTag=function(t,e){return this.rs.projects.createTag(this.scope.projectId,t,e)},k.prototype.editTag=function(t,e,r){return t===e&&(e=null),this.rs.projects.editTag(this.scope.projectId,t,e,r)},k.prototype.deleteTag=function(t){return this.scope.loadingDelete=!0,this.rs.projects.deleteTag(this.scope.projectId,t).finally((e=this,function(){return e.scope.loadingDelete=!1}));var e},k.prototype.startMixingTags=function(t){return this.scope.mixingTags.toTag=t.name},k.prototype.toggleMixingFromTags=function(t){var e;if(t.name!==this.scope.mixingTags.toTag)return-1===(e=this.scope.mixingTags.fromTags.indexOf(t.name))?this.scope.mixingTags.fromTags.push(t.name):this.scope.mixingTags.fromTags.splice(e,1)},k.prototype.confirmMixingTags=function(){var t,e,r=this.scope.mixingTags.toTag,n=this.scope.mixingTags.fromTags;return this.scope.loadingMixing=!0,this.rs.projects.mixTags(this.scope.projectId,r,n).then((e=this,function(){return e.cancelMixingTags(),e.loadTags()})).finally((t=this,function(){return t.scope.loadingMixing=!1}))},k.prototype.cancelMixingTags=function(){return this.scope.mixingTags.toTag=null,this.scope.mixingTags.fromTags=[]},k.prototype.mixingClass=function(t){if(null!==this.scope.mixingTags.toTag){if(t.name===this.scope.mixingTags.toTag)return"mixing-tags-to";if(-1!==this.scope.mixingTags.fromTags.indexOf(t.name))return"mixing-tags-from"}},u.controller("ProjectTagsController",k),i=function(t,e,d,r,n,h,f){return{link:function(s,r,t){var n,i,o,e=$(window),a=r.controller(),c=(t.type,t.objname,function(){return s.newValue={tag:"",color:""}}),u=function(){return s.tagsFilter={name:""}},l=function(){return s.mixingTags={toTag:null,fromTags:[]}},p=function(){return s.addNewElementText=h.instant("ADMIN.PROJECT_VALUES_TAGS.ACTION_ADD")};return c(),u(),l(),p(),f.$on("$translateChangeEnd",function(){return s.$evalAsync(p)}),o=function(e){var t,r,n,i=e.parents("form"),o=i.checksley();if(o.validate())return(t=(n=i.scope().tag).clone()).revert(),s.loadingEdit=!0,(r=a.editTag(t.name,n.name,n.color)).then(function(){return a.loadTags().then(function(){var t=e.parents(".row.table-main");return t.addClass("hidden"),s.loadingEdit=!1,f.$broadcast("tags:updated"),t.siblings(".visualization").removeClass("hidden")})}),r.then(null,function(t){return s.loadingEdit=!1,o.setErrors(t.data)})},i=function(e){var r,t;e.parents("form");if((r=e.checksley()).validate())return s.loadingCreate=!0,(t=a.createTag(s.newValue.tag,s.newValue.color)).then(function(t){return a.loadTags().then(function(){return s.loadingCreate=!1,e.addClass("hidden"),f.$broadcast("tags:updated"),c()})}),t.then(null,function(t){return s.loadingCreate=!1,r.setErrors(t.data)})},n=function(t){var e=t.parents(".row.table-main"),r=t.parents("form").scope().tag;return s.$apply(function(){return e.addClass("hidden"),r.revert(),e.siblings(".visualization").removeClass("hidden")})},s.$watch("tagsFilter.name",function(t){return a.filterAndSortTags()}),e.on("keyup",function(t){if(27===t.keyCode)return s.$apply(l)}),r.on("click",".show-add-new",function(t){return t.preventDefault(),r.find(".new-value").removeClass("hidden")}),r.on("click",".add-new",w(2e3,function(t){var e;return t.preventDefault(),e=r.find(".new-value"),i(e)})),r.on("click",".delete-new",function(t){return t.preventDefault(),r.find(".new-value").addClass("hidden"),c()}),r.on("click",".mix-tags",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),s.$apply(function(){return a.startMixingTags(e.parents("form").scope().tag)})}),r.on("click",".mixing-row",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),s.$apply(function(){return a.toggleMixingFromTags(e.parents("form").scope().tag)})}),r.on("click",".mixing-confirm",function(t){return t.preventDefault(),t.stopPropagation(),s.$apply(function(){return a.confirmMixingTags()})}),r.on("click",".mixing-cancel",function(t){return t.preventDefault(),t.stopPropagation(),s.$apply(function(){return a.cancelMixingTags()})}),r.on("click",".edit-value",function(t){var e,r;return t.preventDefault(),(r=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(e=r.siblings(".edition")).removeClass("hidden"),e.find("input:visible").first().focus().select()}),r.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=r.find(".new-value"),i(e)):27===t.keyCode?(r.find(".new-value").addClass("hidden"),c()):void 0}),r.on("keyup",".status-name input",function(t){var e=angular.element(t.currentTarget);return 13===t.keyCode?o(e):27===t.keyCode?n(e):void 0}),r.on("click",".save",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),o(e)}),r.on("click",".cancel",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),n(e)}),r.on("click",".delete-tag",function(t){var e,n,r;return t.preventDefault(),e=angular.element(t.currentTarget).parents("form"),n=e.scope().tag,r=h.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_TAG"),d.askOnDelete(r,n.name).then(function(t){var e=function(){return a.loadTags().finally(function(){return f.$broadcast("tags:updated"),t.finish()})},r=function(){return d.notify("error")};return a.deleteTag(n.name).then(e,r)})}),s.$on("$destroy",function(){return r.off(),e.off()})}}},u.directive("tgProjectTags",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope",i])}.call(this),function(){function m(t,e){return function(){return t.apply(e,arguments)}}var t,e,r,n,v,g,i,o,s,a,c={}.hasOwnProperty,y=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function u(t,e,r,n,i,o,s,a,c,u,l,p,d,h){var f,g;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.model=u,this.appMetaService=l,this.translate=p,this.errorHandlingService=d,this.projectService=h,this._disableComputable=m(this._disableComputable,this),this._enableComputable=m(this._enableComputable,this),v(this),this.scope.sectionName="ADMIN.MENU.PERMISSIONS",this.scope.project={},this.scope.anyComputableRole=!0,(f=this.loadInitialData()).then((g=this,function(){var t=g.translate.instant("ADMIN.ROLES.PAGE_TITLE",{projectName:g.scope.project.name}),e=g.scope.project.description;return g.appMetaService.setAll(t,e)})),f.then(null,this.onInitialDataError.bind(this))}a=this.taiga,o=this.taiga.mixOf,g=this.taiga.bindOnce,i=this.taiga.debounce,v=this.taiga.bindMethods,s=angular.module("taigaAdmin"),function(t,e){for(var r in e)c.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(u,o(a.Controller,a.PageMixin,a.FiltersMixin)),u.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgModel","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],u.prototype.loadProject=function(){var t=this.projectService.project.toJS();return(t=this.model.make_model("projects",t)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.anyComputableRole=_.some(_.map(t.roles,function(t){return t.computable})),t},u.prototype.loadRoles=function(){return this.rs.roles.list(this.scope.projectId).then((r=this,function(t){var e;return t=t.map(function(t){return t.external_user=!1,t}),e={name:r.translate.instant("ADMIN.ROLES.EXTERNAL_USER"),permissions:r.scope.project.public_permissions,external_user:!0},t.push(e),r.scope.roles=t,r.scope.role=r.scope.roles[0],t}));var r},u.prototype.loadInitialData=function(){return this.loadProject(),this.loadRoles()},u.prototype.forceLoadProject=function(){return this.rootscope.$broadcast("admin:project-roles:updated")},u.prototype.setRole=function(t){return this.scope.role=t,this.scope.$broadcast("role:changed",this.scope.role)},u.prototype.delete=function(){for(var t,e,r,n,i,o,s={},a=this.scope.roles,c=0,u=a.length;c<u;c++)(e=a[c]).id!==this.scope.role.id&&(s[e.id]=e.name);return 0===_.keys(s).length?this.confirm.error(this.translate.instant("ADMIN.ROLES.ERROR_DELETE_ALL")):(n=this.translate.instant("ADMIN.ROLES.TITLE_DELETE_ROLE"),r=this.scope.role.name,t=this.translate.instant("ADMIN.ROLES.REPLACEMENT_ROLE"),i=this.translate.instant("ADMIN.ROLES.WARNING_DELETE_ROLE"),this.confirm.askChoice(n,r,s,t,i).then((o=this,function(t){var e=function(){return o.forceLoadProject(),o.loadRoles().finally(function(){return t.finish()})},r=function(){return o.confirm.notify("error")};return o.repo.remove(o.scope.role,{moveTo:t.selected}).then(e,r)})))},u.prototype._enableComputable=function(){var t,e,r=function(){return t.confirm.notify("success"),t.forceLoadProject()},n=function(){return e.confirm.notify("error"),e.scope.role.revert()};return(e=t=this).repo.save(this.scope.role).then(r,n)},u.prototype._disableComputable=function(){var n,e,t=function(t){var e=function(){return t.finish(),n.confirm.notify("success"),n.forceLoadProject()},r=function(){return t.finish(),n.confirm.notify("error"),n.scope.role.revert()};return n.repo.save(n.scope.role).then(e,r)},r=function(t){return e.scope.role.revert()},i=(e=n=this).translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE"),o=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE",{roleName:this.scope.role.name});return this.confirm.ask(i,o,"").then(t,r)},u.prototype.toggleComputable=i(2e3,function(){return this.scope.role.computable?this._enableComputable():this._disableComputable()}),s.controller("RolesController",u),t=function(o,s){return{link:function(e,r,t){var n=function(){return r.find(".total").toggle(),r.find(".edit-role").toggle()},i=function(){var t;return e.role.name=r.find("input").val(),(t=o.save(e.role)).then(function(){return s.notify("success")}),t.then(null,function(t){return s.notify("error")}),n()};return r.on("click",".edit-value",function(){return n(),r.find("input").focus(),r.find("input").val(e.role.name)}),r.on("click","a.save",i),r.on("keyup","input",function(t){return 13===t.keyCode?i():27===t.keyCode?n():void 0}),e.$on("role:changed",function(){if(r.find(".edit-role").is(":visible"))return n()}),e.$on("$destroy",function(){return r.off()})}}},s.directive("tgEditRole",["$tgRepo","$tgConfirm",t]),n=function(){return{link:function(t,e,r){e.controller();return t.$on("$destroy",function(){return e.off()})}}},s.directive("tgRoles",n),e=function(c,u){var l=["view_project","view_milestones","view_us","view_tasks","view_issues"];return{link:function(o,s,t){var a=s.controller();return o.$on("$destroy",function(){return s.off()}),s.on("click","a.add-button",function(t){return t.preventDefault(),s.find(".new").removeClass("hidden"),s.find(".new").focus(),s.find(".add-button").hide()}),s.on("keyup",".new",function(t){var e,r,n,i;return t.preventDefault(),13===t.keyCode?(i=angular.element(t.currentTarget),e={project:o.projectId,name:i.val(),permissions:l,order:_.maxBy(o.roles,function(t){return t.order}).order+1,computable:!1},s.find(".new").addClass("hidden"),s.find(".new").val(""),n=function(t){var e=o.roles.length-1;return o.roles.splice(e,0,t),a.setRole(t),s.find(".add-button").show(),a.forceLoadProject()},r=function(){return u.notify("error")},c.create("roles",e).then(n,r)):27===t.keyCode?(i=angular.element(t.currentTarget),s.find(".new").addClass("hidden"),s.find(".new").val(""),s.find(".add-button").show()):void 0})}}},s.directive("tgNewRole",["$tgRepo","$tgConfirm",e]),r=function(u,l,d,i){var r=_.template('<div class="resume-title" translate="<%- category.name %>"></div>\n<div class="summary-role">\n    <div class="count"><%- category.activePermissions %>/<%- category.permissions.length %></div>\n    <% _.each(category.permissions, function(permission) { %>\n        <div class="role-summary-single check-toggle <% if(permission.active) { %>active<% } %>"\n             title="{{ \'<%- permission.name %>\' | translate }}"></div>\n    <% }) %>\n</div>\n<tg-svg svg-icon="icon-arrow-right"></tg-svg>'),h=_.template('<div class="category-config" data-id="<%- index %>">\n    <div class="resume">\n    </div>\n    <div class="category-items">\n        <div class="items-container">\n        <% _.each(category.permissions, function(permission) { %>\n            <div class="category-item" data-id="<%- permission.key %>">\n                <span translate="<%- permission.name %>"></span>\n                <div class="check">\n                    <input type="checkbox"\n                           <% if(!permission.editable) { %> disabled="disabled" <% } %>\n                           <% if(permission.active) { %> checked="checked" <% } %>/>\n                    <div></div>\n                    <span class="check-text check-yes" translate="COMMON.YES"></span>\n                    <span class="check-text check-no" translate="COMMON.NO"></span>\n                </div>\n            </div>\n        <% }) %>\n        </div>\n    </div>\n</div>'),f=_.template('<div class="category-config-list"></div>');return{link:function(p,o,t){var s=o.controller(),a=function(r){var t,e,n,i,o,s=function(t){return _.map(t,function(t){var e;return _.extend({},t,{active:(e=t.key,0<=y.call(r.permissions,e))})})},a=function(t,e,r){return!(e.external_user&&!r.is_private&&0===t.key.indexOf("view_"))},c=function(t){return _.map(t,function(t){return t.permissions=t.permissions.map(function(t){return t.editable=a(t,r,p.project),t}),_.extend({},t,{activePermissions:_.filter(t.permissions,"active").length})})},u=[],l=[{key:"view_epics",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.VIEW_EPICS"},{key:"add_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.ADD_EPICS"},{key:"modify_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.MODIFY_EPICS"},{key:"comment_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.COMMENT_EPICS"},{key:"delete_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.DELETE_EPICS"}];return u.push({name:"COMMON.PERMISIONS_CATEGORIES.EPICS.NAME",permissions:s(l)}),e=[{key:"view_milestones",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS"},{key:"add_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS"},{key:"modify_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS"},{key:"delete_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS"}],u.push({name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME",permissions:s(e)}),i=[{key:"view_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES"},{key:"add_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES"},{key:"modify_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES"},{key:"comment_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_USER_STORIES"},{key:"delete_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES"}],u.push({name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME",permissions:s(i)}),n=[{key:"view_tasks",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS"},{key:"add_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS"},{key:"modify_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS"},{key:"comment_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.COMMENT_TASKS"},{key:"delete_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS"}],u.push({name:"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME",permissions:s(n)}),t=[{key:"view_issues",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES"},{key:"add_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES"},{key:"modify_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES"},{key:"comment_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.COMMENT_ISSUES"},{key:"delete_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES"}],u.push({name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME",permissions:s(t)}),o=[{key:"view_wiki_pages",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES"},{key:"add_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES"},{key:"modify_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES"},{key:"delete_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES"},{key:"view_wiki_links",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS"},{key:"add_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS"},{key:"delete_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS"}],u.push({name:"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME",permissions:s(o)}),c(u)},c=function(t,e){return t.find(".resume").html(i(r({category:e}))(p))},n=function(t,e){var r=h({category:t,index:e});return r=angular.element(r),c(r,t),i(r)(p)},e=function(){var r;return o.off(),r=f(),_.each(a(p.role),function(t,e){return r=angular.element(r).append(n(t,e))}),o.html(r),o.on("click",".resume",function(t){var e;return t.preventDefault(),(e=angular.element(t.currentTarget)).toggleClass("open-drawer"),e.next().toggleClass("open")}),o.on("change",".category-item input",function(t){var e,r,n=function(){var t=_.filter(o.find(".category-item input"),function(t){return angular.element(t).is(":checked")});return(t=_.sortBy(_.map(t,function(t){return angular.element(t).parents(".category-item").data("id")}))).length&&t.push("view_project"),t},i=angular.element(t.currentTarget);return p.role.permissions=n(),r=function(){var t=a(p.role),e=i.parents(".category-config").data("id");return c(i.parents(".category-config"),t[e]),u.$broadcast("projects:reload"),d.notify("success"),s.forceLoadProject()},e=function(){return d.notify("error"),i.prop("checked",!i.prop("checked")),p.role.permissions=n()},p.role.external_user?(p.project.public_permissions=p.role.permissions,p.project.anon_permissions=p.role.permissions.filter(function(t){return 0===t.indexOf("view_")}),l.save(p.project).then(r,e)):l.save(p.role).then(r,e)})};return p.$on("$destroy",function(){return o.off()}),p.$on("role:changed",e),g(p,t.ngModel,e)}}},s.directive("tgRolePermissions",["$rootScope","$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){function t(t,e){for(var r in e)S.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i,o,s,a,c,d,g,u,l,p,m,h,f,v,y,b,S={}.hasOwnProperty;function j(t,e,r,n,i,o,s,a,c,u){var l,p;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.location=i,this.navUrls=o,this.appMetaService=s,this.translate=a,this.errorHandlingService=c,this.projectService=u,d(this),this.scope.sectionName="ADMIN.WEBHOOKS.SECTION_NAME",this.scope.project={},(l=this.loadInitialData()).then((p=this,function(){var t=p.translate.instant("ADMIN.WEBHOOKS.PAGE_TITLE",{projectName:p.scope.project.name}),e=p.scope.project.description;return p.appMetaService.setAll(t,e)})),l.then(null,this.onInitialDataError.bind(this)),this.scope.$on("webhooks:reload",this.loadWebhooks)}function k(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,d(this),this.scope.sectionName=this.translate.instant("ADMIN.GITHUB.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t=c.translate.instant("ADMIN.GITHUB.PAGE_TITLE",{projectName:c.scope.project.name}),e=c.scope.project.description;return c.appMetaService.setAll(t,e)})),a.then(null,this.onInitialDataError.bind(this))}function I(t,e,r,n,i,o,s){var a,c,u;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,d(this),this.scope.sectionName=this.translate.instant("ADMIN.GITLAB.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t=c.translate.instant("ADMIN.GITLAB.PAGE_TITLE",{projectName:c.scope.project.name}),e=c.scope.project.description;return c.appMetaService.setAll(t,e)})),a.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",(u=this,function(){return u.loadModules()}))}function E(t,e,r,n,i,o,s){var a,c,u;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,d(this),this.scope.sectionName=this.translate.instant("ADMIN.BITBUCKET.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t=c.translate.instant("ADMIN.BITBUCKET.PAGE_TITLE",{projectName:c.scope.project.name}),e=c.scope.project.description;return c.appMetaService.setAll(t,e)})),a.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",(u=this,function(){return u.loadModules()}))}function T(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,d(this),this.scope.sectionName=this.translate.instant("ADMIN.GOGS.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t=c.translate.instant("ADMIN.GOGS.PAGE_TITLE",{projectName:c.scope.project.name}),e=c.scope.project.description;return c.appMetaService.setAll(t,e)})),a.then(null,this.onInitialDataError.bind(this))}p=this.taiga,u=this.taiga.mixOf,d=this.taiga.bindMethods,g=this.taiga.debounce,m=this.taiga.timeout,l=angular.module("taigaAdmin"),h=u(p.Controller,p.PageMixin,p.FiltersMixin),t(j,h),j.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],j.prototype.loadWebhooks=function(){return this.rs.webhooks.list(this.scope.projectId).then((e=this,function(t){return e.scope.webhooks=t}));var e},j.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},j.prototype.loadInitialData=function(){return this.loadProject(),this.loadWebhooks()},l.controller("WebhooksController",j),c=function(p,d,h,t,f){return{link:function(n,i,t){var s=n.$eval(t.tgWebhook),r=function(){var o=f.instant("ADMIN.WEBHOOKS.DATE");return p.webhooklogs.list(s.id).then(function(t){for(var e,r,n=0,i=t.length;n<i;n++)(e=t[n]).validStatus=200<=(r=e.status)&&r<300,e.prettySentHeaders=_.map(_.toPairs(e.request_headers),function(t){return t[0]+": "+t[1]}).join("\n"),e.prettySentData=JSON.stringify(e.request_data),e.prettyDate=moment(e.created).format(o);return s.logs_counter=t.length,s.logs=t,a()})},a=function(){var t,e=i.find(".toggle-history"),r=e.parents(".single-webhook-wrapper").find(".webhooks-history").hasClass("open")?(t=f.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY"),f.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE")):(t=f.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY"),f.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE"));return e.text(t),e.prop("title",r)},o=function(){return i.find(".edition-mode").addClass("hidden"),i.find(".visualization-mode").removeClass("hidden")},e=function(){return i.find(".visualization-mode").addClass("hidden"),i.find(".edition-mode").removeClass("hidden")},c=function(){return i.find(".webhooks-history").addClass("open")},u=function(){return o(),n.$apply(function(){return s.revert()})},l=g(2e3,function(t){var e,r=t.parents("form").checksley();if(r.validate())return(e=d.save(s)).then(o),e.then(null,function(t){return h.notify("error"),r.setErrors(t)})});return i.on("click",".test-webhook",function(){return c(),p.webhooks.test(s.id).then(r)}),i.on("click",".edit-webhook",e),i.on("click",".cancel-existing",u),i.on("click",".edit-existing",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),l(e)}),i.on("keyup",".edition-mode input",function(t){var e;return 13===t.keyCode?(e=angular.element(t.currentTarget),l(e)):27===t.keyCode?(e=angular.element(t.currentTarget),u()):void 0}),i.on("click",".delete-webhook",function(){var t=f.instant("ADMIN.WEBHOOKS.DELETE"),e=f.instant("ADMIN.WEBHOOKS.WEBHOOK_NAME",{name:s.name});return h.askOnDelete(t,e).then(function(t){var e=function(){return t.finish(),n.$emit("webhooks:reload")},r=function(){return t.finish(!1),h.notify("error")};return d.remove(s).then(e,r)})}),i.on("click",".toggle-history",function(t){angular.element(t.currentTarget);return null==s.logs||0===s.logs.length?r().then(function(){return m(0,function(){return i.find(".webhooks-history").toggleClass("open").slideToggle(),a()})}):(i.find(".webhooks-history").toggleClass("open").slideToggle(),n.$apply(function(){return a()}))}),i.on("click",".history-single",function(t){var e=angular.element(t.currentTarget);return e.toggleClass("history-single-open"),e.siblings(".history-single-response").toggleClass("open")}),i.on("click",".resend-request",function(t){var e=angular.element(t.currentTarget).data("log");return p.webhooklogs.resend(e).then(r)})}}},l.directive("tgWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$translate",c]),o=function(t,a,c,e,u){return{link:function(r,t,e){r.$eval(e.tgWebhook);var n,i=t.find(".new-webhook-form"),o=t.find(".add-webhook"),s=function(){return r.newValue={name:"",url:"",key:""}};return s(),r.$watch("webhooks",function(t){if(null!=t)return 0===t.length?(i.removeClass("hidden"),o.addClass("hidden"),i.find("input")[0].focus()):(i.addClass("hidden"),o.removeClass("hidden"))}),n=g(2e3,function(){var t,e=i.checksley();if(e.validate())return r.newValue.project=r.project.id,(t=a.create("webhooks",r.newValue)).then(function(){return u.trackEvent("webhooks","create","Create new webhook",1),r.$emit("webhooks:reload"),s()}),t.then(null,function(t){return c.notify("error"),e.setErrors(t)})}),i.on("click",".add-new",function(t){return t.preventDefault(),n()}),i.on("keyup","input",function(t){if(13===t.keyCode)return n()}),i.on("click",".cancel-new",function(t){return r.$apply(function(){if(s(),1<=r.webhooks.length)return i.addClass("hidden")})}),o.on("click",function(t){return i.removeClass("hidden"),i.find("input")[0].focus()})}}},l.directive("tgNewWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",o]),f=u(p.Controller,p.PageMixin,p.FiltersMixin),t(k,f),k.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],k.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"github").then((e=this,function(t){return e.scope.github=t}));var e},k.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},k.prototype.loadInitialData=function(){this.loadProject();return this.loadModules()},l.controller("GithubController",k),v=u(p.Controller,p.PageMixin,p.FiltersMixin),t(I,v),I.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],I.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gitlab").then((e=this,function(t){return e.scope.gitlab=t}));var e},I.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},I.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},l.controller("GitlabController",I),y=u(p.Controller,p.PageMixin,p.FiltersMixin),t(E,y),E.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],E.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"bitbucket").then((e=this,function(t){return e.scope.bitbucket=t}));var e},E.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},E.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},l.controller("BitbucketController",E),s=function(n,i){return{link:function(t,e,r){return e.on("click",".select-input-content",function(){var t=e.find("input");if(t.val())return t.select(),document.execCommand("copy"),i.notify("success",n.instant("COMMON.COPIED_TO_CLIPBOARD"))})}}},l.directive("tgSelectInputText",["$translate","$tgConfirm",s]),r=function(s,a,c,u){return{link:function(n,t,e){var i=t.find("form").checksley({onlyOneErrorElement:!0}),r=g(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return e=c().target(o).start(),(r=s.saveAttribute(n.github,"github")).then(function(){return u.trackEvent("github-webhook","created-or-changed","Create or changed github webhook",1),e.finish(),a.notify("success")}),r.then(null,function(t){if(e.finish(),i.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",r)}}},l.directive("tgGithubWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",r]),n=function(s,a,c,u){return{link:function(n,t,e){var i=t.find("form").checksley({onlyOneErrorElement:!0}),r=g(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return e=c().target(o).start(),(r=s.saveAttribute(n.gitlab,"gitlab")).then(function(){return u.trackEvent("gitlab-webhook","created-or-changed","Create or changed gitlab webhook",1),e.finish(),a.notify("success"),n.$emit("project:modules:reload")}),r.then(null,function(t){if(e.finish(),i.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",r)}}},l.directive("tgGitlabWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),e=function(s,a,c,u){return{link:function(n,t,e){var i=t.find("form").checksley({onlyOneErrorElement:!0}),r=g(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return e=c().target(o).start(),(r=s.saveAttribute(n.bitbucket,"bitbucket")).then(function(){return u.trackEvent("bitbucket-webhook","created-or-changed","Create or changed bitbucket webhook",1),e.finish(),a.notify("success"),n.$emit("project:modules:reload")}),r.then(null,function(t){if(e.finish(),i.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",r)}}},l.directive("tgBitbucketWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",e]),a=function(){return{link:function(t,e,r,n){return n.$parsers.push(function(t){return""===(t=$.trim(t))?[]:t.split(",")})},restrict:"EA",require:"ngModel"}},l.directive("tgValidOriginIps",a),b=u(p.Controller,p.PageMixin,p.FiltersMixin),t(T,b),T.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],T.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gogs").then((e=this,function(t){return e.scope.gogs=t}));var e},T.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},T.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},i=function(s,a,c,u){return{link:function(n,t,e){var i=t.find("form").checksley({onlyOneErrorElement:!0}),r=g(2e3,function(t){var e,r;if(t.preventDefault(),i.validate())return e=c().target(o).start(),(r=s.saveAttribute(n.gogs,"gogs")).then(function(){return u.trackEvent("gogs-webhook","create-or-change","Create or change gogs webhook",1),e.finish(),a.notify("success"),n.$emit("project:modules:reload")}),r.then(null,function(t){if(e.finish(),i.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",r),t.on("click",".submit-button",r)}}},l.controller("GogsController",T),l.directive("tgGogsWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",i])}.call(this),function(){this.taiga,this.taiga.bindOnce,this.taiga.timeout,this.taiga.debounce;var t=function(o,s,t,a,c,u,l,p,d,h){return{link:function(t,r,e){var n,i=null;return t.$on("deletelightbox:new",function(t,e){return l.open(r),i=e}),t.$on("$destroy",function(){return r.off()}),n=function(){var t;return p.start(),l.close(r),(t=o.remove(i)).then(function(t){return h.trackEvent("projects","delete","Delete project",1),p.pageLoaded(),s.$broadcast("projects:reload"),a.path(c.resolve("home")),u.notify("success"),d.loadProjects()}),t.then(null,function(){return u.notify("error"),l.close(r)})},r.on("click",".button-red",function(t){return t.preventDefault(),l.close(r)}),r.on("click",".button-green",function(t){return t.preventDefault(),n()})}}};angular.module("taigaProject").directive("tgLbDeleteProject",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","$tgConfirm","lightboxService","tgLoader","tgCurrentUserService","$tgAnalytics",t])}.call(this),function(){var n=this.taiga.bindOnce,t=function(){return{link:function(t,e,r){return n(t,r.tgBoBind,function(t){return e.text(t)})}}},e=function(){return{link:function(t,e,r){return n(t,r.tgBoHtml,function(t){return e.html(t)})}}},r=function(){return{link:function(t,e,r){return n(t,r.tgBoRef,function(t){return e.html("#"+t+" ")})}}},i=function(){return{link:function(t,e,r){return n(t,r.tgBoSrc,function(t){return e.attr("src",t)})}}},o=function(){return{link:function(t,e,r){return n(t,r.tgBoHref,function(t){return e.attr("href",t)})}}},s=function(){return{link:function(t,e,r){return n(t,r.tgBoAlt,function(t){return e.attr("alt",t)})}}},a=function(){return{link:function(t,e,r){return n(t,r.tgBoTitle,function(t){return e.attr("title",t)})}}},c=function(){return{link:function(t,e,r){return t.$watch(r.tgTitleHtml,function(t){if(null!=t)return e.attr("title",t)})}}},u=function(){return{link:function(t,e,r){return t.$watch(r.tgBindHtml,function(t){if(null!=t)return e.html(t)})}}},l=angular.module("taigaBase");l.directive("tgBoBind",t),l.directive("tgBoHtml",e),l.directive("tgBoRef",r),l.directive("tgBoSrc",i),l.directive("tgBoHref",o),l.directive("tgBoAlt",s),l.directive("tgBoTitle",a),l.directive("tgBindTitle",c),l.directive("tgBindHtml",u)}.call(this),function(){var t;function e(){this.config=window.taigaConfig}e.prototype.get=function(t,e){return null==e&&(e=null),_.has(this.config,t)?this.config[t]:e},t=e,angular.module("taigaBase").service("$tgConfig",t)}.call(this),function(){function t(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s){this.rootScope=t,this.scope=e,this.params=r,this.repo=n,this.rs=i,this.confirm=o,this.projectService=s,this.scope.currentPlugin=_.head(_.filter(this.rootScope.adminPlugins,{slug:this.params.plugin})),this.scope.projectSlug=this.params.pslug,this.loadInitialData()}function s(t,e,r){this.rootScope=t,this.scope=e,this.params=r,this.scope.currentPlugin=_.head(_.filter(this.rootScope.userSettingsPlugins,{slug:this.params.plugin}))}e=angular.module("taigaBase"),r=taiga.Controller,t(o,r),o.$inject=["$rootScope","$scope","$routeParams","$tgRepo","$tgResources","$tgConfirm","tgProjectService"],o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.$broadcast("project:loaded",t),t},o.prototype.loadInitialData=function(){return this.loadProject()},e.controller("ContribController",o),n=taiga.Controller,t(s,n),s.$inject=["$rootScope","$scope","$routeParams"],e.controller("ContribUserSettingsController",s)}.call(this),function(){var i={}.hasOwnProperty;function t(t,e){this.storage=t,this.params=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(t,this.taiga.Service),t.$inject=["$tgStorage","$routeParams"],t.prototype.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))}}.call(this),function(){var t,i={}.hasOwnProperty;function a(t,e,r,n,i,o,s){this.http=t,this.q=e,this.tgLoader=r,this.storage=n,this.rootScope=i,this.cacheFactory=o,this.translate=s,a.__super__.constructor.call(this),this.cache=this.cacheFactory("httpget")}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(a,this.taiga.Service),a.$inject=["$http","$q","tgLoader","$tgStorage","$rootScope","$cacheFactory","$translate"],a.prototype.headers=function(){var t,e={},r=this.storage.get("token");return r&&(e.Authorization="Bearer "+r),(t=this.translate.preferredLanguage())&&(e["Accept-Language"]=t),e},a.prototype.request=function(t){return t.headers=_.assign({},t.headers||{},this.headers()),this.http(t)},a.prototype.get=function(t,e,r){return r=_.assign({method:"GET",url:t},r),e&&(r.params=e),r.cache=this.cache,this.request(r).finally((n=this,function(t){return n.cache.removeAll()}));var n},a.prototype.post=function(t,e,r,n){return n=_.assign({method:"POST",url:t},n),e&&(n.data=e),r&&(n.params=r),n.responseType="text",this.request(n)},a.prototype.put=function(t,e,r,n){return n=_.assign({method:"PUT",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},a.prototype.patch=function(t,e,r,n){return n=_.assign({method:"PATCH",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},a.prototype.delete=function(t,e,r,n){return n=_.assign({method:"DELETE",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},t=a,angular.module("taigaBase").service("$tgHttp",t)}.call(this),function(){var t=function(n,i,t){return n.noreload=function(t){var e=i.current,r=t.$on("$locationChangeSuccess",function(){return i.current=e,r()});return n},n.isInCurrentRouteParams=function(t,e){return(n.search()||{})[t]===e},n};angular.module("taigaBase").factory("$tgLocation",["$location","$route","$rootScope",t])}.call(this),function(){var o,t,e=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},i={}.hasOwnProperty;function r(t,e,r){this._attrs=e,this._name=t,this._dataTypes=r,this.setAttrs(e),this.initialize()}function s(t,e,r,n){this.q=t,this.urls=e,this.storage=r,this.http=n,s.__super__.constructor.call(this)}r.prototype.realClone=function(){var t=_.cloneDeep(this._attrs),e=new r(this._name,t,this._dataTypes);return e._modifiedAttrs=_.cloneDeep(this._modifiedAttrs),e._isModified=_.cloneDeep(this._isModified),e},r.prototype.clone=function(){var t=new r(this._name,this._attrs,this._dataTypes);return t._modifiedAttrs=this._modifiedAttrs,t._isModified=this._isModified,t},r.prototype.applyCasts=function(){var t,e,r,n=this._dataTypes,i=[];for(t in n)r=n[t],(e=service.casts[r])&&i.push(this._attrs[t]=e(this._attrs[t]));return i},r.prototype.getIdAttrName=function(){return"id"},r.prototype.getName=function(){return this._name},r.prototype.getAttrs=function(t){return null==t&&(t=!1),null!=this._attrs.version&&(this._modifiedAttrs.version=this._attrs.version),t?_.extend({},this._modifiedAttrs):_.extend({},this._attrs,this._modifiedAttrs)},r.prototype.setAttrs=function(t){return this._attrs=t,this._modifiedAttrs={},this.applyCasts(),this._isModified=!1},r.prototype.setAttr=function(t,e){return this._modifiedAttrs[t]=e,this._isModified=!0},r.prototype.initialize=function(){var n=this,i=function(t){return function(){return"string"==typeof t&&"__"===t.substr(0,2)?n[t]:e.call(_.keys(n._modifiedAttrs),t)<0?n._attrs[t]:n._modifiedAttrs[t]}},o=function(e){return function(t){"string"!=typeof e||"__"!==e.substr(0,2)?n._attrs[e]!==t?(n._modifiedAttrs[e]=t,n._isModified=!0):delete n._modifiedAttrs[e]:n[e]=t}};return _.each(this._attrs,function(t,e){var r={get:i(e),set:o(e),enumerable:!0,configurable:!0};return Object.defineProperty(n,e,r)})},r.prototype.serialize=function(){var t={data:_.clone(this._attrs),name:this._name};return JSON.stringify(t)},r.prototype.isModified=function(){return this._isModified},r.prototype.isAttributeModified=function(t){return null!=this._modifiedAttrs[t]},r.prototype.markSaved=function(){return this._isModified=!1,this._attrs=this.getAttrs(),this._modifiedAttrs={}},r.prototype.revert=function(){return this._modifiedAttrs={},this._isModified=!1},r.desSerialize=function(t){var e=JSON.parse(t);return new r(e.url,e.data)},o=r,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(s,this.taiga.Service),s.$inject=["$q","$tgUrls","$tgStorage","$tgHttp"],t=function(t,e,r,n){var i={make_model:function(t,e,r,n){return null==r&&(r=o),null==n&&(n={}),new r(t,e,n)}};return i.cls=o,i.casts={int:function(t){return parseInt(t,10)},float:function(t){return parseFloat(t,10)}},i},angular.module("taigaBase").factory("$tgModel",["$q","$http","$tgUrls","$tgStorage",t])}.call(this),function(){var t,n,e,r,v,i={}.hasOwnProperty;function o(){this.urls={}}r=this.taiga,v=this.taiga.trim,n=this.taiga.bindOnce,e=angular.module("taigaBase"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,r.Service),o.prototype.update=function(t){return this.urls=_.merge({},this.urls,t||{})},o.prototype.formatUrl=function(t,e){var r;return null==e&&(e={}),r=function(t){return t=v(t,":"),e[t]||"undefined"},t.replace(/(:\w+)/g,r)},o.prototype.resolve=function(t,e){var r=this.urls[t];return r?e?this.formatUrl(r,e):r:""},e.service("$tgNavUrls",o),t=function(d,h,l,f,g,m){var p=function(t,e){var r=l.defer();return n(t,e,function(t){return r.resolve(t)}),r.promise},e=function(t,s){var e,r,n,i,o,a=_.map(t.split(":"),v),c=a[0],u=a[1];if(u)for(i=u.split(/(\w+)=/),i=_.filter(i,function(t){return t.length}),i=_.map(i,function(t){return v(t.replace(/,$/g,""))}),u=[],e=0;e<i.length;)(r={})[i[e]]=i[e+1],u.push(r),e+=2;else u=[];return o=_.map(u,function(t){return _.values(t)[0]}),n=_.map(o,function(t){return p(s,t)}),l.all(n).then(function(){for(var t,e,r,n={},i=0,o=u.length;i<o;i++)r=(e=u[i])[t=Object.keys(e)[0]],n[t]=s.$eval(r);return[c,n]})};return{link:function(u,l,p){return l.is("a")&&l.attr("href","#"),l.on("mouseenter",function(t){var c=$(t.currentTarget);if(!c.data("fullUrl")||p.tgNavGetParams!==c.data("params"))return e(p.tgNav,u).then(function(t){var e,r,n,i,o=t[0],s=t[1],a=h.getUser();return a&&(s.user=a.username),"project"===o&&(o=o+"-"+m.getPath(s.project,s.section)),i=d.resolve(o),e=d.formatUrl(i,s),p.tgNavGetParams&&(r=JSON.parse(p.tgNavGetParams),n=$.param(r),e=e+"?"+n,c.data("params",p.tgNavGetParams)),c.data("fullUrl",e),c.is("a")&&c.attr("href",e),l.on("click",function(t){if(!t.metaKey&&!t.ctrlKey&&(t.preventDefault(),!(c=$(t.currentTarget)).hasClass("noclick"))){switch(e=c.data("fullUrl"),t.which){case 1:f.url(e),u.$apply();break;case 2:window.open(e)}return g.closeAll()}})})}),u.$on("$destroy",function(){return l.off()})}}},e.directive("tgNav",["$tgNavUrls","$tgAuth","$q","$tgLocation","lightboxService","$tgSections",t])}.call(this),function(){var t,i={}.hasOwnProperty;function o(t,e,r,n,i){this.q=t,this.model=e,this.storage=r,this.http=n,this.urls=i,o.__super__.constructor.call(this)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(o,this.taiga.Service),o.$inject=["$q","$tgModel","$tgStorage","$tgHttp","$tgUrls"],o.prototype.resolveUrlForModel=function(t){var e=t.getIdAttrName();return this.urls.resolve(t.getName())+"/"+t[e]},o.prototype.resolveUrlForAttributeModel=function(t){return this.urls.resolve(t.getName(),t.parent)},o.prototype.create=function(r,t,n,e){var i,o,s,a;return null==n&&(n={}),null==e&&(e={}),i=this.q.defer(),s=this.urls.resolve(r),(o=this.http.post(s,JSON.stringify(t),e)).success((a=this,function(t,e){return i.resolve(a.model.make_model(r,t,null,n))})),o.error(function(t,e){return i.reject(t)}),i.promise},o.prototype.remove=function(r,t){var n,e,i;return null==t&&(t={}),n=this.q.defer(),i=this.resolveUrlForModel(r),(e=this.http.delete(i,{},t)).success(function(t,e){return n.resolve(r)}),e.error(function(t,e){return n.reject(r)}),n.promise},o.prototype.saveAll=function(t,e){var r,n;return null==e&&(e=!0),r=_.map(t,(n=this,function(t){return n.save(t,!0)})),this.q.all(r)},o.prototype.save=function(i,t,e,r,o){var n,s,a,c;return null==t&&(t=!0),null==e&&(e={}),null==o&&(o=!1),s=this.q.defer(),!i.isModified()&&t?s.resolve(i):(c=this.resolveUrlForModel(i),n=JSON.stringify(i.getAttrs(t)),(a=t?this.http.patch(c,n,e,r):this.http.put(c,n,e,r)).success(function(t,e,r,n){return i._isModified=!1,i._attrs=_.extend(i.getAttrs(),t),i._modifiedAttrs={},i.applyCasts(),o?s.resolve([i,r()]):s.resolve(i)}),a.error(function(t,e){return s.reject(t)})),s.promise},o.prototype.saveAttribute=function(r,t,e){var n,i,o,s;return null==e&&(e=!0),i=this.q.defer(),null!=r&&r.isModified()||!e?(s=this.resolveUrlForAttributeModel(r),(n={})[t]=r.getAttrs(),(o=e?this.http.patch(s,n):this.http.put(s,n)).success(function(t,e){return r._isModified=!1,r._attrs=_.extend(r.getAttrs(),t),r._modifiedAttrs={},r.applyCasts(),i.resolve(r)}),o.error(function(t,e){return i.reject(t)})):i.resolve(r),i.promise},o.prototype.refresh=function(r){var n=this.q.defer(),t=this.resolveUrlForModel(r),e=this.http.get(t);return e.success(function(t,e){return r._modifiedAttrs={},r._attrs=t,r._isModified=!1,r.applyCasts(),n.resolve(r)}),e.error(function(t,e){return n.reject(t)}),n.promise},o.prototype.queryMany=function(r,t,e,n){var i,o,s;return null==e&&(e={}),null==n&&(n=!1),o=this.urls.resolve(r),i={headers:{}},e.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,t,i).then((s=this,function(t){var e=_.map(t.data,function(t){return s.model.make_model(r,t)});return n?[e,t.headers]:e}))},o.prototype.queryOneAttribute=function(r,n,i,t,e){var o,s,a;return null==e&&(e={}),s=this.urls.resolve(r,n),o={headers:{}},e.enablePagination||(o.headers["x-disable-pagination"]="1"),this.http.get(s,t,o).then((a=this,function(t){var e=a.model.make_model(r,t.data[i]);return e.parent=n,e}))},o.prototype.queryOne=function(e,t,r,n){var i,o,s;return null==n&&(n={}),o=this.urls.resolve(e),t&&(o=o+"/"+t),i={headers:{}},n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then((s=this,function(t){return s.model.make_model(e,t.data)}))},o.prototype.queryOneRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then(function(t){return t.data})},o.prototype.queryPaginated=function(n,t,e){var r,i,o;return null==e&&(e={}),i=this.urls.resolve(n),r=_.merge({headers:{}},e),this.http.get(i,t,r).then((o=this,function(t){var e=t.headers(),r={};return r.models=_.map(t.data,function(t){return o.model.make_model(n,t)}),r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r}))},o.prototype.queryOnePaginatedRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),this.http.get(o,r,i).then(function(t){var e=t.headers(),r={};return r.data=t.data,r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r})},o.prototype.resolve=function(t){var e,r={};return null!=t.pslug&&(r.project=t.pslug),null!=t.usref&&(r.us=t.usref),null!=t.taskref&&(r.task=t.taskref),null!=t.issueref&&(r.issue=t.issueref),null!=t.sslug&&(r.milestone=t.sslug),null!=t.wikipage&&(r.wikipage=t.wikipage),null!=t.ref&&(r.ref=t.ref),e=!(t.wikipage||t.sslug),this.queryOneRaw("resolver",null,r,{cache:e})},t=o,angular.module("taigaBase").service("$tgRepo",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){e.__super__.constructor.call(this)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["$rootScope"],e.prototype.get=function(t,e){var r=localStorage.getItem(t);return null===r?e||null:JSON.parse(r)},e.prototype.set=function(t,e){return _.isObject(t)?_.each(t,(r=this,function(t,e){return r.set(e,t)})):localStorage.setItem(t,JSON.stringify(e));var r},e.prototype.contains=function(t){return null!==this.get(t)},e.prototype.remove=function(t){return localStorage.removeItem(t)},e.prototype.clear=function(){return localStorage.clear()},t=e,angular.module("taigaBase").service("$tgStorage",t)}.call(this),function(){var t,n,i={}.hasOwnProperty;function e(t){this.config=t,this.urls={},this.mainUrl=this.config.get("api")}n=function(t,e){return e=_.clone(e),t.replace(/%s/g,function(t){return String(e.shift())})},function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,this.taiga.Service),e.$inject=["$tgConfig"],e.prototype.update=function(t){return this.urls=_.merge(this.urls,t)},e.prototype.resolve=function(){var t,e,r=_.toArray(arguments);if(0===r.length)throw Error("wrong arguments to setUrls");return t=r.slice(0,1)[0],e=n(this.urls[t],r.slice(1)),n("%s/%s",[_.trimEnd(this.mainUrl,"/"),_.trimStart(e,"/")])},e.prototype.resolveAbsolute=function(){var t=this.resolve.apply(this,arguments);return/^https?:\/\//i.test(t)?t:/^\//.test(t)?window.location.protocol+"//"+window.location.host+t:window.location.protocol+"//"+window.location.host+"/"+t},t=e,angular.module("taigaBase").service("$tgUrls",t)}.call(this),function(){this.taiga;var t=function(r){var e=function(t,e){return r.queryOne(e,t)},n={epic:{get:function(t){return e(t,"custom-attributes-values/epic")}},userstory:{get:function(t){return e(t,"custom-attributes-values/userstory")}},task:{get:function(t){return e(t,"custom-attributes-values/task")}},issue:{get:function(t){return e(t,"custom-attributes-values/issue")}}};return function(t){return t.customAttributesValues=n}};angular.module("taigaResources").factory("$tgCustomAttributesValuesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(r){var e=function(t,e){return r.queryMany(e,{project:t})},n={epic:{list:function(t){return e(t,"custom-attributes/epic")}},userstory:{list:function(t){return e(t,"custom-attributes/userstory")}},task:{list:function(t){return e(t,"custom-attributes/task")}},issue:{list:function(t){return e(t,"custom-attributes/issue")}}};return function(t){return t.customAttributes=n}};angular.module("taigaResources").factory("$tgCustomAttributesResourcesProvider",["$tgRepo",t])}.call(this),function(){var c=this.taiga.generateHash,t=function(n,r,i,o){var s={},a="epics-queryparams";return s.getByRef=function(t,e){var r=s.getQueryParams(t);return r.project=t,r.ref=e,n.queryOne("epics","by_ref",r)},s.listValues=function(t,e){var r={project:t};return s.storeQueryParams(t,r),n.queryMany(e,r)},s.storeQueryParams=function(t,e){var r=c([t,t+":"+a]);return o.set(r,e)},s.getQueryParams=function(t){var e=c([t,t+":"+a]);return o.get(e)||{}},s.upvote=function(t){var e=i.resolve("epic-upvote",t);return r.post(e)},s.downvote=function(t){var e=i.resolve("epic-downvote",t);return r.post(e)},s.watch=function(t){var e=i.resolve("epic-watch",t);return r.post(e)},s.unwatch=function(t){var e=i.resolve("epic-unwatch",t);return r.post(e)},function(t){return t.epics=s}};angular.module("taigaResources").factory("$tgEpicsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",t])}.call(this),function(){this.taiga;var t=function(n,a,c){var e={get:function(t,e,r){return n.queryOneRaw("history/"+t,e,{type:r})},editComment:function(t,e,r,n){var i,o,s=c.resolve("history/"+t);return s=s+"/"+e+"/edit_comment",o={id:r},i={comment:n},a.post(s,i,o).then(function(t){return t.data})},getCommentHistory:function(t,e,r){var n,i=c.resolve("history/"+t);return i=i+"/"+e+"/comment_versions",n={id:r},a.get(i,n).then(function(t){return t.data})},deleteComment:function(t,e,r){var n,i=c.resolve("history/"+t);return i=i+"/"+e+"/delete_comment",n={id:r},a.post(i,null,n).then(function(t){return t.data})},undeleteComment:function(t,e,r){var n,i=c.resolve("history/"+t);return i=i+"/"+e+"/undelete_comment",n={id:r},a.post(i,null,n).then(function(t){return t.data})}};return function(t){return t.history=e}};angular.module("taigaResources").factory("$tgHistoryResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var t=function(e){var r={get:function(t){return e.queryOne("invitations",t)}};return function(t){return t.invitations=r}};angular.module("taigaResources").factory("$tgInvitationsResourcesProvider",["$tgRepo",t])}.call(this),function(){var u=this.taiga.generateHash,t=function(i,o,s,n,t){var a={},c="issues-queryparams";return a.get=function(t,e){var r=a.getQueryParams(t);return r.project=t,i.queryOne("issues",e,r)},a.getByRef=function(t,e){var r=a.getQueryParams(t);return r.project=t,r.ref=e,i.queryOne("issues","by_ref",r)},a.listInAllProjects=function(t){return i.queryMany("issues",t)},a.list=function(t,e,r){var n={project:t};return n=_.extend({},n,e||{}),a.storeQueryParams(t,n),i.queryPaginated("issues",n,r)},a.listInProject=function(t,e,r){return null==e&&(e=null),r=_.merge(r,{project:t}),e&&(r.milestone=e),a.storeQueryParams(t,r),i.queryMany("issues",r)},a.bulkCreate=function(t,e,r){var n=s.resolve("bulk-create-issues"),i={project_id:t,milestone_id:e,bulk_issues:r};return o.post(n,i)},a.upvote=function(t){var e=s.resolve("issue-upvote",t);return o.post(e)},a.downvote=function(t){var e=s.resolve("issue-downvote",t);return o.post(e)},a.watch=function(t){var e=s.resolve("issue-watch",t);return o.post(e)},a.unwatch=function(t){var e=s.resolve("issue-unwatch",t);return o.post(e)},a.stats=function(t){return i.queryOneRaw("projects",t+"/issues_stats")},a.filtersData=function(t){return i.queryOneRaw("issues-filters",null,t)},a.listValues=function(t,e){var r={project:t};return a.storeQueryParams(t,r),i.queryMany(e,r)},a.createDefaultValues=function(t,e){var r={project_id:t},n=s.resolve(e+"-create-default");return o.post(n,r)},a.storeQueryParams=function(t,e){var r=u([t,t+":"+c]);return n.set(r,e)},a.getQueryParams=function(t){var e=u([t,t+":"+c]);return n.get(e)||{}},a.bulkUpdateMilestone=function(t,e,r){var n=s.resolve("bulk-update-issue-milestone"),i={project_id:t,milestone_id:e,bulk_issues:r};return o.post(n,i)},a.promoteToUserStory=function(t,e){var r=s.resolve("promote-issue-to-us",t),n={project_id:e};return o.post(r,n)},function(t){return t.issues=a}};angular.module("taigaResources").factory("$tgIssuesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",t])}.call(this),function(){var o=this.taiga.generateHash,t=function(n){var e={},i="kanban-statuscolumnmodels";return e.storeStatusColumnModes=function(t,e){var r=o([t,t+":"+i]);return n.set(r,e)},e.getStatusColumnModes=function(t){var e=o([t,t+":"+i]);return n.get(e)||{}},function(t){return t.kanban=e}};angular.module("taigaResources").factory("$tgKanbanResourcesProvider",["$tgStorage",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(t){var e={list:function(){return t.queryMany("locales")}};return function(t){return t.locales=e}};angular.module("taigaResources").factory("$tgLocalesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga;var t=function(t,i,o){var e={render:function(t,e){var r,n;return null!=e&&""!==e||(e=" "),r={project_id:t,content:e},n=i.resolve("wiki"),o.post(n+"/render",r).then(function(t){return t.data})}};return function(t){return t.mdrender=e}};angular.module("taigaResources").factory("$tgMdRenderResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){this.taiga;var t=function(i,o,s){var e={get:function(t){return i.queryOne("memberships",t)},list:function(t,e,r){var n;return null==r&&(r=!0),n={project:t},n=_.extend({},n,e||{}),r?i.queryPaginated("memberships",n):i.queryMany("memberships",n,{enablePagination:r})},listByUser:function(t,e){var r={user:t};return r=_.extend({},r,e||{}),i.queryPaginated("memberships",r)},resendInvitation:function(t){var e=s.resolve("memberships");return o.post(e+"/"+t+"/resend_invitation",{})},bulkCreateMemberships:function(t,e,r){var n=s.resolve("bulk-create-memberships"),i={project_id:t,bulk_memberships:e,invitation_extra_text:r};return o.post(n,i)}};return function(t){return t.memberships=e}};angular.module("taigaResources").factory("$tgMembershipsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t=function(r){var e={list:function(t,e){return r.queryOneAttribute("project-modules",t,e)}};return function(t){return t.modules=e}};angular.module("taigaResources").factory("$tgModulesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga;var t=function(r,t,e){var n={get:function(t){return r.queryOne("notify-policies",t)},list:function(t){var e=_.extend({},void 0,t||{});return r.queryMany("notify-policies",e)}};return function(t){return t.notifyPolicies=n}};angular.module("taigaResources").factory("$tgNotifyPoliciesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var y=this.taiga.sizeFormat,t=function(h,r,c,f,g,m,v){var e={get:function(t){return r.queryOne("projects",t)},getBySlug:function(t){return r.queryOne("projects","by_slug?slug="+t)},list:function(t){var e={order_by:"user_order"};return e=_.extend({},e,t||{}),r.queryMany("projects",e)},listByMember:function(t){var e={member:t,order_by:"user_order"};return r.queryMany("projects",e)},templates:function(){return r.queryMany("project-templates")},usersList:function(t){var e={project:t};return r.queryMany("users",e)},rolesList:function(t){var e={project:t};return r.queryMany("roles",e)},stats:function(t){return r.queryOneRaw("projects",t+"/stats")},bulkUpdateOrder:function(t){var e=f.resolve("bulk-update-projects-order");return c.post(e,t)},regenerate_epics_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/regenerate_epics_csv_uuid";return c.post(e)},regenerate_userstories_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/regenerate_userstories_csv_uuid";return c.post(e)},regenerate_tasks_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/regenerate_tasks_csv_uuid";return c.post(e)},regenerate_issues_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/regenerate_issues_csv_uuid";return c.post(e)},delete_epics_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/delete_epics_csv_uuid";return c.post(e)},delete_userstories_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/delete_userstories_csv_uuid";return c.post(e)},delete_tasks_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/delete_tasks_csv_uuid";return c.post(e)},delete_issues_csv_uuid:function(t){var e=f.resolve("projects")+"/"+t+"/delete_issues_csv_uuid";return c.post(e)},leave:function(t){var e=f.resolve("projects")+"/"+t+"/leave";return c.post(e)},memberStats:function(t){return r.queryOneRaw("projects",t+"/member_stats")},tagsColors:function(t){return r.queryOne("projects",t+"/tags_colors")},deleteTag:function(t,e){var r=f.resolve("projects")+"/"+t+"/delete_tag";return c.post(r,{tag:e})},createTag:function(t,e,r){var n=f.resolve("projects")+"/"+t+"/create_tag",i={};return i.tag=e,i.color=null,r&&(i.color=r),c.post(n,i)},editTag:function(t,e,r,n){var i=f.resolve("projects")+"/"+t+"/edit_tag",o={};return o.from_tag=e,r&&(o.to_tag=r),o.color=null,n&&(o.color=n),c.post(i,o)},mixTags:function(t,e,r){var n=f.resolve("projects")+"/"+t+"/mix_tags";return c.post(n,{to_tag:e,from_tags:r})},export:function(t){var e=f.resolve("exporter")+"/"+t;return c.get(e)},import:function(t,n){var e,r,i,o,s,a,c,u,l,p=m.defer(),d=h.get("maxUploadFileSize",null);return d&&t.size>d?(i=v.instant("PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:y(t.size),maxFileSize:y(d)}),s={status:413,data:{_error_message:i}},p.reject(s)):(u=function(t){var e=Math.round(t.loaded/t.total*100),r=v.instant("PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE",{uploadedSize:y(t.loaded),totalSize:y(t.total)});return n("in-progress",null,r,e)},a=function(t){return n("done",v.instant("PROJECT.IMPORT.TITLE"),v.instant("PROJECT.IMPORT.DESCRIPTION"))},c=function(t){return n("error")},e=function(t){var e;s={};try{s.data=JSON.parse(t.target.responseText)}catch(t){s.data={}}return s.status=t.target.status,t.target.getResponseHeader("Taiga-Info-Project-Is-Private")&&(s.headers={isPrivate:"True"===t.target.getResponseHeader("Taiga-Info-Project-Is-Private"),memberships:parseInt(t.target.getResponseHeader("Taiga-Info-Project-Memberships"))}),201!==(e=s.status)&&202!==e||p.resolve(s),p.reject(s)},o=function(t){return p.reject("fail")},(r=new FormData).append("dump",t),(l=new XMLHttpRequest).upload.addEventListener("progress",u,!1),l.upload.addEventListener("load",a,!1),l.upload.addEventListener("error",c,!1),l.upload.addEventListener("abort",c,!1),l.addEventListener("load",e,!1),l.addEventListener("error",o,!1),l.open("POST",f.resolve("importer")),l.setRequestHeader("Authorization","Bearer "+g.getToken()),l.setRequestHeader("Accept","application/json"),l.send(r)),p.promise},changeLogo:function(t,e){var r,n,i,o,s,a=h.get("maxUploadFileSize",null);return a&&e.size>a?(o={status:413,data:{_error_message:"'"+e.name+"' ("+y(e.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+y(a)+")"}},(n=m.defer()).reject(o),n.promise):((r=new FormData).append("logo",e),i={transformRequest:angular.identity,headers:{"Content-Type":void 0}},s=f.resolve("projects")+"/"+t+"/change_logo",c.post(s,r,{},i))},removeLogo:function(t){var e=f.resolve("projects")+"/"+t+"/remove_logo";return c.post(e)}};return function(t){return t.projects=e}};angular.module("taigaResources").factory("$tgProjectsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$tgAuth","$q","$translate",t])}.call(this),function(){this.taiga;var t=function(e,t,r){var n={get:function(t){return e.queryOne("roles",t)},list:function(t){return e.queryMany("roles",{project:t})}};return function(t){return t.roles=n}};angular.module("taigaResources").factory("$tgRolesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var t=function(t,o,s,a){var e={do:function(t,e){var r=a.defer(),n={url:o.resolve("search"),method:"GET",timeout:r.promise,cancelable:!0,params:{project:t,text:e,get_all:!1}},i=s.request(n).then(function(t){return t.data});return i.abort=function(){return r.resolve()},i.finally=function(){return i.abort=angular.noop,r=i=null},i}};return function(t){return t.search=e}};angular.module("taigaResources").factory("$tgSearchResourcesProvider",["$tgRepo","$tgUrls","$tgHttp","$q",t])}.call(this),function(){this.taiga.generateHash;var t=function(n,a,t,s,c){var e={get:function(t,e){return n.queryOne("milestones",e).then(function(t){var e=t.user_stories;return e=_.map(e,function(t){return a.make_model("userstories",t)}),t._attrs.user_stories=e,t})},stats:function(t,e){return n.queryOneRaw("milestones",e+"/stats")},list:function(t,e){var r={project:t};return r=_.extend({},r,e||{}),n.queryMany("milestones",r,{},!0).then(function(t){for(var e,r,n=t[0],i=t[1],o=0,s=n.length;o<s;o++)r=(e=n[o]).user_stories,r=_.map(r,function(t){return a.make_model("userstories",t)}),e._attrs.user_stories=r;return{milestones:n,closed:parseInt(i("Taiga-Info-Total-Closed-Milestones"),10),open:parseInt(i("Taiga-Info-Total-Opened-Milestones"),10)}})},moveUserStoriesMilestone:function(t,e,r,n){var i=c.resolve("move-userstories-to-milestone",t),o={project_id:e,milestone_id:r,bulk_stories:n};return s.post(i,o)},moveTasksMilestone:function(t,e,r,n){var i=c.resolve("move-tasks-to-milestone",t),o={project_id:e,milestone_id:r,bulk_tasks:n};return s.post(i,o)},moveIssuesMilestone:function(t,e,r,n){var i=c.resolve("move-issues-to-milestone",t),o={project_id:e,milestone_id:r,bulk_issues:n};return s.post(i,o)}};return function(t){return t.sprints=e}};angular.module("taigaResources").factory("$tgSprintsResourcesProvider",["$tgRepo","$tgModel","$tgStorage","$tgHttp","$tgUrls",t])}.call(this),function(){var p=this.taiga.generateHash,t=function(i,s,a,o){var c={},n="tasks-queryparams",u="tasks-statuscolumnmodels",l="tasks-usrowmodels";return c.get=function(t,e,r){var n=c.getQueryParams(t);return n.project=t,n=_.extend({},n,r),i.queryOne("tasks",e,n)},c.getByRef=function(t,e,r){var n=c.getQueryParams(t);return n.project=t,n.ref=e,n=_.extend({},n,r),i.queryOne("tasks","by_ref",n)},c.listInAllProjects=function(t){return i.queryMany("tasks",t)},c.filtersData=function(t){return i.queryOneRaw("task-filters",null,t)},c.list=function(t,e,r,n){return null==e&&(e=null),null==r&&(r=null),n=_.merge(n,{project:t,order_by:"us_order"}),e&&(n.milestone=e),r&&(n.user_story=r),c.storeQueryParams(t,n),i.queryMany("tasks",n)},c.bulkCreate=function(t,e,r,n){var i=a.resolve("bulk-create-tasks"),o={project_id:t,milestone_id:e,us_id:r,bulk_tasks:n};return s.post(i,o).then(function(t){return t.data})},c.upvote=function(t){var e=a.resolve("task-upvote",t);return s.post(e)},c.downvote=function(t){var e=a.resolve("task-downvote",t);return s.post(e)},c.watch=function(t){var e=a.resolve("task-watch",t);return s.post(e)},c.unwatch=function(t){var e=a.resolve("task-unwatch",t);return s.post(e)},c.bulkUpdateTaskTaskboardOrder=function(t,e){var r=a.resolve("bulk-update-task-taskboard-order"),n={project_id:t,bulk_tasks:e};return s.post(r,n)},c.bulkUpdateMilestone=function(t,e,r){var n=a.resolve("bulk-update-task-milestone"),i={project_id:t,milestone_id:e,bulk_tasks:r};return s.post(n,i)},c.reorder=function(t,e,r){var n=a.resolve("tasks")+"/"+t,i={headers:{"set-orders":JSON.stringify(r)}};return s.patch(n,e,null,i).then(function(t){return t.data})},c.listValues=function(t,e){var r={project:t};return i.queryMany(e,r)},c.createDefaultValues=function(t,e){var r={project_id:t},n=a.resolve(e+"-create-default");return s.post(n,r)},c.storeQueryParams=function(t,e){var r=p([t,t+":"+n]);return o.set(r,e)},c.getQueryParams=function(t){var e=p([t,t+":"+n]);return o.get(e)||{}},c.storeStatusColumnModes=function(t,e){var r=p([t,t+":"+u]);return o.set(r,e)},c.getStatusColumnModes=function(t){var e=p([t,t+":"+u]);return o.get(e)||{}},c.storeUsRowModes=function(t,e,r){var n=p([t,e,t+":"+l]);return o.set(n,r)},c.getUsRowModes=function(t,e){var r=p([t,e,t+":"+l]);return o.get(r)||{}},c.promoteToUserStory=function(t,e){var r=a.resolve("promote-task-to-us",t),n={project_id:e};return s.post(r,n)},function(t){return t.tasks=c}};angular.module("taigaResources").factory("$tgTasksResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",t])}.call(this),function(){this.taiga;var t=function(r,t,e){var n={get:function(t){return r.queryOne("user-project-settings",t)},list:function(t){var e=_.extend({},void 0,t||{});return r.queryMany("user-project-settings",e)}};return function(t){return t.userProjectSettings=n}};angular.module("taigaResources").factory("$tgUserProjectSettingsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var p=this.taiga.sizeFormat,t=function(a,t,c,u,l){var e={changeAvatar:function(t){var e,r,n,i,o,s=a.get("maxUploadFileSize",null);return s&&t.size>s?(i={status:413,data:{_error_message:"'"+t.name+"' ("+p(t.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+p(s)+")"}},(r=l.defer()).reject(i),r.promise):((e=new FormData).append("avatar",t),n={transformRequest:angular.identity,headers:{"Content-Type":void 0}},o=u.resolve("users")+"/change_avatar",c.post(o,e,{},n))},removeAvatar:function(){var t=u.resolve("users")+"/remove_avatar";return c.post(t)},changePassword:function(t,e){var r=u.resolve("users")+"/change_password",n={current_password:t,password:e};return c.post(r,n)}};return function(t){return t.userSettings=e}};angular.module("taigaResources").factory("$tgUserSettingsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$q",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(i,o){var e={contacts:function(t,e){var r,n;return null==e&&(e={}),n=o.resolve("user-contacts",t),r={headers:{}},e.enablePagination||(r.headers["x-disable-pagination"]="1"),i.get(n,{},r).then(function(t){return t.data})}};return function(t){return t.users=e}};angular.module("taigaResources").factory("$tgUsersResourcesProvider",["$tgHttp","$tgUrls","$q",t])}.call(this),function(){var u=this.taiga.generateHash,t=function(i,o,s,n,t){var a={},c="userstories-queryparams";return a.get=function(t,e,r){var n=a.getQueryParams(t);return n.project=t,n=_.extend({},n,r),i.queryOne("userstories",e,n)},a.getByRef=function(t,e,r){var n;return null==r&&(r={}),(n=a.getQueryParams(t)).project=t,n.ref=e,n=_.extend({},n,r),i.queryOne("userstories","by_ref",n)},a.listInAllProjects=function(t){return i.queryMany("userstories",t)},a.filtersData=function(t){return i.queryOneRaw("userstories-filters",null,t)},a.listUnassigned=function(t,e,r){var n={project:t,milestone:"null"};return n=_.extend({},n,e||{}),a.storeQueryParams(t,n),i.queryMany("userstories",_.extend(n,{page_size:r}),{enablePagination:!0},!0)},a.listAll=function(t,e){var r={project:t};return r=_.extend({},r,e||{}),a.storeQueryParams(t,r),i.queryMany("userstories",r)},a.bulkCreate=function(t,e,r){var n={project_id:t,status_id:e,bulk_stories:r},i=s.resolve("bulk-create-us");return o.post(i,n)},a.upvote=function(t){var e=s.resolve("userstory-upvote",t);return o.post(e)},a.downvote=function(t){var e=s.resolve("userstory-downvote",t);return o.post(e)},a.watch=function(t){var e=s.resolve("userstory-watch",t);return o.post(e)},a.unwatch=function(t){var e=s.resolve("userstory-unwatch",t);return o.post(e)},a.bulkUpdateBacklogOrder=function(t,e){var r=s.resolve("bulk-update-us-backlog-order"),n={project_id:t,bulk_stories:e};return o.post(r,n)},a.bulkUpdateMilestone=function(t,e,r){var n=s.resolve("bulk-update-us-milestone"),i={project_id:t,milestone_id:e,bulk_stories:r};return o.post(n,i)},a.bulkUpdateKanbanOrder=function(t,e,r){var n=s.resolve("bulk-update-us-kanban-order"),i={project_id:t,status_id:e,bulk_stories:r};return o.post(n,i)},a.listValues=function(t,e){var r={project:t};return a.storeQueryParams(t,r),i.queryMany(e,r)},a.createDefaultValues=function(t,e){var r={project_id:t},n=s.resolve(e+"-create-default");return o.post(n,r)},a.storeQueryParams=function(t,e){var r=u([t,t+":"+c]);return n.set(r,e)},a.getQueryParams=function(t){var e=u([t,t+":"+c]);return n.get(e)||{}},a.storeShowTags=function(t,e){var r=u([t,"showTags"]);return n.set(r,e)},a.getShowTags=function(t){var e=u([t,"showTags"]);return n.get(e)||null},function(t){return t.userstories=a}};angular.module("taigaResources").factory("$tgUserstoriesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",t])}.call(this),function(){var t=function(r,n,i){var e={list:function(t){var e={webhook:t};return r.queryMany("webhooklogs",e)},resend:function(t){var e=n.resolve("webhooklogs-resend",t);return i.post(e)}};return function(t){return t.webhooklogs=e}};angular.module("taigaResources").factory("$tgWebhookLogsResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){var t=function(r,n,i){var e={list:function(t){var e={project:t};return r.queryMany("webhooks",e)},test:function(t){var e=n.resolve("webhooks-test",t);return i.post(e)}};return function(t){return t.webhooks=e}};angular.module("taigaResources").factory("$tgWebhooksResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){this.taiga;var t=function(r,t,e){var n={get:function(t){return r.queryOne("wiki",t)},getBySlug:function(t,e){return r.queryOne("wiki","by_slug?project="+t+"&slug="+e)},list:function(t){return r.queryMany("wiki",{project:t})},listLinks:function(t){return r.queryMany("wiki-links",{project:t})}};return function(t){return t.wiki=n}};angular.module("taigaResources").factory("$tgWikiResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t,p,e,r,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.translate=l,this.scope.sectionName=this.translate.instant("CHANGE_PASSWORD.SECTION_NAME"),this.scope.user=this.auth.getUser()}n=this.taiga,e=this.taiga.mixOf,p=this.taiga.debounce,r=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,e(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],r.controller("UserChangePasswordController",o),t=function(a,c,u,l){return{link:function(n,t,e,r){var i=new checksley.Form(t.find("form")),o=p(2e3,function(t){var e,r;if(t.preventDefault(),i.validate()){if(n.newPassword1===n.newPassword2)return e=u().target(s).start(),(r=a.userSettings.changePassword(n.currentPassword,n.newPassword1)).then(function(){return e.finish(),c.notify("success")}),r.then(null,function(t){return e.finish(),c.notify("error",t.data._error_message)});c.notify("error",l.instant("CHANGE_PASSWORD.ERROR_PASSWORD_MATCH"))}}),s=t.find(".submit-button");return t.on("submit","form",o),n.$on("$destroy",function(){return t.off()})}}},r.directive("tgUserChangePassword",["$tgResources","$tgConfirm","$tgLoading","$translate",t])}.call(this),function(){this.taiga,this.taiga.bindOnce;var p=this.taiga.debounce,t=function(o,t,s,a,c,u,l){return{link:function(r,n,t){var e,i;return r.$on("deletelightbox:new",function(t,e){return u.open(n)}),r.$on("$destroy",function(){return n.off()}),e=function(){var e=l().target(i).start(),t=o.remove(r.user);return t.then(function(t){return e.finish(),u.close(n),s.logout(),a.path(c.resolve("login"))}),t.then(null,function(){return e.finish(),console.log("FAIL")})},n.on("click",".button-green",function(t){return t.preventDefault(),u.close(n)}),n.on("click",".button-red",p(2e3,function(t){return t.preventDefault(),e()})),i=n.find(".button-red")},templateUrl:"user/lightbox/lightbox-delete-account.html"}};angular.module("taigaUserSettings").directive("tgLbDeleteUser",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","lightboxService","$tgLoading",t])}.call(this),function(){var t,e,o,r,n,i,s={}.hasOwnProperty;function a(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.errorHandlingService=l,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.LIVE_SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}i=this.taiga,r=this.taiga.mixOf,o=this.taiga.bindOnce,n=angular.module("taigaUserSettings"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,r(i.Controller,i.PageMixin)),a.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","tgErrorHandlingService"],a.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},n.controller("UserLiveNotificationsController",a),t=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},n.directive("tgUserLiveNotifications",t),e=function(c,u,n){var i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.live_notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </div>\n  </div>\n  <div class="policy-table-involved">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.live_notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </div>\n  </div>\n  <div class="policy-table-none">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.live_notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(a,r,t){var e=function(){var t,e;return r.off(),t={notifyPolicies:a.notifyPolicies},e=i(t),r.html(n(e)(a)),r.on("change","input[type=radio]",function(t){var e,r,n=angular.element(t.currentTarget),i=n.parents(".policy-table-row").data("index"),o=a.notifyPolicies[i],s=o.live_notify_level;return o.live_notify_level=parseInt(n.val(),10),r=function(){return u.notify("success")},e=function(){return u.notify("error"),n.parents(".policy-table-row").find("input[value="+s+"]").prop("checked",!0)},c.save(o).then(r,e)})};return a.$on("$destroy",function(){return r.off()}),o(a,t.ngModel,e)}}},n.directive("tgUserLiveNotificationsList",["$tgRepo","$tgConfirm","$compile",e])}.call(this),function(){var t,e,r,n,i,o,m,s,a={}.hasOwnProperty;function c(t,e,r,n,i,o,s,a,c,u,l,p,d,h){var f,g;this.scope=t,this.rootscope=e,this.config=r,this.repo=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.location=c,this.navUrls=u,this.auth=l,this.translate=p,this.errorHandlingService=d,this.window=h,this.scope.sectionName="USER_SETTINGS.MENU.SECTION_TITLE",this.scope.project={},this.scope.user=this.auth.getUser(),this.scope.user?(this.scope.lang=this.getLan(),this.scope.theme=this.getTheme()):this.errorHandlingService.permissionDenied(),(f=this.config.get("maxUploadFileSize",null))&&(g=this.translate.instant("USER_SETTINGS.AVATAR_MAX_SIZE",{maxFileSize:m(f)}),this.scope.maxFileSizeMsg=g),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}s=this.taiga,i=this.taiga.mixOf,m=this.taiga.sizeFormat,o=angular.module("taigaUserSettings"),n=this.taiga.debounce,function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(c,i(s.Controller,s.PageMixin)),c.$inject=["$scope","$rootScope","$tgConfig","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate","tgErrorHandlingService","$window"],c.prototype.loadInitialData=function(){return this.scope.availableThemes=this.config.get("themes",[]),this.rs.locales.list().then((e=this,function(t){return e.scope.locales=t}));var e},c.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.user)},c.prototype.getLan=function(){return this.scope.user.lang||this.translate.preferredLanguage()},c.prototype.getTheme=function(){return this.scope.user.theme||this.config.get("defaultTheme")||"taiga"},c.prototype.exportProfile=function(){var r,t=function(t){var e=t.data.url;return this.window.open(e,"_blank")},e=function(t){var e;if(null!=(e=t.data)&&e._error_message)return r.confirm.notify("error",t.data._error_message)};return(r=this).auth.exportProfile().then(t,e)},c.prototype.verifyEmail=function(){var r,n,t=function(t){var e=r.translate.instant("USER_PROFILE.VERIFY_EMAIL_SUCCESS");return r.confirm.notify("success",e)},e=function(t){var e;if(null!=(e=t.data)&&e._error_message)return n.confirm.notify("error",t.data._error_message)};return(n=r=this).auth.sendVerificationEmail().then(t,e)},o.controller("UserSettingsController",c),r=function(a,c,u,l){return{link:function(o,s,t){var e=n(2e3,function(t){var r,e,n,i;if(t.preventDefault(),(e=s.find("form").checksley()).validate())return r=o.user.isAttributeModified("email"),o.user.lang=o.lang,o.user.theme=o.theme,i=function(t){var e;return c.setUser(t),r?(e=l.instant("USER_PROFILE.CHANGE_EMAIL_SUCCESS"),a.success(e)):a.notify("success")},n=function(t){return e.setErrors(t),a.notify("error",t._error_message)},u.save(o.user).then(i,n)});return s.on("submit","form",e),o.$on("$destroy",function(){return s.off()})}}},o.directive("tgUserProfile",["$tgConfirm","$tgAuth","$tgRepo","$translate",r]),e=function(s,a,c,u){return{link:function(r,n,t){var e=function(){return n.find(".size-info").removeClass("hidden")},i=function(t){var e=a.make_model("users",t.data);return s.setUser(e),r.user=e,n.find(".loading-overlay").removeClass("active"),u.notify("success")},o=function(t){return 413===t.status&&e(),n.find(".loading-overlay").removeClass("active"),u.notify("error",t.data._error_message)};return n.on("click",".js-change-avatar",function(){return n.find("#avatar-field").click()}),n.on("change","#avatar-field",function(t){if(r.avatarAttachment)return n.find(".loading-overlay").addClass("active"),c.userSettings.changeAvatar(r.avatarAttachment).then(i,o)}),n.on("click","a.js-use-gravatar",function(t){return n.find(".loading-overlay").addClass("active"),c.userSettings.removeAvatar().then(i,o)}),r.$on("$destroy",function(){return n.off()})}}},o.directive("tgUserAvatar",["$tgAuth","$tgModel","$tgResources","$tgConfirm",e]),t=function(i){return{link:function(t,e,r){var n=i(r.tgAvatarModel).assign;return e.bind("change",function(){return t.$apply(function(){return n(t,e[0].files[0])})})}}},o.directive("tgAvatarModel",["$parse",t])}.call(this),function(){var t=function(){return{link:function(t,e,r){var n=r.tgUserSettingsNavigation;return e.find(".active").removeClass("active"),e.find("#usersettingsmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaUserSettings").directive("tgUserSettingsNavigation",t)}.call(this),function(){var t,e,o,r,n,i,s={}.hasOwnProperty;function a(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.errorHandlingService=l,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}i=this.taiga,r=this.taiga.mixOf,o=this.taiga.bindOnce,n=angular.module("taigaUserSettings"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,r(i.Controller,i.PageMixin)),a.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","tgErrorHandlingService"],a.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},n.controller("UserNotificationsController",a),t=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},n.directive("tgUserNotifications",t),e=function(c,u,n){var i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </div>\n  </div>\n  <div class="policy-table-involved">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </div>\n  </div>\n  <div class="policy-table-none">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(a,r,t){var e=function(){var t,e;return r.off(),t={notifyPolicies:a.notifyPolicies},e=i(t),r.html(n(e)(a)),r.on("change","input[type=radio]",function(t){var e,r,n=angular.element(t.currentTarget),i=n.parents(".policy-table-row").data("index"),o=a.notifyPolicies[i],s=o.notify_level;return o.notify_level=parseInt(n.val(),10),r=function(){return u.notify("success")},e=function(){return u.notify("error"),n.parents(".policy-table-row").find("input[value="+s+"]").prop("checked",!0)},c.save(o).then(r,e)})};return a.$on("$destroy",function(){return r.off()}),o(a,t.ngModel,e)}}},n.directive("tgUserNotificationsList",["$tgRepo","$tgConfirm","$compile",e])}.call(this),function(){var t,e,r,i={}.hasOwnProperty,n=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function o(t,e,r,n,i,o,s){this.rootScope=t,this.scope=e,this.tgSections=r,this.rs=n,this.repo=i,this.confirm=o,this.currentUserService=s,this.scope.sections=this.tgSections.list(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,this.taiga.bindOnce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(r.Controller,r.PageMixin)),o.$inject=["$rootScope","$scope","$tgSections","$tgResources","$tgRepo","$tgConfirm","tgCurrentUserService"],o.prototype.loadInitialData=function(){return this.rs.userProjectSettings.list().then((e=this,function(t){return e.scope.userProjectSettings=t}));var e},o.prototype.updateCustomHomePage=function(t){var e,r,n=function(){return e.currentUserService.loadProjects(),e.rootScope.$broadcast("dropdown-project-list:updated"),e.confirm.notify("success")},i=function(){return r.confirm.notify("error")};return(r=e=this).repo.save(t).then(n,i)},o.prototype.filteredSections=function(r){return _.filter(this.scope.sections,function(t){var e=t.id;return 0<=n.call(r.allowed_sections,e)})},e.controller("UserProjectSettingsController",o)}.call(this),function(){var t,e,o,r,n,i,s={}.hasOwnProperty;function a(t,e,r){this.scope=t,this.rs=e,this.auth=r,this.scope.sectionName="USER_SETTINGS.EVENTS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}i=this.taiga,r=this.taiga.mixOf,o=this.taiga.bindOnce,n=angular.module("taigaUserSettings"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,r(i.Controller,i.PageMixin)),a.$inject=["$scope","$tgResources","$tgAuth"],a.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},n.controller("UserWebNotificationsController",a),t=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},n.directive("tgUserWebNotifications",t),e=function(a,c,n){var i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="check" data-index="<%- index %>">\n      <input type="checkbox"\n        <% if(notifyPolicy.web_notify_level) { %> checked="checked" <% } %>\n        name="policy-<%- notifyPolicy.id %>" id="policy-<%- notifyPolicy.id %>"/>\n      <div></div>\n      <span class="check-text check-yes" translate="COMMON.YES"></span>\n      <span class="check-text check-no"" translate="COMMON.NO"></span>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(s,r,t){var e=function(){var t,e;return r.off(),t={notifyPolicies:s.notifyPolicies},e=i(t),r.html(n(e)(s)),r.on("click",".check",function(t){var e,r,n=angular.element(t.currentTarget),i=n.data("index"),o=s.notifyPolicies[i];return o.web_notify_level=!o.web_notify_level,r=function(){return c.notify("success"),n.find("input").prop("checked",o.web_notify_level)},e=function(){return c.notify("error")},a.save(o).then(r,e)})};return s.$on("$destroy",function(){return r.off()}),o(s,t.ngModel,e)}}},n.directive("tgUserWebNotificationsList",["$tgRepo","$tgConfirm","$compile",e])}.call(this),function(){angular.module("taigaComponents",[])}.call(this),function(){angular.module("taigaDiscover",[])}.call(this),function(){angular.module("taigaExternalApps",[])}.call(this),function(){angular.module("taigaHistory",[])}.call(this),function(){angular.module("taigaHome",[])}.call(this),function(){angular.module("taigaNavigationBar",[])}.call(this),function(){angular.module("taigaNotifications",[])}.call(this),function(){angular.module("taigaProfile",[])}.call(this),function(){angular.module("taigaProjects",[])}.call(this),function(){angular.module("taigaResources2",[])}.call(this),function(){angular.module("taigaUserTimeline",[])}.call(this),function(){angular.module("taigaUtils",[])}.call(this),function(){angular.module("taigaWikiHistory",[])}.call(this),function(){var t=function(t,e,r,n,i,o,c,s,u,l,p){return{link:function(i,e,r,o){var n=function(){var t,e;return-1!==(null!=(t=i.project)&&null!=(e=t.my_permissions)?e.indexOf(r.requiredPerm):void 0)},s=function(t){var e,r=o.$modelValue.assigned_to,n=p.searchUsers(t);return r&&(n=_.reject(n,{id:r})),e=_.slice(n,0,5),_.map(e,function(t){return t.avatar=l.getAvatar(t)}),i.users=_.slice(n,0,5),i.showMore=5<n.length},a=function(t){var e;return null!=t&&t.assigned_to?(i.selected=t.assigned_to,e=i.usersById[i.selected],i.fullName=null!=e?e.full_name_display:void 0,i.isUnassigned=!1,i.avatar=l.getAvatar(e),i.bg=i.avatar.bg,i.isIocaine=null!=t?t.is_iocaine:void 0):(i.fullName=c.instant("COMMON.ASSIGNED_TO.ASSIGN"),i.isUnassigned=!0,i.avatar=l.getAvatar(null),i.bg=null,i.isIocaine=!1),i.fullNameVisible=!(i.isUnassigned&&!u.isAuthenticated()),i.isEditable=n()};return e.on("click",".users-search",function(t){return t.stopPropagation()}),e.on("click",".users-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),i.usersSearch="",s(),i.$apply(),e.find(".pop-users").popover().open()}),i.selfAssign=function(){return o.$modelValue.assigned_to=u.getUser().get("id"),a(o.$modelValue)},i.unassign=function(){return o.$modelValue.assigned_to=null,a()},i.$watch("usersSearch",function(t){if(null!=t)return s(t),e.find("input").focus()}),e.on("click",".user-list-single",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),o.$modelValue.assigned_to=e.data("user-id"),a(o.$modelValue),i.$apply()}),i.$watch(r.ngModel,a),i.$on("isiocaine:changed",function(t,e){return a(e)}),i.$on("$destroy",function(){return e.off()})},templateUrl:"components/assigned-inline/assigned-to-inline.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedToInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var h=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},t=function(t,e,r,n,i,o,s,a,l,p,d){return{scope:!0,link:function(i,e,t,r){var o=[],n=null,s=function(){return 0<o.length},a=function(t){var r,e=d.searchUsers(t),n=[];return _.map(e,function(t){var e=t.id;if(0<=h.call(o,e))return t.avatar=p.getAvatar(t),n.push(t)}),r=[],_.map(e,function(t){var e=t.id;if(h.call(o,e)<0)return t.avatar=p.getAvatar(t),r.push(t)}),i.selected=_.slice(n,0,5),i.selected.length<5?i.users=_.slice(r,0,5-i.selected.length):i.users=[],i.showMore=5<e.length},c=function(){var t=_.map(o,function(t){return i.usersById[t]});return t=_.filter(t,function(t){return!!t}),i.hiddenUsers=3<o.length?o.length-3:0,i.assignedUsers=_.slice(t,0,3),i.isAssigned=s()},u=function(){return _.map(o,function(t){if(!i.usersById[t])return o.splice(o.indexOf(t),1)}),0===o.length?n=null:-1!==o.indexOf(n)&&n||(n=o[0]),r.$modelValue.assigned_users?r.$modelValue.setAttr("assigned_users",o):r.$modelValue.assigned_users=o,r.$modelValue.assigned_to=n};return e.on("click",".users-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),i.usersSearch=null,a(),i.$apply(),e.find(".pop-users").popover().open()}),i.assign=function(t){return o.push(t.id),c(),u()},i.selfAssign=function(){return o.push(l.getUser().get("id")),c(),u()},i.unassign=function(t){var e=o.indexOf(t.id);return o.splice(e,1),c(),u()},e.on("click",".users-search",function(t){return t.stopPropagation()}),i.$watch("usersSearch",function(t){if(null!=t)return a(t),e.find("input").focus()}),i.$watch(t.ngModel,function(t){if(null!=t)return o=[],null!=t.assigned_users&&(o=t.assigned_users),t.assigned_to,c()}),i.$on("$destroy",function(){return e.off()})},templateUrl:"components/assigned-inline/assigned-users-inline.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedUsersInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var t=function(i,o,s){return{link:function(e,t,r){var n=i(r.tgAttachmentLink)(e);return t.on("click",function(t){return taiga.isImage(n.getIn(["file","name"]))?(t.preventDefault(),e.$apply(function(){return s.open($("tg-attachments-preview")),o.fileId=n.getIn(["file","id"])})):taiga.isPdf(n.getIn(["file","name"]))?(t.preventDefault(),window.open(n.getIn(["file","url"]))):void 0}),e.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse","tgAttachmentsPreviewService","lightboxService"],angular.module("taigaComponents").directive("tgAttachmentLink",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment-gallery.html",link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentGallery",t)}.call(this),function(){var t;function e(t,e){this.attachmentsService=t,this.translate=e,this.form={},this.form.description=this.attachment.getIn(["file","description"]),this.form.is_deprecated=this.attachment.get(["file","is_deprecated"]),this.title=this.translate.instant("ATTACHMENT.TITLE",{fileName:this.attachment.get("name"),date:moment(this.attachment.get("created_date")).format(this.translate.instant("ATTACHMENT.DATE"))})}e.$inject=["tgAttachmentsService","$translate"],e.prototype.editMode=function(t){var e=this.attachment.set("editable",t);return this.onUpdate({attachment:e})},e.prototype.delete=function(){return this.onDelete({attachment:this.attachment})},e.prototype.save=function(){var t=this.attachment.set("loading",!0);return this.onUpdate({attachment:t}),t=(t=this.attachment.merge({editable:!1,loading:!1})).mergeIn(["file"],{description:this.form.description,is_deprecated:!!this.form.is_deprecated}),this.onUpdate({attachment:t})},t=e,angular.module("taigaComponents").controller("Attachment",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment.html",link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachment",t)}.call(this),function(){var t=function(i){return{link:function(r,t,e){var n=i(e.tgAttachmentsDrop);return t.on("dragover",function(t){return t.preventDefault(),!1}),t.on("drop",function(t){var e;return t.stopPropagation(),t.preventDefault(),e=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,r.$apply(function(){return n(r,{files:e.files})})}),r.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsDrop",t)}.call(this),function(){var t,p;function e(t,e,r,n,i,o,s){var a,c,u,l;this.translate=t,this.confirm=e,this.config=r,this.storage=n,this.attachmentsFullService=i,this.projectService=o,this.attachmentsPreviewService=s,this.mode=this.storage.get("attachment-mode","list"),this.maxFileSize=this.config.get("maxUploadFileSize",null),this.maxFileSize&&(this.maxFileSize=p(this.maxFileSize)),this.maxFileSizeMsg=this.maxFileSize?this.translate.instant("ATTACHMENT.MAX_UPLOAD_SIZE",{maxFileSize:this.maxFileSize}):"",taiga.defineImmutableProperty(this,"attachments",(a=this,function(){return a.attachmentsFullService.attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",(c=this,function(){return c.attachmentsFullService.deprecatedsCount})),taiga.defineImmutableProperty(this,"attachmentsVisible",(u=this,function(){return u.attachmentsFullService.attachmentsVisible})),taiga.defineImmutableProperty(this,"deprecatedsVisible",(l=this,function(){return l.attachmentsFullService.deprecatedsVisible}))}p=this.taiga.sizeFormat,e.$inject=["$translate","$tgConfirm","$tgConfig","$tgStorage","tgAttachmentsFullService","tgProjectService","tgAttachmentsPreviewService"],e.prototype.uploadingAttachments=function(){return this.attachmentsFullService.uploadingAttachments},e.prototype.addAttachment=function(t){var e="list"===this.mode;return this.attachmentsFullService.addAttachment(this.projectId,this.objId,this.type,t,e)},e.prototype.setMode=function(t){return this.mode=t,this.storage.set("attachment-mode",t)},e.prototype.toggleDeprecatedsVisible=function(){return this.attachmentsFullService.toggleDeprecatedsVisible()},e.prototype.addAttachments=function(t){return _.forEach(t,(e=this,function(t){return e.addAttachment(t)}));var e},e.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments(this.type,this.objId,this.projectId)},e.prototype.deleteAttachment=function(n){var i,t,o;return this.attachmentsPreviewService.fileId=null,t=this.translate.instant("ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT"),i=this.translate.instant("ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT",{fileName:n.getIn(["file","name"])}),this.confirm.askOnDelete(t,i).then((o=this,function(t){var e=function(){return i=o.translate.instant("ATTACHMENT.ERROR_DELETE_ATTACHMENT",{errorMessage:i}),o.confirm.notify("error",null,i),t.finish(!1)},r=function(){return t.finish()};return o.attachmentsFullService.deleteAttachment(n,o.type).then(r,e)}))},e.prototype.reorderAttachment=function(t,e){return this.attachmentsFullService.reorderAttachment(this.type,t,e)},e.prototype.updateAttachment=function(t){return this.attachmentsFullService.updateAttachment(t,this.type)},e.prototype._isEditable=function(){return!!this.projectService.project&&this.projectService.hasPermission(this.editPermission)},e.prototype.showAttachments=function(){return this._isEditable()||this.attachmentsFullService.attachments.size},t=e,angular.module("taigaComponents").controller("AttachmentsFull",t)}.call(this),function(){var i=this.taiga.bindOnce,t=function(){return{scope:{},bindToController:{type:"@",objId:"=",projectId:"=",editPermission:"@"},controller:"AttachmentsFull",controllerAs:"vm",templateUrl:"components/attachments-full/attachments-full.html",link:function(t,e,r,n){return i(t,"vm.objId",function(t){return n.loadAttachments()})}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsFull",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){var r,n,i,o;this.attachmentsService=t,this.rootScope=e,this._attachments=Immutable.List(),this._deprecatedsCount=0,this._attachmentsVisible=Immutable.List(),this._deprecatedsVisible=!1,this.uploadingAttachments=[],taiga.defineImmutableProperty(this,"attachments",(r=this,function(){return r._attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",(n=this,function(){return n._deprecatedsCount})),taiga.defineImmutableProperty(this,"attachmentsVisible",(i=this,function(){return i._attachmentsVisible})),taiga.defineImmutableProperty(this,"deprecatedsVisible",(o=this,function(){return o._deprecatedsVisible}))}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgAttachmentsService","$rootScope"],e.prototype.toggleDeprecatedsVisible=function(){return this._deprecatedsVisible=!this._deprecatedsVisible,this.regenerate()},e.prototype.regenerate=function(){return this._deprecatedsCount=this._attachments.count(function(t){return t.getIn(["file","is_deprecated"])}),this._deprecatedsVisible?this._attachmentsVisible=this._attachments:this._attachmentsVisible=this._attachments.filter(function(t){return!t.getIn(["file","is_deprecated"])})},e.prototype.addAttachment=function(e,n,i,o,s,a){return null==s&&(s=!0),null==a&&(a=!1),new Promise((c=this,function(r,t){return c.attachmentsService.validate(o)?(c.uploadingAttachments.push(o),c.attachmentsService.upload(o,n,e,i,a).then(function(e){var t;return c.uploadingAttachments=c.uploadingAttachments.filter(function(t){return t.name!==e.get("name")}),t=(t=Immutable.Map()).merge({file:e,editable:s,loading:!1,from_comment:a}),c._attachments=c._attachments.push(t),c.regenerate(),c.rootScope.$broadcast("attachment:create"),r(t)})):t(new Error(o))}));var c},e.prototype.loadAttachments=function(t,e,r){return this.attachmentsService.list(t,e,r).then((n=this,function(t){return n._attachments=t.map(function(t){return Immutable.Map().merge({loading:!1,editable:!1,file:t})}),n.regenerate()}));var n},e.prototype.deleteAttachment=function(e,t){var r,n=function(){return r._attachments=r._attachments.filter(function(t){return t!==e}),r.regenerate()};return(r=this).attachmentsService.delete(t,e.getIn(["file","id"])).then(n)},e.prototype.reorderAttachment=function(r,e,t){var n,i,o,s,a=this.attachments.findIndex(function(t){return t===e});if(a!==t)return o=(o=(o=this.attachments.remove(a)).splice(t,0,e)).map(function(t,e){return t.setIn(["file","order"],e+1)}),n=[],o.forEach((i=this,function(t){var e={order:t.getIn(["file","order"])};return n.push(i.attachmentsService.patch(t.getIn(["file","id"]),r,e))})),Promise.all(n).then((s=this,function(){return s._attachments=o,s.regenerate()}))},e.prototype.updateAttachment=function(e,t){var r,n=this._attachments.findIndex(function(t){return t.getIn(["file","id"])===e.getIn(["file","id"])}),i=this._attachments.get(n),o=taiga.patch(i.get("file"),e.get("file"));return e.get("loading")?(this._attachments=this._attachments.set(n,e),this.regenerate()):this.attachmentsService.patch(e.getIn(["file","id"]),t,o).then((r=this,function(){return r._attachments=r._attachments.set(n,e),r.regenerate()}))},t=e,angular.module("taigaComponents").service("tgAttachmentsFullService",t)}.call(this),function(){var t;function e(t){var e;this.attachmentsPreviewService=t,taiga.defineImmutableProperty(this,"current",(e=this,function(){return e.attachmentsPreviewService.fileId?e.getCurrent():null}))}e.$inject=["tgAttachmentsPreviewService"],e.prototype.hasPagination=function(){return 1<this.attachments.filter(function(t){return taiga.isImage(t.getIn(["file","name"]))}).size},e.prototype.getCurrent=function(){var e,t=this.attachments.find((e=this,function(t){return e.attachmentsPreviewService.fileId===t.getIn(["file","id"])}));return t?t.get("file"):null},e.prototype.getIndex=function(){return this.attachments.findIndex((e=this,function(t){return e.attachmentsPreviewService.fileId===t.getIn(["file","id"])}));var e},e.prototype.next=function(){var t=this.getIndex(),e=this.attachments.slice(t+1).find(function(t){return taiga.isImage(t.getIn(["file","name"]))});return e=e||this.attachments.find(function(t){return taiga.isImage(t.getIn(["file","name"]))}),this.attachmentsPreviewService.fileId=e.getIn(["file","id"])},e.prototype.previous=function(){var t=this.getIndex(),e=this.attachments.slice(0,t).findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))});return e=e||this.attachments.findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))}),this.attachmentsPreviewService.fileId=e.getIn(["file","id"])},t=e,angular.module("taigaComponents").controller("AttachmentsPreview",t)}.call(this),function(){var t=function(t,i){return{scope:{},controller:"AttachmentsPreview",templateUrl:"components/attachments-preview/attachments-preview.html",link:function(e,t,r,n){return $(document.body).on("keydown.image-preview",function(t){return i.fileId&&(39===t.keyCode?n.next():37===t.keyCode&&n.previous()),e.$digest()}),e.$on("$destroy",function(){return $(document.body).off(".image-preview")})},controllerAs:"vm",bindToController:{attachments:"="}}};angular.module("taigaComponents").directive("tgAttachmentsPreview",["lightboxService","tgAttachmentsPreviewService",t])}.call(this),function(){var t,i={}.hasOwnProperty;function e(){}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=[],t=e,angular.module("taigaComponents").service("tgAttachmentsPreviewService",t)}.call(this),function(){var t;function e(t){this.attachmentsService=t}e.$inject=["tgAttachmentsService"],e.prototype.addAttachment=function(t){var e=Immutable.fromJS({file:t,name:t.name,size:t.size});if(this.attachmentsService.validate(t)&&(this.attachments=this.attachments.push(e),this.onAdd))return this.onAdd({attachment:e})},e.prototype.addAttachments=function(t){return _.forEach(t,this.addAttachment.bind(this))},e.prototype.deleteAttachment=function(e){if(this.attachments=this.attachments.filter(function(t){return t!==e}),this.onDelete)return this.onDelete({attachment:e})},t=e,angular.module("taigaComponents").controller("AttachmentsSimple",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachments:"=",onAdd:"&",onDelete:"&"},controller:"AttachmentsSimple",controllerAs:"vm",templateUrl:"components/attachments-simple/attachments-simple.html",link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsSimple",t)}.call(this),function(){var t=function(o){return{link:function(n,t,e){var i=o(e.tgAttachmentsSortable),r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}});return r.on("dragend",function(t){var e,r;return t=$(t),e=t.scope().attachment,r=t.index(),n.$apply(function(){return i(n,{attachment:e,index:r})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsSortable",t)}.call(this),function(){var t=function(r){return{link:function(t,e){return r(function(){return e[0].select()})}}};t.$inject=["$timeout"],angular.module("taigaComponents").directive("tgAutoSelect",t)}.call(this),function(){var t=function(i){return{link:function(t,r,e){var n=e.tgAvatarBig?"avatarBig":"avatar";return t.$watch(n,function(t){var e=i.getAvatar(t,n);return r.attr("src",e.url),r.attr("title",""+e.username),r.attr("alt",""+e.username),r.css("background",e.bg||"")})},scope:{avatar:"=tgAvatar",avatarBig:"=tgAvatarBig"}}};t.$inject=["tgAvatarService"],angular.module("taigaComponents").directive("tgAvatar",t),angular.module("taigaComponents").directive("tgAvatarBig",t)}.call(this),function(){var t=function(n,a,i,c,t){return{link:function(s,t,e){var r;return s.$watch("epics",function(t){return r(t)}),s.$on("related-epics:changed",function(t,e){return i.userstories.getByRef(e.project,e.ref,{}).then(function(t){return s.item.epics=t.epics,r(t.epics)})}),s.removeEpicRelationship=function(o){var t=n.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),e=n.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:o.get("subject")});return a.ask(t,null,e).then(function(t){var e=function(){return t.finish(),s.$broadcast("related-epics:changed",s.item)},r=function(){return t.finish(!1),a.notify("error")},n=o.get("id"),i=s.item.id;return c.epics.deleteRelatedUserstory(n,i).then(e,r)})},r=function(t){if(s.epicsLength=0,s.immutable_epics=[],t&&!t.isIterable)return s.epicsLength=t.length,s.immutable_epics=Immutable.fromJS(t)}},scope:{epics:"=",item:"="},templateUrl:function(t,e){return e.format?"components/belong-to-epics/belong-to-epics-"+e.format+".html":"components/belong-to-epics/belong-to-epics-pill.html"}}};angular.module("taigaEpics").directive("tgBelongToEpics",["$translate","$tgConfirm","$tgResources","tgResources","lightboxService",t])}.call(this),function(){var t=function(o,r,s,a,c){return{restrict:"A",compile:function(t,e){var n=r(e.tgBindCode),i=r(e.tgBindCode,function(t){return(t||"").toString()});return s.$$addBindingClass(t),function(e,r,t){return s.$$addBindingInfo(r,t.tgBindCode),e.$watch(i,function(){var t=a.getHTML(n(e));return r.html(o.getTrustedHtml(t)||""),c.addHightlighter(r)})}}}};angular.module("taigaComponents").directive("tgBindCode",["$sce","$parse","$compile","tgWysiwygService","tgWysiwygCodeHightlighterService",t])}.call(this),function(){var t=function(){return{scope:{levels:"=",value:"="},templateUrl:"components/board-zoom/board-zoom.html"}};angular.module("taigaComponents").directive("tgBoardZoom",[t])}.call(this),function(){var t;function e(){this.index=0}e.$inject=[],e.prototype.next=function(){if(this.index++,this.index>=this.images.size)return this.index=0},e.prototype.previous=function(){if(this.index--,this.index<0)return this.index=this.images.size-1},t=e,angular.module("taigaComponents").controller("CardSlideshow",t)}.call(this),function(){var t=function(){return{controller:"CardSlideshow",templateUrl:"components/card-slideshow/card-slideshow.html",bindToController:!0,controllerAs:"vm",scope:{images:"="}}};angular.module("taigaComponents").directive("tgCardSlideshow",t)}.call(this),function(){var t;function e(){}e.$inject=[],e.prototype.visible=function(t){return-1!==this.zoom.indexOf(t)},e.prototype.hasTasks=function(){var t=this.item.getIn(["model","tasks"]);return t&&0<t.size},e.prototype.hasMultipleAssignedUsers=function(){var t=this.item.getIn(["model","assigned_users"]);return t&&1<t.size},e.prototype.hasVisibleAttachments=function(){return 0<this.item.get("images").size},e.prototype.toggleFold=function(){return this.onToggleFold({id:this.item.get("id")})},e.prototype.getClosedTasks=function(){return this.item.getIn(["model","tasks"]).filter(function(t){return t.get("is_closed")})},e.prototype.closedTasksPercent=function(){return 100*this.getClosedTasks().size/this.item.getIn(["model","tasks"]).size},e.prototype.getModifyPermisionKey=function(){return"task"===this.type?"modify_task":"modify_us"},e.prototype.getDeletePermisionKey=function(){return"task"===this.type?"delete_task":"delete_us"},e.prototype._setVisibility=function(){var t={related:this.visible("related_tasks"),slides:this.visible("attachments")};return _.isUndefined(this.item.get("foldStatusChanged"))||(this.visible("related_tasks")&&this.visible("attachments")?(t.related=!this.item.get("foldStatusChanged"),t.slides=!this.item.get("foldStatusChanged")):!this.visible("attachments")&&(this.visible("related_tasks")||this.visible("attachments"))||(t.related=this.item.get("foldStatusChanged"),t.slides=this.item.get("foldStatusChanged"))),this.item.getIn(["model","tasks"])&&this.item.getIn(["model","tasks"]).size||(t.related=!1),this.item.get("images")&&this.item.get("images").size||(t.slides=!1),t},e.prototype.isRelatedTasksVisible=function(){return this._setVisibility().related},e.prototype.isSlideshowVisible=function(){return this._setVisibility().slides},e.prototype.getNavKey=function(){return"task"===this.type?"project-tasks-detail":"issue"===this.type?"project-issues-detail":"project-userstories-detail"},t=e,angular.module("taigaComponents").controller("Card",t)}.call(this),function(){var t=function(){return{link:function(t){},controller:"Card",controllerAs:"vm",bindToController:!0,templateUrl:"components/card/card.html",scope:{onToggleFold:"&",onClickAssignedTo:"&",onClickEdit:"&",onClickRemove:"&",onClickDelete:"&",project:"=",item:"=",zoom:"=",zoomLevel:"=",archived:"=",type:"@"}}};angular.module("taigaComponents").directive("tgCard",t)}.call(this),function(){var t=function(){return{link:function(t,r){return r.on("click",function(t){var e;if(!$(t.target).is("input"))return t.preventDefault(),(e=r.find('input[type="file"]')).val(""),e.trigger("click")}),t.$on("$destroy",function(){return r.off()})}}};angular.module("taigaComponents").directive("tgClickInputFile",[t])}.call(this),function(){var t,e,r;function n(t){this.projectService=t,this.colorList=e(),this.checkIsColorRequired(),this.displayColorList=!1}r=this.taiga,e=r.getDefaulColorList,n.$inject=["tgProjectService"],n.prototype.userCanChangeColor=function(){return!this.requiredPerm||this.projectService.hasPermission(this.requiredPerm)},n.prototype.checkIsColorRequired=function(){if(!this.isColorRequired)return this.colorList=_.dropRight(this.colorList)},n.prototype.setColor=function(t){return this.color=t,this.customColor=t},n.prototype.resetColor=function(){if(this.isColorRequired&&!this.color)return this.color=this.initColor},n.prototype.toggleColorList=function(){return this.displayColorList=!this.displayColorList,this.customColor=this.color,this.resetColor()},n.prototype.onSelectDropdownColor=function(t){return this.color=t,this.onSelectColor({color:t}),this.toggleColorList()},n.prototype.onKeyDown=function(t){if(13===t.which)return!this.customColor&&this.isColorRequired||this.onSelectDropdownColor(this.customColor),t.preventDefault()},t=n,angular.module("taigaComponents").controller("ColorSelectorCtrl",t)}.call(this),function(){this.taiga.bindOnce;var t=function(a){return{link:function(t,e,r,n){var i=null,o=function(){return a.cancel(i),i=null},s=function(){if(!i)return i=a(function(){return n.displayColorList=!1,n.resetColor()},400)};return e.find(".color-selector").mouseenter(o).mouseleave(s),e.find(".color-selector-dropdown").mouseenter(o).mouseleave(s),t.$watch("vm.initColor",function(t){return n.setColor(t)})},templateUrl:"components/color-selector/color-selector.html",controller:"ColorSelectorCtrl",controllerAs:"vm",bindToController:{isColorRequired:"=",onSelectColor:"&",initColor:"=",requiredPerm:"@"},scope:{}}};t.$inject=["$timeout"],angular.module("taigaComponents").directive("tgColorSelector",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.navUrls=n,this.window=i,this.editMode=!1,this.loadingSubject=!1,this.originalSubject=this.item.subject,this.objType={tasks:"task",issues:"issue",userstories:"us"}[this.item._name]}t=angular.module("taigaBase"),e.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation","$tgNavUrls","$window"],e.prototype._checkPermissions=function(){return this.permissions={canEdit:_.includes(this.project.my_permissions,this.requiredPerm)}},e.prototype.cancelEdit=function(){return this.editMode=!1,this.item.subject=this.originalSubject},e.prototype.editSubject=function(t){if("Range"!==this.window.getSelection().type&&(t&&(this.editMode=!0),!t))return this.editMode=!1},e.prototype.onKeyDown=function(t){if(13===t.which&&this.saveSubject(),27===t.which)return this.item.subject=this.originalSubject,this.editSubject(!1)},e.prototype.saveSubject=function(){var t,e,r=function(){return t.loadingSubject=!1,t.rootScope.$broadcast("object:updated"),t.confirm.notify("success"),t.originalSubject=t.item.subject},n=function(){return e.loadingSubject=!1,e.confirm.notify("error")};return(e=t=this).editMode=!1,this.loadingSubject=!0,this.item,this.modelTransform.save(function(t){return t}).then(r,n)},t.controller("DetailHeaderCtrl",e)}.call(this),function(){var t=function(){return this.$inject=[],{link:function(t,e,r,n){return n._checkPermissions()},controller:"DetailHeaderCtrl",bindToController:!0,scope:{item:"=",project:"=",sectionName:"=",requiredPerm:"@"},controllerAs:"vm",templateUrl:"components/detail/header/detail-header.html"}};angular.module("taigaBase").directive("tgDetailHeader",t)}.call(this),function(){var t;function e(t){this.navUrls=t}t=angular.module("taigaBase"),e.$inject=["$tgNavUrls"],e.prototype._checkNav=function(){var t,e,r;if(null!=(null!=(e=this.item.neighbors.previous)?e.ref:void 0)&&(t={project:this.item.project_extra_info.slug,ref:this.item.neighbors.previous.ref},this.previousUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)),null!=(null!=(r=this.item.neighbors.next)?r.ref:void 0))return t={project:this.item.project_extra_info.slug,ref:this.item.neighbors.next.ref},this.nextUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)},t.controller("DetailNavCtrl",e)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.item",function(t){if(t)return n._checkNav()})},controller:"DetailNavCtrl",bindToController:!0,scope:{item:"="},controllerAs:"vm",templateUrl:"components/detail/nav/detail-nav.html"}};angular.module("taigaBase").directive("tgDetailNav",t)}.call(this),function(){var t;function e(t,e,r,n){this.translate=t,this.tgLightboxFactory=e,this.projectService=r,this.rootscope=n,this.defaultConfig=[{color:"#9dce0a",name:"normal due",days_to_due:null,by_default:!0},{color:"#ff9900",name:"due soon",days_to_due:14,by_default:!1},{color:"#ff8a84",name:"past due",days_to_due:0,by_default:!1}]}e.$inject=["$translate","tgLightboxFactory","tgProjectService","$rootScope"],e.prototype.visible=function(){return"button"===this.format||null!=this.dueDate},e.prototype.disabled=function(){return this.isClosed},e.prototype.color=function(){var t;return(null!=(t=this.getStatus())?t.color:void 0)||null},e.prototype.title=function(){return this.dueDate?this._formatTitle():"button"===this.format?this.translate.instant("COMMON.DUE_DATE.TITLE_ACTION_SET_DUE_DATE"):""},e.prototype.getStatus=function(t){return this.dueDate?(t=(t=this.projectService.project.toJS()[this.objType+"_duedates"])||this.defaultConfig,this._getAppearance(t)):null},e.prototype._getDefaultAppearance=function(t){var e=null;return _.map(t,function(t){if(!0===t.by_default)return e=t}),e},e.prototype._getAppearance=function(t){var e,r,n=this._getDefaultAppearance(t);return t=_.sortBy(t,function(t){return-t.days_to_due}),e=moment(this.dueDate),r=moment(),_.map(t,function(t){if(null!==t.days_to_due)return moment(e-moment.duration(t.days_to_due,"days"))<=r?n=t:void 0}),n},e.prototype._formatTitle=function(){var t=this.translate.instant("COMMON.PICKERDATE.FORMAT"),e=moment(this.dueDate).format(t),r=this.getStatus();return null!=r&&r.name?e+" ("+r.name+")":e},e.prototype.setDueDate=function(){if(!this.disabled())return this.tgLightboxFactory.create("tg-lb-set-due-date",{class:"lightbox lightbox-set-due-date"},{object:this.item,notAutoSave:this.notAutoSave})},t=e,angular.module("taigaComponents").controller("DueDateCtrl",t)}.call(this),function(){var t=function(t,o){return{link:function(e,r,t,n){var i;return e.open=!1,i=o.get(),_.merge(i,{field:r.find(".due-date-button")[0],container:r.find(".date-picker-container")[0],bound:!0,onClose:function(){return e.open=!1,e.$apply()},onSelect:function(){return n.dueDate=this.getMoment().format("YYYY-MM-DD")}}),r.picker=new Pikaday(i),r.on("click",".due-date-button",function(t){return e.open?void r.picker.hide():(!r.picker.getDate()&&n.dueDate&&r.picker.setDate(moment(n.dueDate).format("YYYY-MM-DD")),r.picker.show(),e.open=!0,e.$apply())}),r.on("click",".date-picker-clean",function(t){return t.preventDefault(),t.stopPropagation(),n.dueDate=null,r.picker.setDate(n.dueDate),e.open=!1,r.picker.hide(),e.$apply()}),e.$on("status:changed",function(t,e){return n.isClosed=n.item.is_closed})},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/due-date/due-date-popover.html",scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}};angular.module("taigaComponents").directive("tgDueDatePopover",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t=function(o,s){return{link:function(r,n,t,i){var e=function(){var t,e=o.instant("COMMON.PICKERDATE.FORMAT");return i.dueDate&&(i.dueDate=moment(i.dueDate,e)),n.on("click",".date-picker-popover-trigger",function(t){if(!i.disabled())return t.preventDefault(),t.stopPropagation(),n.find(".date-picker-popover").popover().open()}),n.on("click",".date-picker-clean",function(t){return t.preventDefault(),t.stopPropagation(),i.dueDate=null,r.$apply(),n.find(".date-picker-popover").popover().close()}),t=s.get(),_.merge(t,{field:n.find("input.due-date")[0],container:n.find(".date-picker-container")[0],bound:!1,onSelect:function(){return i.dueDate=this.getMoment().format("YYYY-MM-DD"),n.find(".date-picker-popover").popover().close(),r.$apply()}}),n.picker=new Pikaday(t)};if("button-popover"===t.format)return e()},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:function(t,e){return e.format?"components/due-date/due-date-"+e.format+".html":"components/due-date/due-date-icon.html"},scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}};angular.module("taigaComponents").directive("tgDueDate",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t=function(o){return{restrict:"A",link:function(e,t,r,n){var i=o(r.tgFileChange);return t.on("change",function(t){return e.$apply(function(){return i(e,{files:t.currentTarget.files})})}),e.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgFileChange",t)}.call(this),function(){var t,c,i={}.hasOwnProperty;function e(t,e,r){this.q=t,this.urls=e,this.http=r}c=taiga.generateHash,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=["$q","$tgUrls","$tgHttp"],e.prototype.storeFilters=function(t,r,e){var n,i,o=this.q.defer(),s=this.urls.resolve("user-storage"),a=c([t,t+":"+e]);return _.isEmpty(r)?((n=this.http.delete(s+"/"+a,{key:a,value:r})).then(function(){return o.resolve()}),n.then(null,function(){return o.reject()})):((n=this.http.put(s+"/"+a,{key:a,value:r})).then(function(t){return o.resolve()}),n.then(null,(i=this,function(t){var e=i.http.post(""+s,{key:a,value:r});return e.then(function(){return o.resolve()}),e.then(null,function(){return o.reject()})}))),o.promise},e.prototype.getFilters=function(t,e){var r=this.q.defer(),n=this.urls.resolve("user-storage"),i=c([t,t+":"+e]),o=this.http.get(n+"/"+i);return o.then(function(t){return r.resolve(t.data.value)}),o.then(null,function(t){return r.resolve({})}),r.promise},t=e,angular.module("taigaComponents").service("tgFilterRemoteStorageService",t)}.call(this),function(){var t=function(){return{priority:900,link:function(t,r,e,n){var i=$("tg-filter");return t.$watch(e.ngIf,function(t){var e;if(t)return i.find(".filter-list").hide(),i.height(),e=0,i.children().each(function(){return e+=$(this).outerHeight(!0)}),$(r.context.nextSibling).css({display:"block"})})}}};angular.module("taigaComponents").directive("tgFilterSlideDown",[t])}.call(this),function(){var t;function e(t){this.translate=t,this.opened=null,this.filterModeOptions=["include","exclude"],this.filterModeLabels={include:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.INCLUDE"),exclude:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.EXCLUDE")},this.filterMode="include",this.showAdvancedFilter=!1,this.customFilterForm=!1,this.customFilterName=""}e.$inject=["$translate"],e.prototype.toggleAdvancedFilter=function(){return this.showAdvancedFilter=!this.showAdvancedFilter},e.prototype.toggleFilterCategory=function(t){return this.opened===t?this.opened=null:this.opened=t},e.prototype.isOpen=function(t){return this.opened===t},e.prototype.saveCustomFilter=function(){return this.onSaveCustomFilter({name:this.customFilterName}),this.customFilterForm=!1,this.opened="custom-filter",this.customFilterName=""},e.prototype.changeQ=function(){return this.onChangeQ({q:this.q})},e.prototype.unselectFilter=function(t){return this.onRemoveFilter({filter:t})},e.prototype.unselectFilter=function(t){return this.onRemoveFilter({filter:t})},e.prototype.selectFilter=function(t,e){return e={category:t,filter:e,mode:this.filterMode},this.onAddFilter({filter:e})},e.prototype.removeCustomFilter=function(t){return this.onRemoveCustomFilter({filter:t})},e.prototype.selectCustomFilter=function(t){return this.onSelectCustomFilter({filter:t})},e.prototype.isFilterSelected=function(e,r){return!!_.find(this.selectedFilters,function(t){return r.id===t.id&&e.dataType===t.dataType})},t=e,angular.module("taigaComponents").controller("Filter",t)}.call(this),function(){var t=function(){return{scope:{onChangeQ:"&",onAddFilter:"&",onSelectCustomFilter:"&",onRemoveFilter:"&",onRemoveCustomFilter:"&",onSaveCustomFilter:"&",customFilters:"<",defaultQ:"=q",filters:"<",selectedFilters:"<"},bindToController:!0,controller:"Filter",controllerAs:"vm",templateUrl:"components/filter/filter.html",link:function(e,r,t,n){var i=e.$watch("vm.defaultQ",function(t){return t&&!e.vm.filtersForm.$dirty?(e.vm.q=t,i()):e.vm.filtersForm.$dirty?i():void 0});return t.$observe("open",function(t){return(t=e.$eval(t))?r.addClass("open"):r.removeClass("open")})}}};angular.module("taigaComponents").directive("tgFilter",[t])}.call(this),function(){this.taiga;var t=function(a,c,u,t,l){return{scope:{},link:function(t,e,r,n){var i,o=null,s=introJs();return s.oncomplete(function(){return $("html,body").scrollTop(0)}),s.onexit(function(){return c.disableJoyRide()}),i=function(t,e){if(e[t.joyride])return s.setOptions({exitOnEsc:!1,exitOnOverlayClick:!1,showStepNumbers:!1,nextLabel:l.instant("JOYRIDE.NAV.NEXT")+" &rarr;",prevLabel:"&larr; "+l.instant("JOYRIDE.NAV.BACK"),skipLabel:l.instant("JOYRIDE.NAV.SKIP"),doneLabel:l.instant("JOYRIDE.NAV.DONE"),disableInteraction:!0}),s.setOption("steps",u.get(t.joyride)),s.start()},a.$on("$routeChangeSuccess",function(t,e){return e.joyride&&c.isAuthenticated()?(s.oncomplete(function(){return c.disableJoyRide(e.joyride)}),e.loader?o=a.$on("loader:end",function(){return c.loadJoyRideConfig().then(function(t){return i(e,t)}),o()}):c.loadJoyRideConfig().then(function(t){return i(e,t)})):(s.exit(),void(o&&o()))})}}};t.$inject=["$rootScope","tgCurrentUserService","tgJoyRideService","$location","$translate"],angular.module("taigaComponents").directive("tgJoyRide",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.translate=t,this.checkPermissionsService=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["$translate","tgCheckPermissionsService"],e.prototype.getConfig=function(){return{dashboard:function(){var t=[{element:".project-list > section:not(.ng-hide)",position:"left",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP1.TITLE"),text:n.translate.instant("JOYRIDE.DASHBOARD.STEP1.TEXT")}},{element:".working-on-container",position:"right",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP2.TITLE"),text:n.translate.instant("JOYRIDE.DASHBOARD.STEP2.TEXT")}},{element:".watching-container",position:"right",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TITLE"),text:[n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT1"),n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT2")]}}];return $(".project-list .create-project-button").is(":hidden")||t.push({element:".project-list .create-project-button",position:"bottom",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TITLE"),text:[n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT1"),n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT2")]}}),t},backlog:function(){var t=[{element:".summary",position:"bottom",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP1.TITLE"),text:[r.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT1"),r.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT2")]}},{element:".backlog-table-empty",position:"bottom",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP2.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP2.TEXT")}},{element:".sprints",position:"left",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP3.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP3.TEXT")}}];return r.checkPermissionsService.check("add_us")&&t.push({element:".new-us",position:"rigth",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP4.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP4.TEXT")}}),t},kanban:(e=r=n=this,function(){var t=[{element:".kanban-table-inner",position:"bottom",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP1.TITLE"),text:e.translate.instant("JOYRIDE.KANBAN.STEP1.TEXT")}},{element:".card-placeholder",position:"right",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP2.TITLE"),text:e.translate.instant("JOYRIDE.KANBAN.STEP2.TEXT")}}];return e.checkPermissionsService.check("add_us")&&t.push({element:".add-action",position:"bottom",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP3.TITLE"),text:[e.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT1"),e.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT2")]}}),t})};var e,r,n},e.prototype.get=function(t){var e=this.getConfig()[t].call(this);return _.map(e,function(t){var e="";return t.joyride.title&&(e+="<h3>"+t.joyride.title+"</h3>"),_.isArray(t.joyride.text)?_.forEach(t.joyride.text,function(t){return e+="<p>"+t+"</p>"}):e+="<p>"+t.joyride.text+"</p>",t.intro=e,t})},t=e,angular.module("taigaComponents").service("tgJoyRideService",t)}.call(this),function(){var t=function(a,c){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    class="board-zoom"\n    value="zoomIndex"\n    levels="levels"\n></tg-board-zoom>',link:function(r,t,e,n){var i,o,s;return r.zoomIndex=a.get("kanban_zoom")||2,r.levels=5,s=[["ref"],["subject"],["owner","tags","extra_info"],["unfold"],["attachments","related_tasks","empty_extra_info"]],i=function(n){return null==n&&(n=0),a.get("kanban_zoom")!==n&&a.set("kanban_zoom",n),_.reduce(s,function(t,e,r){return r<=n&&(t=t.concat(e)),t})},r.$watch("zoomIndex",function(t){var e=i(t);return r.onZoomChange({zoomLevel:t,zoom:e})}),o=r.$watch(function(){return c.project},function(t){if(t)return-1===t.get("my_permissions").indexOf("view_tasks")&&(r.levels=4),o()})}}};angular.module("taigaComponents").directive("tgKanbanBoardZoom",["$tgStorage","tgProjectService",t])}.call(this),function(){var h=taiga.truncate,t=function(t,e,c,u,l,p,d){return{templateUrl:"components/lb-select-user/lb-select-user.html",link:function(o,r,t){var e,n,i,s=[],a=[];return u.open(r),i=function(t){var e,r,n,i;return null==t&&(t=""),i=_.compact(_.sortBy(_.filter(s,function(t){return _.includes(o.currentUsers,t.id)}),"name")),e=function(t,e){var r;return("user"!==e.type||!_.find(i,["id",e.id]))&&(r=e.name.toUpperCase(),t=t.toUpperCase(),_.includes(r,t))},n=_.union(s,_.filter(a,function(t){return 0<_.difference(t.userIds,_.map(i,"id")).length})),r=_.sortBy(_.filter(n,_.partial(e,t)),"name"),t?(o.selected=[],o.collection=r):(o.selected=i,o.collection=_.union(i,r))},e=function(){return l.stop(),u.close(r)},o.$on("watcher:add",function(t,e){return o.item=e,i(),u.open(r).then(function(){return r.find("input").focus(),l.init(r)})}),o.$watch("activeUsers",function(n){var t;if(n&&(s=_.map(n,function(t){return{id:t.id,type:"user",name:t.full_name_display,avatar:p.getAvatar(t)}}),!o.single))return t=d.project.toJS(),a=_.map(t.roles,function(t){var e=_.filter(n,{role:t.id}),r=c.instant("LIGHTBOX.SELECT_USER.ROLE");return{id:t.id,type:"role",name:r+": "+t.name,avatar:null,userIds:_.map(e,"id"),userNames:h("("+_.join(_.map(e,"full_name_display"),", ")+")",110)}})}),o.$watch("currentUsers",function(t){if(t)return i()}),o.$watch("searchText",function(t){return i(t),r.find("input").focus()}),o.removeItem=function(t,e){return e.preventDefault(),e.stopPropagation(),e.currentTarget.remove(),o.searchText=null,_.pull(o.currentUsers,t.id),i()},o.addItem=function(t){if("user"===t.type){if(_.find(o.currentUsers,["id",t.id]))return;if(o.single)return o.currentUsers=[t.id],void n();o.currentUsers.push(t.id)}return"role"===t.type&&(o.currentUsers=_.union(o.currentUsers,t.userIds)),o.searchText=null,i()},o.clearSearch=function(){return o.searchText=""},n=function(){return o.loading=!0,o.onClose(o.currentUsers),e(),o.loading=!1},r.on("click",".lb-select-user-confirm",function(t){if(!o.loading)return t.preventDefault(),n()}),r.on("click",".close",function(t){return t.preventDefault(),e(),o.$apply(function(){return o.searchText=null})}),o.$on("$destroy",function(){return r.off()})},scope:!0}};t.$inject=["$rootScope","$tgRepo","$translate","lightboxService","lightboxKeyboardNavigationService","tgAvatarService","tgProjectService"],angular.module("taigaComponents").directive("tgLbSelectUser",t)}.call(this),function(){var t=function(t){return{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){return t.open=!1},Object.defineProperties(this,{open:{get:function(){return t.open}},title:{get:function(){return t.title}},desc:{get:function(){return t.desc}}})},link:function(t,e,r){},templateUrl:"components/live-announcement/live-announcement.html"}};t.$inject=["tgLiveAnnouncementService"],angular.module("taigaComponents").directive("tgLiveAnnouncement",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.open=!1,this.title="",this.desc=""}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.prototype.show=function(t,e){return this.open=!0,this.title=t,this.desc=e},t=e,angular.module("taigaComponents").service("tgLiveAnnouncementService",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s){var a;this.rootScope=t,this.scope=e,this.rs=r,this.projectService=n,this.translate=i,this.lightboxService=o,this.confirm=s,this.projectId=this.projectService.project.get("id"),this.loading=!1,this.someSelected=!1,this.selectedSprintId=null,this.typesSelected={uss:!1,tasks:!1,issues:!1},this.itemsToMove={},this._loadSprints(),this.scope.$watch("vm.openItems",(a=this,function(t){if(t)return a._init(t)}))}t=angular.module("taigaComponents"),e.$inject=["$rootScope","$scope","$tgResources","tgProjectService","$translate","lightboxService","$tgConfirm"],e.prototype._init=function(t){var e,r,n;return this.hasManyItemTypes=1<_.size(this.openItems),this.ussCount=parseInt(null!=(e=t.uss)?e.length:void 0),this.updateSelected("uss",0<this.ussCount),this.tasksCount=parseInt(null!=(r=t.tasks)?r.length:void 0),this.updateSelected("tasks",0<this.tasksCount),this.issuesCount=parseInt(null!=(n=t.issues)?n.length:void 0),this.updateSelected("issues",0<this.issuesCount)},e.prototype._loadSprints=function(){return this.rs.sprints.list(this.projectId,{closed:!1}).then((e=this,function(t){return e.sprints=_.filter(t.milestones,function(t){return t.id!==e.sprint.id})}));var e},e.prototype.updateSelected=function(t,e){return this.typesSelected[t]=e,this.someSelected=_.some(this.typesSelected),!0===e?this.itemsToMove[t]=this.openItems[t]:this.itemsToMove[t]?delete this.itemsToMove[t]:void 0},e.prototype.submit=function(){var r,t,n={};return _.map(this.openItems,(r=this,function(t,e){if(!r.itemsToMove[e])return n[e]=!0})),this.loading=!0,this.moveItems().then((t=this,function(){if(t.rootScope.$broadcast("taskboard:items:move",t.typesSelected),t.lightboxService.closeAll(),t.loading=!1,0<_.size(n))return t.displayWarning(n)}))},e.prototype.moveItems=function(){var t=[];return this.itemsToMove.uss&&t.push(this.rs.sprints.moveUserStoriesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.uss)),this.itemsToMove.tasks&&t.push(this.rs.sprints.moveTasksMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.tasks)),this.itemsToMove.issues&&t.push(this.rs.sprints.moveIssuesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.issues)),Promise.all(t)},e.prototype.displayWarning=function(t){var e,r,n,i=this.translate.instant("COMMON.I_GET_IT"),o=1===_.size(t)&&!0===t.issues?(r=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED_TITLE"),this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED")):(n=0,_.map(this.itemsToMove,function(t,e){return n+=t.length}),r=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN_TITLE",{total:n},"messageformat"),this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN",{sprintName:null!=(e=this.sprint)?e.name:void 0}));return this.confirm.success(r,o,null,i)},t.controller("MoveToSprintLbCtrl",e)}.call(this),function(){var t=angular.module("taigaComponents"),e=function(i){return{scope:{},bindToController:{openItems:"=",sprint:"="},templateUrl:"components/move-to-sprint/move-to-sprint-lb/move-to-sprint-lb.html",controller:"MoveToSprintLbCtrl",controllerAs:"vm",link:function(t,e,r,n){return i.open(e)}}};e.$inject=["lightboxService"],t.directive("tgLbMoveToSprint",e)}.call(this),function(){var t;function e(t,e,r){var n,i,o;this.scope=t,this.lightboxFactory=e,this.projectService=r,this.permissions=this.projectService.project.get("my_permissions"),this.hasOpenItems=!1,this.disabled=!1,this.openItems={uss:[],tasks:[],issues:[]},this.scope.$watch("vm.uss",(n=this,function(){return n.getOpenUss()})),this.scope.$watch("vm.unnasignedTasks",(i=this,function(){return i.getOpenStorylessTasks()})),this.scope.$watch("vm.issues",(o=this,function(){return o.getOpenIssues()}))}this.taiga,e.$inject=["$scope","tgLightboxFactory","tgProjectService"],e.prototype.checkOpenItems=function(){return _.some(Object.keys(this.openItems),(e=this,function(t){return 0<e.openItems[t].length}));var e},e.prototype.openLightbox=function(){var r;if(!1===this.disabled&&this.hasOpenItems)return r={},_.map(this.openItems,function(t,e){if(t.length)return r[e]=t}),this.lightboxFactory.create("tg-lb-move-to-sprint",{class:"lightbox lightbox-move-to-sprint",sprint:"sprint","open-items":"openItems"},{sprint:this.sprint,openItems:r})},e.prototype.getOpenUss=function(){var e;if(this.uss&&-1!==this.permissions.indexOf("modify_us"))return this.openItems.uss=[],this.uss.map((e=this,function(t){if(!1===t.is_closed)return e.openItems.uss.push({us_id:t.id,order:t.sprint_order})})),this.hasOpenItems=this.checkOpenItems()},e.prototype.getOpenStorylessTasks=function(){var e;if(this.unnasignedTasks&&-1!==this.permissions.indexOf("modify_task"))return this.openItems.tasks=[],this.unnasignedTasks.map((e=this,function(t){return t.map(function(t){if(!1===t.get("model").get("is_closed"))return e.openItems.tasks.push({task_id:t.get("model").get("id"),order:t.get("model").get("taskboard_order")})})})),this.hasOpenItems=this.checkOpenItems()},e.prototype.getOpenIssues=function(){var e;if(this.issues&&-1!==this.permissions.indexOf("modify_issue"))return this.openItems.issues=[],this.issues.map((e=this,function(t){if(!1===t.get("status").get("is_closed"))return e.openItems.issues.push({issue_id:t.get("id")})})),this.hasOpenItems=this.checkOpenItems()},t=e,angular.module("taigaComponents").controller("MoveToSprintCtrl",t)}.call(this),function(){var t=angular.module("taigaComponents"),e=function(t){return{controller:"MoveToSprintCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/move-to-sprint/move-to-sprint.html",scope:{sprint:"=",uss:"=",unnasignedTasks:"=",issues:"=",disabled:"="}}};e.$inject=["tgTaskboardTasks"],t.directive("tgMoveToSprint",[e])}.call(this),function(){var t=function(i){return{link:function(t,n,e){return t.$watch("project",function(t){var e,r;if(t=Immutable.fromJS(t))return(r=t.get("logo_big_url"))?(n.attr("src",r),n.css("background","")):(e=i.getDefaultProjectLogo(t.get("slug"),t.get("id")),n.attr("src",e.src),n.css("background",e.color))})},scope:{project:"=tgProjectLogoBigSrc"}}};t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoBigSrc",t)}.call(this),function(){var t=function(i){return{link:function(t,n,e){return t.$watch("project",function(t){var e,r;if(t=Immutable.fromJS(t))return(r=t.get("logo_small_url"))?(n.attr("src",r),n.css("background","")):(e=i.getDefaultProjectLogo(t.get("slug"),t.get("id")),n.attr("src",e.src),n.css("background",e.color))})},scope:{project:"=tgProjectLogoSmallSrc"}}};t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoSmallSrc",t)}.call(this),function(){var t;function e(t,e){this.projectService=t,this.lightboxFactory=e,this.project=null,this.menu=Immutable.Map()}e.$inject=["tgProjectService","tgLightboxFactory"],e.prototype.show=function(){var t;return this.project=this.projectService.project,this.sprints=null!=(t=this.project.get("milestones"))?t.toJS():void 0,this.active=this._getActiveSection(),this._setVideoConference(),this._setMenuPermissions()},e.prototype.hide=function(){return this.project=null,this.menu={}},e.prototype.search=function(){return this.lightboxFactory.create("tg-search-box",{class:"lightbox lightbox-search"})},e.prototype._setVideoConference=function(){var t=this._videoConferenceUrl();if(t)return this.project=this.project.set("videoconferenceUrl",t)},e.prototype._setMenuPermissions=function(){if(this.menu=Immutable.Map({epics:!1,backlog:!1,kanban:!1,issues:!1,wiki:!1}),this.project.get("is_epics_activated")&&-1!==this.project.get("my_permissions").indexOf("view_epics")&&(this.menu=this.menu.set("epics",!0)),this.project.get("is_backlog_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("backlog",!0)),this.project.get("is_kanban_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("kanban",!0)),this.project.get("is_issues_activated")&&-1!==this.project.get("my_permissions").indexOf("view_issues")&&(this.menu=this.menu.set("issues",!0)),this.project.get("is_wiki_activated")&&-1!==this.project.get("my_permissions").indexOf("view_wiki_pages"))return this.menu=this.menu.set("wiki",!0)},e.prototype._getActiveSection=function(){var t,e=this.projectService.section,r=this.projectService.sectionsBreadcrumb,n=r.lastIndexOf("backlog"),i=r.lastIndexOf("kanban");return-1===n&&-1===i||(t=-1===i||i<n?"backlog":"kanban"),"backlog-kanban"===e&&("backlog"===t||"kanban"===t?e=t:this.project.get("is_backlog_activated")&&!this.project.get("is_kanban_activated")?e="backlog":!this.project.get("is_backlog_activated")&&this.project.get("is_kanban_activated")&&(e="kanban")),e},e.prototype._videoConferenceUrl=function(){var t,e;if("whereby-com"===this.project.get("videoconferences"))t="https://whereby.com/";else if("talky"===this.project.get("videoconferences"))t="https://talky.io/";else{if("jitsi"!==this.project.get("videoconferences"))return"custom"===this.project.get("videoconferences")?this.project.get("videoconferences_extra_data"):"";t="https://meet.jit.si/"}return e=this.project.get("videoconferences_extra_data")?this.project.get("slug")+"-"+taiga.slugify(this.project.get("videoconferences_extra_data")):this.project.get("slug"),"jitsi"===this.project.get("videoconferences")&&(e=e.replace(/-/g,"")),t+e},t=e,angular.module("taigaComponents").controller("ProjectMenu",t)}.call(this),function(){this.taiga;var t=function(o,t){return{scope:{},controller:"ProjectMenu",controllerAs:"vm",templateUrl:"components/project-menu/project-menu.html",link:function(e,t,r,n){var i=function(){return o.project?n.show():n.hide()};return e.$watch(function(){return o.project},i),e.vm.fixed=!1,$(window).on("scroll",function(){var t=$(window).scrollTop();return 100<t&&!1===e.vm.fixed?(e.vm.fixed=!0,e.$digest()):t<100&&!0===e.vm.fixed?(e.vm.fixed=!1,e.$digest()):void 0})}}};t.$inject=["tgProjectService","tgLightboxFactory"],angular.module("taigaComponents").directive("tgProjectMenu",t)}.call(this),function(){var t=function(i,o,u,l){return{restrict:"AE",require:"ngModel",templateUrl:"components/promote-to-us/promote-to-us.html",link:function(t,e,r,s){var a=null,c=function(t,e){t.project;var r=function(t){return e.finish(),u.notify("success"),i.$broadcast("promote-"+a+"-to-us:success",t.data[0])},n=function(){return e.finish(),u.notify("error")};return o[t._name].promoteToUserStory(t.id,t.project).then(r,n)};return e.on("click","a",function(t){var e,r,n,i,o;return t.preventDefault(),r=s.$modelValue,e="COMMON.CONFIRM_PROMOTE."+(a=_.get({tasks:"task",issues:"issue"},r._name)).toUpperCase(),o=l.instant(e+".TITLE"),n=l.instant(e+".MESSAGE"),i=r.subject,u.ask(o,i,n).then(function(t){return c(r,t)})}),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaComponents").directive("tgPromoteToUsButton",["$rootScope","$tgResources","$tgConfirm","$translate",t])}.call(this),function(){var t=angular.module("taigaComponents"),p=this.taiga.normalizeString,d=this.taiga.groupBy,e=function(l){return{link:function(i,t,o,s){var e,n,a,r,c,u;return i.templateUrl="components/search-list/search-list-"+i.itemType+"-choice.html",i.currentSelected=null,e=[],a={},"issue"===i.itemType&&(i.milestonesById=d(i.project.milestones,function(t){return t.id})),i.filterClosed&&(i.showClosed=!1,"sprint"===i.itemType&&(i.textShowClosed=l.instant("BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS"),i.textHideClosed=l.instant("BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS"))),t.on("click",".choice",function(t){var e,r=parseInt($(t.currentTarget).data("choice-id")),n=(null!=(e=o.ngModel)?e.id:void 0)!==r?a[r]:null;return s.$setViewValue(n),i.currentSelected=n,i.$apply()}),n=function(t,e){return _.includes(r(e),r(t))},r=function(t){return"string"!=typeof t&&(t=t.toString()),p(t.toUpperCase())},u=function(){return i.currentSelected=null,s.$setViewValue(null)},c=function(){return u(),i.searchText="",e=angular.copy(i.items),a=d(e,function(t){return t.id})},i.isVisible=function(t){var e;return!(i.filterClosed&&!i.showClosed)||("sprint"!==i.itemType||!t.closed&&!t.is_closed||((null!=(e=i.currentSelected)?e.id:void 0)===t.id&&u(),!1))},i.toggleShowClosed=function(t){return i.showClosed=!i.showClosed},i.filterItems=function(r){if(i.filtering=!0,i.items=_.filter(e,function(t){var e=t.getAttrs();return Array.isArray(i.filterBy)?_.some(i.filterBy,function(t){return n(r,e[t])}):n(r,e[i.filterBy])}),!_.find(i.items,i.currentSelected))return u()},i.$watch("items",function(t){if(!i.filtering&&t)return c()})},templateUrl:"components/search-list/search-list.html",require:"ngModel",scope:{label:"@",placeholder:"@",project:"=",filterBy:"=",items:"=",itemType:"@",filterClosed:"=",itemDisabled:"="}}};t.directive("tgSearchList",["$translate",e])}.call(this),function(){var t=function(){var s=function(t){var e,r,n;return t.addClass("selected"),n=t.position().top+t.outerHeight(),(e=t.parent().outerHeight())<n?(r=n-e,t.parent().scrollTop(t.parent().scrollTop()+r)):t.position().top<0?t.parent().scrollTop(t.parent().scrollTop()+t.position().top):void 0},n=function(t,e,r){var n,i,o=t.find(".selected");if(40===e){if(!o.length)return s(t.find("li:first"));if((n=o.next("li")).length)return o.removeClass("selected"),s(n)}else if(38===e){if(!o.length)return s(t.find("li:last"));if((i=o.prev("li")).length)return o.removeClass("selected"),s(i)}},e=function(){return $(document).off(".tags-keyboard-navigation")};return{link:function(t,r){return e(),$(r).parent().on("keydown.tags-keyboard-navigation",function(t){var e=t.keyCode?t.keyCode:t.which;if(40===e||38===e)return t.preventDefault(),n(r,e)}),t.$on("$destroy",e)},templateUrl:"components/tags/tag-dropdown/tag-dropdown.html",scope:{onSelectTag:"&",colorArray:"=",tag:"="}}};angular.module("taigaCommon").directive("tgTagsDropdown",t)}.call(this),function(){var t;function e(t){this.tagLineService=t,this.disableColorSelection=!1,this.newTag={name:"",color:null},this.colorArray=[],this.addTag=!1}this.taiga.trim,t=angular.module("taigaCommon"),e.$inject=["tgTagLineService"],e.prototype.checkPermissions=function(){return this.tagLineService.checkPermissions(this.project.my_permissions,this.permissions)},e.prototype._createColorsArray=function(t){return this.colorArray=this.tagLineService.createColorsArray(t)},e.prototype.displayTagInput=function(){return this.addTag=!0},e.prototype.addNewTag=function(t,e){if(this.newTag.name="",this.newTag.color=null,t.length)return this.disableColorSelection?t.length?this.onAddTag({name:t,color:e}):void 0:(this.project.tags_colors[t]&&(e=this.project.tags_colors[t]),this.onAddTag({name:t,color:e}))},e.prototype.selectColor=function(t){return this.newTag.color=t},t.controller("TagLineCommonCtrl",e)}.call(this),function(){var t=function(){return{link:function(r,n,t,i){var e;return _.isUndefined(t.disableColorSelection)||(i.disableColorSelection=!0),e=r.$watch("vm.project",function(t){if(t&&Object.keys(t).length)return e(),i.disableColorSelection?void 0:i.colorArray=i._createColorsArray(i.project.tags_colors)}),n.on("keydown",".tag-input",function(t){var e;return 27===t.keyCode?(i.addTag=!1,i.newTag.name="",i.newTag.color="",t.stopPropagation()):13===t.keyCode&&(t.preventDefault(),n.find(".tags-dropdown .selected").length?(e=$(".tags-dropdown .selected .tags-dropdown-name").text(),i.addNewTag(e,null)):i.addNewTag(i.newTag.name,i.newTag.color)),r.$apply()})},scope:{permissions:"@",loadingAddTag:"=",loadingRemoveTag:"=",tags:"=",project:"=",onAddTag:"&",onDeleteTag:"&"},templateUrl:"components/tags/tag-line-common/tag-line-common.html",controller:"TagLineCommonCtrl",controllerAs:"vm",bindToController:!0}};angular.module("taigaCommon").directive("tgTagLineCommon",t)}.call(this),function(){var t,s;function e(t,e,r){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.loadingAddTag=!1}s=this.taiga.trim,t=angular.module("taigaCommon"),e.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation"],e.prototype.onDeleteTag=function(t){var e,r,n,i,o;return this.loadingRemoveTag=t[0],r=function(t){return i.rootScope.$broadcast("object:updated"),i.loadingRemoveTag=!1,t},o=i=this,e=function(){return o.confirm.notify("error"),o.loadingRemoveTag=!1},n=s(t[0].toLowerCase()),this.modelTransform.save(function(t){var e=_.clone(t.tags);return _.remove(e,function(t){return t[0]===n}),t.tags=e,t}).then(r,e)},e.prototype.onAddTag=function(r,n){var t,e,i,o;return this.loadingAddTag=!0,e=function(t){return i.rootScope.$broadcast("object:updated"),i.rootScope.$broadcast("tags:updated"),i.addTag=!1,i.loadingAddTag=!1,t},t=function(){return o.loadingAddTag=!1,o.confirm.notify("error")},(o=i=this).modelTransform.save(function(t){s(r.toLowerCase());var e=_.clone(t.tags);return e.push([r,n]),t.tags=e,t}).then(e,t)},t.controller("TagLineCtrl",e)}.call(this),function(){var t=function(){return{scope:{item:"=",permissions:"@",project:"="},templateUrl:"components/tags/tag-line-detail/tag-line-detail.html",controller:"TagLineCtrl",controllerAs:"vm",bindToController:!0}};angular.module("taigaCommon").directive("tgTagLine",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){}t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.checkPermissions=function(t,e){return _.includes(t,e)},e.prototype.createColorsArray=function(t){return _.map(t,function(t,e){return[e,t]})},t.service("tgTagLineService",e)}.call(this),function(){var t=function(){return{templateUrl:"components/tags/tag/tag.html",scope:{tag:"<",loadingRemoveTag:"<",onDeleteTag:"&",hasPermissions:"@"}}};angular.module("taigaCommon").directive("tgTag",t)}.call(this),function(){var t=function(s){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    levels="levels"\n    class="board-zoom"\n    value="zoomIndex"\n></tg-board-zoom>',link:function(r,t,e,n){var i,o;return r.zoomIndex=s.get("taskboard_zoom")||2,r.levels=4,o=[["ref"],["subject"],["owner","tags","extra_info","unfold"],["attachments","empty_extra_info"],["related_tasks"]],i=function(n){return null==n&&(n=0),s.get("taskboard_zoom")!==n&&s.set("taskboard_zoom",n),_.reduce(o,function(t,e,r){return r<=n&&(t=t.concat(e)),t})},r.$watch("zoomIndex",function(t){var e=i(t);return r.onZoomChange({zoomLevel:t,zoom:e})})}}};angular.module("taigaComponents").directive("tgTaskboardZoom",["$tgStorage",t])}.call(this),function(){var t=function(n,s){return{link:function(i,t,e){var o,r;if(s.hasPermission("modify_task"))return o=n(e.tgTasksSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div.single-related-task.js-related-task")}})).on("dragend",function(t){var e=$(t),r=e.scope().task,n=e.index();return i.$apply(function(){return o(i,{task:r,newIndex:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),i.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgTasksSortable",t)}.call(this),function(){var t=function(n,i,o,s,a){return{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){var t,e,r;return n.open=!1,void 0===(e=o.getUser()).read_new_terms&&((r=e.getAttrs()).read_new_terms=!1,e=a.make_model("users",r)),e.read_new_terms=!0,t=function(t){return o.setUser(t)},i.save(e).then(t)},Object.defineProperties(this,{open:{get:function(){return n.open}}})},link:function(t,e,r){return t.privacyPolicyUrl=s.get("privacyPolicyUrl"),t.termsOfServiceUrl=s.get("termsOfServiceUrl"),t.GDPRUrl=s.get("GDPRUrl")},templateUrl:"components/terms-announcement/terms-announcement.html"}};t.$inject=["tgTermsAnnouncementService","$tgRepo","$tgAuth","$tgConfig","$tgModel"],angular.module("taigaComponents").directive("tgTermsAnnouncement",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.open=!1}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.prototype.show=function(){return this.open=!0},t=e,angular.module("taigaComponents").service("tgTermsAnnouncementService",t)}.call(this),function(){var t=function(n){return{restrict:"AE",link:function(r,t,e){return r.privacyPolicyUrl=n.get("privacyPolicyUrl"),r.termsOfServiceUrl=n.get("termsOfServiceUrl"),r.target=!1,r.privacyPolicyUrl&&r.termsOfServiceUrl||(r.target=!0),t.on("change","input[name='accepted_terms']",function(t){var e=angular.element(t.currentTarget);return r.target=e.is(":checked"),r.$apply()})},scope:{target:"="},templateUrl:"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html"}};angular.module("taigaComponents").directive("tgTermsOfServiceAndPrivacyPolicyNotice",["$tgConfig",t])}.call(this),function(){var t=function(p,d,t,e,h,r,f,n,g,i,m){return{link:function(r,t,n,i){var e,o=null!=(e=g.getUser())?e.get("id"):void 0,s=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(n.requiredPerm):void 0)},a=function(t){return null!=t?t.is_iocaine:void 0},c=function(){return r.assignedUser&&r.assignedUser.id===o},u=function(e){var t;return r.loading=!0,(t=h.save(function(t){return t.assigned_to=e,t})).then(function(t){return n.ngModel=t,p.$broadcast("object:updated")}),t.then(null,function(){return d.notify("error")}),t.finally(function(){return r.loading=!1}),t},l=function(t){return r.assignedUser=r.usersById[null!=t?t.assigned_to:void 0],r.isEditable=s(),r.isIocaine=a(t),r.isSelfAssigned=c()};return t.on("click",".remove-user",function(t){var e;if(s())return t.stopPropagation(),e=f.instant("COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED"),d.ask(e).then(function(t){return t.finish(),u(null)})}),r.openAssignedUsers=function(){var t=function(t){return u(t.pop()||null)},e=_.clone(i.$modelValue,!1);return m.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[e.assigned_to],activeUsers:this.activeUsers,onClose:t,single:!0,lbTitle:f.instant("COMMON.ASSIGNED_USERS.ADD")})},r.selfAssign=function(){return u(o)},r.$watch(n.ngModel,function(t,e){if(null!=t)return l(t)}),r.$on("$destroy",function(){return t.off()})},templateUrl:"components/ticket-assigned/assigned-to.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedTo",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgLightboxFactory",t])}.call(this),function(){var m=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},t=function(l,p,t,d,e,r,h,f,g){return{scope:!0,templateUrl:"components/ticket-assigned/assigned-users.html",link:function(o,t,n,s){var a,c,e,r,i,u=null!=(e=f.getUser())?e.get("id"):void 0;return o.visibleAssignedUsersCount=4,o.displayHidden=!1,o.toggleFold=function(){return o.displayHidden=!o.displayHidden},c=function(){var t,e;return-1!==(null!=(t=o.project)&&null!=(e=t.my_permissions)?e.indexOf(n.requiredPerm):void 0)},i=function(e,r){var t;return o.loading=!0,(t=d.save(function(t){return t.assigned_users=e,r?t.assigned_to=r:e.length?_.includes(e,t.assigned_to)||(t.assigned_to=e[0]):t.assigned_to=null,t})).then(function(){return l.$broadcast("object:updated")}),t.then(null,function(){return p.notify("error")}),t.finally(function(){return o.loading=!1})},o.openAssignedUsers=function(){var t=function(t){return i(t)},e=_.clone(s.$modelValue,!1);return g.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:e.assigned_users,activeUsers:o.activeUsers,onClose:t,lbTitle:h.instant("COMMON.ASSIGNED_USERS.ADD")})},t.on("click",".user-list-single",function(t){if(c())return t.stopPropagation(),o.openAssignedUsers()}),t.on("click",".remove-user",function(t){var r,e,n,i;if(c())return t.stopPropagation(),n=angular.element(t.currentTarget),r=n.data("user-id"),i=h.instant("COMMON.ASSIGNED_USERS.TITLE_LIGHTBOX_DELETE_ASSIGNED"),e=o.usersById[r].full_name_display,p.askOnDelete(i,e).then(function(t){var e;return t.finish(),e=_.clone(s.$modelValue.assigned_users,!1),e=_.pull(e,r),a(e)})}),o.selfAssign=function(){var t;if(c())return(t=_.clone(s.$modelValue.assigned_users,!1)).push(u),t=_.uniq(t),i(t,u)},a=function(r){var t;return o.loading=!0,(t=d.save(function(t){var e;return t.assigned_users=r,e=t.assigned_to,m.call(r,e)<0&&0<r.length&&(t.assigned_to=r[0]),0===r.length&&(t.assigned_to=null),t})).then(function(){var t=d.getObj();return n.ngModel=t,l.$broadcast("object:updated")}),t.then(null,function(){return item.revert(),p.notify("error")}),t.finally(function(){return o.loading=!1})},r=function(t){var e=_.map(t,function(t){return o.usersById[t]});return o.assignedUsers=_.compact(e),o.selfAssigned=_.includes(t,u),o.isEditable=c()},o.$on("assigned-user:deleted",function(t,e){var r=_.clone(s.$modelValue.assigned_users,!1);return r=_.pull(r,e),r=_.uniq(r),a(r)}),o.$on("assigned-user:added",function(t,e){var r=_.clone(s.$modelValue.assigned_users,!1);return r.push(e),r=_.uniq(r),i(r,e)}),o.$watch(n.ngModel,function(t,e){if(null!=t)return r(t.assigned_users)}),o.$on("$destroy",function(){return t.off()})},require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedUsers",["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate","tgCurrentUserService","tgLightboxFactory",t])}.call(this),function(){var t;function e(t,e,r,n,i){this.currentUserService=t,this.rootScope=e,this.lightboxFactory=r,this.translate=n,this.modelTransform=i,this.user=this.currentUserService.getUser(),this.loading=!1}e.$inject=["tgCurrentUserService","$rootScope","tgLightboxFactory","$translate","$tgQueueModelTransformation"],e.prototype.openWatchers=function(){var e,t=function(t){return e.save(t)};return(e=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:this.item.watchers,activeUsers:this.activeUsers,onClose:t,lbTitle:this.translate.instant("COMMON.WATCHERS.ADD")})},e.prototype.getPerms=function(){return this.item?{userstories:"modify_us",issues:"modify_issue",tasks:"modify_task",epics:"modify_epic"}[this.item._name]:""},e.prototype.watch=function(){var t,e;return this.loading=!0,(t=this._watch()).finally((e=this,function(){return e.loading=!1})),t},e.prototype.unwatch=function(){var t,e;return this.loading=!0,(t=this._unwatch()).finally((e=this,function(){return e.loading=!1})),t},e.prototype.deleteWatcher=function(e){var t=_.filter(this.item.watchers,function(t){return t!==e});return this.save(t)},e.prototype.save=function(e){var t,r,n;return this.loading=!0,(t=this.modelTransform.save(function(t){return t.watchers=e,t})).then((r=this,function(){return r.rootScope.$broadcast("object:updated")})),t.finally((n=this,function(){return n.loading=!1}))},e.prototype._watch=function(){return this.onWatch()},e.prototype._unwatch=function(){return this.onUnwatch()},t=e,angular.module("taigaComponents").controller("TicketWatchersController",t)}.call(this),function(){var t=function(t,a,e,r,n,i,c,u){return{scope:!0,controller:"TicketWatchersController",bindToController:{item:"=",onWatch:"=",onUnwatch:"=",activeUsers:"="},controllerAs:"vm",templateUrl:"components/ticket-watchers/ticket-watchers.html",link:function(o,t,r){var s,e;return o.visibleWatchersCount=4,o.displayHidden=!1,o.isAuthenticated=!!u.getUser(),s=function(){var t,e;return-1!==(null!=(t=o.project)&&null!=(e=t.my_permissions)?e.indexOf(r.requiredPerm):void 0)},e=function(){var t,e=_.clone(null!=(t=o.vm.item)?t.watchers:void 0,!1),r=_.map(e,function(t){return o.usersById[t]});return r=_.filter(r,function(t){return!!t}),o.vm.watchers=_.compact(r),o.isEditable=s()},o.toggleFold=function(){return o.displayHidden=!o.displayHidden},t.on("click",".user-list-single",function(t){if(s())return t.stopPropagation(),o.vm.openWatchers()}),t.on("click",".remove-user",function(t){var e,r,n,i;if(s())return t.stopPropagation(),r=angular.element(t.currentTarget),i=r.data("watcher-id"),n=c.instant("COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER"),e=o.usersById[i].full_name_display,a.askOnDelete(n,e).then(function(t){return t.finish(),o.vm.deleteWatcher(i)})}),o.$on("watcher:added",function(t,e){var r=_.clone(o.item.watchers,!1);return r.push(e),r=_.uniq(watchers),o.vm.save(r)}),o.$on("watchers:selected",function(t,e){return o.vm.save(e)}),o.$watch("vm.item",function(t){if(t)return e()}),o.$on("$destroy",function(){return t.off()})}}};t.$inject=["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate","tgCurrentUserService"],angular.module("taigaComponents").directive("tgWatchers",t)}.call(this),function(){var c=this.taiga.timeout,t=function(o,t){var s=[{contentType:"icon",icon:"icon-project",message:"PROJECTS_ORDER"},{contentType:"icon",icon:"icon-upvote",message:"VOTING"},{contentType:"icon",icon:"icon-attach",message:"ISSUES_TO_SPRINT"},{contentType:"icon",icon:"icon-clock",message:"DUE_DATE"},{contentType:"icon",icon:"icon-iocaine",message:"IOCAIN"},{contentType:"icon",icon:"icon-blocked-project",message:"BLOCKED"},{contentType:"icon",icon:"icon-promote",message:"PROMOTE"},{contentType:"icon",icon:"icon-bulk",message:"BULK"},{contentType:"range",message:"ZOOM"},{contentType:"icon",icon:"icon-settings",message:"CUSTOM_FIELDS"},{contentType:"arrows",message:"SLIDE_ARROWS"}],a=function(t){return Math.floor(Math.random()*t)+1};return{link:function(e,t,r){var n,i;return e.tipLoaded=!1,i=null,o.onStart(function(){return i=c(1e3,function(){return n()})}),o.onEnd(function(){return clearTimeout(i),e.tipLoaded=!1}),n=function(){var t;return e.tipLoaded=!0,t=s[a(s.length-1)],e.tip={contentType:t.contentType,message:"TIPS.TIP_"+t.message,icon:t.icon,color:"tip-color-"+a(5)}}},scope:!0,templateUrl:"components/tips/tip.html"}};angular.module("taigaComponents").directive("tgTips",["tgLoader","$translate",t])}.call(this),function(){var t=function(n,i){return{scope:{usId:"=",projectSlug:"="},controllerAs:"vm",templateUrl:"components/tribe-button/tribe-button.html",link:function(t,e,r){return t.vm={},t.vm.tribeHost=n.config.tribeHost,t.vm.url=i.protocol()+"://"+i.host(),"http"===i.protocol()&&80!==i.port()||"https"===i.protocol()&&443!==i.port()?t.vm.url=t.vm.url+":"+i.port():void 0}}};t.$inject=["$tgConfig","$tgLocation"],angular.module("taigaComponents").directive("tgTribeButton",t)}.call(this),function(){var t=function(n){return{templateUrl:"components/tribe-button/tribe-linked.html",scope:{gigTitle:"=",gigId:"="},link:function(e,t,r){return e.vm={},e.vm.tribeHost=n.config.tribeHost,e.vm.show=function(){return e.vm.open=!0},e.vm.hide=function(t){return e.vm.open=!1}}}};t.$inject=["$tgConfig"],angular.module("taigaComponents").directive("tgTribeLinked",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.user=this.currentUserService.getUser(),this.loading=!1}e.$inject=["tgCurrentUserService"],e.prototype.toggleVote=function(){var t,e;return this.loading=!0,(t=this.item.is_voter?this.onDownvote():this.onUpvote()).finally((e=this,function(){return e.loading=!1})),t},t=e,angular.module("taigaComponents").controller("VoteButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"VoteButton",bindToController:{item:"=",onUpvote:"=",onDownvote:"="},controllerAs:"vm",templateUrl:"components/vote-button/vote-button.html"}};angular.module("taigaComponents").directive("tgVoteButton",t)}.call(this),function(){var t=function(i){return{scope:!0,link:function(r,t,e){var n={epics:"epic",userstories:"us",issues:"issue",tasks:"task"},s=function(t,e){return i.addAttachment(r.vm.projectId,r.vm.comment.comment.id,n[r.vm.comment.comment._name],t,!0,!0).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]),n[r.vm.comment.comment._name],t.getIn(["file","id"]))})};return r.uploadFiles=function(t,e){for(var r,n=[],i=0,o=t.length;i<o;i++)r=t[i],n.push(s(r,e));return n}},template:"<div>\n    <tg-wysiwyg\n        editonly\n        required\n        content='vm.comment.comment'\n        on-save=\"vm.saveComment(text, cb)\"\n        on-cancel=\"vm.onEditMode({commentId: vm.comment.id})\"\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}};angular.module("taigaComponents").directive("tgCommentEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t=function(i,o,a){return{scope:!0,link:function(n,t,e){var r,s;return n.editableDescription=!1,n.saveComment=function(t,e){var r;return n.content="",n.vm.type.comment=t,(r=i.save(function(t){})).then(function(){return n.vm.onAddComment&&n.vm.onAddComment(),o.$broadcast("object:updated")}),r.finally(e)},r={epics:"epic",userstories:"us",issues:"issue",tasks:"task"},s=function(t,e){return a.addAttachment(n.vm.projectId,n.vm.type.id,r[n.vm.type._name],t,!0,!0).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]),r[n.vm.type._name],t.getIn(["file","id"]))})},n.onChange=function(t){return n.vm.type.comment=t},n.uploadFiles=function(t,e){for(var r,n=[],i=0,o=t.length;i<o;i++)r=t[i],n.push(s(r,e));return n},n.content="",n.$watch("vm.type",function(t){if(t)return n.storageKey="comment-"+t.project+"-"+t.id+"-"+t._name})},template:"<div>\n    <tg-wysiwyg\n        required\n        not-persist\n        placeholder='{{\"COMMENTS.TYPE_NEW_COMMENT\" | translate}}'\n        storage-key='storageKey'\n        content='content'\n        on-save='saveComment(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}};angular.module("taigaComponents").directive("tgCommentWysiwyg",["$tgQueueModelTransformation","$rootScope","tgAttachmentsFullService",t])}.call(this),function(){var t=function(i){return{scope:!0,link:function(r,t,e){var n={userstories:"us",issues:"issue",tasks:"task"},s=function(t,e){return i.addAttachment(r.vm.projectId,r.vm.comment.comment.id,n[r.vm.comment.comment._name],t).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]),n[r.vm.comment.comment._name],t.getIn(["file","id"]))})};return r.uploadFiles=function(t,e){for(var r,n=[],i=0,o=t.length;i<o;i++)r=t[i],n.push(s(r,e));return n}},template:"<div>\n    <tg-wysiwyg\n        editonly\n        content='customAttributeValue.value'\n        on-save=\"saveCustomRichText(text, cb)\"\n        on-cancel=\"cancelCustomRichText()\"\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}};angular.module("taigaComponents").directive("tgCustomFieldEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t=function(i,o,a,c,t){return{scope:!0,link:function(r,t,n){var s;return r.editableDescription=!1,r.saveDescription=function(e,t){var r=i.save(function(t){return t.description=e,t});return r.then(function(){return a.notify("success"),o.$broadcast("object:updated")}),r.then(null,function(){return a.notify("error")}),r.finally(t)},s=function(t,e){return c.addAttachment(r.project.id,r.item.id,n.type,t).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]),n.type,t.getIn(["file","id"]))})},r.uploadFiles=function(t,e){for(var r,n=[],i=0,o=t.length;i<o;i++)r=t[i],n.push(s(r,e));return n},r.$watch(n.model,function(t){if(t)return r.item=t,r.version=t.version,r.storageKey=r.project.id+"-"+t.id+"-"+n.type}),r.$watch("project",function(t){if(t)return r.editableDescription=-1!==t.my_permissions.indexOf(n.requiredPerm)})},template:"<div>\n    <tg-wysiwyg\n        ng-if=\"editableDescription\"\n        placeholder='{{\"COMMON.DESCRIPTION.EMPTY\" | translate}}'\n        version='version'\n        storage-key='storageKey'\n        content='item.description'\n        on-save='saveDescription(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && item.description.length\"\n        ng-bind-html=\"item.description | markdownToHTML\"></div>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && !item.description.length\">\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\n    </div>\n</div>"}};angular.module("taigaComponents").directive("tgItemWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$translate",t])}.call(this),function(){var t;function e(){Prism.plugins.customClass.prefix("prism-"),Prism.plugins.customClass.map({})}e.prototype.getLanguages=function(){return new Promise((r=this,function(e,t){return r.languages?e(r.languages):r.loadPromise?r.loadPromise.then(function(){return e(r.languages)}):r.loadPromise=$.getJSON("/"+window._version+"/prism/prism-languages.json").then(function(t){return r.loadPromise=null,r.languages=_.map(t,function(t){return t.url="/"+window._version+"/prism/"+t.file,t}),e(r.languages)})}));var r},e.prototype.getLanguageInClassList=function(t){var e=_.find(this.languages,function(e){return!!_.find(t,function(t){return"language-"+e.name===t})});return e?e.name:null},e.prototype.loadLanguage=function(e){return new Promise(function(t){return Prism.languages[e]?t():ljs.load("/"+window._version+"/prism/prism-"+e+".min.js",t)})},e.prototype.replaceCodeBrToNl=function(t){return $(t).find("br").replaceWith("\n")},e.prototype.hightlightCode=function(t){var e;if(this.replaceCodeBrToNl(t),e=this.getLanguageInClassList(t.classList))return this.loadLanguage(e).then(function(){return Prism.highlightElement(t)})},e.prototype.addHightlighter=function(t){var r;return $(t).find("code").each((r=this,function(t,e){return r.hightlightCode(e)}))},t=e,angular.module("taigaComponents").service("tgWysiwygCodeHightlighterService",t)}.call(this),function(){var t=function(i){return{scope:{languages:"<",codeLanguage:"<",code:"<",visible:"<",onClose:"&",onSave:"&"},link:function(e,r,t,n){return e.$watch("visible",function(t){return t&&!r.hasClass("open")?(e.open=!0,i.open(r,null,e.onClose),e.$applyAsync(function(){var t=r[0].querySelector("textarea");if(t)return t.select()})):!t&&r.hasClass("open")?(e.open=!1,i.close(r)):void 0})},templateUrl:"components/wysiwyg/wysiwyg-code-lightbox/wysiwyg-code-lightbox.html"}};angular.module("taigaComponents").directive("tgWysiwygCodeLightbox",["lightboxService",t])}.call(this),function(){var t;function e(t,e,r,n){this.projectService=t,this.wysiwygService=e,this.navurls=r,this.rs=n,this.cancelablePromise=null,this.projectSlug=this.projectService.project.get("slug")}e.$inject=["tgProjectService","tgWysiwygService","$tgNavUrls","$tgResources"],e.prototype.search=function(e){return new Promise((r=this,function(t){return-1!=="#".indexOf(e[0])?r.searchItem(e.replace("#","")).then(t):-1!=="@".indexOf(e[0])?r.searchUser(e.replace("@",""),t):-1!==":".indexOf(e[0])?r.searchEmoji(e.replace(":",""),t):void 0}));var r},e.prototype.searchItem=function(r){return new Promise((l=this,function(c,t){var u;return r=taiga.slugify(r),u=function(e){return["subject","ref"].some(function(t){return 0<=taiga.slugify(e[t]).indexOf(r)})},l.rs.search.do(l.projectService.project.get("id"),r).then(function(t){var e,r,n,i,o,s,a=[];if(t.count&&t.count!==t.wikipages.length){for(s={issues:"project-issues-detail",userstories:"project-userstories-detail",tasks:"project-tasks-detail"},e=0,n=(i=["issues","tasks","userstories"]).length;e<n;e++)t[o=i[e]]&&(r=t[o].filter(u).map(function(t){return t.url=l.navurls.resolve(s[o],{project:l.projectSlug,ref:t.ref}),t}),a=a.concat(r));return c(_.sortBy(a,["ref"]).slice(0,10))}return c(a)})}));var l},e.prototype.searchUser=function(r,t){var e,n=this.projectService.project.toJS().members.filter(function(e){return["username","full_name","full_name_display"].some(function(t){return 0<=taiga.slugify(e[t]).indexOf(r)||0<=e[t].indexOf(r)})});return t(n=n.slice(0,10).map((e=this,function(t){return t.url=e.navurls.resolve("user-profile",{project:e.projectSlug,username:t.username}),t})))},e.prototype.searchEmoji=function(t,e){var r=this.wysiwygService.searchEmojiByName(t);return e(r=r.slice(0,10))},t=e,angular.module("taigaComponents").service("tgWysiwygMentionService",t)}.call(this),function(){var q=this.taiga,t=(this.taiga.bindOnce,function(C,P,w,A,t,O,R,M,U,D){var n=function(){if(window.getSelection){if(window.getSelection().empty)return window.getSelection().empty()}else{if(window.getSelection().removeAllRanges)return window.getSelection().removeAllRanges();if(document.selection)return document.selection.empty()}},e=function(t){return $(t.endContainer).parentsUntil(".editor","code")},i=function(t){return!!e(t).length},N=function(t,e){var r=$(t).is("code")?t:$(t).closest("code")[0],n=r.parentNode,i=document.createElement("p");return i.innerText=r.innerText,n.parentNode.replaceChild(i,n),e.checkContentChanged(e.elements[0])},o=function(t,e){var r,n,i=document.createElement("pre"),o=document.createElement("code");return t.startContainer.parentNode.nextSibling||$("<br/>").insertAfter(t.startContainer.parentNode),n=t.endContainer.parentNode.nextSibling,r=t.extractContents(),o.appendChild(r),i.appendChild(o),n.parentNode.insertBefore(i,n),x(e),e.checkContentChanged(e.elements[0])},x=function(t){var e,r,n,i,o,s,a,c,u,l;if(t){for(e=0,n=(u=t.elements[0].children).length;e<n;e++)(o=u[e])&&"p"===o.tagName.toLowerCase()&&!o.innerHTML.trim().length&&o.parentNode.removeChild(o);for(l=[],r=0,i=(c=t.elements[0].querySelectorAll("pre")).length;r<i;r++)(a=c[r]).setAttribute("contenteditable",!1),a.setAttribute("title",C.instant("COMMON.WYSIWYG.DB_CLICK")),a.addEventListener("mousedown",function(t){return t.preventDefault()}),a.nextElementSibling&&"p"===a.nextElementSibling.nodeName.toLowerCase()&&!a.nextElementSibling.children.length?l.push(a.nextElementSibling.appendChild(document.createElement("br"))):a.nextElementSibling&&-1!==["p","ul","h1","h2","h3"].indexOf(a.nextElementSibling.nodeName.toLowerCase())?l.push(void 0):((s=document.createElement("p")).appendChild(document.createElement("br")),l.push(a.parentNode.insertBefore(s,a.nextSibling)));return l}},L=MediumEditor.extensions.button.extend({name:"rtl",init:function(){var t=_.find(this.base.options.toolbar.buttons,function(t){return"rtl"===t.name});return this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML=t.contentDefault||"<b>RTL</b>",this.button.title="RTL",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(t){return"right"===MediumEditor.selection.getSelectionRange(document).commonAncestorContainer.parentNode.style.textAlign?document.execCommand("justifyLeft",!1):document.execCommand("justifyRight",!1)}}),F=function(t){return'<svg class="icon icon-'+t+'">\n    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+t+'"></use>\n</svg>'},B=MediumEditor.extensions.button.extend({name:"code",init:function(){var t=_.find(this.base.options.toolbar.buttons,function(t){return"code"===t.name});return this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML=t.contentDefault||"<b>Code</b>",this.button.title="Code",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},tagNames:["code"],handleClick:function(t){var e,r=MediumEditor.selection.getSelectionRange(self.document);if(i(r,this.base)?N(r.endContainer,this.base):(o(r,this.base),n()),e=this.base.getExtensionByName("toolbar"))return e.hideToolbar()}}),H=MediumEditor.extensions.paste.extend({doPaste:function(t,e,r){var n=MediumEditor.util.htmlEntities(e);return MediumEditor.util.insertHTMLCommand(this.document,n)}}),r=MediumEditor.util.isBlockContainer;return MediumEditor.util.isBlockContainer=function(t){return t&&"code"===(t.tagName?t.tagName:t.parentNode.tagName).toLowerCase()||r(t)},{templateUrl:"common/components/wysiwyg-toolbar.html",scope:{placeholder:"@",version:"<",storageKey:"<",content:"<",onCancel:"&",onSave:"&",onUploadFile:"&",onChange:"&"},link:function(i,t,e){var r,n,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S=null,j=t.find(".medium"),k=t.find(".markdown"),I=null,E=!!e.$attr.editonly,T=!!e.$attr.notPersist;return i.required=!!e.$attr.required,i.editMode=E||!1,i.mode=w.get("editor-mode","html"),i.markdown="",i.codeEditorVisible=!1,i.codeLans=[],R.getLanguages().then(function(t){return i.codeLans=t}),h=function(t){return i.editMode=t},f=function(t){var e=A.getHTML(t);if(j.html(e),R.addHightlighter(S.elements[0]),i.editMode)return x(S)},i.saveSnippet=function(t,e){var r;return i.codeEditorVisible=!1,I.innerText=e,r=I.parentNode,"remove-formating"===t?(I.className="",r.className="",N(I,S)):(_.trim(e).length?(t?(I.className="language-"+t,r.className="language-"+t):(I.className="",r.className=""),R.hightlightCode(I)):I.parentNode.parentNode.removeChild(I.parentNode),S.checkContentChanged(S.elements[0])),g(),null},i.setMode=function(t){return w.set("editor-mode",t),"markdown"===t?v():f(i.markdown),i.mode=t,S.trigger("editableBlur",{},j[0])},i.save=function(t){t&&t.preventDefault(),"html"===i.mode&&v(),f(i.markdown),i.required&&!i.markdown.length||(i.saving=!0,i.outdated=!1,i.onSave({text:i.markdown,cb:d}))},i.cancel=function(t){t&&t.preventDefault(),E||h(!1),T?n():"html"===i.mode&&f(i.content||null),i.markdown=i.content,s(),S.trigger("blur",{},j[0]),i.outdated=!1,x(S),i.onCancel()},n=function(){return i.markdown="",j.html("")},d=function(){return i.saving=!1,E||h(!1),T&&n(),s(),S.trigger("blur",{},j[0]),U.trackEvent("develop","save wysiwyg",i.mode,1)},y=function(t,e,r,n){return null==n&&(n=null),n&&(e=e+"#_taiga-refresh="+r+":"+n),q.isImage(t)?S.pasteHTML("<img alt='"+t+"' src='"+e+"' title='"+t+"' /><br/>"):(t=$("<div/>").text(t).html(),S.pasteHTML("<a target='_blank' href='"+e+"'>"+t+"</a><br/>"))},b=function(t,e,r,n){return null==n&&(n=null),n&&(e=e+"#_taiga-refresh="+r+":"+n),q.isImage(t)?i.markdown+="\n!["+t+"]("+e+' "'+t+'")\n':i.markdown+="\n["+t+"]("+e+")\n"},u=function(){var t=w.get(i.storageKey);return!(!t||!t.version||t.version===i.version)},c=function(){return!!w.get(i.storageKey)},a=function(){var t=w.get(i.storageKey);return t?t.text:i.content},s=function(){return w.remove(i.storageKey)},i.cancelWithConfirmation=function(){var t,e;return i.content===i.markdown?(i.cancel(),document.activeElement.blur&&document.activeElement.blur(),document.body.click(),null):(e=C.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE"),t=C.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE"),P.ask(e,null,t).then(function(t){return i.cancel(),t.finish()}))},p=function(){var t=$("<div></div>").html(j.html());return t.find("code br").replaceWith("\n"),t.html()},v=function(){var t=p();return i.markdown=A.getMarkdown(t)},l=function(t){var e;if(i.storageKey)return(e={}).version=i.version||0,e.text=t,w.set(i.storageKey,e)},r=function(){return"html"===i.mode&&v(),l(i.markdown),i.onChange({markdown:i.markdown})},g=_.throttle(r,200),o=function(t,e){var r;return null==e&&(e=!1),r="",t.length&&(r=A.getHTML(t)),A.refreshAttachmentURL(r).then(function(t){return j.html(t),S=new MediumEditor(j[0],{imageDragging:!1,placeholder:{text:i.placeholder},toolbar:{buttons:[{name:"bold",contentDefault:F("editor-bold")},{name:"italic",contentDefault:F("editor-italic")},{name:"strikethrough",contentDefault:F("editor-cross-out")},{name:"anchor",contentDefault:F("editor-link")},{name:"image",contentDefault:F("editor-image")},{name:"orderedlist",contentDefault:F("editor-list-n")},{name:"unorderedlist",contentDefault:F("editor-list-o")},{name:"h1",contentDefault:F("editor-h1")},{name:"h2",contentDefault:F("editor-h2")},{name:"h3",contentDefault:F("editor-h3")},{name:"quote",contentDefault:F("editor-quote")},{name:"removeFormat",contentDefault:F("editor-no-format")},{name:"rtl",contentDefault:F("editor-rtl")},{name:"code",contentDefault:F("editor-code")}]},extensions:{paste:new H,code:new B,autolist:new AutoList,alignright:new L,mediumMention:new MentionExtension({getItems:function(t,e){return M.search(t).then(e)}})}}),i.changeMarkdown=g,S.subscribe("editableInput",function(t){return i.$applyAsync(g)}),S.subscribe("editableClick",function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");if(t.target.href)return e.test(t.target.getAttribute("href"))||"_blank"===t.target.getAttribute("target")?(t.stopPropagation(),window.open(t.target.href)):D.url(t.target.href)}),S.subscribe("editableDrop",function(t){return i.onUploadFile({files:t.dataTransfer.files,cb:y})}),S.subscribe("editableKeydown",function(t){var e=t.keyCode?t.keyCode:t.which,r=$(".medium-mention");return 40!==e&&38!==e||!r.length?i.editMode&&27===e?(t.stopPropagation(),i.$applyAsync(i.cancelWithConfirmation)):27===e?j.blur():void 0:(t.stopPropagation(),void t.preventDefault())}),h(e),i.$applyAsync(function(){return R.addHightlighter(S.elements[0]),x(S)})})},$(j[0]).on("mousedown",function(t){return t.target.href?(t.preventDefault(),t.stopPropagation()):i.$applyAsync(function(){if(!i.editMode)return h(!0),x(S)})}),$(j[0]).on("dblclick","pre",function(t){return i.$applyAsync(function(){return i.codeEditorVisible=!0,I=t.currentTarget.querySelector("code"),i.currentCodeLanguage=R.getLanguageInClassList(I.classList),i.code=I.innerText})}),$(k).on("dragover",function(t){return t.preventDefault()}),$(k).on("dragenter",function(t){return t.preventDefault()}),$(k).on("drop",function(t){return t.preventDefault(),i.onUploadFile({files:t.originalEvent.dataTransfer.files,cb:b})}),m=i.$watch("content",function(t){var e;if(!_.isUndefined(t)){if(i.outdated=u(),!S&&c()&&h(!0),(i.markdown.length||t.length)&&i.markdown===t)return;return t=a(),i.markdown=t,S&&S.destroy(),O.open()?e=O.onEnd(function(){return o(t,i.editMode),e()}):o(t,i.editMode),m()}}),i.$on("$destroy",function(){if(S)return j.length&&$(j[0]).off(),S.destroy()})}}});angular.module("taigaComponents").directive("tgWysiwyg",["$translate","$tgConfirm","$tgStorage","tgWysiwygService","animationFrame","tgLoader","tgWysiwygCodeHightlighterService","tgWysiwygMentionService","$tgAnalytics","$location",t])}.call(this),function(){var t;function e(t,e,r,n,i,o){var s,a,c,u;for(this.wysiwygCodeHightlighterService=t,this.projectService=e,this.navurls=r,this.emojis=n,this.attachmentsService=i,this.q=o,this.members=this.projectService.project.get("members").toJS(),this.memberObjectMap={},s=0,a=(u=this.members).length;s<a;s++)c=u[s],this.memberObjectMap[c.username]=c}e.$inject=["tgWysiwygCodeHightlighterService","tgProjectService","$tgNavUrls","$tgEmojis","tgAttachmentsService","$q"],e.prototype.searchEmojiByName=function(t){return this.emojis.searchByName(t)},e.prototype.pipeLinks=function(t){return t.replace(/\[\[(.*?)\]\]/g,function(t,e,r,n){var i=e.split("|"),o=i[0];return"["+(i[1]||i[0])+"]("+o+")"})},e.prototype.replaceUrls=function(t){var e,r,n,i,o,s=document.createElement("html");for(s.innerHTML=t,e=0,r=(i=s.querySelectorAll("a")).length;e<r;e++)-1!==(n=i[e]).getAttribute("href").indexOf("/profile/")?(o=n.getAttribute("href").split("/profile/")[1],n.innerText="@"+o,n.parentNode.replaceChild(document.createTextNode(n.innerText),n)):-1!==n.getAttribute("href").indexOf("/t/")&&n.parentNode.replaceChild(document.createTextNode(n.innerText),n);return s.innerHTML},e.prototype.getAttachmentData=function(e,r,n){var i=this.q.defer();return this.attachmentsService.get(r[0],r[1]).then(function(t){return e.setAttribute(n,t.data.url+"#_taiga-refresh="+r[0]+":"+r[1]),i.resolve(e)}),i.promise},e.prototype.refreshAttachmentURL=function(t){var e,r,n,i,o,s,a=document.createElement("html");return a.innerHTML=t,o=/#_taiga-refresh=([a-zA-Z]*\:\d+)/,n={elements:a.querySelectorAll("a"),attr:"href"},r={elements:a.querySelectorAll("img"),attr:"src"},e=this.q.defer(),i=[],_.map([n,r],(s=this,function(n){return _.map(n.elements,function(t){var e,r;if(-1!==t.getAttribute(n.attr).indexOf("#_taiga-refresh=")&&(e=t.getAttribute(n.attr).match(o)))return r=e[1].split(":"),i.push(s.getAttachmentData(t,r,n.attr))})})),this.q.all(i).then(function(){return e.resolve(a.innerHTML)}),e.promise},e.prototype.searchWikiLinks=function(t){var e,r,n,i,o,s=document.createElement("html");for(s.innerHTML=t,e=0,r=(i=s.querySelectorAll("a")).length;e<r;e++)-1===(n=i[e]).getAttribute("href").indexOf("/")&&(o=this.navurls.resolve("project-wiki-page",{project:this.projectService.project.get("slug"),slug:n.getAttribute("href")}),n.setAttribute("href",o));return s.innerHTML},e.prototype.removeTrailingListBr=function(t){return t.replace(/<li>(.*?)<br><\/li>/g,"<li>$1</li>")},e.prototype.getMarkdown=function(t){var n,e={filter:["html","body","span","div"],replacement:function(t){return t}},r={filter:function(t){return"PRE"===t.nodeName&&t.firstChild&&"CODE"===t.firstChild.nodeName},replacement:(n=this,function(t,e){var r=n.wysiwygCodeHightlighterService.getLanguageInClassList(e.firstChild.classList);return"\n\n```"+(r=r||"")+"\n"+_.trim(e.firstChild.textContent)+"\n```\n\n"})};return t=t.replace(/&nbsp;(<\/.*>)/g,"$1"),t=this.emojis.replaceImgsByEmojiName(t),t=this.replaceUrls(t),t=this.removeTrailingListBr(t),toMarkdown(t,{gfm:!0,converters:[e,r]})},e.prototype.parseMentionMatches=function(t){for(var r,n=this.tagBuilder,i=[],e=/@[^\s]{1,50}[^.\s]/g,o=e.exec(t);null!==o;)r=o.index,t.charAt(r-1),o.index===e.lastIndex&&e.lastIndex++,o.forEach(function(t,e){return i.push(new Autolinker.match.Mention({tagBuilder:n,matchedText:t,offset:r,serviceName:"twitter",mention:t.slice(1)}))}),o=e.exec(t);return i},e.prototype.escapeEmojisInUrls=function(t){for(var e,r,n,i,o,s,a=taiga.getMatches(t,/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&\/\/=]*)/g),c=0,u=a.length;c<u;c++)for(s=a[c],i=0,o=(r=taiga.getMatches(s,/:([\w +-]*):/g)).length;i<o;i++)e=r[i],n=s.replace(":"+e+":","\\:"+e+"\\:"),t=t.replace(s,n);return t},e.prototype.autoLinkHTML=function(t){var e,n;return-1===String(Autolinker.matcher.Mention.prototype.matcherRegexes.twitter).indexOf(".")&&0,e=new Autolinker({mention:"twitter",hashtag:"twitter",replaceFn:(n=this,function(t){var e,r;if("mention"===t.getType()){if(r=n.navurls.resolve("user-profile",{project:n.projectService.project.get("slug"),username:t.getMention()}),!n.memberObjectMap.hasOwnProperty(t.getMention()))return'<a class="autolink" href="'+r+'">@'+t.getMention()+"</a>";if((e=n.memberObjectMap[t.getMention()]).full_name)return'<a class="autolink" href="'+r+'">@'+e.full_name+"</a>"}else if("hashtag"===t.getType())return'<a class="autolink" href="'+n.navurls.resolve("project-detail-ref",{project:n.projectService.project.get("slug"),ref:t.getHashtag()})+'">#'+t.getHashtag()+"</a>"})}),Autolinker.matcher.Mention.prototype.parseMatches=this.parseMentionMatches.bind(e),e.link(t)},e.prototype.getHTML=function(t){var e,r;return t&&t.length?(t=this.escapeEmojisInUrls(t),t=this.emojis.replaceEmojiNameByImgs(t),t=this.pipeLinks(t),(e=window.markdownit({breaks:!0})).use(window.markdownitLazyHeaders),r=e.render(t),r=this.searchWikiLinks(r),this.autoLinkHTML(r)):""},t=e,angular.module("taigaComponents").service("tgWysiwygService",t)}.call(this),function(){var t;function e(t){this.translate=t,this.is_open=!1,this.texts={week:this.translate.instant("DISCOVER.FILTERS.WEEK"),month:this.translate.instant("DISCOVER.FILTERS.MONTH"),year:this.translate.instant("DISCOVER.FILTERS.YEAR"),all:this.translate.instant("DISCOVER.FILTERS.ALL_TIME")}}e.$inject=["$translate"],e.prototype.currentText=function(){return this.texts[this.currentOrderBy]},e.prototype.open=function(){return this.is_open=!0},e.prototype.close=function(){return this.is_open=!1},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.is_open=!1,this.onChange({orderBy:this.currentOrderBy})},t=e,angular.module("taigaDiscover").controller("DiscoverHomeOrderBy",t)}.call(this),function(){var t=function(){return{controller:"DiscoverHomeOrderBy",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-home-order-by/discover-home-order-by.html",scope:{currentOrderBy:"=orderBy",onChange:"&"},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverHomeOrderBy",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.discoverProjectsService.projectsCount})),this.discoverProjectsService.fetchStats()}e.$inject=["tgDiscoverProjectsService"],e.prototype.selectFilter=function(t){return this.onChange({filter:t,q:this.q})},e.prototype.submitFilter=function(){return this.onChange({filter:this.filter,q:this.q})},t=e,angular.module("taigaDiscover").controller("DiscoverSearchBar",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearchBar",controllerAs:"vm",templateUrl:"discover/components/discover-search-bar/discover-search-bar.html",bindToController:!0,scope:{q:"=",filter:"=",onChange:"&"},compile:function(t,e){if(!e.q)return e.q=""},link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchBar",t)}.call(this),function(){var t;function e(){this.like_is_open=0===this.orderBy.indexOf("-total_fans"),this.activity_is_open=0===this.orderBy.indexOf("-total_activity")}e.$inject=[],e.prototype.openLike=function(){return this.like_is_open=!0,this.activity_is_open=!1,this.setOrderBy("-total_fans_last_week")},e.prototype.openActivity=function(){return this.activity_is_open=!0,this.like_is_open=!1,this.setOrderBy("-total_activity_last_week")},e.prototype.setOrderBy=function(t){return null==t&&(t=""),t||(this.like_is_open=!1,this.activity_is_open=!1),this.onChange({orderBy:t})},t=e,angular.module("taigaDiscover").controller("DiscoverSearchListHeader",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearchListHeader",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-search-list-header/discover-search-list-header.html",scope:{onChange:"&",orderBy:"="},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchListHeader",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"featured",(e=this,function(){return e.discoverProjectsService.featured})),this.discoverProjectsService.fetchFeatured()}e.$inject=["tgDiscoverProjectsService"],t=e,angular.module("taigaDiscover").controller("FeaturedProjects",t)}.call(this),function(){var t=function(){return{controller:"FeaturedProjects",controllerAs:"vm",templateUrl:"discover/components/featured-projects/featured-projects.html",scope:{},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgFeaturedProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"discover/components/highlighted/highlighted.html",scope:{loading:"=",highlighted:"=",orderBy:"="}}};t.$inject=[],angular.module("taigaDiscover").directive("tgHighlighted",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostActive})),this.currentOrderBy="week",this.order_by=this.getOrderBy()}e.$inject=["tgDiscoverProjectsService"],e.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostActive({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},e.prototype.getOrderBy=function(t){return"all"===this.currentOrderBy?"-total_activity":"-total_activity_last_"+this.currentOrderBy},t=e,angular.module("taigaDiscover").controller("MostActive",t)}.call(this),function(){var t=function(){return{controller:"MostActive",controllerAs:"vm",templateUrl:"discover/components/most-active/most-active.html",scope:{},link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgMostActive",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostLiked})),this.currentOrderBy="week",this.order_by=this.getOrderBy()}e.$inject=["tgDiscoverProjectsService"],e.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostLiked({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},e.prototype.getOrderBy=function(){return"all"===this.currentOrderBy?"-total_fans":"-total_fans_last_"+this.currentOrderBy},t=e,angular.module("taigaDiscover").controller("MostLiked",t)}.call(this),function(){var t=function(){return{controller:"MostLiked",controllerAs:"vm",templateUrl:"discover/components/most-liked/most-liked.html",scope:{},link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgMostLiked",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.location=t,this.navUrls=e,this.appMetaService=r,this.translate=n,o=this.translate.instant("DISCOVER.PAGE_TITLE"),i=this.translate.instant("DISCOVER.PAGE_DESCRIPTION"),this.appMetaService.setAll(o,i)}e.$inject=["$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.onSubmit=function(t){var e=this.navUrls.resolve("discover-search");return this.location.search("text",t).path(e)},t=e,angular.module("taigaDiscover").controller("DiscoverHome",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s){var a,c,u,l;this.routeParams=t,this.discoverProjectsService=e,this.route=r,this.location=n,this.analytics=i,this.appMetaService=o,this.translate=s,this.page=1,taiga.defineImmutableProperty(this,"searchResult",(u=this,function(){return u.discoverProjectsService.searchResult})),taiga.defineImmutableProperty(this,"nextSearchPage",(l=this,function(){return l.discoverProjectsService.nextSearchPage})),this.q=this.routeParams.text,this.filter=this.routeParams.filter||"all",this.orderBy=this.routeParams.order_by||"",this.loadingGlobal=!1,this.loadingList=!1,this.loadingPagination=!1,c=this.translate.instant("DISCOVER.SEARCH.PAGE_TITLE"),a=this.translate.instant("DISCOVER.SEARCH.PAGE_DESCRIPTION"),this.appMetaService.setAll(c,a),this.analytics.trackPage(this.location.url(),"Discover Search")}e.$inject=["$routeParams","tgDiscoverProjectsService","$route","$tgLocation","$tgAnalytics","tgAppMetaService","$translate"],e.prototype.fetch=function(){return this.page=1,this.discoverProjectsService.resetSearchList(),this.search()},e.prototype.fetchByGlobalSearch=function(){var t;if(!this.loadingGlobal)return this.loadingGlobal=!0,this.fetch().then((t=this,function(){return t.loadingGlobal=!1}))},e.prototype.fetchByOrderBy=function(){var t;if(!this.loadingList)return this.loadingList=!0,this.fetch().then((t=this,function(){return t.loadingList=!1}))},e.prototype.showMore=function(){var t;if(!this.loadingPagination)return this.loadingPagination=!0,this.page++,this.search().then((t=this,function(){return t.loadingPagination=!1}))},e.prototype.search=function(){var t=this.getFilter(),e={page:this.page,q:this.q,order_by:this.orderBy};return _.assign(e,t),this.discoverProjectsService.fetchSearch(e)},e.prototype.getFilter=function(){return"people"===this.filter?{is_looking_for_people:!0}:"scrum"===this.filter?{is_backlog_activated:!0}:"kanban"===this.filter?{is_kanban_activated:!0}:{}},e.prototype.onChangeFilter=function(t,e){return this.filter=t,this.q=e,this.route.updateParams({filter:this.filter,text:this.q}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByGlobalSearch()},e.prototype.onChangeOrder=function(t){return this.orderBy=t,this.route.updateParams({order_by:t}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByOrderBy()},t=e,angular.module("taigaDiscover").controller("DiscoverSearch",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearch",controllerAs:"vm",link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearch",t)}.call(this),function(){var t,c,i,o={}.hasOwnProperty;function e(t,e){var r,n,i,o,s,a;this.rs=t,this.projectsService=e,this._mostLiked=Immutable.List(),this._mostActive=Immutable.List(),this._featured=Immutable.List(),this._searchResult=Immutable.List(),this._projectsCount=0,this.decorate=this.projectsService._decorate.bind(this.projectsService),c.defineImmutableProperty(this,"mostLiked",(r=this,function(){return r._mostLiked})),c.defineImmutableProperty(this,"mostActive",(n=this,function(){return n._mostActive})),c.defineImmutableProperty(this,"featured",(i=this,function(){return i._featured})),c.defineImmutableProperty(this,"searchResult",(o=this,function(){return o._searchResult})),c.defineImmutableProperty(this,"nextSearchPage",(s=this,function(){return s._nextSearchPage})),c.defineImmutableProperty(this,"projectsCount",(a=this,function(){return a._projectsCount}))}(function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,(c=this.taiga).Service),e.$inject=["tgResources","tgProjectsService"],i={discover_mode:!0},e.prototype.fetchMostLiked=function(t){var n,e=_.extend({},i,t);return this.rs.projects.getProjects(e,!1).then((n=this,function(t){var e=t.data.slice(0,5),r=Immutable.fromJS(e);return r=r.map(n.decorate),n._mostLiked=r}))},e.prototype.fetchMostActive=function(t){var n,e=_.extend({},i,t);return this.rs.projects.getProjects(e,!1).then((n=this,function(t){var e=t.data.slice(0,5),r=Immutable.fromJS(e);return r=r.map(n.decorate),n._mostActive=r}))},e.prototype.fetchFeatured=function(){var n,t=_.extend({},i);return t.is_featured=!0,this.rs.projects.getProjects(t,!1).then((n=this,function(t){var e=t.data.slice(0,4),r=Immutable.fromJS(e);return r=r.map(n.decorate),n._featured=r}))},e.prototype.resetSearchList=function(){return this._searchResult=Immutable.List()},e.prototype.fetchStats=function(){return this.rs.stats.discover().then((e=this,function(t){return e._projectsCount=t.getIn(["projects","total"])}));var e},e.prototype.fetchSearch=function(t){var r,e=_.extend({},i,t);return this.rs.projects.getProjects(e).then((r=this,function(t){var e;return r._nextSearchPage=!!t.headers("X-Pagination-Next"),e=(e=Immutable.fromJS(t.data)).map(r.decorate),r._searchResult=r._searchResult.concat(e)}))},t=e,angular.module("taigaDiscover").service("tgDiscoverProjectsService",t)}.call(this),function(){var t,i,e,r;function n(t,e,r,n){this.confirm=t,this.projectService=e,this.epicsService=r,this.analytics=n,this.project=this.projectService.project.toJS(),this.newEpic={color:i(),status:this.project.default_epic_status,tags:[]},this.attachments=Immutable.List(),this.loading=!1}e=this.taiga,r=e.trim,i=e.getRandomDefaultColor,n.$inject=["$tgConfirm","tgProjectService","tgEpicsService","$tgAnalytics"],n.prototype.createEpic=function(){var e,r;if(this.validateForm())return this.loading=!0,this.epicsService.createEpic(this.newEpic,this.attachments).then((r=this,function(t){return r.analytics.trackEvent("epic","create","create epic",1),r.onCreateEpic(),r.loading=!1})).catch((e=this,function(t){if(e.loading=!1,e.setFormErrors(t.data),t.data._error_message)return e.confirm.notify("error",t.data._error_message)}))},n.prototype.selectColor=function(t){return this.newEpic.color=t},n.prototype.addTag=function(e,t){if(e=r(e.toLowerCase()),!_.find(this.newEpic.tags,function(t){return t[0]===e}))return this.newEpic.tags.push([e,t])},n.prototype.deleteTag=function(e){return _.remove(this.newEpic.tags,function(t){return t[0]===e[0]})},n.prototype.addAttachment=function(t){return this.attachments.push(t)},t=n,angular.module("taigaEpics").controller("CreateEpicCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){var i=e.find("form").checksley();return n.validateForm=function(){return i.validate()},n.setFormErrors=function(t){return i.setErrors(t)}},templateUrl:"epics/create-epic/create-epic.html",controller:"CreateEpicCtrl",controllerAs:"vm",bindToController:{onCreateEpic:"&"},scope:{}}};angular.module("taigaEpics").directive("tgCreateEpic",t)}.call(this),function(){var t;function e(t,e,r){this.confirm=t,this.projectService=e,this.epicsService=r,this.displayUserStories=!1,this.displayAssignedTo=!1,this.displayStatusList=!1,this.loadingStatus=!1,this.project=this.projectService.project.toJS(),this._calculateProgressBar()}e.$inject=["$tgConfirm","tgProjectService","tgEpicsService"],e.prototype._calculateProgressBar=function(){var t,e;return!0===this.epic.getIn(["status_extra_info","is_closed"])?this.percentage="100%":(t=this.epic.getIn(["user_stories_counts","progress"]),e=this.epic.getIn(["user_stories_counts","total"]),this.percentage=0===e?"0%":100*t/e+"%")},e.prototype.canEditEpics=function(){return this.projectService.hasPermission("modify_epic")},e.prototype.toggleUserStoryList=function(){return this.displayUserStories?this.displayUserStories=!1:this.epicsService.listRelatedUserStories(this.epic).then((e=this,function(t){return e.epicStories=t,e.displayUserStories=!0})).catch((t=this,function(){return t.confirm.notify("error")}));var t,e},e.prototype.updateStatus=function(t){return this.displayStatusList=!1,this.loadingStatus=!0,this.epicsService.updateEpicStatus(this.epic,t).catch((r=this,function(){return r.confirm.notify("error")})).finally((e=this,function(){return e.loadingStatus=!1}));var e,r},e.prototype.updateAssignedTo=function(t){return this.assignLoader=!0,this.epicsService.updateEpicAssignedTo(this.epic,(null!=t?t.id:void 0)||null).catch((r=this,function(){return r.confirm.notify("error")})).then((e=this,function(){return e.assignLoader=!1}));var e,r},t=e,angular.module("taigaEpics").controller("EpicRowCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/epic-row/epic-row.html",controller:"EpicRowCtrl",controllerAs:"vm",bindToController:!0,scope:{epic:"=",options:"="}}};angular.module("taigaEpics").directive("tgEpicRow",t)}.call(this),function(){var t,p;function e(t,e,r,n,i,o,s,a,c){var u,l;this.params=t,this.errorHandlingService=e,this.lightboxFactory=r,this.lightboxService=n,this.confirm=i,this.projectService=o,this.epicsService=s,this.appMetaService=a,this.translate=c,this.sectionName="EPICS.SECTION_NAME",p.defineImmutableProperty(this,"project",(u=this,function(){return u.projectService.project})),p.defineImmutableProperty(this,"epics",(l=this,function(){return l.epicsService.epics})),this.appMetaService.setfn(this._setMeta.bind(this))}p=this.taiga,e.$inject=["$routeParams","tgErrorHandlingService","tgLightboxFactory","lightboxService","$tgConfirm","tgProjectService","tgEpicsService","tgAppMetaService","$translate"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name"),projectDescription:this.project.get("description")},{title:this.translate.instant("EPICS.PAGE_TITLE",t),description:this.translate.instant("EPICS.PAGE_DESCRIPTION",t)}):null},e.prototype.loadInitialData=function(){return this.epicsService.clear(),this.projectService.setProjectBySlug(this.params.pslug).then((t=this,function(){return t.projectService.isEpicsDashboardEnabled()?t.projectService.hasPermission("view_epics")?t.epicsService.fetchEpics():t.errorHandlingService.permissionDenied():t.errorHandlingService.notFound()}));var t},e.prototype.canCreateEpics=function(){return this.projectService.hasPermission("add_epic")},e.prototype.onCreateEpic=function(){var t,e=function(){t.lightboxService.closeAll(),t.confirm.notify("success")};return(t=this).lightboxFactory.create("tg-create-epic",{class:"lightbox lightbox-create-epic open","on-create-epic":"onCreateEpic()"},{onCreateEpic:e.bind(this)})},t=e,angular.module("taigaEpics").controller("EpicsDashboardCtrl",t)}.call(this),function(){var t=function(n,s){return{link:function(i,t,e){var o,r;if(s.hasPermission("modify_epic"))return o=n(e.tgEpicsSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div.epics-table-body-row")}})).on("dragend",function(t){var e=$(t),r=e.scope().epic,n=e.index();return i.$apply(function(){return o(i,{epic:r,newIndex:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),i.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgEpicsSortable",t)}.call(this),function(){var t,c,u;function e(t,e,r,n,i){var o,s,a;this.confirm=t,this.epicsService=e,this.timeout=r,this.storage=n,this.projectService=i,this.hash=c([this.projectService.project.get("id"),"epics"]),this.displayOptions=!1,this.displayVotes=!0,this.options=this.storage.get(this.hash,{votes:!0,name:!0,project:!0,sprint:!0,assigned:!0,status:!0,progress:!0,closed:!0,closed_us:!0}),u.defineImmutableProperty(this,"epics",(o=this,function(){return o.epicsService.epics})),u.defineImmutableProperty(this,"disabledEpicsPagination",(s=this,function(){return s.epicsService._disablePagination})),u.defineImmutableProperty(this,"loadingEpics",(a=this,function(){return a.epicsService._loadingEpics}))}u=this.taiga,c=this.taiga.generateHash,e.$inject=["$tgConfirm","tgEpicsService","$timeout","$tgStorage","tgProjectService"],e.prototype.toggleEpicTableOptions=function(){return this.displayOptions=!this.displayOptions},e.prototype.reorderEpic=function(t,e){return t.get("epics_order")===e?null:this.epicsService.reorderEpic(t,e).then(null,(r=this,function(){return r.confirm.notify("error")}));var r},e.prototype.nextPage=function(){return this.epicsService.nextPage()},e.prototype.hoverEpicTableOption=function(){if(this.timer)return this.timeout.cancel(this.timer)},e.prototype.hideEpicTableOption=function(){return this.timer=this.timeout((t=this,function(){return t.displayOptions=!1}),400);var t},e.prototype.updateViewOptions=function(){return this.storage.set(this.hash,this.options)},t=e,angular.module("taigaEpics").controller("EpicsTableCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/epics-table/epics-table.html",controller:"EpicsTableCtrl",controllerAs:"vm",scope:{}}};angular.module("taigaEpics").directive("tgEpicsTable",t)}.call(this),function(){var t;function e(){this._calculateProgressBar()}t=angular.module("taigaEpics"),e.$inject=[],e.prototype._calculateProgressBar=function(){var t,e;return!0===this.story.get("is_closed")?this.percentage="100%":(t=this.story.get("tasks").size,e=this.story.get("tasks").filter(function(t){return t.get("is_closed")}).size,this.percentage=0===t?"0%":100*e/t+"%")},t.controller("StoryRowCtrl",e)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/story-row/story-row.html",controller:"StoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{story:"=",options:"="}}};angular.module("taigaEpics").directive("tgStoryRow",t)}.call(this),function(){var t,o;function e(t,e,r,n){var i;this.projectService=t,this.attachmentsService=e,this.resources=r,this.xhrError=n,this.clear(),o.defineImmutableProperty(this,"epics",(i=this,function(){return i._epics}))}o=this.taiga,e.$inject=["tgProjectService","tgAttachmentsService","tgResources","tgXhrErrorService"],e.prototype.clear=function(){return this._loadingEpics=!1,this._disablePagination=!1,this._page=1,this._epics=Immutable.List()},e.prototype.fetchEpics=function(e){return null==e&&(e=!1),this._loadingEpics=!0,this._disablePagination=!0,this.resources.epics.list(this.projectService.project.get("id"),this._page).then((n=this,function(t){return e?(n.clear(),n._epics=t.list):n._epics=n._epics.concat(t.list),n._loadingEpics=!1,n._disablePagination=!t.headers("x-pagination-next")})).catch((r=this,function(t){return r.xhrError.response(t)}));var r,n},e.prototype.nextPage=function(){return this._page++,this.fetchEpics()},e.prototype.listRelatedUserStories=function(t){return this.resources.userstories.listInEpic(t.get("id"))},e.prototype.createEpic=function(t,r,e){return t.project=e||this.projectService.project.get("id"),this.resources.epics.post(t).then((n=this,function(e){var t;return r?(t=_.map(r.toJS(),function(t){return n.attachmentsService.upload(t.file,e.get("id"),e.get("project"),"epic")}),Promise.all(t).then(n.fetchEpics.bind(n,!0))):e}));var n},e.prototype.reorderEpic=function(e,t){var r,n,i,o,s,a,c,u,l,p={};return this._epics.forEach(function(t){return p[t.get("id")]=t.get("epics_order")}),n=(u=this.epics.filter(function(t){return t.get("id")!==e.get("id")})).slice(0,t),r=u.slice(t),o=(s=n.last())?s.get("epics_order")+1:0,p[e.get("id")]=o,a=n.filter(function(t){return t.get("epics_order")===s.get("epics_order")}),c=_.fromPairs(a.map(function(t){return[t.get("id"),t.get("epics_order")]}).toJS()),r.forEach(function(t){return p[t.get("id")]=t.get("epics_order")+1}),this._epics=this._epics.map(function(t){return t.set("epics_order",p[t.get("id")])}),this._epics=this._epics.sortBy(function(t){return t.get("epics_order")}),i={epics_order:o,version:e.get("version")},this.resources.epics.reorder(e.get("id"),i,c).then((l=this,function(e){return l._epics=l._epics.map(function(t){return t.get("id")===e.get("id")?e:t})}))},e.prototype.reorderRelatedUserstory=function(t,e,r,n){var i,o=e.filter(function(t){return t.get("id")!==r.get("id")}).slice(0,n),s=o.last(),a=s?s.get("epic_order")+1:0,c=o.filter(function(t){return t.get("epic_order")===s.get("epic_order")}),u=_.fromPairs(c.map(function(t){return[t.get("id"),t.get("epic_order")]}).toJS()),l={order:a},p=t.get("id"),d=r.get("id");return this.resources.epics.reorderRelatedUserstory(p,d,l,u).then((i=this,function(){return i.listRelatedUserStories(t)}))},e.prototype.replaceEpic=function(e){return this._epics=this._epics.map(function(t){return t.get("id")===e.get("id")?e:t})},e.prototype.updateEpicStatus=function(t,e){var r={status:e,version:t.get("version")};return this.resources.epics.patch(t.get("id"),r).then(this.replaceEpic.bind(this))},e.prototype.updateEpicAssignedTo=function(t,e){var r={assigned_to:e,version:t.get("version")};return this.resources.epics.patch(t.get("id"),r).then(this.replaceEpic.bind(this))},t=e,angular.module("taigaEpics").service("tgEpicsService",t)}.call(this),function(){var t;function e(t,e){this.projectService=t,this.epicsService=e,this.sectionName="Epics",this.showCreateRelatedUserstoriesLightbox=!1}t=angular.module("taigaEpics"),e.$inject=["tgProjectService","tgEpicsService"],e.prototype.showRelatedUserStoriesSection=function(){var t;return this.projectService.hasPermission("view_epics")||0<(null!=(t=this.userstories)?t.length:void 0)},e.prototype.userCanSort=function(){return this.projectService.hasPermission("modify_epic")},e.prototype.loadRelatedUserstories=function(){return this.epicsService.listRelatedUserStories(this.epic).then((e=this,function(t){return e.userstories=t}));var e},e.prototype.reorderRelatedUserstory=function(t,e){return this.epicsService.reorderRelatedUserstory(this.epic,this.userstories,t,e).then((r=this,function(t){return r.userstories=t}));var r},t.controller("RelatedUserStoriesCtrl",e)}.call(this),function(){var t;function e(t,e,r,n){this.currentUserService=t,this.rs=e,this.confirm=r,this.analytics=n,this.projects=null,this.projectUserstories=Immutable.List(),this.loading=!1}t=angular.module("taigaEpics"),e.$inject=["tgCurrentUserService","tgResources","$tgConfirm","$tgAnalytics"],e.prototype.loadProjects=function(){if(null===this.projects)return this.projects=this.currentUserService.projects.get("unblocked")},e.prototype.filterUss=function(t,e){var n;return this.rs.userstories.listInAllProjects({project:t,q:e},!0).then((n=this,function(t){var e=n.epicUserstories.map(function(t){return t.get("id")}),r=t.filter(function(t){return-1===e.indexOf(t.get("id"))});return n.projectUserstories=r}))},e.prototype.saveRelatedUserStory=function(t,e){var r,n,i,o,s;if(this.validateExistingUserstoryForm())return this.loading=!0,n=function(t){return o.loading=!1,o.confirm.notify("error"),o.setExistingUserstoryFormErrors(t)},i=function(){return s.analytics.trackEvent("epic related user story","create","create related user story on epic",1),s.loading=!1,e&&e(),s.loadRelatedUserstories()},r=(s=o=this).epic.get("id"),this.rs.epics.addRelatedUserstory(r,t).then(i,n)},e.prototype.bulkCreateRelatedUserStories=function(t,e,r){var n,i,o,s,a;if(this.validateNewUserstoryForm())return this.loading=!0,i=function(t){return s.loading=!1,s.confirm.notify("error"),s.setNewUserstoryFormErrors(t)},o=function(){return a.analytics.trackEvent("epic related user story","create","create related user story on epic",1),a.loading=!1,r&&r(),a.loadRelatedUserstories()},n=(a=s=this).epic.get("id"),this.rs.epics.bulkCreateRelatedUserStories(n,t,e).then(o,i)},t.controller("RelatedUserstoriesCreateCtrl",e)}.call(this),function(){var t=angular.module("taigaEpics"),s=this.taiga.debounceLeading,e=function(t){return this.lightboxService=t,{link:function(e,r,t,n){var i=r.find(".new-user-story-form").checksley(),o=r.find(".existing-user-story-form").checksley();return n.validateNewUserstoryForm=function(){return i.validate()},n.setNewUserstoryFormErrors=function(t){return i.setErrors(t)},n.validateExistingUserstoryForm=function(){return o.validate()},n.setExistingUserstoryFormErrors=function(t){return o.setErrors(t)},e.showLightbox=function(t){return n.loadProjects(),e.selectProject(t).then(function(){return lightboxService.open(r.find(".lightbox-create-related-user-stories"))})},e.closeLightbox=function(){return e.selectedUserstory=null,e.searchUserstory="",e.relatedUserstoriesText="",lightboxService.close(r.find(".lightbox-create-related-user-stories"))},e.$watch("vm.project",function(t){if(null!=t)return e.selectedProject=t.get("id")}),e.selectProject=function(t){return e.selectedUserstory=null,e.searchUserstory="",n.filterUss(t,e.searchUserstory)},e.onUpdateSearchUserstory=s(300,function(){return e.selectedUserstory=null,n.filterUss(e.selectedProject,e.searchUserstory)})},templateUrl:"epics/related-userstories/related-userstories-create/related-userstories-create.html",controller:"RelatedUserstoriesCreateCtrl",controllerAs:"vm",bindToController:!0,scope:{showCreateRelatedUserstoriesLightbox:"=",project:"=",epic:"=",epicUserstories:"=",loadRelatedUserstories:"&"}}};e.$inject=["lightboxService"],t.directive("tgRelatedUserstoriesCreate",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(n,s){return{link:function(i,t,e){var o,r;if(s.hasPermission("modify_epic"))return o=n(e.tgRelatedUserstoriesSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("tg-related-userstory-row")}})).on("dragend",function(t){var e=$(t),r=e.scope().us,n=e.index();return i.$apply(function(){return o(i,{us:r,newIndex:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),i.$on("$destroy",function(){return t.off(),r.destroy()})}}};e.$inject=["$parse","tgProjectService"],t.directive("tgRelatedUserstoriesSortable",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(){return{templateUrl:"epics/related-userstories/related-userstories.html",controller:"RelatedUserStoriesCtrl",controllerAs:"vm",bindToController:!0,scope:{userstories:"=",project:"=",epic:"="}}};e.$inject=[],t.directive("tgRelatedUserstories",e)}.call(this),function(){var t;function e(t,e,r,n){this.avatarService=t,this.translate=e,this.confirm=r,this.rs=n}t=angular.module("taigaEpics"),e.$inject=["tgAvatarService","$translate","$tgConfirm","tgResources"],e.prototype.setAvatarData=function(){var t=this.userstory.get("assigned_to_extra_info");return this.avatar=this.avatarService.getAvatar(t)},e.prototype.getAssignedToFullNameDisplay=function(){return this.userstory.get("assigned_to")?this.userstory.getIn(["assigned_to_extra_info","full_name_display"]):this.translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},e.prototype.onDeleteRelatedUserstory=function(){var o,t=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),s=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:this.epic.get("subject")});return this.confirm.ask(t,null,s).then((o=this,function(t){var e=function(){return s=o.translate.instant("EPIC.ERROR_UNLINK_RELATED_USERSTORY",{errorMessage:s}),o.confirm.notify("error",null,s),t.finish(!1)},r=function(){return o.loadRelatedUserstories(),t.finish()},n=o.epic.get("id"),i=o.userstory.get("id");return o.rs.epics.deleteRelatedUserstory(n,i).then(r,e)}))},t.controller("RelatedUserstoryRowCtrl",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(){return{link:function(t,e,r,n){return n.setAvatarData()},templateUrl:"epics/related-userstories/related-userstory-row/related-userstory-row.html",controller:"RelatedUserstoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{userstory:"=",epic:"=",project:"=",loadRelatedUserstories:"&"}}};e.$inject=[],t.directive("tgRelatedUserstoryRow",e)}.call(this),function(){function d(t,e){return function(){return t.apply(e,arguments)}}var t,h,i={}.hasOwnProperty;function e(t,e,r,n,i,o,s,a){var c,u,l,p;this.routeParams=t,this.externalAppsService=e,this.window=r,this.currentUserService=n,this.location=i,this.navUrls=o,this.xhrError=s,this.loader=a,this.createApplicationToken=d(this.createApplicationToken,this),this._getApplicationToken=d(this._getApplicationToken,this),this._redirect=d(this._redirect,this),this.loader.start(!1),this._applicationId=this.routeParams.application,this._state=this.routeParams.state,this._getApplicationToken(),this._user=this.currentUserService.getUser(),this._application=null,u=encodeURIComponent(this.location.url()),c=this.navUrls.resolve("login"),this.loginWithAnotherUserUrl=c+"?next="+u+"&force_login=1",h.defineImmutableProperty(this,"user",(l=this,function(){return l._user})),h.defineImmutableProperty(this,"application",(p=this,function(){return p._application}))}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,(h=this.taiga).Controller),e.$inject=["$routeParams","tgExternalAppsService","$window","tgCurrentUserService","$location","$tgNavUrls","tgXhrErrorService","tgLoader"],e.prototype._redirect=function(t){var e=t.get("next_url");return this.window.open(e,"_self")},e.prototype._getApplicationToken=function(){return this.externalAppsService.getApplicationToken(this._applicationId,this._state).then((r=this,function(t){return r._application=t.get("application"),t.get("auth_code")?r._redirect(t):r.loader.pageLoaded()})).catch((e=this,function(t){return e.loader.pageLoaded(),e.xhrError.response(t)}));var e,r},e.prototype.cancel=function(){return this.window.history.back()},e.prototype.createApplicationToken=function(){return this.externalAppsService.authorizeApplicationToken(this._applicationId,this._state).then((r=this,function(t){return r._redirect(t)})).catch((e=this,function(t){return e.xhrError.response(t)}));var e,r},t=e,angular.module("taigaExternalApps").controller("ExternalApp",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.rs=t}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources"],e.prototype.getApplicationToken=function(t,e){return this.rs.externalapps.getApplicationToken(t,e)},e.prototype.authorizeApplicationToken=function(t,e){return this.rs.externalapps.authorizeApplicationToken(t,e)},t=e,angular.module("taigaExternalApps").service("tgExternalAppsService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.lightboxFactory=t}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgLightboxFactory"],e.prototype.sendFeedback=function(){return this.lightboxFactory.create("tg-lb-feedback",{class:"lightbox lightbox-feedback lightbox-generic-form"})},t=e,angular.module("taigaFeedback").service("tgFeedbackService",t)}.call(this),function(){var t;function e(t,e){this.rs=t,this.xhrError=e,this._contentType=null,this._objectId=null,this.clear()}this.taiga,e.$inject=["tgResources","tgXhrErrorService"],e.prototype.clear=function(){return this.page=1,this.loadingEntries=!1,this.disablePagination=!1,this.entries=Immutable.List(),this.count=null},e.prototype.fetchEntries=function(e){var r,n;if(null==e&&(e=!1),e&&(this.page=1),this.loadingEntries=!0,this.disablePagination=!0,this._contentType&&this._objectId)return this.rs.history.getHistory("activity",this._contentType,this._objectId,this.page).then((n=this,function(t){return e?(n.clear(),n.entries=t.list):n.entries=n.entries.concat(t.list),n.loadingEntries=!1,n.disablePagination=!t.headers("x-pagination-next"),n.count=t.headers("x-pagination-count"),n.entries})).catch((r=this,function(t){return r.xhrError.response(r.entries)}))},e.prototype.nextPage=function(t){return null==t&&(t="comment"),this.page++,this.fetchEntries()},e.prototype.init=function(t,e){return this._contentType=t,this._objectId=e,this.clear()},t=e,angular.module("taigaHistory").service("tgActivityService",t)}.call(this),function(){var t;function e(t,e,r){this.currentUserService=t,this.permissionService=e,this.lightboxFactory=r,this.hiddenDeletedComment=!0}t=angular.module("taigaHistory"),e.$inject=["tgCurrentUserService","tgCheckPermissionsService","tgLightboxFactory"],e.prototype.showDeletedComment=function(){return this.hiddenDeletedComment=!1},e.prototype.hideDeletedComment=function(){return this.hiddenDeletedComment=!0},e.prototype.checkCancelComment=function(t){if(27===t.keyCode)return this.onEditMode({commentId:this.comment.id})},e.prototype.canEditDeleteComment=function(){if(this.currentUserService.getUser())return this.user=this.currentUserService.getUser(),this.user.get("id")===this.comment.user.pk||this.permissionService.check("modify_project")},e.prototype.saveComment=function(t,e){return this.onEditComment({commentId:this.comment.id,commentData:t,callback:e})},e.prototype.displayCommentHistory=function(){return this.lightboxFactory.create("tg-lb-display-historic",{class:"lightbox lightbox-display-historic",comment:"comment",name:"name",object:"object"},{comment:this.comment,name:this.name,object:this.object})},t.controller("CommentCtrl",e)}.call(this),function(){var t=function(){return{scope:{name:"@",object:"@",comment:"<",type:"<",loading:"<",editing:"<",deleting:"<",objectId:"<",editMode:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onEditComment:"&"},templateUrl:"history/comments/comment.html",bindToController:!0,controller:"CommentCtrl",controllerAs:"vm"}};angular.module("taigaHistory").directive("tgComment",t)}.call(this),function(){var t;function e(){}t=angular.module("taigaHistory"),e.$inject=[],e.prototype.initializePermissions=function(){return this.canAddCommentPermission="comment_"+this.name},t.controller("CommentsCtrl",e)}.call(this),function(){var t=function(){return{scope:{type:"<",name:"@",object:"@",comments:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onAddComment:"&",onEditComment:"&",editMode:"<",loading:"<",deleting:"<",editing:"<",projectId:"=",reverse:"="},templateUrl:"history/comments/comments.html",bindToController:!0,controller:"CommentsCtrl",controllerAs:"vm",link:function(t,e,r,n){return n.initializePermissions()}}};angular.module("taigaHistory").directive("tgComments",t)}.call(this),function(){var t;function e(t){this.rs=t}t=angular.module("taigaHistory"),e.$inject=["$tgResources"],e.prototype._loadHistoric=function(){var e,t=this.name,r=this.object,n=this.comment.id;return this.rs.history.getCommentHistory(t,r,n).then((e=this,function(t){return e.commentHistoryEntries=t}))},t.controller("LightboxDisplayHistoricCtrl",e)}.call(this),function(){var t=function(i){return{scope:{},bindToController:{name:"=",object:"=",comment:"="},templateUrl:"history/history-lightbox/comment-history-lightbox.html",controller:"LightboxDisplayHistoricCtrl",controllerAs:"vm",link:function(t,e,r,n){return n._loadHistoric(),i.open(e)}}};t.$inject=["lightboxService"],angular.module("taigaHistory").directive("tgLbDisplayHistoric",t)}.call(this),function(){var t=function(){return{scope:{entry:"<"},templateUrl:"history/history-lightbox/history-entry.html"}};angular.module("taigaHistory").directive("tgHistoryEntry",t)}.call(this),function(){var t=function(){return{templateUrl:"history/history-tabs/history-tabs.html",scope:{showCommentTab:"&",showActivityTab:"&",onActiveComments:"&",onActiveActivities:"&",onOrderComments:"&",activeTab:"<",commentsNum:"<",activitiesNum:"<",onReverse:"<"}}};angular.module("taigaHistory").directive("tgHistoryTabs",t)}.call(this),function(){var t;function e(t,e,r,n,i){var o,s;this.rs=t,this.repo=e,this.storage=r,this.projectService=n,this.activityService=i,this.editing=null,this.deleting=null,this.editMode={},this.viewComments=!0,this.reverse=this.storage.get("orderComments"),taiga.defineImmutableProperty(this,"disabledActivityPagination",(o=this,function(){return o.activityService.disablePagination})),taiga.defineImmutableProperty(this,"loadingActivity",(s=this,function(){return s.activityService.loading}))}t=angular.module("taigaHistory"),e.$inject=["$tgResources","$tgRepo","$tgStorage","tgProjectService","tgActivityService"],e.prototype._loadHistory=function(){return this._loadComments(),this._loadActivity()},e.prototype._loadActivity=function(){return this.activityService.init(this.name,this.id),this.activityService.fetchEntries().then((e=this,function(t){return e.activitiesNum=e.activityService.count,e.activities=t.toJS()}));var e},e.prototype._loadComments=function(){return this.rs.history.get(this.name,this.id,"comment").then((e=this,function(t){return e.comments=_.filter(t,function(t){return""!==t.comment}),e.reverse&&(e.comments,_.reverse(e.comments)),e.commentsNum=e.comments.length}));var e},e.prototype.nextActivityPage=function(){return this.activityService.nextPage().then((e=this,function(t){return e.activities=t.toJS()}));var e},e.prototype.showHistorySection=function(){return this.showCommentTab()||this.showActivityTab()},e.prototype.showCommentTab=function(){return 0<this.commentsNum||this.projectService.hasPermission("comment_"+this.name)},e.prototype.showActivityTab=function(){return 0<this.activitiesNum},e.prototype.toggleEditMode=function(t){return this.editMode[t]=!this.editMode[t]},e.prototype.onActiveHistoryTab=function(t){return this.viewComments=t},e.prototype.deleteComment=function(t){var e,r=this.name,n=this.id,i=t;return this.deleting=t,this.rs.history.deleteComment(r,n,i).then((e=this,function(){return e._loadComments(),e.deleting=null}))},e.prototype.editComment=function(t,e){var r,n=this.name,i=this.id,o=t;return this.editing=t,this.rs.history.editComment(n,i,o,e).then((r=this,function(){return r._loadComments(),r.toggleEditMode(t),r.editing=null}))},e.prototype.restoreDeletedComment=function(t){var e,r=this.name,n=this.id,i=t;return this.editing=t,this.rs.history.undeleteComment(r,n,i).then((e=this,function(){return e._loadComments(),e.editing=null}))},e.prototype.addComment=function(){return this.editMode={},this.editing=null,this._loadComments()},e.prototype.onOrderComments=function(){return this.reverse=!this.reverse,this.storage.set("orderComments",this.reverse),this._loadComments()},t.controller("HistorySection",e)}.call(this),function(){var t=angular.module("taigaHistory"),e=(this.taiga.bindOnce,function(){return{link:function(t,e,r,n){return t.$on("object:updated",function(){return n._loadActivity()}),t.$watch("vm.id",function(t){return n._loadHistory()})},templateUrl:"history/history.html",controller:"HistorySection",controllerAs:"vm",bindToController:!0,scope:{type:"=",name:"@",id:"=",projectId:"="}}});e.$inject=[],t.directive("tgHistorySection",e)}.call(this),function(){var t;function e(){}t=angular.module("taigaHistory"),e.$inject=[],e.prototype.diffTags=function(){var e;return"tags"===this.type?(this.diffRemoveTags=_.difference(this.diff[0],this.diff[1]).toString(),this.diffAddTags=_.difference(this.diff[1],this.diff[0]).toString()):"promoted_to"===this.type?(e=_.difference(this.diff[1],this.diff[0]),this.promotedTo=_.filter(this.model.generated_user_stories,function(t){return _.includes(e,t.id)})):void 0},t.controller("ActivitiesDiffCtrl",e)}.call(this),function(){var t=function(){return{scope:{model:"<",type:"<",diff:"<"},templateUrl:"history/history/history-diff.html",controller:"ActivitiesDiffCtrl",controllerAs:"vm",bindToController:!0,link:function(t,e,r,n){return n.diffTags()}}};angular.module("taigaHistory").directive("tgHistoryDiff",t)}.call(this),function(){var t=function(){return{scope:{activities:"<",model:"<"},templateUrl:"history/history/history.html",link:function(t,e,r){}}};angular.module("taigaHistory").directive("tgHistory",t)}.call(this),function(){var t=function(t,i){return{templateUrl:"home/duties/duty.html",scope:{duty:"=tgDuty",isHidden:"=",type:"@"},link:function(e,r,t,n){return e.vm={},e.vm.duty=e.duty,e.vm.type=e.type,e.vm.isHidden=e.isHidden,e.vm.getDutyType=function(){if(e.vm.duty){if("epics"===e.vm.duty.get("_name"))return i.instant("COMMON.EPIC");if("userstories"===e.vm.duty.get("_name"))return i.instant("COMMON.USER_STORY");if("tasks"===e.vm.duty.get("_name"))return i.instant("COMMON.TASK");if("issues"===e.vm.duty.get("_name"))return i.instant("COMMON.ISSUE")}},r.on("click",".button-hide",function(t){return t.preventDefault(),r.remove(),e.$emit("duty:toggle-hidden",e.vm.duty,e.vm.type)})}}};t.$inject=["$tgNavUrls","$translate"],angular.module("taigaHome").directive("tgDuty",t)}.call(this),function(){var t;function e(t,e,r){this.currentUserService=t,this.location=e,this.navUrls=r,this.currentUserService.getUser()||this.location.path(this.navUrls.resolve("discover"))}e.$inject=["tgCurrentUserService","$location","$tgNavUrls"],t=e,angular.module("taigaHome").controller("Home",t)}.call(this),function(){var t,_,i={}.hasOwnProperty;function e(t,e,r){this.navurls=t,this.rs=e,this.projectsService=r}_=this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=["$tgNavUrls","tgResources","tgProjectsService"],e.prototype._attachProjectInfoToWorkInProgress=function(t,o){var r,e,n,i,s,a;return a=this,r=function(t,e){var r=o.get(String(t.get("project"))),n={project:r.get("slug"),ref:t.get("ref")},i=a.navurls.resolve("project-"+e+"-detail",n);return t=(t=(t=t.set("url",i)).set("project",r)).set("_name",e)},n=function(t,e){return t=(t=t.filter(function(t){return o.get(String(t.get("project")))})).map(function(t){return r(t,e)})},(i=t.get("assignedTo")).get("epics")&&(e=n(i.get("epics"),"epics"),i=i.set("epics",e)),i.get("userStories")&&(e=n(i.get("userStories"),"userstories"),i=i.set("userStories",e)),i.get("tasks")&&(e=n(i.get("tasks"),"tasks"),i=i.set("tasks",e)),i.get("issues")&&(e=n(i.get("issues"),"issues"),i=i.set("issues",e)),(s=t.get("watching")).get("epics")&&(e=n(s.get("epics"),"epics"),s=s.set("epics",e)),s.get("userStories")&&(e=n(s.get("userStories"),"userstories"),s=s.set("userStories",e)),s.get("tasks")&&(e=n(s.get("tasks"),"tasks"),s=s.set("tasks",e)),s.get("issues")&&(e=n(s.get("issues"),"issues"),s=s.set("issues",e)),(t=t.set("assignedTo",i)).set("watching",s)},e.prototype.getWorkInProgress=function(t){var e,r,n,i,o,s,a,c=Immutable.Map(),u=this.projectsService.getListProjectsByUserId(t).then(function(t){return c=Immutable.fromJS(_(t.toJS(),function(t){return t.id}))}),l=Immutable.Map(),p={status__is_closed:!1,assigned_to:t},d={is_closed:!1,assigned_users:t,dashboard:!0},h={status__is_closed:!1,assigned_to:t},f={status__is_closed:!1,assigned_to:t},g=this.rs.epics.listInAllProjects(p).then(function(t){return l=l.set("epics",t)}),m=this.rs.userstories.listInAllProjects(d).then(function(t){return l=l.set("userStories",t)}),v=this.rs.tasks.listInAllProjects(h).then(function(t){return l=l.set("tasks",t)}),y=this.rs.issues.listInAllProjects(f).then(function(t){return l=l.set("issues",t)});return f={status__is_closed:!(h={status__is_closed:!(d={is_closed:!(p={status__is_closed:!1,watchers:t}),watchers:t,dashboard:!0}),watchers:t}),watchers:t},e=Immutable.Map(),r=this.rs.epics.listInAllProjects(p).then(function(t){return e=e.set("epics",t)}),o=this.rs.userstories.listInAllProjects(d).then(function(t){return e=e.set("userStories",t)}),i=this.rs.tasks.listInAllProjects(h).then(function(t){return e=e.set("tasks",t)}),n=this.rs.issues.listInAllProjects(f).then(function(t){return e=e.set("issues",t)}),s=Immutable.Map(),Promise.all([u,g,r,m,o,v,i,y,n]).then((a=this,function(){return s=(s=s.set("assignedTo",l)).set("watching",e),s=a._attachProjectInfoToWorkInProgress(s,c)}))},t=e,angular.module("taigaHome").service("tgHomeService",t)}.call(this),function(){var t=function(i){return{templateUrl:"home/projects/home-project-list.html",scope:{},link:function(t,e,r,n){return t.vm={},taiga.defineImmutableProperty(t.vm,"projects",function(){return i.projects.get("recents")})}}};t.$inject=["tgCurrentUserService"],angular.module("taigaHome").directive("tgHomeProjectList",t)}.call(this),function(){var t;function e(t){this.homeService=t,this.assignedTo=Immutable.Map(),this.hiddenAssignedTo=[],this.showHiddenAssignedTo=!1,this.watching=Immutable.Map(),this.showHiddenWatching=!1}e.$inject=["tgHomeService"],e.prototype._setAssignedTo=function(t){var e=t.get("assignedTo").get("epics"),r=t.get("assignedTo").get("userStories"),n=t.get("assignedTo").get("tasks"),i=t.get("assignedTo").get("issues");if(this.assignedTo=r.concat(n).concat(i).concat(e),0<this.assignedTo.size)return this.assignedTo=this.assignedTo.sortBy(function(t){return t.get("modified_date")}).reverse()},e.prototype._setWatching=function(t){var e=t.get("watching").get("epics"),r=t.get("watching").get("userStories"),n=t.get("watching").get("tasks"),i=t.get("watching").get("issues");if(this.watching=r.concat(n).concat(i).concat(e),0<this.watching.size)return this.watching=this.watching.sortBy(function(t){return t.get("modified_date")}).reverse()},e.prototype.getWorkInProgress=function(t){return this.homeService.getWorkInProgress(t).then((e=this,function(t){return e._setAssignedTo(t),e._setWatching(t)}));var e},t=e,angular.module("taigaHome").controller("WorkingOn",t)}.call(this),function(){var v=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},y=(this.taiga,this.taiga.generateHash),t=function(t,g,m){return{controller:"WorkingOn",controllerAs:"vm",templateUrl:"home/working-on/working-on.html",scope:{},link:function(n,t,e,r){var i,o,s,a,c,u=function(t){var e=y(["ShowHiddenDashboardDuties",t]);return m.set(e,n.showHiddenDuties[t])},l=function(t){var e=y(["ShowHiddenDashboardDuties",t]);return m.get(e)||!1},p=function(t){var e=y(["HiddenDashboardDuties",t]);return m.set(e,n.hiddenDuties[t])},d=function(t){var e=y(["HiddenDashboardDuties",t]);return m.get(e)||[]},h=function(t,e){var r=t.get("id");return 0<=v.call(n.hiddenDuties[e],r)?n.hiddenDuties[e].splice(n.hiddenDuties[e].indexOf(t.get("id")),1):n.hiddenDuties[e].push(t.get("id")),p(e),n.$apply()},f=g.getUser();if(f){for(c=f.get("id"),r.getWorkInProgress(c),a=["working-on","watching"],n.hiddenDuties={},n.showHiddenDuties={},n.toggleShowHiddenDuties=function(t){return 0<=v.call(a,t)?(n.showHiddenDuties[t]=!n.showHiddenDuties[t],u(t)):console.error("Invalid duties slot `"+t+"`")},i=0,o=a.length;i<o;i++)s=a[i],n.hiddenDuties[s]=d(s),n.showHiddenDuties[s]=l(s);return n.$on("duty:toggle-hidden",function(t,e,r){return 0<=v.call(a,r)?h(e,r):console.error("Invalid duties slot `"+r+"`")})}}}};t.$inject=["tgHomeService","tgCurrentUserService","$tgStorage"],angular.module("taigaHome").directive("tgWorkingOn",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.projectService=t,this.rs=e,this.lightboxService=r,this.confirm=n,this.rootScope=i,this.project=this.projectService.project,this.roles=this.projectService.project.get("roles"),this.rolesValues={},this.loading=!1,this.defaultMaxInvites=4}this.taiga,e.$inject=["tgProjectService","$tgResources","lightboxService","$tgConfirm","$rootScope"],e.prototype._areRolesValidated=function(){return Object.defineProperty(this,"areRolesValidated",{get:(t=this,function(){return _.filter(_.values(t.rolesValues),function(t){return t}).length===t.contactsToInvite.size+t.emailsToInvite.size})});var t},e.prototype._checkLimitMemberships=function(){var t;return null===this.project.get("max_memberships")?this.membersLimit=this.defaultMaxInvites:(t=Math.max(this.project.get("max_memberships")-this.project.get("total_memberships"),0),this.membersLimit=Math.min(t,this.defaultMaxInvites)),this.showWarningMessage=this.membersLimit<this.defaultMaxInvites},e.prototype.sendInvites=function(){var r,e,n;return this.setInvitedContacts=[],_.forEach(this.rolesValues,(r=this,function(t,e){return r.setInvitedContacts.push({role_id:t,username:e})})),this.loading=!0,this.rs.memberships.bulkCreateMemberships(this.project.get("id"),this.setInvitedContacts,this.inviteContactsMessage).then((n=this,function(t){return n.projectService.fetchProject().then(function(){return n.loading=!1,n.lightboxService.closeAll(),n.rootScope.$broadcast("membersform:new:success"),n.confirm.notify("success")})})).catch((e=this,function(t){if(e.loading=!1,t.data._error_message)return e.confirm.notify("error",t.data._error_message)}))},t=e,angular.module("taigaAdmin").controller("InviteMembersFormCtrl",t)}.call(this),function(){var t=function(){return{scope:{},templateUrl:"invite-members/invite-members-form/invite-members-form.html",controller:"InviteMembersFormCtrl",controllerAs:"vm",bindToController:{contactsToInvite:"<",emailsToInvite:"=",onDisplayContactList:"&",onRemoveInvitedContact:"&",onRemoveInvitedEmail:"&",onSendInvites:"&"},link:function(t,e,r,n){return n._areRolesValidated(),n._checkLimitMemberships()}}};angular.module("taigaAdmin").directive("tgInviteMembersForm",t)}.call(this),function(){var t;function e(t,e,r){this.userService=t,this.currentUserService=e,this.projectService=r,this.contactsToInvite=Immutable.List(),this.emailsToInvite=Immutable.List(),this.displayContactList=!1}this.taiga,e.$inject=["tgUserService","tgCurrentUserService","tgProjectService"],e.prototype._getContacts=function(){var e,t=this.currentUserService.getUser().get("id"),r=this.projectService.project.get("id");return this.userService.getContacts(t,r).then((e=this,function(t){return e.contacts=t}))},e.prototype._filterContacts=function(e){return this.contacts=this.contacts.filter(function(t){return t.get("id")!==e.get("id")})},e.prototype.inviteSuggested=function(t){return this.contactsToInvite=this.contactsToInvite.push(t),this._filterContacts(t),this.displayContactList=!0},e.prototype.removeContact=function(e){return this.contactsToInvite=this.contactsToInvite.filter(function(t){return t.get("id")!==e.id}),e=Immutable.fromJS(e),this.contacts=this.contacts.push(e),this.testEmptyContacts()},e.prototype.inviteEmail=function(t){var e=Immutable.Map({email:t});return this.emailsToInvite=this.emailsToInvite.push(e),this.displayContactList=!0},e.prototype.removeEmail=function(e){return this.emailsToInvite=this.emailsToInvite.filter(function(t){return t.get("email")!==e.email}),this.testEmptyContacts()},e.prototype.testEmptyContacts=function(){if(this.emailsToInvite.size+this.contactsToInvite.size===0)return this.displayContactList=!1},t=e,angular.module("taigaAdmin").controller("AddMembersCtrl",t)}.call(this),function(){var t=function(i){return{scope:{},templateUrl:"invite-members/lightbox-add-members.html",controller:"AddMembersCtrl",controllerAs:"vm",link:function(t,e,r,n){return i.open(e),n._getContacts()}}};angular.module("taigaAdmin").directive("tgLbAddMembers",["lightboxService",t])}.call(this),function(){var t,e;function r(){this.contactQuery=""}e=this.taiga,r.$inject=[],r.prototype.isEmail=function(){return e.isEmail(this.contactQuery)},r.prototype.filterContacts=function(){return this.filteredContacts=this.contacts.filter((e=this,function(t){return t.get("full_name_display").toLowerCase().includes(e.contactQuery.toLowerCase())||t.get("username").toLowerCase().includes(e.contactQuery.toLowerCase())})).slice(0,12);var e},r.prototype.setInvited=function(t){return this.onInviteSuggested({contact:t})},t=r,angular.module("taigaAdmin").controller("SuggestAddMembersCtrl",t)}.call(this),function(){var t=function(t){return{scope:{},templateUrl:"invite-members/suggest-add-members/suggest-add-members.html",controller:"SuggestAddMembersCtrl",controllerAs:"vm",bindToController:{contacts:"=",onInviteSuggested:"&",onInviteEmail:"&"},link:function(t,e,r,n){return t.$watch("vm.contacts",function(t){if(t)return n.filterContacts()})}}};angular.module("taigaAdmin").directive("tgSuggestAddMembers",["lightboxService",t])}.call(this),function(){var s=this.taiga.timeout,t=function(i,o,t){return{templateUrl:"navigation-bar/dropdown-notifications/dropdown-notifications.html",scope:{active:"="},link:function(r,t,e,n){return r.notificationsList=[],r.loading=!1,r.$on("notifications:loaded",function(t,e){return r.loading=!1,void 0!==r.total&&e>r.total?(r.newEvent=!0,s(100,function(){return r.total=e,r.$apply()}),s(2e3,function(){return r.newEvent=!1})):r.total=e}),r.$on("notifications:loading",function(){return r.loading=!0}),r.setAllAsRead=function(){return o.setNotificationsAsRead().then(function(){return i.$emit("notifications:dismiss-all")})}}}};angular.module("taigaNavigationBar").directive("tgDropdownNotifications",["$rootScope","tgNotificationsService","tgCurrentUserService",t])}.call(this),function(){var t=function(o,s,a){return{templateUrl:"navigation-bar/dropdown-project-list/dropdown-project-list.html",scope:{active:"="},link:function(t,e,r,n){var i;return t.vm={},taiga.defineImmutableProperty(t.vm,"projects",function(){return s.projects.get("recents")}),t.vm.newProject=function(){return a.newProject()},i=function(){return e.find(".dropdown-project-list ul li a").data("fullUrl","")},o.$on("dropdown-project-list:updated",i)}}};t.$inject=["$rootScope","tgCurrentUserService","tgProjectsService"],angular.module("taigaNavigationBar").directive("tgDropdownProjectList",t)}.call(this),function(){var t=function(i,o,s,a,c,u){return{templateUrl:"navigation-bar/dropdown-user/dropdown-user.html",scope:{},link:function(t,e,r,n){return t.vm={},t.vm.isFeedbackEnabled=o.get("feedbackEnabled"),t.vm.customSupportUrl=o.get("supportUrl"),taiga.defineImmutableProperty(t.vm,"user",function(){return i.userData}),t.vm.logout=function(){return i.logout(),s.url(a.resolve("discover")),s.search({})},t.vm.sendFeedback=function(){return c.sendFeedback()},t.vm.userSettingsPlugins=_.filter(u.userSettingsPlugins,{userMenu:!0})}}};t.$inject=["$tgAuth","$tgConfig","$tgLocation","$tgNavUrls","tgFeedbackService","$rootScope"],angular.module("taigaNavigationBar").directive("tgDropdownUser",t)}.call(this),function(){var t=function(i,o,s,a,c){return{templateUrl:"navigation-bar/navigation-bar.html",scope:{},link:function(t,e,r,n){return t.vm={},taiga.defineImmutableProperty(t.vm,"projects",function(){return i.projects.get("recents")}),taiga.defineImmutableProperty(t.vm,"isAuthenticated",function(){return i.isAuthenticated()}),taiga.defineImmutableProperty(t.vm,"isEnabledHeader",function(){return o.isEnabledHeader()}),t.vm.publicRegisterEnabled=c.get("publicRegisterEnabled"),t.vm.customSupportUrl=c.get("supportUrl"),t.vm.login=function(){var t=encodeURIComponent(s.url());return s.url(a.resolve("login")),s.search({next:t})},t.$on("$routeChangeSuccess",function(){switch(t.vm.active=null,s.path()){case"/":return t.vm.active="dashboard";case"/discover":return t.vm.active="discover";case"/notifications":return t.vm.active="notifications";case"/projects/":return t.vm.active="projects"}})}}};t.$inject=["tgCurrentUserService","tgNavigationBarService","$tgLocation","$tgNavUrls","$tgConfig"],angular.module("taigaNavigationBar").directive("tgNavigationBar",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.disableHeader()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.prototype.enableHeader=function(){return this.enabledHeader=!0},e.prototype.disableHeader=function(){return this.enabledHeader=!1},e.prototype.isEnabledHeader=function(){return this.enabledHeader},t=e,angular.module("taigaNavigationBar").service("tgNavigationBarService",t)}.call(this),function(){var t=function(){return{templateUrl:"notifications/notifications-list/notifications-list.html",controller:"Notifications",controllerAs:"vm",bindToController:!0,scope:{infiniteScrollContainer:"@",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",onlyUnread:"=onlyUnread"}}};angular.module("taigaNotifications").directive("tgNotificationsList",t)}.call(this),function(){var t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s){var a,c,u;this.rootScope=t,this.scope=e,this.notificationsService=r,this.currentUserService=n,this.events=i,this.location=o,this.window=s,this.total=0,this.user=this.currentUserService.getUser(),this.scrollDisabled=!1,this.initList(),this.loadNotifications(),this.rootScope.$on("notifications:dismiss",(a=this,function(t){if(a.onlyUnread)return a.reloadList()})),this.rootScope.$on("notifications:new",(c=this,function(t){return c.reloadList()})),this.rootScope.$on("notifications:dismiss-all",(u=this,function(t){return u.reloadList()}))}r=this.taiga,e=this.taiga.mixOf,this.taiga.debounceLeading,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,e(r.Controller,r.PageMixin,r.FiltersMixin)),n.$inject=["$rootScope","$scope","tgNotificationsService","tgCurrentUserService","$tgEvents","$location","$window"],n.prototype.initList=function(){return this.notificationsList=Immutable.List(),this.list=this.notificationsService.getNotificationsList(this.user.get("id"),null!=this.onlyUnread),this.loading=null==this.list},n.prototype.reloadList=function(){return this.initList(),this.loadNotifications()},n.prototype.loadNotifications=function(){return this.scrollDisabled=!0,this.loading=!0,this.scope.$emit("notifications:loading"),this.list.next().then((e=this,function(t){return e.notificationsList=e.notificationsList.concat(t.get("items")),!e.infiniteScrollDisabled&&t.get("next")&&(e.scrollDisabled=!1),e.total=t.get("total"),e.scope.$emit("notifications:loaded",e.total),e.loading=!1,e.notificationsList}));var e},n.prototype.setAsRead=function(t,e){return this.notificationsService.setNotificationAsRead(t.get("id")).then((r=this,function(){return r.location.$$url===e?r.window.location.reload():r.location.path(e),r.rootScope.$broadcast("notifications:dismiss")}));var r},n.prototype.setAllAsRead=function(){return this.notificationsService.setNotificationsAsRead().then((t=this,function(){return t.rootScope.$broadcast("notifications:dismiss-all")}));var t},t=n,angular.module("taigaNotifications").controller("Notifications",t)}.call(this),function(){var t,r,n,i={}.hasOwnProperty;function e(t,e,r,n,i){this.rs=t,this.userTimelinePaginationSequenceService=e,this.translate=r,this.navUrls=n,this.tgSections=i}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgUserTimelinePaginationSequenceService","$translate","$tgNavUrls","$tgSections"],r=[{check:function(t){return 1===t.get("event_type")},key:"EVENTS.ASSIGNED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 2===t.get("event_type")},key:"EVENTS.MENTIONED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 3===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_WATCHER",translate_params:["username","obj_name"]},{check:function(t){return 4===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_MEMBER",translate_params:["username"]},{check:function(t){return 5===t.get("event_type")},key:"EVENTS.COMMENTED",translate_params:["username","obj_name"]},{check:function(t){return 6===t.get("event_type")},key:"EVENTS.MENTIONED_YOU_IN_COMMENT",translate_params:["username","obj_name"]}],n={username:function(t){var e,r,n=t.getIn(["data","user"]);return n.get("is_profile_visible")?(e=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:n.get("username")}),r=this.navUrls.resolve("user-profile",{username:t.getIn(["data","user","username"])}),this._getLink(t,r,n.get("name"),"user-link",e)):this._getUsernameSpan(n.get("name"))},project_name:function(t){var e=this.navUrls.resolve("project",{project:t.getIn(["data","project","slug"])});return this._getLink(t,e,t.getIn(["data","project","name"]),"project-link")},obj_name:function(t){var e=this._getNotificationObject(t),r=this._getDetailObjUrl(t,e.get("content_type")),n="#"+e.get("ref")+" "+e.get("subject");return this._getLink(t,r,n,"object-link")}},e.prototype.getNotificationsList=function(e,r){var n,i,t={};return t.fetch=(n=this,function(t){return n.rs.users.getNotifications(e,t,r).then(function(t){return t})}),t.map=(i=this,function(t){return i._addNotificationAttributes(t)}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.setNotificationAsRead=function(t){return this.rs.users.setNotificationAsRead(t)},e.prototype.setNotificationsAsRead=function(){return this.rs.users.setNotificationsAsRead()},e.prototype._getNotificationObject=function(t){if(t.get("data").get("obj"))return t.get("data").get("obj")},e.prototype._getType=function(e){return _.find(r,function(t){return t.check(e)})},e.prototype._addNotificationAttributes=function(t){var e=t.get("event_type"),r=this._getType(t),n=this._getTitle(t,e,r),i=(t=t.set("title_html",n)).getIn(["data","project","slug"]),o=this.tgSections.getPath(i),s=this.navUrls.resolve("project-"+o,{project:i});return t=(t=t.set("projectUrl",s)).set("obj",this._getNotificationObject(t))},e.prototype._translateTitleParams=function(t,e,r){return n[t].call(this,e,r)},e.prototype._getDetailObjUrl=function(t,e){var r={issue:"project-issues-detail",task:"project-tasks-detail",userstory:"project-userstories-detail"};return this.navUrls.resolve(r[e],{project:t.getIn(["data","project","slug"]),ref:t.getIn(["data","obj","ref"])})},e.prototype._getLink=function(t,e,r,n,i){var o;return i=i||r,o=$("<span>").attr("ng-non-bindable",!0).text(r),$('<a href="">').attr("title",i).attr("class",n).attr("ng-click",'vm.setAsRead(notification, "'+e+'")').append(o).prop("outerHTML")},e.prototype._getUsernameSpan=function(t){return $("<span>").addClass("username").text(t).prop("outerHTML")},e.prototype._getParams=function(e,r,t){var n,i={};return t.translate_params.forEach((n=this,function(t){return i[t]=n._translateTitleParams(t,e,r)})),i},e.prototype._getTitle=function(t,e,r){var n,i=this._getParams(t,e,r),o={};return Object.keys(i).forEach(function(t){return o[t]="{{"+t+"}}"}),n=this.translate.instant(r.key,o),Object.keys(i).forEach(function(t){var e="{{"+t+"}}";return n=n.replace(new RegExp(e,"g"),i[t])}),n},t=e,angular.module("taigaNotifications").service("tgNotificationsService",t)}.call(this),function(){var t;function e(t){this.userService=t,this.loadStats()}e.$inject=["tgUserService"],e.prototype.loadStats=function(){return this.userService.getStats(this.user.get("id")).then((e=this,function(t){return e.stats=t}));var e},t=e,angular.module("taigaProfile").controller("ProfileBar",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-bar/profile-bar.html",controller:"ProfileBar",controllerAs:"vm",scope:{user:"=user",isCurrentUser:"=iscurrentuser"},bindToController:!0}};angular.module("taigaProfile").directive("tgProfileBar",t)}.call(this),function(){var t;function e(t,e){this.userService=t,this.currentUserService=e,this.currentUser=this.currentUserService.getUser(),this.isCurrentUser=!1,this.currentUser&&this.currentUser.get("id")===this.user.get("id")&&(this.isCurrentUser=!0)}e.$inject=["tgUserService","tgCurrentUserService"],e.prototype.loadContacts=function(){return this.userService.getContacts(this.user.get("id")).then((e=this,function(t){return e.contacts=t}));var e},t=e,angular.module("taigaProfile").controller("ProfileContacts",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-contacts/profile-contacts.html",scope:{user:"="},controllerAs:"vm",controller:"ProfileContacts",link:function(t,e,r,n){return n.loadContacts()},bindToController:!0}};angular.module("taigaProfile").directive("tgProfileContacts",t)}.call(this),function(){var t=function(){return{scope:{item:"=tgFavItem"},link:function(t,e,r,n){return t.vm={item:t.item}},templateUrl:function(t,e){return"project"===e.itemType?"profile/profile-favs/items/project.html":"profile/profile-favs/items/ticket.html"}}};angular.module("taigaProfile").directive("tgFavItem",t)}.call(this),function(){function t(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,n,i,o,s={}.hasOwnProperty;function a(){this._init()}function c(t){this.userService=t,c.__super__.constructor.call(this),this.tabName="likes",this.enableFilterByAll=!1,this.enableFilterByProjects=!1,this.enableFilterByEpics=!1,this.enableFilterByUserStories=!1,this.enableFilterByTasks=!1,this.enableFilterByIssues=!1,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getLiked}function u(t){this.userService=t,u.__super__.constructor.call(this),this.tabName="upvotes",this.enableFilterByAll=!0,this.enableFilterByProjects=!1,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getVoted}function l(t){this.userService=t,l.__super__.constructor.call(this),this.tabName="watchers",this._getItems=this.userService.getWatched}o=this.taiga.debounceLeading,a.prototype._init=function(){return this.enableFilterByAll=!0,this.enableFilterByProjects=!0,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._resetList(),this.q=null,this.type=null},a.prototype._resetList=function(){return this.items=Immutable.List(),this.scrollDisabled=!1,this._page=1},a.prototype._enableLoadingSpinner=function(){return this.isLoading=!0},a.prototype._disableLoadingSpinner=function(){return this.isLoading=!1},a.prototype._enableScroll=function(){return this.scrollDisabled=!1},a.prototype._disableScroll=function(){return this.scrollDisabled=!0},a.prototype._checkIfHasMorePages=function(t){return t?(this._page+=1,this._enableScroll()):this._disableScroll()},a.prototype._checkIfHasNoResults=function(){return this.hasNoResults=0===this.items.size},a.prototype.loadItems=function(){return this._enableLoadingSpinner(),this._disableScroll(),this._getItems(this.user.get("id"),this._page,this.type,this.q).then((e=this,function(t){return e.items=e.items.concat(t.get("data")),e._checkIfHasMorePages(t.get("next")),e._checkIfHasNoResults(),e._disableLoadingSpinner(),e.items})).catch((t=this,function(){return t._disableLoadingSpinner(),t.items}));var t,e},a.prototype.filterByTextQuery=o(500,function(){return this._resetList(),this.loadItems()}),a.prototype.showAll=function(){if(null!==this.type)return this.type=null,this._resetList(),this.loadItems()},a.prototype.showProjectsOnly=function(){if("project"!==this.type)return this.type="project",this._resetList(),this.loadItems()},a.prototype.showEpicsOnly=function(){if("epic"!==this.type)return this.type="epic",this._resetList(),this.loadItems()},a.prototype.showUserStoriesOnly=function(){if("userstory"!==this.type)return this.type="userstory",this._resetList(),this.loadItems()},a.prototype.showTasksOnly=function(){if("task"!==this.type)return this.type="task",this._resetList(),this.loadItems()},a.prototype.showIssuesOnly=function(){if("issue"!==this.type)return this.type="issue",this._resetList(),this.loadItems()},t(c,e=a),c.$inject=["tgUserService"],r=c,angular.module("taigaProfile").controller("ProfileLiked",r),t(u,e),u.$inject=["tgUserService"],n=u,angular.module("taigaProfile").controller("ProfileVoted",n),t(l,e),l.$inject=["tgUserService"],i=l,angular.module("taigaProfile").controller("ProfileWatched",i)}.call(this),function(){var t,e,r={scope:{},bindToController:{user:"=",type:"@",q:"@",scrollDisabled:"@",isLoading:"@",hasNoResults:"@"},controller:null,controllerAs:"vm",templateUrl:"profile/profile-favs/profile-favs.html"},n=function(){return _.extend({},r,{controller:"ProfileLiked"})};angular.module("taigaProfile").directive("tgProfileLiked",n),t=function(){return _.extend({},r,{controller:"ProfileVoted"})},angular.module("taigaProfile").directive("tgProfileVoted",t),e=function(){return _.extend({},r,{controller:"ProfileWatched"})},angular.module("taigaProfile").directive("tgProfileWatched",e)}.call(this),function(){var t;function e(t){var e;this.translate=t,e=Math.floor(Math.random()*this.HINTS.length)+1,this.hint=this.HINTS[e-1],this.hint.linkText=this.hint.linkText||"HINTS.LINK",this.hint.title=this.translate.instant("HINTS.HINT"+e+"_TITLE"),this.hint.text=this.translate.instant("HINTS.HINT"+e+"_TEXT")}e.prototype.HINTS=[{url:"https://tree.taiga.io/support/admin/import-export-projects/"},{url:"https://tree.taiga.io/support/admin/custom-fields/"},{},{}],(t=e).$inject=["$translate"],angular.module("taigaProfile").controller("ProfileHints",t)}.call(this),function(){var t=function(t){return{scope:{},controller:"ProfileHints",controllerAs:"vm",templateUrl:"profile/profile-hints/profile-hints.html"}};t.$inject=["$translate"],angular.module("taigaProfile").directive("tgProfileHints",t)}.call(this),function(){var t;function e(t,e){this.projectsService=t,this.userService=e}e.$inject=["tgProjectsService","tgUserService"],e.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this.user.get("id")).then((r=this,function(t){return r.userService.attachUserContactsToProjects(r.user.get("id"),t)})).then((e=this,function(t){return e.projects=t}));var e,r},t=e,angular.module("taigaProfile").controller("ProfileProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-projects/profile-projects.html",scope:{user:"="},link:function(t,e,r,n){return n.loadProjects()},bindToController:!0,controllerAs:"vm",controller:"ProfileProjects"}};angular.module("taigaProfile").directive("tgProfileProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-tab/profile-tab.html",scope:{},require:"^tgProfileTabs",link:function(e,t,r,n,i){if(e.tab={},r.$observe("tgProfileTab",function(t){return e.tab.name=t}),r.$observe("tabTitle",function(t){return e.tab.title=t}),e.tab.icon=r.tabIcon,e.tab.active=!!r.tabActive,!0!==e.$eval(r.tabDisabled))return n.addTab(e.tab)},transclude:!0}};angular.module("taigaProfile").directive("tgProfileTab",t)}.call(this),function(){var t;function e(){this.tabs=[]}e.prototype.addTab=function(t){return this.tabs.push(t)},e.prototype.toggleTab=function(t){return _.map(this.tabs,function(t){return t.active=!1}),t.active=!0},t=e,angular.module("taigaProfile").controller("ProfileTabs",t)}.call(this),function(){var t=function(){return{scope:{},controller:"ProfileTabs",controllerAs:"vm",templateUrl:"profile/profile-tabs/profile-tabs.html",transclude:!0}};angular.module("taigaProfile").directive("tgProfileTabs",t)}.call(this),function(){var t;function e(t,e,r,n,i,o){var s,a;this.appMetaService=t,this.currentUserService=e,this.routeParams=r,this.userService=n,this.xhrError=i,this.translate=o,this.isCurrentUser=!1,this.routeParams.slug?this.userService.getUserByUserName(this.routeParams.slug).then((a=this,function(t){return t.get("is_active")?(a.user=t,a.isCurrentUser=!1,a._setMeta(a.user),t):a.xhrError.notFound()})).catch((s=this,function(t){return s.xhrError.response(t)})):(this.user=this.currentUserService.getUser(),this.isCurrentUser=!0,this._setMeta(this.user))}e.$inject=["tgAppMetaService","tgCurrentUserService","$routeParams","tgUserService","tgXhrErrorService","$translate"],e.prototype._setMeta=function(t){var e={userFullName:t.get("full_name_display"),userUsername:t.get("username")},r=this.translate.instant("USER.PROFILE.PAGE_TITLE",e),n=t.get("bio");return this.appMetaService.setAll(r,n)},t=e,angular.module("taigaProfile").controller("Profile",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/project/blocked-project-explanation.html"}};angular.module("taigaProjects").directive("tgBlockedProjectExplanation",t)}.call(this),function(){var t;function e(t){this.lightboxFactory=t}e.$inject=["tgLightboxFactory"],e.prototype.launchContactForm=function(){return this.lightboxFactory.create("tg-lb-contact-project",{class:"lightbox lightbox-contact-project e2e-lightbox-contact-project",project:"project"},{project:this.project})},t=e,angular.module("taigaProjects").controller("ContactProjectButtonCtrl",t)}.call(this),function(){var t=function(){return{scope:{},controller:"ContactProjectButtonCtrl",bindToController:{project:"=",layout:"@"},controllerAs:"vm",templateUrl:"projects/components/contact-project-button/contact-project-button.html"}};angular.module("taigaProjects").directive("tgContactProjectButton",t)}.call(this),function(){var t;function e(t,e,r){this.lightboxService=t,this.rs=e,this.confirm=r,this.contact={}}e.$inject=["lightboxService","tgResources","$tgConfirm"],e.prototype.contactProject=function(){var t,e=this.project.get("id"),r=this.contact.message,n=this.rs.projects.contactProject(e,r);return this.sendingFeedback=!0,n.then((t=this,function(){return t.lightboxService.closeAll(),t.sendingFeedback=!1,t.confirm.notify("success")}))},t=e,angular.module("taigaProjects").controller("ContactProjectLbCtrl",t)}.call(this),function(){var t=function(r){return this.inject=["lightboxService"],{controller:"ContactProjectLbCtrl",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/lb-contact-project/lb-contact-project.html",link:function(t,e){return r.open(e)}}};angular.module("taigaProjects").directive("tgLbContactProject",["lightboxService",t])}.call(this),function(){var t;function e(t,e){this.confirm=t,this.likeButtonService=e,this.isMouseOver=!1,this.loading=!1}e.$inject=["$tgConfirm","tgLikeProjectButtonService"],e.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},e.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},e.prototype.toggleLike=function(){var t,e;return this.loading=!0,(t=this.project.get("is_fan")?this._unlike():this._like()).finally((e=this,function(){return e.loading=!1})),t},e.prototype._like=function(){return this.likeButtonService.like(this.project.get("id")).then((e=this,function(){return e.showTextWhenMouseIsLeave()})).catch((t=this,function(){return t.confirm.notify("error")}));var t,e},e.prototype._unlike=function(){return this.likeButtonService.unlike(this.project.get("id")).catch((t=this,function(){return t.confirm.notify("error")}));var t},t=e,angular.module("taigaProjects").controller("LikeProjectButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"LikeProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/like-project-button/like-project-button.html"}};angular.module("taigaProjects").directive("tgLikeProjectButton",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(e){return this.currentUserService.projects.get("all").findIndex(function(t){return t.get("id")===e})},e.prototype._updateProjects=function(t,r){var e,n=this._getProjectIndex(t);if(-1!==n)return e=this.currentUserService.projects.get("all").update(n,function(t){var e=t.get("total_fans");return r?e++:e--,t.merge({is_fan:r,total_fans:e})}),this.currentUserService.setProjects(e)},e.prototype._updateCurrentProject=function(t){var e,r=this.projectService.project.get("total_fans");return t?r++:r--,e=this.projectService.project.merge({is_fan:t,total_fans:r}),this.projectService.setProject(e)},e.prototype.like=function(t){return this.rs.projects.likeProject(t).then((e=this,function(){return e._updateProjects(t,!0),e._updateCurrentProject(!0)}));var e},e.prototype.unlike=function(t){return this.rs.projects.unlikeProject(t).then((e=this,function(){return e._updateProjects(t,!1),e._updateCurrentProject(!1)}));var e},t=e,angular.module("taigaProjects").service("tgLikeProjectButtonService",t)}.call(this),function(){var t=function(l){return{scope:{projects:"=tgSortProjects"},link:function(c,t,e,r){var u=null,n=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).hasClass("list-itemtype-project")}});return n.on("dragend",function(t){var e,r,n,i,o=(u=$(t)).scope().project,s=u.index(),a=_.map(c.projects.toJS(),function(t){return t.id});for((a=_.without(a,o.get("id"))).splice(s,0,o.get("id")),n=[],s=e=0,r=a.length;e<r;s=++e)i=a[s],n.push({project_id:i,order:s});return l.bulkUpdateProjectsOrder(n)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&n.dragging}}),c.$on("$destroy",function(){return t.off(),n.destroy()})}}};angular.module("taigaProjects").directive("tgSortProjects",["tgCurrentUserService",t])}.call(this),function(){var t;function e(t,e){this.confirm=t,this.watchButtonService=e,this.showWatchOptions=!1,this.loading=!1}e.$inject=["$tgConfirm","tgWatchProjectButtonService"],e.prototype.toggleWatcherOptions=function(){return this.showWatchOptions=!this.showWatchOptions},e.prototype.closeWatcherOptions=function(){return this.showWatchOptions=!1},e.prototype.watch=function(t){var e,r;if(t!==this.project.get("notify_level"))return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.watch(this.project.get("id"),t).catch((r=this,function(){return r.confirm.notify("error")})).finally((e=this,function(){return e.loading=!1}))},e.prototype.unwatch=function(){return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.unwatch(this.project.get("id")).catch((e=this,function(){return e.confirm.notify("error")})).finally((t=this,function(){return t.loading=!1}));var t,e},t=e,angular.module("taigaProjects").controller("WatchProjectButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"WatchProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/watch-project-button/watch-project-button.html"}};angular.module("taigaProjects").directive("tgWatchProjectButton",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(e){return this.currentUserService.projects.get("all").findIndex(function(t){return t.get("id")===e})},e.prototype._updateProjects=function(t,r,n){var e=this._getProjectIndex(t);if(-1!==e){var i,o=this.currentUserService.projects.get("all").update(e,(i=this,function(t){var e=t.get("total_watchers");return!i.projectService.project.get("is_watcher")&&n?e++:i.projectService.project.get("is_watcher")&&!n&&e--,t.merge({is_watcher:n,total_watchers:e,notify_level:r})}));return this.currentUserService.setProjects(o)}},e.prototype._updateCurrentProject=function(t,e){var r,n=this.projectService.project.get("total_watchers");return!this.projectService.project.get("is_watcher")&&e?n++:this.projectService.project.get("is_watcher")&&!e&&n--,r=this.projectService.project.merge({is_watcher:e,notify_level:t,total_watchers:n}),this.projectService.setProject(r)},e.prototype.watch=function(t,e){return this.rs.projects.watchProject(t,e).then((r=this,function(){return r._updateProjects(t,e,!0),r._updateCurrentProject(e,!0)}));var r},e.prototype.unwatch=function(t){return this.rs.projects.unwatchProject(t).then((e=this,function(){return e._updateProjects(t,null,!1),e._updateCurrentProject(null,!1)}));var e},t=e,angular.module("taigaProjects").service("tgWatchProjectButtonService",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Asana",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="scrum",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("AsanaImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/asana-import/asana-import-project-form/asana-import-project-form.html",controller:"AsanaImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgAsanaImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.asanaImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-asana",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.asanaImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.asanaImportService.projectUsers}))}e.$inject=["tgAsanaImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-asana",this.asanaImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-asana",this.project=t,this.fetchingUsers=!0,this.asanaImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-asana"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-asana"},e.prototype.startImport=function(t){var e,r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return r.start(),e=this.asanaImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(e).then(function(){return r.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("AsanaImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/asana-import/asana-import.html",controller:"AsanaImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgAsanaImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$location"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.asanaImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.asanaImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.asanaImporter.importProject(this.token,t,e,r,n,i,o,s)},e.prototype.getAuthUrl=function(){return new Promise((r=this,function(e){return r.resources.asanaImporter.getAuthUrl().then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return new Promise((n=this,function(e,r){return n.resources.asanaImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgAsanaImportService",t)}.call(this),function(){var t;function e(t,e,r,n,i,o){this.currentUserService=t,this.projectsService=e,this.projectUrl=r,this.location=n,this.navUrls=i,this.analytics=o,this.projectForm={is_private:!1},this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0),"scrum"===this.type?this.projectForm.creation_template=1:this.projectForm.creation_template=2}e.$inject=["tgCurrentUserService","tgProjectsService","$projectUrl","$location","$tgNavUrls","$tgAnalytics"],e.prototype.submit=function(){return this.formSubmitLoading=!0,this.projectsService.create(this.projectForm).then((e=this,function(t){return e.analytics.trackEvent("project","create","project creation",{slug:t.get("slug"),id:t.get("id")}),e.location.url(e.projectUrl.get(t)),e.currentUserService.loadProjects()}));var e},e.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},e.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("CreateProjectFormCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/create-project-form/create-project-form.html",controller:"CreateProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{type:"@"}}};angular.module("taigaProjects").directive("tgCreateProjectForm",t)}.call(this),function(){var t=function(){return{scope:{isPrivate:"=",limitMembersPrivateProject:"=",limitMembersPublicProject:"="},templateUrl:"projects/create/create-project-members-restrictions/create-project-members-restrictions.html"}};angular.module("taigaProject").directive("tgCreateProjectMembersRestrictions",[t])}.call(this),function(){var t=function(){return{scope:{isPrivate:"=",canCreatePrivateProjects:"=",canCreatePublicProjects:"="},templateUrl:"projects/create/create-project-restrictions/create-project-restrictions.html"}};angular.module("taigaProject").directive("tgCreateProjectRestrictions",[t])}.call(this),function(){var t;function e(t,e,r,n,i){var o;this.appMetaService=t,this.translate=e,this.projectService=r,this.location=n,this.authService=i,taiga.defineImmutableProperty(this,"project",(o=this,function(){return o.projectService.project})),this.appMetaService.setfn(this._setMeta.bind(this)),this.authService.refresh(),this.displayScrumDesc=!1,this.displayKanbanDesc=!1}e.$inject=["tgAppMetaService","$translate","tgProjectService","$location","$tgAuth"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},e.prototype.displayHelp=function(t,e){if(e.stopPropagation(),e.preventDefault(),"scrum"===t&&(this.displayScrumDesc=!this.displayScrumDesc),"kanban"===t)return this.displayKanbanDesc=!this.displayKanbanDesc},t=e,angular.module("taigaProjects").controller("CreateProjectCtrl",t)}.call(this),function(){var t;function e(t,e,r,n){var i;this.currentUserService=t,this.projectsService=e,this.location=r,this.navUrls=n,this.user=this.currentUserService.getUser(),this.members=Immutable.List(),this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.currentUserService.projects.get("all")})),this.projectForm={is_private:!1},!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService","tgProjectsService","$tgLocation","$tgNavUrls"],e.prototype.refreshReferenceProject=function(t){return this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.referenceProject=t,e.members=t.get("members").filter(function(t){return t.get("id")!==e.user.get("id")}),e.invitedMembers=e.members.map(function(t){return t.get("id")}),e.checkUsersLimit()}));var e},e.prototype.toggleInvitedMember=function(e){return this.invitedMembers.includes(e)?this.invitedMembers=this.invitedMembers.filter(function(t){return t!==e}):this.invitedMembers=this.invitedMembers.push(e),this.checkUsersLimit()},e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.invitedMembers.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.invitedMembers.size+1)},e.prototype.submit=function(){var e,t=this.referenceProject.get("id"),r=this.projectForm;return r.users=this.invitedMembers,this.formSubmitLoading=!0,this.projectsService.duplicate(t,r).then((e=this,function(t){return e.formSubmitLoading=!1,e.location.path(e.navUrls.resolve("project",{project:t.data.slug})),e.currentUserService.loadProjects()}))},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid&&this.limitMembersPrivateProject.valid:this.canCreatePublicProjects.valid&&this.limitMembersPublicProject.valid},e.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},e.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},t=e,angular.module("taigaProjects").controller("DuplicateProjectCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/duplicate/duplicate-project.html",controller:"DuplicateProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{}}};t.$inject=[],angular.module("taigaProjects").directive("tgDuplicateProject",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Github",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="kanban",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("GithubImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/github-import/github-import-project-form/github-import-project-form.html",controller:"GithubImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgGithubImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.githubImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-github",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.githubImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.githubImportService.projectUsers}))}e.$inject=["tgGithubImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-github",this.githubImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-github",this.project=t,this.fetchingUsers=!0,this.githubImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-github"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-github"},e.prototype.startImport=function(t){var e,r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return r.start(),e=this.githubImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(e).then(function(){return r.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("GithubImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/github-import/github-import.html",controller:"GithubImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgGithubImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.githubImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.githubImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.githubImporter.importProject(this.token,t,e,r,n,i,o,s)},e.prototype.getAuthUrl=function(t){return new Promise((r=this,function(e){return r.resources.githubImporter.getAuthUrl(t).then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return new Promise((n=this,function(e,r){return n.resources.githubImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgGithubImportService",t)}.call(this),function(){var t;function e(t,e){this.currentUserService=t,this.userService=e,this.selectImportUserLightbox=!1,this.warningImportUsers=!1,this.displayEmailSelector=!0,this.cancelledUsers=Immutable.List(),this.selectedUsers=Immutable.List(),this.selectableUsers=Immutable.List(),this.userContacts=Immutable.List()}e.$inject=["tgCurrentUserService","tgUserService"],e.prototype.fetchUser=function(){return this.currentUser=this.currentUserService.getUser(),this.userService.getContacts(this.currentUser.get("id")).then((e=this,function(t){return e.userContacts=t,e.refreshSelectableUsers()}));var e},e.prototype.searchUser=function(t){return this.selectImportUserLightbox=!0,this.searchingUser=t},e.prototype.beforeSubmitUsers=function(){return this.selectedUsers.size!==this.members.size?this.warningImportUsers=!0:this.submit()},e.prototype.confirmUser=function(t,e){var r;return this.selectImportUserLightbox=!1,r=(r=(r=Immutable.Map()).set("user",t)).set("taigaUser",e),this.selectedUsers=this.selectedUsers.push(r),this.discardSuggestedUser(t),this.refreshSelectableUsers()},e.prototype.unselectUser=function(e){var t=this.selectedUsers.findIndex(function(t){return t.getIn(["user","id"])===e.get("id")});return this.selectedUsers=this.selectedUsers.delete(t),this.refreshSelectableUsers()},e.prototype.discardSuggestedUser=function(t){return this.cancelledUsers=this.cancelledUsers.push(t.get("id"))},e.prototype.getSelectedMember=function(e){return this.selectedUsers.find(function(t){return t.getIn(["user","id"])===e.get("id")})},e.prototype.isMemberSelected=function(t){return!!this.getSelectedMember(t)},e.prototype.getUser=function(t){var e=this.getSelectedMember(t);return e?e.get("taigaUser"):null},e.prototype.submit=function(){var r;return this.warningImportUsers=!1,r=Immutable.Map(),this.selectedUsers.map(function(t){var e="";return e=_.isString(t.get("taigaUser"))?t.get("taigaUser"):t.getIn(["taigaUser","id"]),r=r.set(t.getIn(["user","id"]),e)}),this.onSubmit({users:r})},e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size+1)},e.prototype.showSuggestedMatch=function(t){return t.get("user")&&-1===this.cancelledUsers.indexOf(t.get("id"))&&!this.isMemberSelected(t)},e.prototype.getDistinctSelectedTaigaUsers=function(){var e,r=[];return this.selectedUsers.filter(function(t){var e=t.getIn(["taigaUser","id"]);return-1===r.indexOf(e)&&(r.push(e),!0)}).filter((e=this,function(t){return t.getIn(["taigaUser","id"])!==e.currentUser.get("id")}))},e.prototype.refreshSelectableUsers=function(){var t;return this.importMoreUsersDisabled=this.isImportMoreUsersDisabled(),this.importMoreUsersDisabled?(t=this.getDistinctSelectedTaigaUsers(),this.selectableUsers=t.map(function(t){return t.get("taigaUser")}),this.displayEmailSelector=!1):(this.selectableUsers=this.userContacts,this.displayEmailSelector=!0),this.selectableUsers=this.selectableUsers.push(this.currentUser)},e.prototype.isImportMoreUsersDisabled=function(){var t=this.getDistinctSelectedTaigaUsers().size+2;return this.project.get("is_private")?!this.currentUserService.canAddMembersPrivateProject(t).valid:!this.currentUserService.canAddMembersPublicProject(t).valid},t=e,angular.module("taigaProjects").controller("ImportProjectMembersCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.fetchUser(),t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/import-project-members/import-project-members.html",controller:"ImportProjectMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSubmit:"&",platform:"@",logo:"@",onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgImportProjectMembers",t)}.call(this),function(){var t;function e(){}e.prototype.selectProject=function(t){return this.onSelectProject({project:Immutable.fromJS(t)})},t=e,angular.module("taigaProjects").controller("ImportProjectSelectorCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/import-project-selector/import-project-selector.html",controller:"ImportProjectSelectorCtrl",controllerAs:"vm",bindToController:!0,scope:{projects:"<",onCancel:"&",onSelectProject:"&",logo:"@",noProjectsMsg:"@",search:"@"}}};angular.module("taigaProjects").directive("tgImportProjectSelector",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.confirm=t,this.rs=e,this.importProjectService=r,this.translate=n,this.analytics=i}e.$inject=["$tgConfirm","$tgResources","tgImportProjectService","$translate","$tgAnalytics"],e.prototype.importTaiga=function(t){var e,r,n;this.analytics.trackEvent("import","taiga","Start import from taiga",1),e=t[0],(r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),n=this.rs.projects.import(e,r.update),this.importProjectService.importPromise(n).finally(function(){return r.stop()})},t=e,angular.module("taigaProjects").controller("ImportTaigaCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/import-taiga/import-taiga.html",controller:"ImportTaigaCtrl",controllerAs:"vm",bindToController:!0,scope:{}}};angular.module("taigaProjects").directive("tgImportTaiga",t)}.call(this),function(){var t=function(n){return{templateUrl:"projects/create/import/import-project-error-lb.html",link:function(t,e,r){return n.open(e),t.close=function(){n.close(e)}}}};t.$inject=["lightboxService"],angular.module("taigaProjects").directive("tgLbImportError",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a,c,u,l){this.trelloService=t,this.jiraService=e,this.githubService=r,this.asanaService=n,this.location=i,this.window=o,this.routeParams=s,this.tgNavUrls=a,this.config=c,this.confirm=u,this.analytics=l}e.$inject=["tgTrelloImportService","tgJiraImportService","tgGithubImportService","tgAsanaImportService","$location","$window","$routeParams","$tgNavUrls","$tgConfig","$tgConfirm","$tgAnalytics"],e.prototype.start=function(){var t,e,r,n,i,o,s,a,c;if(this.token=null,this.from=this.routeParams.platform,n=this.location.search(),this.from&&this.analytics.trackEvent("import",this.from,"Start import from "+this.from,1),"asana"===this.from){if(n.code,n.code)return t=n.code,this.asanaService.authorize(t).then(function(t){return o.location.search({token:encodeURIComponent(JSON.stringify(t))})},(o=this).cancelCurrentImport.bind(this));this.token=JSON.parse(decodeURIComponent(n.token)),this.asanaService.setToken(this.token)}if("trello"===this.from){if(n.oauth_verifier)return i=n.oauth_verifier,this.trelloService.authorize(i).then(function(t){return s.location.search({token:t})},(s=this).cancelCurrentImport.bind(this));n.token&&(this.token=n.token,this.trelloService.setToken(n.token))}if("github"===this.from){if(n.code)return e=n.code,this.githubService.authorize(e).then(function(t){return a.location.search({token:t})},(a=this).cancelCurrentImport.bind(this));n.token&&(this.token=n.token,this.githubService.setToken(n.token))}if("jira"===this.from)return n.oauth_token?(r=n.oauth_verifier,this.jiraService.authorize(r).then(function(t){return c.location.search({token:t.token,url:t.url})},(c=this).cancelCurrentImport.bind(this))):(this.token=n.token,this.jiraService.setToken(n.token,n.url))},e.prototype.select=function(t){var e,r,n,i,o,s;return"trello"===t?this.trelloService.getAuthUrl().then((s=this,function(t){return s.window.open(t,"_self")})):"jira"===t?this.jiraService.getAuthUrl(this.jiraUrl).then(function(t){return o.window.open(t,"_self")},(i=o=this,function(t){return i.confirm.notify("error",t)})):"github"===t?(e=this.location.absUrl()+"/github",this.githubService.getAuthUrl(e).then((n=this,function(t){return n.window.open(t,"_self")}))):"asana"===t?this.asanaService.getAuthUrl().then((r=this,function(t){return r.window.open(t,"_self")})):this.from=t},e.prototype.unfoldOptions=function(t){return this.unfoldedOptions=t},e.prototype.isActiveImporter=function(t){return-1!==this.config.get("importers").indexOf(t)},e.prototype.cancelCurrentImport=function(){return this.location.url(this.tgNavUrls.resolve("create-project-import"))},e.prototype.backToCreate=function(){return this.location.url(this.tgNavUrls.resolve("create-project"))},t=e,angular.module("taigaProjects").controller("ImportProjectCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.start()},templateUrl:"projects/create/import/import-project.html",controller:"ImportProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancelImport:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgImportProject",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r,n,i,o,s){this.currentUserService=t,this.tgAuth=e,this.lightboxFactory=r,this.translate=n,this.confirm=i,this.location=o,this.tgNavUrls=s}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgCurrentUserService","$tgAuth","tgLightboxFactory","$translate","$tgConfirm","$location","$tgNavUrls"],e.prototype.importPromise=function(t){return t.then(this.importSuccess.bind(this),this.importError.bind(this))},e.prototype.importSuccess=function(i){var o,t=this.currentUserService.loadProjects();return t.then((o=this,function(){var t,e,r,n;return 202===i.status?(n=o.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE"),e=o.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE"),o.location.path(o.tgNavUrls.resolve("home")),o.confirm.success(n,e)):(t={project:i.data.slug},o.location.path(o.tgNavUrls.resolve("project-admin-project-profile-details",t)),r=o.translate.instant("PROJECT.IMPORT.SYNC_SUCCESS"),o.confirm.notify("success",r))})),t},e.prototype.importError=function(n){var i,t=this.tgAuth.refresh();return t.then((i=this,function(){var t,e,r=i.getRestrictionError(n);return r?i.lightboxFactory.create("tg-lb-import-error",{class:"lightbox lightbox-import-error"},r):(t=i.translate.instant("PROJECT.IMPORT.ERROR"),429===n.status?t=i.translate.instant("PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST"):null!=(e=n.data)&&e._error_message&&(t=i.translate.instant("PROJECT.IMPORT.ERROR_MESSAGE",{error_message:n.data._error_message})),i.confirm.notify("error",t))})),t},e.prototype.getRestrictionError=function(t){var e,r,n,i,o,s;return!!t.headers&&(e="",s=this.currentUserService.getUser(),r=null,t.headers.isPrivate?(i=!this.currentUserService.canCreatePrivateProjects().valid,n=null!==s.get("max_memberships_private_projects")&&t.headers.memberships>=s.get("max_memberships_private_projects"),i&&n?(e="private-space-members",r=s.get("max_memberships_private_projects")):i?e="private-space":n&&(e="private-members",r=s.get("max_memberships_private_projects"))):(o=!this.currentUserService.canCreatePublicProjects().valid,n=null!==s.get("max_memberships_public_projects")&&t.headers.memberships>=s.get("max_memberships_public_projects"),o&&n?(e="public-space-members",r=s.get("max_memberships_public_projects")):o?e="public-space":n&&(e="public-members",r=s.get("max_memberships_public_projects"))),!!e&&{key:e,values:{max_memberships:r,members:t.headers.memberships}})},t=e,angular.module("taigaProjects").service("tgImportProjectService",t)}.call(this),function(){var t;function e(){}e.$inject=[],e.prototype.isDisabled=function(t){return-1===this.invitedMembers.indexOf(t)},t=e,angular.module("taigaProjects").controller("InviteMembersCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/invite-members/invite-members.html",controller:"InviteMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{invitedMembers:"<",members:"<",onToggleInvitedMember:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgInviteMembers",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/invite-members/single-member/single-member.html",scope:{disabled:"<",avatar:"="}}};t.$inject=[],angular.module("taigaProjects").directive("tgSingleMember",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,"agile"===this.projectForm.importer_type?this.projectForm.project_type=null:this.projectForm.project_type="scrum",this.projectForm.create_subissues=!0,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("JiraImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/jira-import/jira-import-project-form/jira-import-project-form.html",controller:"JiraImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgJiraImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.jiraImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-jira",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.jiraImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.jiraImportService.projectUsers}))}e.$inject=["tgJiraImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-jira",this.jiraImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-jira",this.project=t,this.fetchingUsers=!0,this.jiraImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-jira"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-jira"},e.prototype.startImport=function(t){var e,r,n=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return n.start(),"issues"===(e=this.project.get("project_type"))&&this.project.get("create_subissues")&&(e="issues-with-subissues"),r=this.jiraImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),e,this.project.get("importer_type")),this.importProjectService.importPromise(r).then(function(){return n.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("JiraImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/jira-import/jira-import.html",controller:"JiraImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgJiraImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$location"],e.prototype.setToken=function(t,e){return this.token=t,this.url=e},e.prototype.fetchProjects=function(){return this.resources.jiraImporter.listProjects(this.url,this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.jiraImporter.listUsers(this.url,this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s,a){return this.resources.jiraImporter.importProject(this.url,this.token,t,e,r,n,i,o,s,a)},e.prototype.getAuthUrl=function(t){return new Promise((n=this,function(e,r){return n.resources.jiraImporter.getAuthUrl(t).then(function(t){return n.authUrl=t.data.url,e(n.authUrl)},function(t){return r(t.data._error_message)})}));var n},e.prototype.authorize=function(t){return new Promise((n=this,function(e,r){return n.resources.jiraImporter.authorize(t).then(function(t){return n.token=t.data.token,n.url=t.data.url,e(t.data)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgJiraImportService",t)}.call(this),function(){var t;function e(){}e.$inject=[],e.prototype.start=function(){return this.mode="search",this.invalid=!1},e.prototype.assignUser=function(){return this.onSelectUser({user:this.user,taigaUser:this.userEmail})},e.prototype.selectUser=function(t){return this.onSelectUser({user:this.user,taigaUser:Immutable.fromJS(t)})},t=e,angular.module("taigaProjects").controller("SelectImportUserLightboxCtrl",t)}.call(this),function(){var t=function(i,o){return{controller:"SelectImportUserLightboxCtrl",controllerAs:"vm",bindToController:!0,scope:{user:"<",visible:"<",onClose:"&",onSelectUser:"&",selectableUsers:"<",isPrivate:"<",limitMembersPrivateProject:"<",limitMembersPublicProject:"<",displayEmailSelector:"<"},templateUrl:"projects/create/select-import-user-lightbox/select-import-user-lightbox.html",link:function(e,r,t,n){return e.$watch("vm.visible",function(t){return t&&!r.hasClass("open")?(n.start(),i.open(r,null,e.vm.onClose).then(function(){return r.find("input").focus(),o.init(r)})):!t&&r.hasClass("open")?i.close(r).then(function(){return n.userEmail="",n.usersSearch=""}):void 0})}}};t.$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgSelectImportUserLightbox",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Trello",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("TrelloImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/trello-import/trello-import-project-form/trello-import-project-form.html",controller:"TrelloImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgTrelloImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.trelloImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.trelloImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.trelloImportService.projectUsers}))}e.$inject=["tgTrelloImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.trelloImportService.fetchProjects().then((t=this,function(){return t.step="project-select-trello"}));var t},e.prototype.onSelectProject=function(t){return this.step="project-form-trello",this.project=t,this.fetchingUsers=!0,this.trelloImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-trello"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-trello"},e.prototype.startImport=function(t){var e,r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return r.start(),e=this.trelloImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private")),this.importProjectService.importPromise(e).then(function(){return r.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("TrelloImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/trello-import/trello-import.html",controller:"TrelloImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgTrelloImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.resources=t,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.trelloImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.trelloImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o){return this.resources.trelloImporter.importProject(this.token,t,e,r,n,i,o)},e.prototype.getAuthUrl=function(){return new Promise((r=this,function(e){return r.resources.trelloImporter.getAuthUrl().then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return new Promise((n=this,function(e,r){return n.resources.trelloImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgTrelloImportService",t)}.call(this),function(){var t=function(n,i){return{link:function(e,r,t){return e.$watch("visible",function(t){return t&&!r.hasClass("open")?n.open(r,e.onClose).then(function(){return r.find("input").focus(),i.init(r)}):!t&&r.hasClass("open")?n.close(r):void 0})},templateUrl:"projects/create/warning-user-import-lightbox/warning-user-import-lightbox.html",scope:{visible:"<",onClose:"&",onConfirm:"&"}}};t.$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgWarningUserImportLightbox",t)}.call(this),function(){var t;function e(t){var e;this.currentUserService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.currentUserService.projects.get("all")}))}e.$inject=["tgCurrentUserService"],t=e,angular.module("taigaProjects").controller("ProjectsListing",t)}.call(this),function(){var t;function e(t,e,r,n,i){var o;this.routeParams=t,this.location=e,this.projectService=r,this.rs=n,this.tgSections=i,this.getProjectHomepage().then((o=this,function(t){return t?o.location.url("project/"+o.routeParams.pslug+"/"+t):o.gotoDefaultProjectHomepage()})).then(null,function(){return this.gotoDefaultProjectHomepage()})}e.$inject=["$routeParams","$location","tgProjectService","$tgResources","$tgSections"],e.prototype.gotoDefaultProjectHomepage=function(){return this.location.url("project/"+this.routeParams.pslug+"/timeline")},e.prototype.getProjectHomepage=function(){var r,n=this.projectService.project.toJS();return this.rs.userProjectSettings.list({project:n.id}).then((r=this,function(t){var e=_.find(t,{project:n.id});if(e)return r.tgSections.getPath(n.slug,e.homepage)}))},t=e,angular.module("taigaProjects").controller("ProjectRouter",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a){var c,u,l,p;this.routeParams=t,this.appMetaService=e,this.auth=r,this.translate=n,this.projectService=i,this.config=o,this.navUrls=s,this.location=a,this.user=this.auth.userData,taiga.defineImmutableProperty(this,"project",(u=this,function(){return u.projectService.project})),taiga.defineImmutableProperty(this,"members",(l=this,function(){return l.projectService.activeMembers})),taiga.defineImmutableProperty(this,"isAuthenticated",(p=this,function(){return!!p.user})),c=this.location.url(),this.registerUrl=this.navUrls.resolve("register")+"?next="+c,this.loginUrl=this.navUrls.resolve("login")+"?next="+c,this.publicRegisterEnabled=this.config.get("publicRegisterEnabled"),this.appMetaService.setfn(this._setMeta.bind(this))}e.$inject=["$routeParams","tgAppMetaService","$tgAuth","$translate","tgProjectService","$tgConfig","$tgNavUrls","$location"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},t=e,angular.module("taigaProjects").controller("Project",t)}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e){this.rs=t,this.projectUrl=e}e=this.taiga,this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["tgResources","$projectUrl"],r.prototype.create=function(t){return this.rs.projects.create(t)},r.prototype.duplicate=function(t,e){return this.rs.projects.duplicate(t,e)},r.prototype.getProjectBySlug=function(t){return this.rs.projects.getProjectBySlug(t).then((e=this,function(t){return e._decorate(t)}));var e},r.prototype.getProjectStats=function(t){return this.rs.projects.getProjectStats(t)},r.prototype.getProjectsByUserId=function(t,e){return this.rs.projects.getProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},r.prototype.getListProjectsByUserId=function(t,e){return this.rs.projects.getListProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},r.prototype._decorate=function(t){var e=this.projectUrl.get(t.toJS());return t=t.set("url",e)},r.prototype.bulkUpdateProjectsOrder=function(t){return this.rs.projects.bulkUpdateOrder(t)},r.prototype.transferValidateToken=function(t,e){return this.rs.projects.transferValidateToken(t,e)},r.prototype.transferAccept=function(t,e,r){return this.rs.projects.transferAccept(t,e,r)},r.prototype.transferReject=function(t,e,r){return this.rs.projects.transferReject(t,e,r)},t=r,angular.module("taigaProjects").service("tgProjectsService",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/transfer/cant-own-project-explanation.html"}};angular.module("taigaProjects").directive("tgCantOwnProjectExplanation",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a,c,u){this.routeParams=t,this.projectsService=e,this.projectService=r,this.location=n,this.authService=i,this.currentUserService=o,this.navUrls=s,this.translate=a,this.confirmService=c,this.errorHandlingService=u}t=angular.module("taigaProjects"),e.$inject=["$routeParams","tgProjectsService","tgProjectService","$location","$tgAuth","tgCurrentUserService","$tgNavUrls","$translate","$tgConfirm","tgErrorHandlingService"],e.prototype.initialize=function(){return this.projectId=this.project.get("id"),this.token=this.routeParams.token,this.showAddComment=!1,this._refreshUserData()},e.prototype._validateToken=function(){return this.projectsService.transferValidateToken(this.projectId,this.token).then(null,(r=this,function(t,e){return r.errorHandlingService.notfound()}));var r},e.prototype._refreshUserData=function(){return this.authService.refresh().then((t=this,function(){return t._validateToken(),t._setProjectData(),t._checkOwnerData()}));var t},e.prototype._setProjectData=function(){return this.canBeOwnedByUser=this.currentUserService.canOwnProject(this.project)},e.prototype._checkOwnerData=function(){var t=this.currentUserService.getUser(),e=this.project.get("is_private")?(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE",this.maxProjects=t.get("max_private_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_private_projects"),t.get("max_memberships_private_projects")):(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC",this.maxProjects=t.get("max_public_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_public_projects"),t.get("max_memberships_public_projects"));return this.validNumberOfMemberships=null===e||this.project.get("total_memberships")<=e},e.prototype.transferAccept=function(t,e){return this.loadingAccept=!0,this.projectsService.transferAccept(this.project.get("id"),t,e).then((r=this,function(){return r.projectService.fetchProject().then(function(){var t=r.navUrls.resolve("project-admin-project-profile-details",{project:r.project.get("slug")});r.loadingAccept=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP"),"",5e3)})}));var r},e.prototype.transferReject=function(t,e){return this.loadingReject=!0,this.projectsService.transferReject(this.project.get("id"),t,e).then((r=this,function(){var t=r.navUrls.resolve("home",{project:r.project.get("slug")});r.loadingReject=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP"),"",5e3)}));var r},e.prototype.addComment=function(){return this.showAddComment=!0},e.prototype.hideComment=function(){return this.showAddComment=!1,this.reason=""},t.controller("TransferProjectController",e)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.initialize()},scope:{},bindToController:{project:"="},templateUrl:"projects/transfer/transfer-project.html",controller:"TransferProjectController",controllerAs:"vm"}};angular.module("taigaProjects").directive("tgTransferProject",t)}.call(this),function(){this.taiga;var S=this.taiga.sizeFormat,t=function(m,a,v,y,_,b){var t={list:function(t,e,r){var n="attachments/"+t,i={object_id:e,project:r},o={headers:{"x-disable-pagination":"1"}},s=m.resolve(n);return a.get(s,i,o).then(function(t){return Immutable.fromJS(t.data)})},get:function(t,e){var r="attachments/"+t,n=m.resolve(r)+"/"+e;return a.get(n)},delete:function(t,e){var r="attachments/"+t,n=m.resolve(r)+"/"+e;return a.delete(n)},patch:function(t,e,r){var n="attachments/"+t,i=m.resolve(n)+"/"+e;return a.patch(i,r)},create:function(t,e,r,i,n){var o,s,a,c,u,l,p,d,h="attachments/"+t,f=m.resolve(h),g=_.defer();return void 0===i?g.reject(null):(s=v.get("maxUploadFileSize",null))&&i.size>s?(a={status:413,data:{_error_message:"'"+i.name+"' ("+S(i.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+S(s)+")"}},g.reject(a)):(p=function(t){return y.$apply(function(){return i.status="in-progress",i.size=S(t.total),i.progressMessage="upload "+S(t.loaded)+" of "+S(t.total),i.progressPercent=Math.round(t.loaded/t.total*100)+"%"})},u=function(n){return y.$apply(function(){var e,t,r;i.status="done",r=n.target.status;try{e=JSON.parse(n.target.responseText)}catch(t){e={}}return 200<=r&&r<400?(e=Immutable.fromJS(e),g.resolve(e)):(a={status:r,data:{_error_message:null!=(t=o.attached_file)?t[0]:void 0}},g.reject(a))})},l=function(t){return y.$apply(function(){return i.status="error",g.reject("fail")})},(o=new FormData).append("project",e),o.append("object_id",r),o.append("attached_file",i),o.append("from_comment",n),(d=new XMLHttpRequest).upload.addEventListener("progress",p,!1),d.addEventListener("load",u,!1),d.addEventListener("error",l,!1),c=b.get("token"),d.open("POST",f),d.setRequestHeader("Authorization","Bearer "+c),d.setRequestHeader("Accept","application/json"),d.send(o)),g.promise}};return function(){return{attachments:t}}};t.$inject=["$tgUrls","$tgHttp","$tgConfig","$rootScope","$q","$tgStorage"],angular.module("taigaResources2").factory("tgAttachmentsResource",t)}.call(this),function(){var t=function(s,a){var t={listInAllProjects:function(t){var e=s.resolve("epics"),r={headers:{"x-disable-pagination":"1"}};return a.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})},list:function(t,e){var r,n;return null==e&&(e=0),n=s.resolve("epics"),r={project:t,page:e},a.get(n,r).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})},patch:function(t,e){var r=s.resolve("epics")+"/"+t;return a.patch(r,e).then(function(t){return Immutable.fromJS(t.data)})},post:function(t){var e=s.resolve("epics");return a.post(e,t).then(function(t){return Immutable.fromJS(t.data)})},reorder:function(t,e,r){var n=s.resolve("epics")+"/"+t,i={headers:{"set-orders":JSON.stringify(r)}};return a.patch(n,e,null,i).then(function(t){return Immutable.fromJS(t.data)})},addRelatedUserstory:function(t,e){var r=s.resolve("epic-related-userstories",t),n={user_story:e,epic:t};return a.post(r,n)},reorderRelatedUserstory:function(t,e,r,n){var i=s.resolve("epic-related-userstories",t)+"/"+e,o={headers:{"set-orders":JSON.stringify(n)}};return a.patch(i,r,null,o)},bulkCreateRelatedUserStories:function(t,e,r){var n=s.resolve("epic-related-userstories-bulk-create",t),i={bulk_userstories:r,project_id:e};return a.post(n,i)},deleteRelatedUserstory:function(t,e){var r=s.resolve("epic-related-userstories",t)+"/"+e;return a.delete(r)}};return function(){return{epics:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgEpicsResource",t)}.call(this),function(){var t=function(i,o){var t={getApplicationToken:function(t,e){var r=i.resolve("applications");return r=r+"/"+t+"/token?state="+e,o.get(r).then(function(t){return Immutable.fromJS(t.data)})},authorizeApplicationToken:function(t,e){var r,n=i.resolve("application-tokens");return n+="/authorize",r={state:e,application:t},o.post(n,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{externalapps:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgExternalAppsResource",t)}.call(this),function(){var t=function(o,s){var t={getHistory:function(t,e,r,n){var i=o.resolve("history/"+e);return s.get(i+"/"+r,{page:n,type:t}).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})}};return function(){return{history:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgHistory",t)}.call(this),function(){this.taiga;var t,e,r,n,i=function(u,l){var t={getAuthUrl:function(t){return t=u.resolve("importers-trello-auth-url"),l.get(t)},authorize:function(t){var e=u.resolve("importers-trello-authorize");return l.post(e,{code:t})},listProjects:function(t){var e=u.resolve("importers-trello-list-projects");return l.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=u.resolve("importers-trello-list-users");return l.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s){var a=u.resolve("importers-trello-import-project"),c={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:"kanban"};return l.post(a,c)}};return function(){return{trelloImporter:t}}};i.$inject=["$tgUrls","$tgHttp"],(r=function(h,f){var t={getAuthUrl:function(t){var e=h.resolve("importers-jira-auth-url")+"?url="+t;return f.get(e)},authorize:function(t){var e=h.resolve("importers-jira-authorize");return f.post(e,{oauth_verifier:t})},listProjects:function(t,e){var r=h.resolve("importers-jira-list-projects");return f.post(r,{url:t,token:e}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e,r){var n=h.resolve("importers-jira-list-users");return f.post(n,{url:t,token:e,project:r}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a,c,u){var l=h.resolve("importers-jira-import-project"),p="kanban"!==c?"scrum":"kanban",d={url:t,token:e,name:r,description:n,project:i,users_bindings:o.toJS(),keep_external_reference:s,is_private:a,project_type:c,importer_type:u,template:p};return f.post(l,d)}};return function(){return{jiraImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(e=function(l,p){var t={getAuthUrl:function(t){var e=l.resolve("importers-github-auth-url")+"?uri="+t;return p.get(e)},authorize:function(t){var e=l.resolve("importers-github-authorize");return p.post(e,{code:t})},listProjects:function(t){var e=l.resolve("importers-github-list-projects");return p.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=l.resolve("importers-github-list-users");return p.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a){var c=l.resolve("importers-github-import-project"),u={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:a};return p.post(c,u)}};return function(){return{githubImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(t=function(l,p){var t={getAuthUrl:function(){var t=l.resolve("importers-asana-auth-url");return p.get(t)},authorize:function(t){var e=l.resolve("importers-asana-authorize");return p.post(e,{code:t})},listProjects:function(t){var e=l.resolve("importers-asana-list-projects");return p.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=l.resolve("importers-asana-list-users");return p.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a){var c=l.resolve("importers-asana-import-project"),u={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:a};return p.post(c,u)}};return function(){return{asanaImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(n=angular.module("taigaResources2")).factory("tgTrelloImportResource",i),n.factory("tgJiraImportResource",r),n.factory("tgGithubImportResource",e),n.factory("tgAsanaImportResource",t)}.call(this),function(){var t=function(n,i){var t={listInAllProjects:function(t){var e=n.resolve("issues"),r={headers:{"x-disable-pagination":"1"}};return i.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{issues:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgIssuesResource",t)}.call(this),function(){var t=function(o,s,i){var t={create:function(t){var e=o.resolve("projects");return s.post(e,JSON.stringify(t)).then(function(t){return Immutable.fromJS(t.data)})},duplicate:function(t,e){var r,n,i=o.resolve("projects");return i=i+"/"+t+"/duplicate",r=e.users.map(function(t){return{id:t}}),n={name:e.name,description:e.description,is_private:e.is_private,users:r},s.post(i,n)},getProjects:function(t,e){var r,n;return null==t&&(t={}),null==e&&(e=!0),n=o.resolve("projects"),r=e?{}:{headers:{"x-lazy-pagination":!0}},s.get(n,t,r)},getProjectBySlug:function(t){var e=o.resolve("projects");return e=e+"/by_slug?slug="+t,s.get(e).then(function(t){return Immutable.fromJS(t.data)})},getProjectsByUserId:function(t,e){var r,n,i;return null==e&&(e=!1),i=o.resolve("projects"),r={},e||(r.headers={"x-disable-pagination":"1"}),n={member:t,order_by:"user_order"},s.get(i,n,r).then(function(t){return Immutable.fromJS(t.data)})},getListProjectsByUserId:function(t,e){var r,n,i;return null==e&&(e=!1),i=o.resolve("projects"),r={},e||(r.headers={"x-disable-pagination":"1"}),n={member:t,order_by:"user_order",slight:!0},s.get(i,n,r).then(function(t){return Immutable.fromJS(t.data)})},getProjectStats:function(t){var e=o.resolve("projects");return e=e+"/"+t,s.get(e).then(function(t){return Immutable.fromJS(t.data)})},bulkUpdateOrder:function(t){var e=o.resolve("bulk-update-projects-order");return s.post(e,t)},getTimeline:function(t,e){var r={page:e,only_relevant:!0},n=o.resolve("timeline-project");return n=n+"/"+t,s.get(n,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),i(t)})},likeProject:function(t){var e=o.resolve("project-like",t);return s.post(e)},unlikeProject:function(t){var e=o.resolve("project-unlike",t);return s.post(e)},watchProject:function(t,e){var r={notify_level:e,live_notify_level:e},n=o.resolve("project-watch",t);return s.post(n,r)},unwatchProject:function(t){var e=o.resolve("project-unwatch",t);return s.post(e)},contactProject:function(t,e){var r={project:t,comment:e},n=o.resolve("project-contact");return s.post(n,r)},transferValidateToken:function(t,e){var r={token:e},n=o.resolve("project-transfer-validate-token",t);return s.post(n,r)},transferAccept:function(t,e,r){var n={token:e,reason:r},i=o.resolve("project-transfer-accept",t);return s.post(i,n)},transferReject:function(t,e,r){var n={token:e,reason:r},i=o.resolve("project-transfer-reject",t);return s.post(i,n)},transferRequest:function(t){var e=o.resolve("project-transfer-request",t);return s.post(e)},transferStart:function(t,e,r){var n={user:e,reason:r},i=o.resolve("project-transfer-start",t);return s.post(i,n)}};return function(){return{projects:t}}};t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgProjectsResources",t)}.call(this),function(){var l=["tgProjectsResources","tgUserResources","tgUsersResources","tgUserstoriesResource","tgTasksResource","tgIssuesResource","tgExternalAppsResource","tgAttachmentsResource","tgStatsResource","tgHistory","tgEpicsResource","tgTrelloImportResource","tgJiraImportResource","tgGithubImportResource","tgAsanaImportResource"],t=function(t){for(var e,r,n,i,o,s,a,c=0,u=l.length;c<u;c++)for(s=l[c],o=t.get(s),i=t.invoke(o),e=0,r=(n=Object.keys(i)).length;e<r;e++)this[a=n[e]]&&console.warn("repeated resource "+a),this[a]=i[a];return this};t.$inject=["$injector"],angular.module("taigaResources2").service("tgResources",t)}.call(this),function(){var t=function(n,i){var t={discover:function(t,e){var r=n.resolve("stats-discover");return i.get(r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{stats:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgStatsResource",t)}.call(this),function(){var t=function(n,i){var t={listInAllProjects:function(t){var e=n.resolve("tasks"),r={headers:{"x-disable-pagination":"1"}};return i.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{tasks:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgTasksResource",t)}.call(this),function(){var t=function(i,o,t){var e={getUserStorage:function(t){var e=i.resolve("user-storage");return t&&(e+="/"+t),o.get(e,{}).then(function(t){return t.data.value})},setUserStorage:function(t,e){var r=i.resolve("user-storage")+"/"+t,n={key:t,value:e};return o.put(r,n)},createUserStorage:function(t,e){var r=i.resolve("user-storage"),n={key:t,value:e};return o.post(r,n)}};return function(){return{user:e}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserResources",t)}.call(this),function(){var t=function(s,a,c){var t={getUserByUsername:function(t){var e=s.resolve("by_username"),r={headers:{"x-disable-pagination":"1"}},n={username:t};return a.get(e,n,r).then(function(t){return Immutable.fromJS(t.data)})},getStats:function(t){var e=s.resolve("user-stats",t),r={headers:{"x-disable-pagination":"1"}};return a.get(e,{},r).then(function(t){return Immutable.fromJS(t.data)})},getContacts:function(t,e){var r,n=s.resolve("user-contacts",t),i={};return null!=e&&(i.exclude_project=e),r={headers:{"x-disable-pagination":"1"}},a.get(n,i,r).then(function(t){return Immutable.fromJS(t.data)})},getLiked:function(t,e,r,n){var i=s.resolve("user-liked",t),o={};return null!=e&&(o.page=e),null!=r&&(o.type=r),null!=n&&(o.q=n),o.only_relevant=!0,a.get(i,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),c(t)})},getVoted:function(t,e,r,n){var i=s.resolve("user-voted",t),o={};return null!=e&&(o.page=e),null!=r&&(o.type=r),null!=n&&(o.q=n),a.get(i,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),c(t)})},getWatched:function(t,e,r,n){var i=s.resolve("user-watched",t),o={};return null!=e&&(o.page=e),null!=r&&(o.type=r),null!=n&&(o.q=n),a.get(i,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),c(t)})},getProfileTimeline:function(t,e){var r={page:e},n=s.resolve("timeline-profile");return n=n+"/"+t,a.get(n,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),c(t)})},getUserTimeline:function(t,e){var r={page:e,only_relevant:!0},n=s.resolve("timeline-user");return n=n+"/"+t,a.get(n,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),c(t)})},getNotifications:function(t,e,r){var n,i={page:e};return r&&(i.only_unread=!0),n=s.resolve("notifications"),a.get(n,i,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),Immutable.Map({data:t.get("data").get("objects"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count"),total:t.get("data").get("total")})})},setNotificationAsRead:function(t){var e=s.resolve("notifications")+"/"+t+"/set-as-read";return a.patch(e).then(function(t){return t})},setNotificationsAsRead:function(){var t=s.resolve("notifications")+"/set-as-read";return a.post(t).then(function(t){return t})}};return function(){return{users:t}}};t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgUsersResources",t)}.call(this),function(){var t=function(i,o){var t={listInAllProjects:function(t,e){var r,n;return null==e&&(e=!1),n=i.resolve("userstories"),e||(r={headers:{"x-disable-pagination":"1"}}),o.get(n,t,r).then(function(t){return Immutable.fromJS(t.data)})},listAllInProject:function(t){var e=i.resolve("userstories"),r={headers:{"x-disable-pagination":"1"}},n={project:t};return o.get(e,n,r).then(function(t){return Immutable.fromJS(t.data)})},listInEpic:function(t){var e=i.resolve("userstories"),r={headers:{"x-disable-pagination":"1"}},n={epic:t,order_by:"epic_order",include_tasks:!0};return o.get(e,n,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{userstories:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserstoriesResource",t)}.call(this),function(){var t,e,r;function n(t){this.rootScope=t}e=this.taiga,r=e.truncate,n.$inject=["$rootScope"],n.prototype._set=function(t,e){var r;if(t)return"title"===t?(0===(r=$("head title")).length&&(r=$("<title></title>"),$("head").append(r)),r.text(e||"")):(0===t.indexOf("og:")?0===(r=$("head meta[property='"+t+"']")).length&&(r=$("<meta property='"+t+"'/>"),$("head").append(r)):0===(r=$("head meta[name='"+t+"']")).length&&(r=$("<meta name='"+t+"'/>"),$("head").append(r)),r.attr("content",e||""))},n.prototype.setTitle=function(t){return this._set("title",t)},n.prototype.setDescription=function(t){return this._set("description",r(t,250))},n.prototype.setTwitterMetas=function(t,e){return this._set("twitter:card","summary"),this._set("twitter:site","@taigaio"),this._set("twitter:title",t),this._set("twitter:description",r(e,300)),this._set("twitter:image",window.location.origin+"/"+window._version+"/images/logo-color.png")},n.prototype.setOpenGraphMetas=function(t,e){return this._set("og:type","object"),this._set("og:site_name","Taiga - Love your projects"),this._set("og:title",t),this._set("og:description",r(e,300)),this._set("og:image",window.location.origin+"/"+window._version+"/images/logo-color.png"),this._set("og:url",window.location.href)},n.prototype.setAll=function(t,e){return this.setTitle(t),this.setDescription(e),this.setTwitterMetas(t,e),this.setOpenGraphMetas(t,e)},n.prototype.addMobileViewport=function(){return $("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">')},n.prototype.removeMobileViewport=function(){return $('head meta[name="viewport"]').remove()},n.prototype.setfn=function(t){return this.listener&&this._listener(),this._listener=this.rootScope.$watchCollection(t,(e=this,function(t){if(t)return e.setAll(t.title,t.description),e._listener()}));var e},t=n,angular.module("taigaCommon").service("tgAppMetaService",t)}.call(this),function(){var t,i;function e(t,e,r,n){this.confirm=t,this.config=e,this.translate=r,this.rs=n,this.maxFileSize=this.getMaxFileSize(),this.maxFileSize&&(this.maxFileSizeFormated=i(this.maxFileSize))}i=this.taiga.sizeFormat,e.$inject=["$tgConfirm","$tgConfig","$translate","tgResources"],e.prototype.sizeError=function(t){var e=this.translate.instant("ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:i(t.size),maxFileSize:this.maxFileSizeFormated});return this.confirm.notify("error",e)},e.prototype.validate=function(t){return!(this.maxFileSize&&t.size>this.maxFileSize)||(this.sizeError(t),!1)},e.prototype.getMaxFileSize=function(){return this.config.get("maxUploadFileSize",null)},e.prototype.list=function(t,e,r){return this.rs.attachments.list(t,e,r).then(function(t){return t.sortBy(function(t){return t.get("order")})})},e.prototype.get=function(t,e){return this.rs.attachments.get(t,e)},e.prototype.delete=function(t,e){return this.rs.attachments.delete(t,e)},e.prototype.saveError=function(t,e){var r="";return t&&(r=this.translate.instant("ATTACHMENT.ERROR_UPLOAD_ATTACHMENT",{fileName:t.name,errorMessage:e.data._error_message})),this.confirm.notify("error",r)},e.prototype.upload=function(t,e,r,n,i){var o;return null==i&&(i=!1),(o=this.rs.attachments.create(n,r,e,t,i)).then(null,this.saveError.bind(this,t)),o},e.prototype.patch=function(t,e,r){var n=this.rs.attachments.patch(e,t,r);return n.then(null,this.saveError.bind(this,null)),n},t=e,angular.module("taigaCommon").service("tgAttachmentsService",t)}.call(this),function(){var t;function e(t){var e,r;this.config=t,r=["/"+window._version+"/images/user-avatars/user-avatar-01.png","/"+window._version+"/images/user-avatars/user-avatar-02.png","/"+window._version+"/images/user-avatars/user-avatar-03.png","/"+window._version+"/images/user-avatars/user-avatar-04.png","/"+window._version+"/images/user-avatars/user-avatar-05.png"],e=["rgba( 178, 176, 204, 1 )","rgba( 183, 203, 131, 1 )","rgba( 210, 198, 139, 1 )","rgba( 214, 161, 212, 1 )","rgba( 247, 154, 154, 1 )"],this.logos=_.cartesianProduct(r,e)}e.prototype.getDefault=function(t){var e,r,n,i;return n=murmurhash3_32_gc(t,42),i=this.logos.length,e=(+n%(i=+i)+i)%i,{src:(r=this.logos[e])[0],color:r[1]}},e.prototype.getUnnamed=function(){return{url:"/"+window._version+"/images/unnamed.png",username:""}},e.prototype.getAvatar=function(t,e){var r,n,i,o,s,a;return t?(r="avatarBig"===e?"big_photo":"photo",o=null,a=t instanceof Immutable.Map?(n=t.get("gravatar_id"),o=t.get(r),"@"+t.get("username")):(n=t.gravatar_id,o=t[r],"@"+t.username),n?o?{url:o,username:a}:-1===location.host.indexOf("localhost")&&this.config.get("gravatar",!0)?(s=location.protocol+"//"+location.host,i=this.getDefault(n),{url:"https://www.gravatar.com/avatar/"+n+"?s=200&d="+encodeURIComponent(s+i.src),bg:i.color,username:a}):{url:(s=location.protocol+"//"+location.host)+(i=this.getDefault(n)).src,bg:i.color,username:a}:this.getUnnamed()):this.getUnnamed()},t=e,angular.module("taigaCommon").service("tgAvatarService",["$tgConfig",t])}.call(this),function(){var t;function e(t){this.projectService=t}this.taiga,e.$inject=["tgProjectService"],e.prototype.check=function(t){return!!this.projectService.project&&-1!==this.projectService.project.get("my_permissions").indexOf(t)},t=e,angular.module("taigaCommon").service("tgCheckPermissionsService",t)}.call(this),function(){var t,e,o;function r(t,e,r){var n,i;this.projectsService=t,this.storageService=e,this.rs=r,this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null,o.defineImmutableProperty(this,"projects",(n=this,function(){return n._projects})),o.defineImmutableProperty(this,"projectsById",(i=this,function(){return i._projectsById}))}o=this.taiga,e=this.taiga.groupBy,r.$inject=["tgProjectsService","$tgStorage","tgResources"],r.prototype.isAuthenticated=function(){return null!==this.getUser()},r.prototype.getUser=function(){var t;return this._user||(t=this.storageService.get("userInfo"))&&(t=Immutable.fromJS(t),this.setUser(t)),this._user},r.prototype.removeUser=function(){return this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null},r.prototype.setUser=function(t){return this._user=t,this._loadUserInfo()},r.prototype.bulkUpdateProjectsOrder=function(t){return this.projectsService.bulkUpdateProjectsOrder(t).then((e=this,function(){return e.loadProjects()}));var e},r.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this._user.get("id")).then((e=this,function(t){return e.setProjects(t)}));var e},r.prototype.loadProjectsList=function(){return this.projectsService.getListProjectsByUserId(this._user.get("id"),null).then((e=this,function(t){return e.setProjects(t)}));var e},r.prototype.disableJoyRide=function(t){if(this.isAuthenticated())return t?this._joyride[t]=!1:this._joyride={backlog:!1,kanban:!1,dashboard:!1},this.rs.user.setUserStorage("joyride",this._joyride)},r.prototype.loadJoyRideConfig=function(){return new Promise((r=this,function(e){if(null===r._joyride)return r.rs.user.getUserStorage("joyride").then(function(t){return r._joyride=t,e(r._joyride)}).catch(function(){return r._joyride={backlog:!0,kanban:!0,dashboard:!0},r.rs.user.createUserStorage("joyride",r._joyride),e(r._joyride)});e(r._joyride)}));var r},r.prototype._loadUserInfo=function(){return Promise.all([this.loadProjectsList()])},r.prototype.setProjects=function(t){return this._projects=this._projects.set("all",t),this._projects=this._projects.set("recents",t.slice(0,10)),this._projects=this._projects.set("unblocked",t.filter(function(t){return null===t.toJS().blocked_code})),this._projectsById=Immutable.fromJS(e(t.toJS(),function(t){return t.id})),this.projects},r.prototype.canCreatePrivateProjects=function(){var t=this.getUser();return null!==t.get("max_private_projects")&&t.get("total_private_projects")>=t.get("max_private_projects")?{valid:!1,reason:"max_private_projects",type:"private_project",current:t.get("total_private_projects"),max:t.get("max_private_projects")}:{valid:!0}},r.prototype.canCreatePublicProjects=function(){var t=this.getUser();return null!==t.get("max_public_projects")&&t.get("total_public_projects")>=t.get("max_public_projects")?{valid:!1,reason:"max_public_projects",type:"public_project",current:t.get("total_public_projects"),max:t.get("max_public_projects")}:{valid:!0}},r.prototype.canAddMembersPublicProject=function(t){var e=this.getUser();return null!==e.get("max_memberships_public_projects")&&t>e.get("max_memberships_public_projects")?{valid:!1,reason:"max_members_public_projects",type:"public_project",current:t,max:e.get("max_memberships_public_projects")}:{valid:!0}},r.prototype.canAddMembersPrivateProject=function(t){var e=this.getUser();return null!==e.get("max_memberships_private_projects")&&t>e.get("max_memberships_private_projects")?{valid:!1,reason:"max_members_private_projects",type:"private_project",current:t,max:e.get("max_memberships_private_projects")}:{valid:!0}},r.prototype.canOwnProject=function(t){var e,r;this.getUser();if(t.get("is_private")){if(!(r=this.canCreatePrivateProjects()).valid)return r;if(!(e=this.canAddMembersPrivateProject(t.get("total_memberships"))).valid)return e}else{if(!(r=this.canCreatePublicProjects()).valid)return r;if(!(e=this.canAddMembersPublicProject(t.get("total_memberships"))).valid)return e}return{valid:!0}},t=r,angular.module("taigaCommon").service("tgCurrentUserService",t)}.call(this),function(){var t;function e(t){this.rootScope=t}this.taiga,e.$inject=["$rootScope"],e.prototype.init=function(){return this.rootScope.errorHandling={}},e.prototype.notfound=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.notfound=!0},e.prototype.error=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.error=!0},e.prototype.permissionDenied=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.permissionDenied=!0},e.prototype.block=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.blocked=!0},t=e,angular.module("taigaCommon").service("tgErrorHandlingService",t)}.call(this),function(){var t;function e(t,e){this.rootScope=t,this.compile=e}e.$inject=["$rootScope","$compile"],e.prototype.create=function(t,e,r){var n,i,o=this.rootScope.$new();o=_.merge(o,r),n=$("<div>").attr(t,!0).attr("tg-bind-scope",!0),e&&n.attr(e),n.addClass("remove-on-close"),i=this.compile(n)(o),$(document.body).append(i)},t=e,angular.module("taigaCommon").service("tgLightboxFactory",t)}.call(this),function(){var t=function(){return function(t){return Immutable.Map({data:t.get("data"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count")})}};angular.module("taigaCommon").factory("tgPaginateResponseService",t)}.call(this),function(){var t;function e(){var t=["/"+window._version+"/images/project-logos/project-logo-01.png","/"+window._version+"/images/project-logos/project-logo-02.png","/"+window._version+"/images/project-logos/project-logo-03.png","/"+window._version+"/images/project-logos/project-logo-04.png","/"+window._version+"/images/project-logos/project-logo-05.png"],e=["rgba( 153,  214, 220, 1 )","rgba( 213,  156,  156, 1 )","rgba( 214, 161, 212,  1 )","rgba( 164, 162, 219, 1 )","rgba( 152, 224, 168,  1 )"];this.logos=_.cartesianProduct(t,e)}e.prototype.getDefaultProjectLogo=function(t,e){var r,n,i,o;return i=murmurhash3_32_gc(t+"-"+e,42),o=this.logos.length,r=(+i%(o=+o)+o)%o,{src:(n=this.logos[r])[0],color:n[1]}},t=e,angular.module("taigaCommon").service("tgProjectLogoService",t)}.call(this),function(){var t,p;function e(t,e,r,n,i){var o,s,a,c,u,l;this.rootScope=t,this.projectsService=e,this.xhrError=r,this.userActivityService=n,this.interval=i,this.manageProjectSignal=(o=this.manageProjectSignal,s=this,function(){return o.apply(s,arguments)}),this._project=null,this._section=null,this._sectionsBreadcrumb=Immutable.List(),this._activeMembers=Immutable.List(),p.defineImmutableProperty(this,"project",(a=this,function(){return a._project})),p.defineImmutableProperty(this,"section",(c=this,function(){return c._section})),p.defineImmutableProperty(this,"sectionsBreadcrumb",(u=this,function(){return u._sectionsBreadcrumb})),p.defineImmutableProperty(this,"activeMembers",(l=this,function(){return l._activeMembers})),window.localStorage.e2e||this.autoRefresh(),this.watchSignals()}p=this.taiga,e.$inject=["$rootScope","tgProjectsService","tgXhrErrorService","tgUserActivityService","$interval"],e.prototype.watchSignals=function(){for(var t,e=["admin:project-modules:updated","admin:project-roles:updated","admin:project-default-values:updated","admin:project-values:updated","admin:project-values:move","admin:project-custom-attributes:updated","sprintform:create:success","sprintform:edit:success","sprintform:remove:success","tags:updated"],r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(this.rootScope.$on(t,this.manageProjectSignal));return r},e.prototype.manageProjectSignal=function(t){return this.fetchProject()},e.prototype.cleanProject=function(){return this._project=null,this._activeMembers=Immutable.List(),this._section=null,this._sectionsBreadcrumb=Immutable.List()},e.prototype.autoRefresh=function(){var t,e,r,n=this.interval((t=this,function(){return t.fetchProject()}),6e5);return this.userActivityService.onInactive((e=this,function(){return e.interval.cancel(n)})),this.userActivityService.onActive((r=this,function(){return r.fetchProject(),r.autoRefresh()}))},e.prototype.setSection=function(t){return this._section=t,this._sectionsBreadcrumb=t?this._sectionsBreadcrumb.push(this._section):Immutable.List()},e.prototype.setProject=function(t){return this._project=t,this._activeMembers=this._project.get("members").filter(function(t){return t.get("is_active")})},e.prototype.setProjectBySlug=function(r){return new Promise((n=this,function(e,t){return n.project&&n.project.get("slug")===r?e():n.projectsService.getProjectBySlug(r).then(function(t){return n.setProject(t),e()}).catch(function(t){return n.xhrError.response(t)})}));var n},e.prototype.fetchProject=function(){var t,e;if(this.project)return t=this.project.get("slug"),this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.setProject(t)}))},e.prototype.hasPermission=function(t){return-1!==this._project.get("my_permissions").indexOf(t)},e.prototype.isEpicsDashboardEnabled=function(){return this._project.get("is_epics_activated")},t=e,angular.module("taigaCommon").service("tgProjectService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){return e.__super__.constructor.apply(this,arguments)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.prototype.use=function(t){var e=$("link[rel='stylesheet']:first");return 0===e.length&&(e=$("<link rel='stylesheet' href='' type='text/css'>"),$("head").append(e)),e.attr("href","/"+window._version+"/styles/theme-"+t+".css")},t=e,angular.module("taigaCommon").service("tgThemeService",t)}.call(this),function(){var t;function e(t){if(this.timeout=t,window.localStorage.e2e)return null;window.addEventListener("mousemove",this.resetTimer.bind(this),!1),window.addEventListener("mousedown",this.resetTimer.bind(this),!1),window.addEventListener("keypress",this.resetTimer.bind(this),!1),window.addEventListener("mousewheel",this.resetTimer.bind(this),!1),window.addEventListener("touchmove",this.resetTimer.bind(this),!1),this.subscriptionsActive=[],this.subscriptionsInactive=[],this.isActive=!0,this.startTimer()}this.taiga,this.taiga.groupBy,e.$inject=["$timeout"],e.prototype.idleTimeout=3e5,e.prototype.startTimer=function(){return this.timerId=this.timeout(this._fireInactive.bind(this),this.idleTimeout)},e.prototype.resetTimer=function(){return this.isActive||this._fireActive(),this.timeout.cancel(this.timerId),this.startTimer(),this.isActive=!0},e.prototype.onActive=function(t){return this.subscriptionsActive.push(t),this._unSubscriptionsActive.bind(this,t)},e.prototype.onInactive=function(t){return this.subscriptionsInactive.push(t),this._unSubscriptionsInactive.bind(this,t)},e.prototype._fireActive=function(){return this.subscriptionsActive.forEach(function(t){return t()})},e.prototype._fireInactive=function(){return this.isActive=!1,this.subscriptionsInactive.forEach(function(t){return t()})},e.prototype._unSubscriptionsActive=function(e){return this.subscriptionsActive=this.subscriptionsActive.filter(function(t){return t!==e})},e.prototype._unSubscriptionsInactive=function(e){return this.subscriptionsInactive=this.subscriptionsInactive.filter(function(t){return t!==e})},t=e,angular.module("taigaCommon").service("tgUserActivityService",t)}.call(this),function(){var t,n;function e(t,e){this.currentUserService=t,this.projectService=e}this.taiga,n=this.taiga.normalizeString,e.$inject=["tgCurrentUserService","tgProjectService"],e.prototype.filterUsers=function(t,e){var r=e.full_name_display.toUpperCase();return r=n(r),t=t.toUpperCase(),t=n(t),_.includes(r,t)},e.prototype.searchUsers=function(t,e){var r,n;return this.currentUser=this.currentUserService.getUser(),r=_.clone(this.projectService.activeMembers.toJS(),!0),e&&(r=_.reject(r,{id:e.id})),r=_.sortBy(r,(n=this,function(t){var e;return t.id===(null!=(e=n.currentUser)?e.get("id"):void 0)?0:t.id})),null!=t&&(r=_.filter(r,_.partial(this.filterUsers,t))),r},t=e,angular.module("taigaCommon").service("tgUserListService",t)}.call(this),function(){var t,e,r,i={}.hasOwnProperty;function n(t){this.rs=t,e(this)}r=this.taiga,e=r.bindMethods,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,r.Service),n.$inject=["tgResources"],n.prototype.getUserByUserName=function(t){return this.rs.users.getUserByUsername(t)},n.prototype.getContacts=function(t,e){return this.rs.users.getContacts(t,e)},n.prototype.getLiked=function(t,e,r,n){return this.rs.users.getLiked(t,e,r,n)},n.prototype.getVoted=function(t,e,r,n){return this.rs.users.getVoted(t,e,r,n)},n.prototype.getWatched=function(t,e,r,n){return this.rs.users.getWatched(t,e,r,n)},n.prototype.getStats=function(t){return this.rs.users.getStats(t)},n.prototype.attachUserContactsToProjects=function(t,r){return this.getContacts(t).then(function(e){return r=r.map(function(r){var t=e.filter(function(t){var e=t.get("id");return-1!==r.get("members").indexOf(e)});return r=r.set("contacts",t)})})},t=n,angular.module("taigaCommon").service("tgUserService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.q=t,this.errorHandlingService=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["$q","tgErrorHandlingService"],e.prototype.notFound=function(){return this.errorHandlingService.notfound()},e.prototype.permissionDenied=function(){return this.errorHandlingService.permissionDenied()},e.prototype.response=function(t){return t&&(404===t.status?this.notFound():403===t.status&&this.permissionDenied()),this.q.reject(t)},t=e,angular.module("taigaCommon").service("tgXhrErrorService",t)}.call(this),function(){var t=function(n,i){var t=[".jpg",".jpeg",".bmp",".gif",".png"],o=function(e){return e=e.toLowerCase(),_.some(t,function(t){return-1!==e.indexOf(t,e-t.length)})};return{link:function(t,e){var r=o(t.attachment.get("url"))?n.get("user-timeline/user-timeline-attachment/user-timeline-attachment-image.html"):n.get("user-timeline/user-timeline-attachment/user-timeline-attachment.html");return e.html(r),i(e.contents())(t),e.find("img").error(function(){return this.remove()})},scope:{attachment:"=tgUserTimelineAttachment"}}};t.$inject=["$tgTemplate","$compile"],angular.module("taigaUserTimeline").directive("tgUserTimelineAttachment",t)}.call(this),function(){var t,o;function e(t,e){this.translate=t,this.sce=e}o=this.taiga.unslugify,e.$inject=["$translate","$sce"],e.prototype._fieldTranslationKey={status:"COMMON.FIELDS.STATUS",subject:"COMMON.FIELDS.SUBJECT",description_diff:"COMMON.FIELDS.DESCRIPTION",points:"COMMON.FIELDS.POINTS",assigned_to:"COMMON.FIELDS.ASSIGNED_TO",assigned_users:"COMMON.FIELDS.ASSIGNED_USERS",severity:"ISSUES.FIELDS.SEVERITY",priority:"ISSUES.FIELDS.PRIORITY",type:"ISSUES.FIELDS.TYPE",is_iocaine:"TASK.FIELDS.IS_IOCAINE",is_blocked:"COMMON.FIELDS.IS_BLOCKED",color:"COMMON.FIELDS.COLOR",due_date:"COMMON.FIELDS.DUE_DATE",due_date_reason:"COMMON.FIELDS.DUE_DATE_REASON",milestone:"COMMON.FIELDS.SPRINT"},e.prototype._params={username:function(t,e){var r,n=t.getIn(["data","user"]);return n.get("is_profile_visible")?(r=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:n.get("username")}),this._getLink("user-profile:username=timeline.getIn(['data', 'user', 'username'])",n.get("name"),r)):this._getUsernameSpan(n.get("name"))},field_name:function(t,e){var r=t.getIn(["data","value_diff","key"]);return this.translate.instant(this._fieldTranslationKey[r])},project_name:function(t,e){return this._getLink("project:project=timeline.getIn(['data', 'project', 'slug'])",t.getIn(["data","project","name"]))},new_value:function(t,e){var r,n,i=_.isArray(t.getIn(["data","value_diff","value"]).toJS())?(null===(n=t.getIn(["data","value_diff","value"]).get(1))&&"assigned_to"===t.getIn(["data","value_diff","key"])&&(n=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED")),null===n&&"assigned_users"===t.getIn(["data","value_diff","key"])?n=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED"):"due_date"===t.getIn(["data","value_diff","key"])&&(n=n?(r=this.translate.instant("COMMON.PICKERDATE.FORMAT"),moment(n,"YYYY-MM-DD").format(r)):this.translate.instant("ACTIVITY.VALUES.NOT_SET")),n):t.getIn(["data","value_diff","value"]).first().get(1);return $("<span>").attr("ng-non-bindable",!0).text(i).prop("outerHTML")},sprint_name:function(t,e){return this._getLink("project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])",t.getIn(["data","milestone","name"]))},us_name:function(t,e){var r=this._getTimelineObj(t,e).get("userstory"),n={obj:"parent_userstory"},i=this._getDetailObjUrl(n),o="#"+r.get("ref")+" "+r.get("subject");return this._getLink(i,o)},related_us_name:function(t,e){var r=t.getIn(["data","userstory"]),n="#"+r.get("ref")+" "+r.get("subject");return this._getLink("project-userstories-detail:project=timeline.getIn(['data', 'userstory', 'project', 'slug']),ref=timeline.getIn(['data', 'userstory', 'ref'])",n)},epic_name:function(t,e){var r=t.getIn(["data","epic"]),n="#"+r.get("ref")+" "+r.get("subject");return this._getLink("project-epics-detail:project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['data', 'epic', 'ref'])",n)},obj_name:function(t,e){var r=this._getTimelineObj(t,e),n=this._getDetailObjUrl(e),i="wikipage"===e.obj?o(r.get("slug")):"milestone"===e.obj?r.get("name"):"#"+r.get("ref")+" "+r.get("subject");return this._getLink(n,i)},role_name:function(t,e){return _.escape(t.getIn(["data","value_diff","value"]).keySeq().first())}},e.prototype._translateTitleParams=function(t,e,r){return this._params[t].call(this,e,r)},e.prototype._getTimelineObj=function(t,e){return t.getIn(["data",e.obj])},e.prototype._getDetailObjUrl=function(t){var e={issue:["project-issues-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],wikipage:["project-wiki-page",":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])"],task:["project-tasks-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],parent_userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])"],milestone:["project-taskboard",":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])"],epic:["project-epics-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"]};return e[t.obj][0]+e[t.obj][1]},e.prototype._getLink=function(t,e,r){var n;return n=$("<span>").attr("ng-non-bindable",!0).text(e),$("<a>").attr("tg-nav",t).append(n).prop("outerHTML")},e.prototype._getUsernameSpan=function(t){return $("<span>").addClass("username").text(t).prop("outerHTML")},e.prototype._getParams=function(e,r,t){var n,i={};return t.translate_params.forEach((n=this,function(t){return i[t]=n._translateTitleParams(t,e,r)})),i},e.prototype.getTitle=function(t,e,r){var n,i=this._getParams(t,e,r),o={};return Object.keys(i).forEach(function(t){return o[t]="{{"+t+"}}"}),n=this.translate.instant(r.key,o),Object.keys(i).forEach(function(t){var e="{{"+t+"}}";return n=n.replace(new RegExp(e,"g"),i[t])}),n},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineItemTitle",t)}.call(this),function(){var t;function e(){}e.prototype.getType=function(e,r){var t=[{check:function(t,e){return"membership"===e.obj},key:"TIMELINE.NEW_MEMBER",translate_params:["project_name"],member:function(t){return Immutable.Map({user:t.getIn(["data","user"]),role:t.getIn(["data","role"])})}},{check:function(t,e){return"project"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_PROJECT",translate_params:["username","project_name"],description:function(t){return t.getIn(["data","project","description"])}},{check:function(t,e){return"change"===e.type&&t.hasIn(["data","value_diff"])&&"attachments"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.UPLOAD_ATTACHMENT",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"create"===e.type},key:"TIMELINE.US_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"create"===e.type},key:"TIMELINE.ISSUE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"create"===e.type},key:"TIMELINE.WIKI_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED_WITH_US",translate_params:["username","project_name","obj_name","us_name"]},{check:function(t,e){return"milestone"===e.obj&&"create"===e.type},key:"TIMELINE.MILESTONE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"relateduserstory"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_RELATED_USERSTORY_CREATED",translate_params:["username","project_name","related_us_name","epic_name"]},{check:function(t,e){return t.getIn(["data","comment"])&&"userstory"===e.obj},key:"TIMELINE.NEW_COMMENT_US",translate_params:["username","obj_name"],description:function(t){var e=t.getIn(["data","comment_html"]);return $($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"issue"===e.obj},key:"TIMELINE.NEW_COMMENT_ISSUE",translate_params:["username","obj_name"],description:function(t){var e=t.getIn(["data","comment_html"]);return $($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"task"===e.obj},key:"TIMELINE.NEW_COMMENT_TASK",translate_params:["username","obj_name"],description:function(t){var e=t.getIn(["data","comment_html"]);return $($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"epic"===e.obj},key:"TIMELINE.NEW_COMMENT_EPIC",translate_params:["username","obj_name"],description:function(t){var e=t.getIn(["data","comment_html"]);return $($.parseHTML(e)).text()}},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","backlog_order"])&&"change"===e.type},key:"TIMELINE.US_MOVED",translate_params:["username","obj_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"moveInBacklog"!==t.getIn(["data","value_diff","key"])||"change"!==e.type||"userstory"!==e.obj)&&null===t.getIn(["data","value_diff","value","milestone"]).get(1)},key:"TIMELINE.US_REMOVED_FROM_MILESTONE",translate_params:["username","obj_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&"change"===e.type&&"userstory"===e.obj},key:"TIMELINE.US_ADDED_MILESTONE",translate_params:["username","obj_name","sprint_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!0===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.BLOCKED",translate_params:["username","obj_name"],description:function(t){var e;return!!t.hasIn(["data","value_diff","value","blocked_note_html"])&&(e=t.getIn(["data","value_diff","value","blocked_note_html"]).get(1),$($.parseHTML(e)).text())}},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!1===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.UNBLOCKED",translate_params:["username","obj_name"]},{check:function(t,e){return"milestone"===e.obj&&"change"===e.type},key:"TIMELINE.MILESTONE_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"change"===e.type},key:"TIMELINE.WIKI_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"points"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED_POINTS",translate_params:["username","field_name","obj_name","new_value","role_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type},key:"TIMELINE.US_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.ISSUE_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type},key:"TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED_WITH_US",translate_params:["username","field_name","obj_name","us_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE",translate_params:["username","field_name","obj_name","us_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"color"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_COLOR",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"user"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_USER",translate_params:["username"]}];return _.find(t,function(t){return t.check(e,r)})},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineItemType",t)}.call(this),function(){var t=function(){return{templateUrl:"user-timeline/user-timeline-item/user-timeline-item.html",scope:{timeline:"=tgUserTimelineItem"}}};angular.module("taigaUserTimeline").directive("tgUserTimelineItem",t)}.call(this),function(){var t=function(){var t={generate:function(r){var n,t,i=1,o=Immutable.List();return r.minItems=r.minItems||20,t=function(){return o=Immutable.List(),n()},n=function(){return r.fetch(i).then(function(t){var e;return i++,e=t.get("data"),r.filter&&(e=r.filter(e)),r.map&&(e=e.map(r.map)),(o=o.concat(e)).size<r.minItems&&t.get("next")?n():Immutable.Map({items:o,total:t.get("total"),next:t.get("next")})})},{next:t}}};return t};angular.module("taigaUserTimeline").factory("tgUserTimelinePaginationSequenceService",t)}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t){this.userTimelineService=t,this.timelineList=Immutable.List(),this.scrollDisabled=!1,this.timeline=null,this.projectId?this.timeline=this.userTimelineService.getProjectTimeline(this.projectId):this.currentUser?this.timeline=this.userTimelineService.getProfileTimeline(this.user.get("id")):this.timeline=this.userTimelineService.getUserTimeline(this.user.get("id")),this.loadTimeline()}e=this.taiga,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,(0,this.taiga.mixOf)(e.Controller,e.PageMixin,e.FiltersMixin)),r.$inject=["tgUserTimelineService"],r.prototype.loadTimeline=function(){return this.scrollDisabled=!0,this.timeline.next().then((e=this,function(t){return e.timelineList=e.timelineList.concat(t.get("items")),t.get("next")&&(e.scrollDisabled=!1),e.timelineList}));var e},t=r,angular.module("taigaUserTimeline").controller("UserTimeline",t)}.call(this),function(){var t=function(){return{templateUrl:"user-timeline/user-timeline/user-timeline.html",controller:"UserTimeline",controllerAs:"vm",scope:{projectId:"=projectid",user:"=",currentUser:"="},bindToController:!0}};angular.module("taigaProfile").directive("tgUserTimeline",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r,n){this.rs=t,this.userTimelinePaginationSequenceService=e,this.userTimelineItemType=r,this.userTimelineItemTitle=n}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgUserTimelinePaginationSequenceService","tgUserTimelineItemType","tgUserTimelineItemTitle"],e.prototype._valid_fields=["status","subject","description_diff","assigned_users","assigned_to","points","severity","priority","type","attachments","is_iocaine","content_diff","name","estimated_finish","estimated_start","blocked","moveInBacklog","milestone","color","due_date","due_date_reason"],e.prototype._invalid=[{check:function(t){var e,r=t.get("data").get("value_diff");if(r){if(e=r.get("key"),-1===this._valid_fields.indexOf(e))return!0;if("attachments"===e&&0===r.get("value").get("new").size)return!0}return!1}},{check:function(t){var e=t.get("event_type").split("."),r=t.get("data").get("value_diff");return"change"===e[2]&&void 0===r}},{check:function(t){return"delete"===t.get("event_type").split(".")[2]}},{check:function(t){var e=t.get("event_type").split(".");return"project"===e[1]&&"change"===e[2]}},{check:function(t){return!!t.get("data").get("comment_deleted")}},{check:function(t){var e=t.get("event_type").split("."),r=t.get("data").get("value_diff");return!(!r||"task"!==e[1]||"change"!==e[2]||"milestone"!==r.get("key"))&&t.get("data").get("value_diff").get("value")}}],e.prototype._isInValidTimeline=function(e){return _.some(this._invalid,(r=this,function(t){return t.check.call(r,e)}));var r},e.prototype._parseEventType=function(t){return{section:(t=t.split("."))[0],obj:t[1],type:t[2]}},e.prototype._getTimelineObject=function(t,e){if(t.get("data").get(e.obj))return t.get("data").get(e.obj)},e.prototype._attachExtraInfoToTimelineEntry=function(t,e,r){var n=this.userTimelineItemTitle.getTitle(t,e,r);return t=(t=t.set("title_html",n)).set("obj",this._getTimelineObject(t,e)),r.description&&(t=t.set("description",r.description(t))),r.member&&(t=t.set("member",r.member(t))),"attachments"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","new"])&&(t=t.set("attachments",t.getIn(["data","value_diff","value","new"]))),t},e.prototype._parseTimeline=function(t){var n,o=Immutable.List();return t.get("data").forEach((n=this,function(i){var t,e=n._parseEventType(i.get("event_type")),r=i.get("data").get("values_diff");return r&&r.count()?(r.has("is_blocked")&&(r=Immutable.Map({blocked:r})),r.has("milestone")?r="userstory"===e.obj?Immutable.Map({moveInBacklog:r}):r.deleteIn(["values_diff","milestone"]):"milestone"===e.obj&&(r=Immutable.Map({milestone:r})),r.forEach(function(t,e){var r=Immutable.Map({key:e,value:t}),n=i.setIn(["data","value_diff"],r);return n=n.deleteIn(["data","values_diff"]),o=o.push(n)})):(t=i.deleteIn(["data","values_diff"]),o=o.push(t))})),t.set("data",o)},e.prototype._addEntyAttributes=function(t){var e=this._parseEventType(t.get("event_type")),r=this.userTimelineItemType.getType(t,e);return this._attachExtraInfoToTimelineEntry(t,e,r)},e.prototype.getProfileTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.users.getProfileTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.getUserTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.users.getUserTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.getProjectTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.projects.getTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineService",t)}.call(this),function(){var t=function(){return{link:function(t,e,r){return e.on("click",function(t){return t.stopPropagation()})}}};angular.module("taigaUtils").directive("tgIsolateClick",t)}.call(this),function(){var t=function(){return{templateUrl:"wiki/history/wiki-history-diff.html",scope:{key:"<",diff:"<"}}};angular.module("taigaWikiHistory").directive("tgWikiHistoryDiff",t)}.call(this),function(){var t=function(){return{link:function(t,e,r){return t.singleHistoryEntry=t.historyEntry.toJS()},templateUrl:"wiki/history/wiki-history-entry.html",scope:{historyEntry:"<"}}};angular.module("taigaWikiHistory").directive("tgWikiHistoryEntry",t)}.call(this),function(){var t,n;function e(t){var e,r;this.activityService=t,n.defineImmutableProperty(this,"historyEntries",(e=this,function(){return e.activityService.entries})),n.defineImmutableProperty(this,"disablePagination",(r=this,function(){return r.activityService.disablePagination})),this.toggle=!1}n=this.taiga,t=angular.module("taigaWikiHistory"),e.$inject=["tgActivityService"],e.prototype.initializeHistory=function(t){return t&&this.activityService.init("wiki",t),this.loadHistory()},e.prototype.loadHistory=function(){return this.activityService.fetchEntries()},e.prototype.nextPage=function(){return this.activityService.nextPage()},t.controller("WikiHistoryCtrl",e)}.call(this),function(){var i=this.taiga.bindOnce,t=function(){return{scope:{},bindToController:{wikiId:"<"},controller:"WikiHistoryCtrl",controllerAs:"vm",templateUrl:"wiki/history/wiki-history.html",link:function(t,e,r,n){return i(t,"vm.wikiId",function(t){return n.initializeHistory(t)})}}};angular.module("taigaWikiHistory").directive("tgWikiHistory",t)}.call(this);
//# sourceMappingURL=maps/app.js.map
